try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b61bdce6-c5b7-4a6b-947a-eef7910ca355",e._sentryDebugIdIdentifier="sentry-dbid-b61bdce6-c5b7-4a6b-947a-eef7910ca355")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.01.28-fd13201"}}catch(e){}}(),exports.id=348,exports.ids=[348],exports.modules={"./src/always-approve-decision-provider.ts":(e,t,s)=>{s.d(t,{I:()=>n});class n{requestApproval(e){return Promise.resolve({approved:!0})}}},"./src/commands/custom-commands.ts":(e,t,s)=>{s.d(t,{FD:()=>u,H8:()=>d,jI:()=>c});var n=s("node:fs/promises"),o=s("node:os"),i=s("node:path"),r=s("../proto/dist/generated/aiserver/v1/dashboard_pb.js"),a=s("./src/debug.ts"),l=function(e,t,s,n){return new(s||(s=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};function d(e,t){const s=t.join(" ");let n=e,o=!1;n.includes("$ARGUMENTS")&&(o=!0,n=n.replace(/\$ARGUMENTS/g,s));const i=/(?<!\w)\$(\d{1,2})\b/g;return i.test(n)&&(o=!0,i.lastIndex=0,n=n.replace(i,((e,s)=>{const n=parseInt(s,10);return n>0&&n<=t.length?t[n-1]:""}))),{result:n,hadPlaceholders:o}}function c(e,t){return{fullMessage:t?`${t} ${e} `:`${e} `,displayText:t?`${t} ${e}`:e}}class u{constructor(e,t=()=>!0){this.commands=new Map,this.skills=new Map,this.dashboardClient=e,this.getThirdPartyExtensibilityEnabled=t}loadCommands(e,t){return l(this,void 0,void 0,(function*(){var s;const n=null===(s=null==t?void 0:t.includeSkills)||void 0===s||s;this.commands.clear(),this.skills.clear();const r=this.getThirdPartyExtensibilityEnabled();yield this.loadTeamCommands(),r&&(yield this.loadCommandsFromDirectory((0,i.join)(e,".claude","commands"),"claude-workspace")),yield this.loadCommandsFromDirectory((0,i.join)(e,".cursor","commands"),"workspace"),r&&(yield this.loadCommandsFromDirectory((0,i.join)((0,o.homedir)(),".claude","commands"),"claude-user")),yield this.loadCommandsFromDirectory((0,i.join)((0,o.homedir)(),".cursor","commands"),"user"),yield this.loadSkillsFromDirectory((0,i.join)((0,o.homedir)(),".cursor","skills-cursor"),"builtin"),yield this.loadSkillsFromDirectory((0,i.join)(e,".cursor","skills"),"workspace"),yield this.loadSkillsFromDirectory((0,i.join)((0,o.homedir)(),".cursor","skills"),"user");const a=Array.from(this.commands.values()).map((e=>this.convertToSlashCommand(e)));if(!n)return a;const l=Array.from(this.skills.values()).map((e=>this.convertSkillToSlashCommand(e)));return[...a,...l]}))}findSkillReferences(e){const t=[],s=new Set,n=e.matchAll(/(?:^|\s)\/([a-zA-Z0-9_-]{1,30})/g);for(const e of n){const n=e[1];if(n&&!s.has(n)){const e=this.getSkillById(n);e&&(t.push(e),s.add(n))}}return{skills:t,cleanedMessage:e}}loadCommandsFromDirectory(e,t){return l(this,void 0,void 0,(function*(){if(!(yield this.exists(e)))return;const s=(yield this.readDirectory(e)).filter((e=>!e.isDirectory&&e.name.endsWith(".md")));for(const e of s){const s=yield this.readTextFile(e.path);if(!s)continue;const n=this.parseMarkdownCommand(e.name,s,t);n&&this.commands.set(n.id,n)}}))}loadSkillsFromDirectory(e,t){return l(this,void 0,void 0,(function*(){if(!(yield this.exists(e)))return;const s=(yield this.readDirectory(e)).filter((e=>e.isDirectory));for(const e of s){const s=(0,i.join)(e.path,"SKILL.md");if(yield this.exists(s)){const n=yield this.readTextFile(s);if(!n)continue;const o=this.parseSkillMarkdown(e.name,n,t,s);o&&this.skills.set(o.id,o)}}}))}parseSkillMarkdown(e,t,s,n){if(!e.trim())return null;let o=e,i="";const r=t.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(r){const e=r[1],t=e.match(/^name:\s*(.+)$/m),s=e.match(/^description:\s*(.+)$/m);t&&(o=t[1].trim()),s&&(i=s[1].trim())}if(!i){const e=t.split("\n");for(const t of e)if(t.startsWith("#")){const e=t.replace(/^#+\s*/,"").trim();if(e){i=e;break}}else if(t.trim()&&!t.startsWith("---")){i=t.trim();break}}return{id:e,title:o,description:i||o,content:t.trim(),source:s,path:n}}parseMarkdownCommand(e,t,s){const n=e.replace(/\.md$/,"");if(!n.trim())return null;const o=t.split("\n"),i=this.extractTitle(o[0])||n;return{id:n,title:i,description:i,content:t.trim(),source:s,filename:e}}extractTitle(e){if(!e)return null;const t=e.match(/^#+\s*(.+)$/);if(t)return t[1].trim();return e.trim()||null}convertToSlashCommand(e){const t=this.getScopeIndicator(e.source);return{id:e.id,title:e.title,description:`${e.description} ${t}`,inline:!0,run:(t,s,n)=>{var o,i,r,a;const l=null!==(i=null===(o=n.getPromptPrefix)||void 0===o?void 0:o.call(n))&&void 0!==i?i:"",c=s||[],u=c.join(" ").trim(),{result:h,hadPlaceholders:m}=d(e.content,c);let p;p=m?h:u?`${e.content}\n\n${u}`:e.content;const f=l?`${l}\n\n${p}`:p,g=u?`/${e.id} ${u}`:`/${e.id}`,v=l?`${l} ${g}`:g;n.submitMessage?(null===(r=n.clearInput)||void 0===r||r.call(n),n.submitMessage(f,{display:v})):(null===(a=n.clearInput)||void 0===a||a.call(n),n.insertText(f))}}}convertSkillToSlashCommand(e){const t=this.getSkillScopeIndicator(e.source);return{id:e.id,title:e.title,description:`${e.description} ${t}`,inline:!0,run:(t,s,n)=>{var o,i,r,a,l,d;const u=null!==(i=null===(o=n.getPromptPrefix)||void 0===o?void 0:o.call(n))&&void 0!==i?i:"",h=null!==(r=null==s?void 0:s.join(" ").trim())&&void 0!==r?r:"",m=`/${e.id}`,p=[u,h].filter(Boolean).join(" "),{fullMessage:f,displayText:g}=c(m,p);null===(a=n.clearInput)||void 0===a||a.call(n),null===(l=n.hidePalette)||void 0===l||l.call(n),null===(d=n.submitMessage)||void 0===d||d.call(n,f.trim(),{display:g})}}}getScopeIndicator(e){switch(e){case"team":return"(team)";case"workspace":case"claude-workspace":return"(project)";case"user":case"claude-user":return"(user)";default:return""}}getSkillScopeIndicator(e){switch(e){case"workspace":return"(project skill)";case"user":return"(user skill)";case"builtin":return"(builtin skill)";default:return"(skill)"}}exists(e){return l(this,void 0,void 0,(function*(){try{return yield(0,n.stat)(e),!0}catch(e){return!1}}))}readDirectory(e){return l(this,void 0,void 0,(function*(){try{return(yield(0,n.readdir)(e,{withFileTypes:!0})).map((t=>({path:(0,i.join)(e,t.name),name:t.name,isDirectory:t.isDirectory()})))}catch(e){return[]}}))}readTextFile(e){return l(this,void 0,void 0,(function*(){try{const t=yield(0,n.stat)(e);return t.size>1048576?((0,a.debugLog)(`Skipping large file (${t.size} bytes): ${e}`),null):yield(0,n.readFile)(e,"utf-8")}catch(e){return null}}))}getLoadedCommands(){return Array.from(this.commands.values())}getCommandById(e){return this.commands.get(e)}getSkillById(e){return this.skills.get(e)}slugify(e){return e.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}loadTeamCommands(){return l(this,void 0,void 0,(function*(){try{if(!(yield this.dashboardClient.getMe(new r.GetMeRequest({}))).teamId)return void(0,a.debugLog)("User does not belong to a team, skipping team commands");const e=yield this.dashboardClient.getTeamCommands(new r.GetTeamCommandsRequest({activeOnly:!0}));for(const t of e.commands){if(!t.isActive)continue;const e={id:this.slugify(t.name),title:t.name,description:t.description||t.content.trim(),content:t.content,source:"team",filename:t.name};this.commands.has(e.id)||this.commands.set(e.id,e)}(0,a.debugLog)("Loaded team commands:",e.commands.length)}catch(e){(0,a.debugLog)("Failed to load team commands:",e)}}))}}},"./src/hang-detection.ts":(e,t,s)=>{s.d(t,{Dy:()=>c,M4:()=>u,ln:()=>l});var n=s("../../node_modules/.pnpm/@sentry+core@10.1.0/node_modules/@sentry/core/build/esm/currentScopes.js"),o=s("../../node_modules/.pnpm/@sentry+core@10.1.0/node_modules/@sentry/core/build/esm/exports.js"),i=s("./src/instrument.ts");let r,a;function l(e){r=Object.assign(Object.assign({},r),e)}function d(e){if(!e)return{};const t={};for(const[s,n]of Object.entries(e))t[`handler_${s}_state`]=n.state,t[`handler_${s}_duration_ms`]=n.durationMs,n.error&&(t[`handler_${s}_error`]=n.error);return t}function c(e,t="warning"){if(!(0,i.Fj)())return;const{category:s,waitingFor:l,lastActivityAgoMs:d,lastActivityType:c,requestId:u,conversationId:h,modelName:m,actionType:p,heartbeatsOnly:f,lastHeartbeatAgoMs:g,streamOpen:v,extra:y}=e,b=r,w=(a||(a={os_platform:"linux",os_arch:"x64",node_version:process.version}),a),M=(null==b?void 0:b.conversationCreatedAt)?Date.now()-b.conversationCreatedAt:void 0,_=function(e){const{category:t,waitingFor:s,lastActivityAgoMs:n}=e,o=void 0!==n?Math.round(n/1e3):void 0,i=void 0!==o?` - ${o}s`:"";switch(t){case"stream_stall":return`CLI hang: Stream stall detected - no activity for ${o}s while waiting for ${s}`;case"stream_stall_heartbeat_only":return`CLI hang: Stream receiving heartbeats only - no meaningful data for ${o}s while waiting for ${s}`;case"exec_pending":return`CLI hang: Tool execution pending - no result for ${o}s`;case"model_init":return`CLI hang: Model initialization stalled - no response for ${o}s`;case"queue_processing":return`CLI hang: Message queue not processing${i} - pending messages in queue`;case"background_composer":return`CLI hang: Background composer stalled - no messages for ${o}s`;default:return`CLI hang: Unknown hang type (${t})${i}`}}(e),I=new Error(_);I.name="CLIHangDetected",n.v4((e=>{e.setFingerprint(["cli-hang",s,l]),e.setLevel(t),e.setTag("hang.category",s),e.setTag("hang.waiting_for",l),p&&e.setTag("hang.action_type",p),m&&e.setTag("hang.model_name",m),f&&e.setTag("hang.heartbeats_only","true"),(null==b?void 0:b.agentMode)&&e.setTag("hang.agent_mode",b.agentMode),(null==b?void 0:b.isHeadless)&&e.setTag("hang.is_headless","true"),e.setContext("hang_details",Object.assign({category:s,waiting_for:l,last_activity_ago_ms:d,last_activity_type:c,request_id:u,conversation_id:null!=h?h:null==b?void 0:b.conversationId,model_name:m,action_type:p,heartbeats_only:f,last_heartbeat_ago_ms:g,stream_open:v},y)),e.setContext("conversation",{turn_count:null==b?void 0:b.turnCount,conversation_age_ms:M,conversation_created_at:null==b?void 0:b.conversationCreatedAt,agent_mode:null==b?void 0:b.agentMode,checkpoints_enabled:null==b?void 0:b.checkpointsEnabled,is_headless:null==b?void 0:b.isHeadless,background_composer_attached:null==b?void 0:b.backgroundComposerAttached,background_composer_id:null==b?void 0:b.backgroundComposerId}),e.setContext("system",w),o.Cp(I)}))}function u(e,t){const s="string"==typeof t?{actionType:t}:null!=t?t:{};return t=>{(0,i.Fj)()&&c({category:"heartbeat_only"===t.type?"stream_stall_heartbeat_only":"stream_stall",waitingFor:"any_stream_activity",lastActivityAgoMs:"heartbeat_only"===t.type?t.lastMeaningfulActivityAgoMs:t.lastActivityAgoMs,lastActivityType:t.lastActivityType,requestId:t.requestId,conversationId:e,modelName:t.modelName,actionType:s.actionType,heartbeatsOnly:"heartbeat_only"===t.type,lastHeartbeatAgoMs:t.lastServerHeartbeatAgoMs,streamOpen:!t.streamEnded,extra:Object.assign({lastMeaningfulActivityAgoMs:t.lastMeaningfulActivityAgoMs,lastInboundMessageType:t.lastInboundMessageType,lastOutboundMessageType:t.lastOutboundMessageType,aborted:t.aborted,lastClientHeartbeatAgoMs:t.lastClientHeartbeatAgoMs,thresholdMs:t.thresholdMs,execId:s.execId},d(t.handlers))},"warning")}}},"./src/models/index.ts":(e,t,s)=>{s.d(t,{P3:()=>d});var n=s("./src/console-io.ts"),o=s("./src/debug.ts"),i=s("./src/hang-detection.ts"),r=s("./src/models/model-service.ts"),a=s("./src/models/model-utils.ts"),l=function(e,t,s,n){return new(s||(s=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class d{constructor(){this.availableModels=[],this.aliasMap=new Map,this.listeners=new Set}static init(e,t){return l(this,void 0,void 0,(function*(){const s=new d;return s.models=s.initializeModels(e,t),t.initialModel&&(yield s.models),s}))}initializeModels(e,t){return l(this,void 0,void 0,(function*(){const s=Date.now(),n=setTimeout((()=>{(0,i.Dy)({category:"model_init",waitingFor:"model_fetch_response",lastActivityAgoMs:Date.now()-s,extra:{initialModel:t.initialModel}},"warning")}),3e4);try{const{availableModels:s,defaultModel:o}=yield(0,r.aC)(e);clearTimeout(n),s&&(this.availableModels=s,this.buildAliasMap(s));const i=yield this.selectModel({options:t,defaultModel:o,availableModels:this.availableModels});if(!i)throw new Error("No model found. Please check your model settings.");return this.currentModel=i,this.notifyListeners(),i}catch(e){throw clearTimeout(n),e}}))}selectModel(e){return l(this,void 0,void 0,(function*(){var t;const{options:s,defaultModel:n,availableModels:o}=e,i=s.configProvider.get(),r=e=>{if((0,a.B)(e))return e;if(!0===i.maxMode){const t=(0,a.U)(e);return t.maxMode=!0,t}return e};if(s.initialModel)return r(yield this.handleInitialModel(s.initialModel,s.configProvider));if(!n)return i.model?r(i.model):i.model;if(!i.hasChangedDefaultModel||(null===(t=i.model)||void 0===t?void 0:t.modelId)===n.modelId){const e=r(n);return yield this.updateConfig(s.configProvider,e,!1),e}const l=o.some((e=>{var t;return e.modelId===(null===(t=i.model)||void 0===t?void 0:t.modelId)}));if(l&&i.model)return r(i.model);const d=r(n);return yield this.updateConfig(s.configProvider,d,!1),d}))}handleInitialModel(e,t){return l(this,void 0,void 0,(function*(){let s=this.normalizeModelId(e);return s||(e.startsWith("GENERICBASE")?s={modelId:e,displayModelId:e,displayName:e,displayNameShort:e}:(0,n.uQ)(1,`Cannot use this model: ${e}. Available models: ${this.availableModels.map((e=>e.displayModelId)).join(", ")}`)),yield this.updateConfig(t,s,!0),s}))}updateConfig(e,t,s){return l(this,void 0,void 0,(function*(){const n=e.get().maxMode,o=(0,a.B)(t)?n:!0===t.maxMode;yield e.transform((e=>Object.assign(Object.assign({},e),{model:t,hasChangedDefaultModel:s,maxMode:o})))}))}setCurrentModel(e,t){return l(this,void 0,void 0,(function*(){var s,n;if(yield this.awaitCurrentModel(),!(null!==(n=null===(s=e.modelId)||void 0===s?void 0:s.startsWith("GENERICBASE"))&&void 0!==n&&n||this.availableModels.some((t=>t.modelId===e.modelId))))return;const o=t.get().maxMode,i=(0,a.B)(e)?o:!0===e.maxMode;yield t.transform((t=>Object.assign(Object.assign({},t),{model:e,hasChangedDefaultModel:!0,maxMode:i}))),this.currentModel=e,this.notifyListeners()}))}getCurrentModel(){return this.currentModel}awaitCurrentModel(){return l(this,void 0,void 0,(function*(){if(this.models&&(yield this.models),!this.currentModel)throw new Error("We had an issue initializing the model. Please try again.");return this.currentModel}))}getAvailableModels(){return this.availableModels}awaitAvailableModels(){return l(this,void 0,void 0,(function*(){return yield this.awaitCurrentModel(),this.availableModels}))}normalizeModelId(e){return this.aliasMap.get(e.toLowerCase())}setCurrentModelWithoutPersistence(e){this.currentModel=e,this.notifyListeners()}setModelFromStoredId(e,t){return l(this,void 0,void 0,(function*(){if(!e||"string"!=typeof e)return(0,o.debugLog)("No stored model ID to restore"),!1;const s=t.get(),n=(yield this.awaitAvailableModels()).find((t=>t.modelId===e)),i=e=>{if((0,a.B)(e))return e;if(!0===s.maxMode){const t=(0,a.U)(e);return t.maxMode=!0,t}return e};if(n){const e=i(n);return yield this.setCurrentModel(e,t),!0}if(e.startsWith("GENERICBASE")){const s=i({modelId:e,displayModelId:e,displayName:e,displayNameShort:e});return yield this.setCurrentModel(s,t),!0}return(0,o.debugLog)(`Could not find model with ID: ${e} in available models`),!1}))}buildAliasMap(e){var t;const s=new Map;for(const n of e)if(n.modelId){s.set(n.modelId.toLowerCase(),n),s.set(n.displayModelId.toLowerCase(),n),n.displayName&&s.set(n.displayName.toLowerCase(),n),n.displayNameShort&&s.set(n.displayNameShort.toLowerCase(),n);for(const e of null!==(t=n.aliases)&&void 0!==t?t:[])s.set(e.toLowerCase(),n)}this.aliasMap=s}subscribe(e){return this.listeners.add(e),e(this.currentModel),()=>{this.listeners.delete(e)}}notifyListeners(){for(const e of this.listeners)e(this.currentModel)}static createForTesting(){const e=new d;return e.models=Promise.resolve(void 0),e}}},"./src/models/model-service.ts":(e,t,s)=>{s.d(t,{aC:()=>a});var n=s("../proto/dist/generated/agent/v1/agent_service_pb.js"),o=s("./src/debug.ts"),i=s("./src/utils/error-info.ts"),r=function(e,t,s,n){return new(s||(s=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};function a(e){return r(this,void 0,void 0,(function*(){const[t,s]=yield Promise.allSettled([l(e),d(e)]),n={};return"fulfilled"===t.status&&t.value?n.availableModels=t.value:"rejected"===t.status&&(0,o.debugLogJSON)("models.fetchUsableModels.error",(0,i.q)(t.reason),"ERROR"),"fulfilled"===s.status&&s.value?n.defaultModel=s.value:"rejected"===s.status&&(0,o.debugLogJSON)("models.fetchDefaultModel.error",(0,i.q)(s.reason),"ERROR"),n}))}function l(e){return r(this,void 0,void 0,(function*(){const{models:t}=yield e.getUsableModels(new n.KD({}));return t.length>0?t:void 0}))}function d(e){return r(this,void 0,void 0,(function*(){const{model:t}=yield e.getDefaultModelForCli(new n.Tu({}));return t}))}},"./src/models/model-utils.ts":(e,t,s)=>{function n(e){var t;return"default"===e.modelId||"auto"===e.displayModelId||"auto"===(null===(t=e.displayName)||void 0===t?void 0:t.toLowerCase())}function o(e){return"function"==typeof e.clone?e.clone():{modelId:e.modelId,displayModelId:e.displayModelId,displayName:e.displayName,displayNameShort:e.displayNameShort,maxMode:e.maxMode}}s.d(t,{B:()=>n,U:()=>o})},"./src/state/index.ts":(e,t,s)=>{s.d(t,{r:()=>r});var n=s("node:crypto"),o=s("node:path"),i=s("../cursor-config/dist/index.js");function r(){const e=(0,n.createHash)("md5").update(process.cwd()).digest("hex");return(0,o.join)((0,i.WI)(),"chats",e)}},"./src/state/session.ts":(e,t,s)=>{s.d(t,{d:()=>o});const n=Object.seal({lastRequest:null}),o=Object.seal({get lastRequest(){return n.lastRequest},recordLastRequest(e,t){const s={id:e,timestamp:Date.now(),path:null==t?void 0:t.path};n.lastRequest=s},getLastRequestId(){var e,t;return null!==(t=null===(e=n.lastRequest)||void 0===e?void 0:e.id)&&void 0!==t?t:null},getLastRequest:()=>n.lastRequest,clearLastRequest(){n.lastRequest=null}})},"./src/state/sqlite-blob-store.ts":(e,t,s)=>{s.d(t,{M:()=>h});var n=s("node:fs"),o=s("node:path"),i=s("../agent-kv/dist/index.js"),r=s("../utils/dist/index.js"),a=s("../../node_modules/.pnpm/sqlite3@5.1.7_patch_hash=aee4b045019cd42c3fc35610736c4496fa74db4d4a28d55c814724e29047da6a/node_modules/sqlite3/lib/sqlite3.js"),l=s.n(a),d=function(e,t,s,n){return new(s||(s=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};const c=new i.aY;class u extends l().Database{}class h extends r.jG{static initAndLoad(e){return d(this,void 0,void 0,(function*(){const t=new h(e);return yield t.getDb(),t}))}constructor(e){super(),this.dbPath=e,this.listeners={agentId:new Set,latestRootBlobId:new Set,name:new Set,createdAt:new Set,mode:new Set,lastUsedModel:new Set},this.isPersisting=!1,this.persistQueued=!1,this.isDisposing=!1,this.inFlightOps=0;const t=(0,o.basename)((0,o.dirname)(this.dbPath));this.metadata=(0,i.sh)(t)}getDb(){return d(this,void 0,void 0,(function*(){return this.dbPromise||(this.dbPromise=new Promise(((e,t)=>{const s=(0,o.dirname)(this.dbPath);(0,n.existsSync)(s)||(0,n.mkdirSync)(s,{recursive:!0});const r=new u(this.dbPath,(s=>{s?t(s):r.serialize((()=>{r.run("PRAGMA journal_mode = WAL"),r.run("PRAGMA synchronous = NORMAL"),r.run("PRAGMA user_version = 1"),r.run("CREATE TABLE IF NOT EXISTS blobs (id TEXT PRIMARY KEY, data BLOB)"),r.run("CREATE TABLE IF NOT EXISTS meta (key TEXT PRIMARY KEY, value TEXT)",(s=>{s?t(s):r.get("SELECT value FROM meta WHERE key = ?","0",((s,n)=>{if(s)t(s);else{if(null==n?void 0:n.value){const e=(0,i.aD)(n.value);this.metadata=c.deserialize(e)}else{const e=c.serialize(this.metadata),t=(0,i.nj)(e);r.run("INSERT OR REPLACE INTO meta (key, value) VALUES (?, ?)","0",t)}e(r)}}))}))}))}))}))),this.dbPromise}))}getBlob(e,t){return d(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),s=(0,i.nj)(t);return yield new Promise(((t,n)=>{e.get("SELECT data FROM blobs WHERE id = ?",s,((e,s)=>{e?n(e):s&&null!=s.data?t(new Uint8Array(s.data)):t(void 0)}))}))}finally{this.inFlightOps--}}}))}setBlob(e,t,s){return d(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),n=(0,i.nj)(t);return yield new Promise(((t,o)=>{e.run("INSERT OR REPLACE INTO blobs (id, data) VALUES (?, ?)",n,Buffer.from(s),(e=>{e?o(e):t()}))}))}finally{this.inFlightOps--}}}))}setBlobLocallyOnly(e,t,s){return d(this,void 0,void 0,(function*(){return Promise.resolve()}))}flush(e){return d(this,void 0,void 0,(function*(){return Promise.resolve()}))}get(e){return this.metadata[e]}valuesEqual(e,t,s){if("latestRootBlobId"===e){const e=t,n=s;if(e===n)return!0;if(!e||!n)return!1;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}return t===s}schedulePersist(){this.dbPromise&&(this.isDisposing||(this.isPersisting?this.persistQueued=!0:(this.isPersisting=!0,this.persistMetadata().finally((()=>{this.isPersisting=!1,this.persistQueued&&(this.persistQueued=!1,this.schedulePersist())})))))}set(e,t){const s=this.metadata[e];if(this.valuesEqual(e,s,t))return;this.metadata=Object.assign(Object.assign({},this.metadata),{[e]:t}),this.dbPromise&&this.schedulePersist();const n=this.listeners[e];n&&n.size>0&&queueMicrotask((()=>{n.forEach((e=>{e()}))}))}persistMetadata(){return d(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),t=c.serialize(this.metadata),s=(0,i.nj)(t);return yield new Promise(((t,n)=>{e.run("INSERT OR REPLACE INTO meta (key, value) VALUES (?, ?)","0",s,(e=>{e?n(e):t()}))}))}finally{this.inFlightOps--}}}))}subscribe(e,t){const s=this.listeners[e];return s?(s.add(t),()=>s.delete(t)):()=>{}}dispose(){return d(this,void 0,void 0,(function*(){return this.disposePromise?this.disposePromise:this.dbPromise?(this.disposePromise=this.cleanup().then((()=>{this.dbPromise=void 0})),this.disposePromise):void 0}))}cleanup(){return d(this,void 0,void 0,(function*(){if(!this.dbPromise)return;for(this.isDisposing=!0,this.persistQueued=!1;this.isPersisting||this.inFlightOps>0;)yield new Promise((e=>setTimeout(e,10)));const e=yield this.dbPromise,t=yield new Promise(((t,s)=>{e.get("SELECT value FROM meta WHERE key = ?","0",((e,n)=>{e?s(e):t(n)}))}));let s=0;if(null==t?void 0:t.value){const e=(0,i.aD)(t.value);s=c.deserialize(e).latestRootBlobId.length}if(yield new Promise((t=>{e.close((()=>t()))})),0!==s);else{this.dbPromise=void 0;const e=(0,o.dirname)(this.dbPath);try{(0,n.rmSync)(e,{recursive:!0,force:!0})}catch(e){}}}))}}},"./src/team-hooks-sync.ts":(e,t,s)=>{s.d(t,{O:()=>d,a:()=>u});var n=s("node:fs/promises"),o=s("node:os"),i=s("node:path"),r=s.n(i),a=s("../proto/dist/generated/aiserver/v1/dashboard_pb.js"),l=function(e,t,s,n){return new(s||(s=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};function d(e,t,s){return Object.assign(Object.assign({},e),{teamHooks:t,configDirs:Object.assign(Object.assign({},e.configDirs),{team:s})})}function c(){return"win32"===(0,o.platform)()}function u(e){return l(this,void 0,void 0,(function*(){var t,s,i,l;const{dashboardClient:d,teamId:u}=e;try{const e=function(){switch((0,o.platform)()){case"darwin":return"Macintosh";case"win32":return"Windows";default:return"Linux"}}(),h=r().join((0,o.homedir)(),".cursor","managed",`team_${u}`,"hooks"),m=(null!==(t=(yield d.getTeamHooks(new a.GetTeamHooksRequest({activeOnly:!0}))).hooks)&&void 0!==t?t:[]).filter((t=>t.operatingSystems&&t.operatingSystems.length>0&&t.operatingSystems.includes(e)));yield(0,n.mkdir)(h,{recursive:!0});const p=new Set,f={};for(const e of m){let t=r().basename(e.scriptName||`team-hook-${e.id}`);c()&&(t.endsWith(".ps1")||t.endsWith(".bat")||t.endsWith(".cmd")||(t=`${t}.ps1`));const o=r().extname(t),a=o.length>0?t.slice(0,-o.length):t;let d=t,u=1;for(;p.has(d);)d=`${a}-${e.id}-${u}${o}`,u+=1;const m=r().join(h,d),g=null!==(s=e.scriptContent)&&void 0!==s?s:"";try{yield(0,n.writeFile)(m,g,"utf-8"),c()||(yield(0,n.chmod)(m,493)),p.add(d);const t=null!==(i=e.hookStep)&&void 0!==i?i:"beforeShellExecution",s=null!==(l=f[t])&&void 0!==l?l:[];s.push({command:m}),f[t]=s}catch(e){console.warn(`[team-hooks-sync] Failed to write ${t}:`,e)}}const g={version:1,hooks:f};try{const e=yield(0,n.readdir)(h,{withFileTypes:!0});for(const t of e)if(t.isFile()&&!p.has(t.name))try{yield(0,n.rm)(r().join(h,t.name))}catch(e){}}catch(e){}return{teamHooks:g,teamDir:h}}catch(e){return console.warn("Team hooks fetch/prepare failed; continuing without team hooks",e),null}}))}},"./src/tracing.ts":(e,t,s)=>{s.d(t,{H:()=>m});var n=s("node:os"),o=s.n(n),i=s("../../node_modules/.pnpm/@opentelemetry+api@1.9.0/node_modules/@opentelemetry/api/build/esm/diag-api.js"),r=s("../../node_modules/.pnpm/@opentelemetry+api@1.9.0/node_modules/@opentelemetry/api/build/esm/diag/types.js"),a=s("../../node_modules/.pnpm/@opentelemetry+exporter-trace-otlp-proto@0.203.0_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/exporter-trace-otlp-proto/build/esm/platform/node/OTLPTraceExporter.js"),l=s("../../node_modules/.pnpm/@opentelemetry+resources@2.0.1_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/resources/build/esm/ResourceImpl.js"),d=s("../../node_modules/.pnpm/@opentelemetry+sdk-node@0.203.0_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/sdk-node/build/src/index.js"),c=s("./src/debug.ts"),u=function(e,t,s,n){return new(s||(s=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};let h=!1;function m(e){return u(this,void 0,void 0,(function*(){if(h)return;const t={verbose:(...e)=>{(0,c.debugLog)("otel.verbose",...e)},debug:(...e)=>{(0,c.debugLog)("otel.debug",...e)},info:(...e)=>{(0,c.debugLog)("otel.info",...e)},warn:(...e)=>{(0,c.debugLog)("otel.warn",...e)},error:(...e)=>{(0,c.debugLog)("otel.error",...e)}};let s;i.s.setLogger(t,r.u.ERROR);try{s=e?yield function(e){return u(this,void 0,void 0,(function*(){const t=e.backendUrl,s=yield e.credentialManager.getAccessToken();if(!s)throw new Error("No access token found for tracing exporter");const n={authorization:`Bearer ${s}`,"x-ghost-mode":(()=>{var t,s;try{const n=null===(s=null===(t=e.configProvider)||void 0===t?void 0:t.get().privacyCache)||void 0===s?void 0:s.ghostMode;return"boolean"!=typeof n||n}catch(e){return!0}})()?"true":"false","x-cursor-client-version":"agent-cli"},o=`${t}/v1/traces`;return new a.Q({url:o,headers:n})}))}(e):void 0}catch(e){return void(0,c.debugLog)("Failed to create OpenTelemetry exporter",e)}const n=e?function(e){var t,s,n;const i=o().platform(),r=o().arch(),a=o().release(),d=process.version,c=null!==(t="2026.01.28-fd13201")?t:"unknown",u=o().hostname();return(0,l.QZ)({"service.name":null!==(s=e.serviceName)&&void 0!==s?s:"cursor-agent-cli","service.version":null!==(n=e.serviceVersion)&&void 0!==n?n:c,"host.name":u,"os.type":i,"os.version":a,"process.runtime.name":"node","process.runtime.version":d,"client.os.platform":i,"client.os.release":a,"client.arch":r,"client.node.version":d,"client.cli.version":c})}(e):void 0,m=new d.P({autoDetectResources:!1,traceExporter:s,resource:n});try{m.start()}catch(e){(0,c.debugLog)("Failed to start OpenTelemetry SDK",e)}const p=()=>{m.shutdown().catch((e=>{(0,c.debugLog)("Error shutting down OpenTelemetry SDK",e)}))};process.once("beforeExit",p),process.once("SIGTERM",p),process.once("SIGINT",p),h=!0}))}},"./src/utils/clipboard.ts":(e,t,s)=>{s.d(t,{e:()=>r});var n=s("node:child_process"),o=(s("node:fs"),s("node:os")),i=(s("node:path"),s("./src/debug.ts"),function(e,t,s,n){return new(s||(s=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))});function r(e){return i(this,void 0,void 0,(function*(){if("darwin"===(0,o.platform)())try{const t=(0,n.spawn)("pbcopy");return t.stdin.write(e),t.stdin.end(),yield new Promise((e=>t.on("close",(()=>e())))),!0}catch(e){return!1}else if("linux"===(0,o.platform)())try{const t=(0,n.spawn)("xclip",["-selection","clipboard"]);return t.stdin.write(e),t.stdin.end(),yield new Promise((e=>t.on("close",(()=>e())))),!0}catch(e){return!1}else if("win32"===(0,o.platform)())try{const t=(0,n.spawn)("C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",["-c","[Console]::InputEncoding = [System.Text.Encoding]::UTF8; $input | Set-Clipboard"]);return t.stdin.write(e,"utf8"),t.stdin.end(),yield new Promise((e=>t.on("close",(()=>e())))),!0}catch(e){return!1}return!1}))}},"./src/utils/interaction-responses.ts":(e,t,s)=>{s.d(t,{l:()=>r});var n=s("../proto/dist/generated/agent/v1/ask_question_tool_pb.js"),o=s("../proto/dist/generated/agent/v1/create_plan_tool_pb.js"),i=s("../proto/dist/generated/agent/v1/setup_vm_environment_tool_pb.js");const r=(e,t)=>{var s;switch(e.type){case"web-search-request":case"web-fetch-request":return t.approveWebSearch?{approved:!0}:{approved:!1,reason:null!==(s=t.webSearchRejectReason)&&void 0!==s?s:"User Rejected"};case"switch-mode-request":return{approved:!0};case"ask-question-request":return{result:new n.tz({result:{case:"rejected",value:new n.ox({reason:t.askQuestionRejectReason})}})};case"create-plan-request":return{result:new o.bK({result:{case:"success",value:new o.Jo},planUri:""})};case"setup-vm-environment-request":return new i.r$({result:{case:"success",value:new i.JH}});default:throw new Error("Unhandled interaction query type")}}},"./src/utils/interaction-utils.ts":(e,t,s)=>{s.d(t,{AX:()=>i,Kx:()=>d,N$:()=>a,cT:()=>c,dy:()=>l,iX:()=>r,mb:()=>u});var n=s("../proto/dist/generated/agent/v1/agent_pb.js"),o=s("../proto/dist/generated/agent/v1/ask_question_tool_pb.js");const i=e=>{const t={};for(const s of e.questions)t[s.id]=[];return{activeQuestionIndex:0,activeOptionIndex:0,selectionsByQuestionId:t}},r=(e,t)=>{const s=e.questions.map((e=>{var s;const n=null!==(s=t.selectionsByQuestionId[e.id])&&void 0!==s?s:[];return new o.wh({questionId:e.id,selectedOptionIds:n})}));return new o.tz({result:{case:"success",value:new o.dE({answers:s})}})},a=e=>new o.tz({result:{case:"rejected",value:new o.ox({reason:null!=e?e:"Questions skipped by user"})}}),l=e=>{switch(e){case"agent":return"Agent";case"plan":return"Plan";case"debug":return"Debug";case"chat":case"ask":case"search":return"Ask";case"background":return"Background";case"triage":return"Triage";case"project":return"Project";case"spec":return"Spec";default:return e}},d=(e,t)=>{switch(e){case"plan":return"plan";case"background":return"background";case"chat":case"ask":case"search":return"search";default:return"plan"===t?"default":t}},c=e=>{switch(e){case"plan":return n.AgentMode.PLAN;case"search":return n.AgentMode.ASK;default:return n.AgentMode.AGENT}},u=e=>{switch(e){case"default":case"auto-run":case"background":default:return"agent";case"plan":return"plan";case"search":return"ask"}}}};