try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="3d493f9d-af83-450e-a32b-cff2dab61bd7",e._sentryDebugIdIdentifier="sentry-dbid-3d493f9d-af83-450e-a32b-cff2dab61bd7")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.01.28-fd13201"}}catch(e){}}(),exports.id=467,exports.ids=[156,467],exports.modules={"./src/always-deny-decision-provider.ts":(e,t,o)=>{o.d(t,{N:()=>n});class n{requestApproval(e){return Promise.resolve({approved:!1})}}},"./src/commands/sandbox-debug.ts":(e,t,o)=>{o.r(t),o.d(t,{handleSandboxDebug:()=>b});var n=o("node:child_process"),r=o("node:fs/promises"),i=o("node:os"),s=o("node:path"),a=o.n(s),c=o("../context/dist/index.js"),d=o("../cursor-config/dist/index.js"),l=o("../local-exec/dist/index.js"),u=o("../shell-exec/dist/index.js"),p=o("./src/always-deny-decision-provider.ts"),f=o("./src/console-io.ts"),h=o("./src/shared/resources.ts"),g=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},m=function(e,t,o){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var n,r;if(o){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],o&&(r=n)}if("function"!=typeof n)throw new TypeError("Object not disposable.");r&&(n=function(){try{r.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:n,async:o})}else o&&e.stack.push({async:!0});return t},v=function(e){return function(t){function o(o){t.error=t.hasError?new e(o,t.error,"An error was suppressed during disposal."):o,t.hasError=!0}var n,r=0;return function e(){for(;n=t.stack.pop();)try{if(!n.async&&1===r)return r=0,t.stack.push(n),Promise.resolve().then(e);if(n.dispose){var i=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(i).then(e,(function(t){return o(t),e()}))}else r|=1}catch(e){o(e)}if(1===r)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}}("function"==typeof SuppressedError?SuppressedError:function(e,t,o){var n=new Error(o);return n.name="SuppressedError",n.error=e,n.suppressed=t,n}),y=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,o=e[Symbol.asyncIterator];return o?o.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=e[o]&&function(t){return new Promise((function(n,r){!function(e,t,o,n){Promise.resolve(n).then((function(t){e({value:t,done:o})}),t)}(n,r,(t=e[o](t)).done,t.value)}))}}};function b(e,t,o,s){return g(this,void 0,void 0,(function*(){var b,w,k,x;const S={stack:[],error:void 0,hasError:!1};try{const v=m(S,(0,c.VI)(e.withName("handleSandboxDebug")),!1),O=String(s.allowPaths||"").split(",").map((e=>e.trim())).filter((e=>e.length>0)),j=String(s.readonlyPaths||"").split(",").map((e=>e.trim())).filter((e=>e.length>0)),D=String(s.blockedPatterns||"").split(",").map((e=>e.trim())).filter((e=>e.length>0)),A=(e=>{try{const t=(0,n.execFileSync)("git",["rev-parse","--show-toplevel"],{cwd:e,stdio:["ignore","pipe","ignore"]}).toString("utf8").trim();if(t&&t.length>0)return t}catch(e){}return(0,d.Xq)(e)})(process.cwd()),C=yield function(e,t){return g(this,void 0,void 0,(function*(){const o=new l.xK,n=new l.E1(o,t,void 0,[e]),r=yield n.getCursorIgnoreMapping();return Object.assign({},r)}))}(A,s.rgPath),R=(0,u.nq)(D,A),I=Object.assign(Object.assign({},C),R),$=s.sbDebug?`${i.tmpdir()}/cursor-sandbox-${Date.now()}`:void 0;if($&&$.length>0)try{yield r.mkdir($,{recursive:!0})}catch(e){(0,f.OT)(`Error creating debug directory: ${$}`)}const _=o&&o.length>0?`${t} ${o.join(" ")}`:t;try{const t=yield d.FO.loadFromDefaults(e),o=new p.N;yield(0,h._Y)(v.ctx,{configProvider:t,decisionProvider:o,workingDirectory:process.cwd(),getIsAutoRun:()=>!1,rgPath:s.rgPath}),(0,f.OT)(`Executing command: ${_}`),(0,f.OT)(`Working directory: ${process.cwd()}`);const n=s.sandbox?{type:"workspace_readwrite",networkAccess:!!s.network,additionalReadwritePaths:O,additionalReadonlyPaths:j,debugOutputDir:$,ignoreMapping:I,blockGitWrites:!0}:{type:"insecure_none",debugOutputDir:$};(0,f.OT)(`Sandbox policy: ${JSON.stringify(n,null,2)}\n`);const i=(0,u.Fn)(),c=new l.MX(i);let g="",m="",S=null,D=[];try{for(var T,P=!0,E=y(c.execute(v.ctx,{command:_,workingDirectory:process.cwd(),sandboxPolicy:n,captureSandboxDenies:!0}));!(b=(T=yield E.next()).done);P=!0){x=T.value,P=!1;const e=x;"stdout"===e.type?g+=e.data:"stderr"===e.type?m+=e.data:"exit"===e.type?S=e.code:"sandbox_denies"===e.type&&(D=e.events)}}catch(e){w={error:e}}finally{try{P||b||!(k=E.return)||(yield k.call(E))}finally{if(w)throw w.error}}let A="",C="";if($){const e=(new Date).toISOString().replace(/[:.]/g,"-");A=a().join($,`stdout-${e}.log`),C=a().join($,`stderr-${e}.log`);try{yield r.writeFile(A,null!=g?g:""),yield r.writeFile(C,null!=m?m:"")}catch(e){}}const R=(e,t)=>(e||"").split(/\r?\n/).slice(-t).join("\n");if(0===S){if((0,f.OT)("\n=== COMMAND SUCCESS ==="),(0,f.OT)("Exit code: 0"),g){const e=R(g,500);(0,f.OT)(`\nSTDOUT (last 500 lines):\n${e}`),$&&A&&(0,f.OT)(`Full STDOUT saved to: ${A}`)}if(m){const e=R(m,500);(0,f.OT)(`\nSTDERR (last 500 lines):\n${e}`),$&&C&&(0,f.OT)(`Full STDERR saved to: ${C}`)}}else{if((0,f.OT)("\n=== COMMAND FAILURE ==="),(0,f.OT)(`Exit code: ${null!=S?S:-1}`),g){const e=R(g,500);(0,f.OT)(`\nSTDOUT (last 500 lines):\n${e}`),$&&A&&(0,f.OT)(`Full STDOUT saved to: ${A}`)}if(m){const e=R(m,500);(0,f.OT)(`\nSTDERR (last 500 lines):\n${e}`),$&&C&&(0,f.OT)(`Full STDERR saved to: ${C}`)}}if(D.length>0)try{const e=new Map;for(const t of D){const{processName:o,operation:n,target:r,timestamp:i,relationship:s}=t;if(!(o&&n&&r&&i))continue;const a=`${o}|||${n}|||${r}`,c=e.get(a);c?new Date(i).getTime()<new Date(c.timestamp).getTime()&&e.set(a,{processName:o,timestamp:i,operation:n,target:r,relationship:s}):e.set(a,{processName:o,timestamp:i,operation:n,target:r,relationship:s})}const t=Array.from(e.values()),o=t.filter((e=>"related"===e.relationship)),n=t.filter((e=>"maybe_related"===e.relationship)),r=t.filter((e=>"probably_unrelated"===e.relationship)),i=e=>e.sort(((e,t)=>e.processName.localeCompare(t.processName)||e.operation.localeCompare(t.operation)||e.target.localeCompare(t.target)||e.timestamp.localeCompare(t.timestamp))),s=i(o),a=i(n),c=i(r),d=["process","timestamp","action","target"],l=[...s.map((e=>[e.processName,e.timestamp,e.operation,e.target])),...a.map((e=>[e.processName,e.timestamp,e.operation,e.target])),...c.map((e=>[e.processName,e.timestamp,e.operation,e.target]))],u=d.map(((e,t)=>Math.max(e.length,...l.map((e=>{var o,n;return null!==(n=null===(o=e[t])||void 0===o?void 0:o.length)&&void 0!==n?n:0}))))),p=e=>e.map(((e,t)=>(null!=e?e:"").padEnd(u[t]))).join("  ");if((0,f.OT)("\n=== SANDBOX DENIES ==="),s.length>0){(0,f.OT)(`\nðŸ”´ RELATED EVENTS (${s.length}):`),(0,f.OT)(p(d)),(0,f.OT)(u.map((e=>"-".repeat(e))).join("  "));for(const e of s)(0,f.OT)(p([e.processName,e.timestamp,e.operation,e.target]))}if(a.length>0){(0,f.OT)(`\nðŸŸ¡ MAYBE RELATED EVENTS (${a.length}):`),(0,f.OT)(p(d)),(0,f.OT)(u.map((e=>"-".repeat(e))).join("  "));for(const e of a)(0,f.OT)(p([e.processName,e.timestamp,e.operation,e.target]))}if(c.length>0){(0,f.OT)(`\nðŸŸ¢ PROBABLY UNRELATED EVENTS (${c.length}):`),(0,f.OT)(p(d)),(0,f.OT)(u.map((e=>"-".repeat(e))).join("  "));for(const e of c)(0,f.OT)(p([e.processName,e.timestamp,e.operation,e.target]))}0===t.length&&(0,f.OT)("No denies captured")}catch(e){(0,f.OT)(`Failed to display sandbox denies: ${e}`)}if($)try{const e=yield r.readdir($);if(e.length>0){(0,f.OT)("\n=== DEBUG FILES CREATED ===");for(const t of e){const e=a().join($,t);(0,f.OT)(`  ${e}`)}}else(0,f.OT)(`\nNo debug files created in: ${$}`)}catch(e){(0,f.OT)(`Error reading debug directory: ${e}`)}process.exit(null!=S?S:0)}catch(e){(0,f.OT)(`Failed to execute command: ${e}`),process.exit(1)}}catch(e){S.error=e,S.hasError=!0}finally{v(S)}}))}},"./src/shared/resources.ts":(e,t,o)=>{o.d(t,{A1:()=>x,Pb:()=>k,_Y:()=>S});var n=o("node:os"),r=o("node:path"),i=o.n(r),s=o("../cli-credentials/dist/index.js"),a=o("../context/dist/index.js"),c=o("../cursor-config/dist/index.js"),d=o("../hooks-exec/dist/index.js"),l=o("../local-exec/dist/index.js"),u=o("../shell-exec/dist/index.js"),p=o("./src/mcp/disabled-store.ts"),f=o("./src/mcp/project-paths.ts"),h=o("./src/statsig.ts"),g=o("./src/team-hooks-sync.ts"),m=o("./src/utils/api-endpoint.ts"),v=o("./src/utils/git.ts"),y=o("./src/utils/git-diffs.ts"),b=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};const w=(0,a.h)("shared-resources");function k(){return b(this,arguments,void 0,(function*(e={}){const{workingDirectory:t,claudeCodeHooksEnabled:o=!1,teamId:n,dashboardClient:r}=e,i=null!=t?t:process.cwd(),s=(0,v.ky)(i);let a;null!=n&&r&&(a=(0,g.a)({dashboardClient:r,teamId:n}));const c=(0,d.Ve)(s,{claudeCodeHooksEnabled:o}),l=new d.IF,u=new d.gY(l,c),p=yield u.load({loadClaudeHooks:o});return a?{hooksConfig:p,projectDir:s,teamHooksResultPromise:a}:{hooksConfig:p,projectDir:s}}))}function x(e,t){const o=(0,s.jo)(null!=="cursor"?"cursor":"cursor-dev"),n=(0,c.Vi)({credentialManager:o,endpoint:(0,m.G6)(t),configProvider:e});return new l.w(new l.zM(n))}function S(e,t){return b(this,void 0,void 0,(function*(){var r,a,v,k,x,S,T,P,E,O,j,D,A;const C=null!==(r=t.workingDirectory)&&void 0!==r?r:process.cwd();let R=null!==(a=t.rgPath)&&void 0!==a?a:"rg";if(!t.rgPath)try{const{execSync:e}=yield Promise.resolve().then(o.t.bind(o,"node:child_process",23));R=e("which rg",{encoding:"utf8"}).trim()}catch(e){}const I=(0,s.jo)(null!=="cursor"?"cursor":"cursor-dev"),$=(0,c.Vi)({credentialManager:I,endpoint:(0,m.G6)(t.endpoint),configProvider:t.configProvider}),_=null!==(v=t.teamSettingsService)&&void 0!==v?v:new l.w(new l.zM($)),F=new l.$1(C);if(t.withDiffs){const e=(0,y.buildFileChanges)((0,y.collectGitStatuses)());for(const t of e)F.trackChange(t.path,t.before,t.after)}try{yield(0,l.Rh)(e)}catch(t){w.warn(e,"Failed to sync built-in skills",{error:t})}const N=()=>!0,M=new l.xK,H=new l.KO(e,M,C,R,!1,N,void 0),G=new l.EV(e,[C],(0,n.homedir)(),void 0,N),L=new l.Px([H,G]),V=new l.o_([new l.Vz(C,N),new l.di(L)]),U=new l.E1(M,R,_),K=[],W=new class{constructor(e,t,o=()=>!1,n,r=!1){this.configProvider=e,this.getIsAutoRun=t,this.getIsAskMode=o,this.teamSettingsService=n,this.sandboxDefaultEnabled=r,this.baseProvider=new c.QX(e)}setGetIsAutoRun(e){this.getIsAutoRun=e}setGetIsAskMode(e){this.getIsAskMode=e}getPermissions(){return b(this,void 0,void 0,(function*(){var e,t,o;const n=yield this.baseProvider.getPermissions();let r,i;const s=this.configProvider.get(),a="enabled"===(null===(e=s.sandbox)||void 0===e?void 0:e.networkAccess),c=this.sandboxDefaultEnabled?"enabled":"disabled",d=null!==(o=null===(t=s.sandbox)||void 0===t?void 0:t.mode)&&void 0!==o?o:c,l=(0,u.K3)()&&"enabled"===d;if(this.getIsAutoRun()){const e=yield this.teamSettingsService.getAutoRunControls();!0===(null==e?void 0:e.enabled)&&!0!==e.enableRunEverything?(r="allowlist",i=l?{type:"workspace_readwrite",networkAccess:a}:{type:"insecure_none"}):(r="unrestricted",i={type:"insecure_none"})}else l?(r="allowlist",i=this.getIsAskMode()?{type:"workspace_readonly",networkAccess:a}:{type:"workspace_readwrite",networkAccess:a}):(r="allowlist",i={type:"insecure_none"});return Object.assign(Object.assign({},n),{approvalMode:r,userConfiguredPolicy:i})}))}updatePermissions(e){return b(this,void 0,void 0,(function*(){return this.baseProvider.updatePermissions(e)}))}}(t.configProvider,t.getIsAutoRun,null!==(k=t.getIsAskMode)&&void 0!==k?k:()=>!1,_,null!==(x=t.sandboxDefaultEnabled)&&void 0!==x&&x);K.push(W);const Y=yield(0,l.ky)(e,M,C),B=!!Y,q=null!=Y?Y:C,X=yield c.N2.loadFromPath(i().join(q,".claude","settings.json"));X&&K.push(X);const z=yield c.N2.loadFromPath(i().join((0,n.homedir)(),".claude","settings.json"));z&&K.push(z);const Q=new c.Ol(K),{projectRoot:J,projectDir:Z,disabledPath:ee}=(0,f.C)(C),te=new p.P(ee),oe=c.aK.init(_,J,Z,null!==(S=t.ignoreApproveMcps)&&void 0!==S&&S,te),ne=t.configProvider.get(),re=!0===t.sandboxDefaultEnabled?"enabled":"disabled",ie=null!==(E=null!==(T=t.sandboxOverride)&&void 0!==T?T:null===(P=ne.sandbox)||void 0===P?void 0:P.mode)&&void 0!==E?E:re,se=null===(O=ne.sandbox)||void 0===O?void 0:O.networkAccess,ae=new l.kh(U,t.decisionProvider,Q,_,void 0,(0,h.QF)("admin_network_controls")),ce={rgPath:R,executeIndexedGrep:void 0};let de,le=t.teamHooksResultPromise;if(t.hooksConfig)de=t.hooksConfig;else{const e=null===(j=t.configProvider.get().authInfo)||void 0===j?void 0:j.teamId;null!=e&&$&&!le&&(le=(0,g.a)({dashboardClient:$,teamId:e}));const o=null!==(D=t.claudeCodeHooksEnabled)&&void 0!==D&&D,n=(0,d.Ve)(q,{claudeCodeHooksEnabled:o}),r=new d.IF,i=new d.gY(r,n);de=yield i.load({loadClaudeHooks:o})}const ue=new d.HW(de);let pe,fe=()=>{};le&&(pe=new Promise((e=>{fe=e})));const he=null!==(A=t.hookExecutor)&&void 0!==A?A:(()=>{var e,o;const n={cursor_version:null!=="2026.01.28-fd13201"?"2026.01.28-fd13201":"1.0.0",user_email:null!==(o=null===(e=t.configProvider.get().authInfo)||void 0===e?void 0:e.email)&&void 0!==o?o:null},r=(0,u.Fn)();return new d.WL(de,q,n,r,t.promptHookClient,pe)})();le&&pe&&le.then((t=>{if(null!=t){const o=(0,g.O)(de,t.teamHooks,t.teamDir);ue.setConfig(o),he.updateConfig(o),w.info(e,"Team hooks config merged after fetch")}})).finally((()=>fe()));const ge=(0,u.K3)()&&"enabled"===ie,me=yield function(e,t){return b(this,void 0,void 0,(function*(){try{const o=yield e.getAutoRunControls();if(!0===(null==o?void 0:o.enabled)&&!0!==o.enableRunEverything)return t?{type:"sandbox-only"}:{type:"disabled"}}catch(e){}return{type:"run-everything"}}))}(_,ge);return{permissionsService:ae,grepProvider:ce,fileChangeTracker:F,dashboardClient:$,teamSettingsService:_,mcpLoader:oe,disabledStore:te,isRepository:B,hooksConfigLease:ue,hookExecutor:he,hooksConfig:de,autoRunAvailability:me,createLocalResourceProvider:({diagnosticsProvider:e,mcpLease:o,codebaseReferenceProvider:n,shellManager:r,pendingDecisionProviderOverride:i,conversationId:s="",generationId:a="",model:c="unknown"})=>{const p=new l.Dv({pendingDecisionStore:null!=i?i:t.decisionProvider,fileChangeTracker:F,gitExecutor:M,ignoreService:U,grepProvider:ce,permissionsService:ae,workspacePaths:[C],diagnosticsProvider:e,mcpLease:o,cursorRulesService:L,subagentsService:V,repositoryProvider:n,projectDir:Z,shellManager:r,_sandboxPolicyResolver:void 0,_defaultSandboxPolicy:"enabled"===ie?{type:"workspace_readwrite",networkAccess:"enabled"===se}:{type:"insecure_none"},getSandboxEnabled:()=>(0,u.K3)()&&"enabled"===ie,getSandboxSupported:u.K3,attributionConfigProvider:t.configProvider,askpassConfig:t.askpassConfig});return new d.ae(p,he,(()=>({conversation_id:s,generation_id:a,model:c})),o,t.hooksAdditionalContextPromise,pe,ue)},setGetIsAutoRun:e=>{W.setGetIsAutoRun(e)},setGetIsAskMode:e=>{W.setGetIsAskMode(e)}}}))}},"./src/team-hooks-sync.ts":(e,t,o)=>{o.d(t,{O:()=>d,a:()=>u});var n=o("node:fs/promises"),r=o("node:os"),i=o("node:path"),s=o.n(i),a=o("../proto/dist/generated/aiserver/v1/dashboard_pb.js"),c=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};function d(e,t,o){return Object.assign(Object.assign({},e),{teamHooks:t,configDirs:Object.assign(Object.assign({},e.configDirs),{team:o})})}function l(){return"win32"===(0,r.platform)()}function u(e){return c(this,void 0,void 0,(function*(){var t,o,i,c;const{dashboardClient:d,teamId:u}=e;try{const e=function(){switch((0,r.platform)()){case"darwin":return"Macintosh";case"win32":return"Windows";default:return"Linux"}}(),p=s().join((0,r.homedir)(),".cursor","managed",`team_${u}`,"hooks"),f=(null!==(t=(yield d.getTeamHooks(new a.GetTeamHooksRequest({activeOnly:!0}))).hooks)&&void 0!==t?t:[]).filter((t=>t.operatingSystems&&t.operatingSystems.length>0&&t.operatingSystems.includes(e)));yield(0,n.mkdir)(p,{recursive:!0});const h=new Set,g={};for(const e of f){let t=s().basename(e.scriptName||`team-hook-${e.id}`);l()&&(t.endsWith(".ps1")||t.endsWith(".bat")||t.endsWith(".cmd")||(t=`${t}.ps1`));const r=s().extname(t),a=r.length>0?t.slice(0,-r.length):t;let d=t,u=1;for(;h.has(d);)d=`${a}-${e.id}-${u}${r}`,u+=1;const f=s().join(p,d),m=null!==(o=e.scriptContent)&&void 0!==o?o:"";try{yield(0,n.writeFile)(f,m,"utf-8"),l()||(yield(0,n.chmod)(f,493)),h.add(d);const t=null!==(i=e.hookStep)&&void 0!==i?i:"beforeShellExecution",o=null!==(c=g[t])&&void 0!==c?c:[];o.push({command:f}),g[t]=o}catch(e){console.warn(`[team-hooks-sync] Failed to write ${t}:`,e)}}const m={version:1,hooks:g};try{const e=yield(0,n.readdir)(p,{withFileTypes:!0});for(const t of e)if(t.isFile()&&!h.has(t.name))try{yield(0,n.rm)(s().join(p,t.name))}catch(e){}}catch(e){}return{teamHooks:m,teamDir:p}}catch(e){return console.warn("Team hooks fetch/prepare failed; continuing without team hooks",e),null}}))}},"./src/utils/git-diffs.ts":(e,t,o)=>{o.r(t),o.d(t,{buildFileChanges:()=>m,buildUnifiedDiff:()=>l,collectGitStatuses:()=>g});var n=o("node:child_process"),r=o("node:fs"),i=o.n(r),s=o("node:os"),a=o.n(s),c=o("node:path"),d=o.n(c);const l=e=>{const t=i().mkdtempSync(d().join(a().tmpdir(),"delta-full-")),o=d().join(t,"before"),r=d().join(t,"after");i().mkdirSync(o,{recursive:!0}),i().mkdirSync(r,{recursive:!0});const s=(e,t,o)=>{const n=d().join(e,t);i().mkdirSync(d().dirname(n),{recursive:!0}),i().writeFileSync(n,o)};for(const t of e){const e=d().isAbsolute(t.path)?d().relative(process.cwd(),t.path):t.path;void 0!==t.before&&s(o,e,t.before),void 0!==t.after&&s(r,e,t.after)}const c=["diff","--no-index","--no-prefix","--diff-algorithm=patience","--unified=3","--","before","after"];let l="";try{l=(0,n.execFileSync)("git",c,{encoding:"utf8",cwd:t})}catch(e){const t=e;if(!(null==t?void 0:t.stdout))throw e;l=t.stdout}const u=(e=>{const t=d().join(o,""),n=d().join(r,"");let i=e.split(t).join("").split(n).join("");const s=d().join("before",""),a=d().join("after","");return i=i.split(s).join("").split(a).join(""),i})(l);return i().rmSync(t,{recursive:!0,force:!0}),u};function u(e){return(0,n.execFileSync)("git",e,{encoding:"utf8"}).trim()}function p(e){try{return(0,n.execFileSync)("git",["show",`HEAD:${e}`],{encoding:"utf8"})}catch(e){return}}let f=null;function h(e){const t=f||(f=u(["rev-parse","--show-toplevel"]),f),o=d().isAbsolute(e)?e:d().join(t,e);try{return(0,r.readFileSync)(o,"utf8")}catch(e){return""}}function g(){const e=u(["diff","--name-status","HEAD"]),t=(""===e?[]:e.split("\n")).filter(Boolean).map((e=>{var t,o,n,r,i;const s=e.split("\t"),a=(null!==(t=s[0])&&void 0!==t?t:"")[0];if("R"===a||"C"===a){const e=null!==(o=s[1])&&void 0!==o?o:"";return{code:a,path:null!==(n=s[2])&&void 0!==n?n:e,oldPath:e}}return{code:a,path:null!==(i=null!==(r=s[1])&&void 0!==r?r:s[0])&&void 0!==i?i:""}})),o=u(["ls-files","--others","--exclude-standard"]),n=""===o?[]:o.split("\n");for(const e of n)e&&t.push({code:"A",path:e});return t}function m(e){var t,o,n;const r=[];for(const i of e)if(i.path)switch(i.code){case"A":{const e=h(i.path);r.push({path:i.path,before:void 0,after:e});break}case"M":{const e=null!==(t=p(i.path))&&void 0!==t?t:"",o=h(i.path);r.push({path:i.path,before:e,after:o});break}case"D":{const e=null!==(o=p(i.path))&&void 0!==o?o:"";r.push({path:i.path,before:e,after:void 0});break}case"R":{const e=i.oldPath&&null!==(n=p(i.oldPath))&&void 0!==n?n:"",t=h(i.path);r.push({path:i.path,before:e,after:t});break}}return r}}};