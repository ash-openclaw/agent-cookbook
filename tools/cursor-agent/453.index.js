try{!function(){var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},e=(new t.Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="6701b33a-5724-4c7a-bc7d-2ba3b0167386",t._sentryDebugIdIdentifier="sentry-dbid-6701b33a-5724-4c7a-bc7d-2ba3b0167386")}()}catch(t){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.01.28-fd13201"}}catch(t){}}(),exports.id=453,exports.ids=[453],exports.modules={"./src/commands/record.ts":(t,e,s)=>{s.r(e),s.d(e,{handleRecord:()=>h});var i=s("node:fs"),n=s("node:os"),r=s("node:path"),a=s("../../node_modules/.pnpm/@lydell+node-pty@1.1.0_patch_hash=8cc7c6b3b59e47c0436b0f2bbb89cec1ced0f8ac0beadc41a2d07016bef0ea46/node_modules/@lydell/node-pty/index.js"),o=s("../../node_modules/.pnpm/node-ansiparser@2.2.1/node_modules/node-ansiparser/dist/ansiparser.js"),d=s.n(o);const c={shell:"/bin/zsh",pendingFile:"",completedFile:"",tempDir:""};class p{constructor(t,e){this.pendingFile=t,this.completedFile=e,this.state={currentCommand:null,isCapturingOutput:!1,pendingStream:null,commandExitCode:null,waitingForExitCode:!1}}startCapture(t){this.state.currentCommand=t,this.state.isCapturingOutput=!0,this.state.pendingStream=i.createWriteStream(this.pendingFile),this.state.pendingStream.write(`${t}\n`)}writeToCapture(t){this.state.isCapturingOutput&&this.state.pendingStream&&this.state.pendingStream.write(t)}setExitCode(t){this.state.commandExitCode=t,this.state.isCapturingOutput&&this.state.currentCommand&&this.state.pendingStream&&(this.state.waitingForExitCode=!0)}finishCommand(){if(this.state.pendingStream&&null!==this.state.commandExitCode){this.state.pendingStream.write(`\n${this.state.commandExitCode}`),this.state.pendingStream.end(),this.state.pendingStream=null;try{i.existsSync(this.pendingFile)&&i.renameSync(this.pendingFile,this.completedFile)}catch(t){}this.state.commandExitCode=null,this.state.waitingForExitCode=!1}}resetForNextCommand(){this.state.isCapturingOutput&&this.state.currentCommand&&(null===this.state.commandExitCode&&(this.state.commandExitCode="0"),this.finishCommand(),this.state.currentCommand=null),this.state.isCapturingOutput=!1}get isCapturing(){return this.state.isCapturingOutput}get hasCommand(){return null!==this.state.currentCommand}get isWaitingForExitCode(){return this.state.waitingForExitCode}get currentCommand(){return this.state.currentCommand}handleProcessExit(t){this.state.isCapturingOutput&&this.state.currentCommand&&(null===this.state.commandExitCode&&(this.state.commandExitCode=t.toString()),this.finishCommand())}closePendingStream(){this.state.pendingStream&&(this.state.pendingStream.end(),this.state.pendingStream=null)}}class l{constructor(t){this.commandCapture=t}parse(t){const e=t.indexOf(";");if(-1===e)return;const s=t.substring(0,e),i=t.substring(e+1);switch(s){case"1":this.handleWindowTitle(i);break;case"2":this.handleTerminalTitle(i);break;case"7":break;case"133":this.handleShellIntegration(t);break;case"9999":this.handleCursorAgentSequence(i)}}handleWindowTitle(t){}handleTerminalTitle(t){}handleShellIntegration(t){}handleCursorAgentSequence(t){const e=t.split(";");if(e.length<1)return;const s=e[0],i=e.slice(1).join(";");switch(s){case"prompt":this.commandCapture.resetForNextCommand();break;case"preexec":i&&!this.commandCapture.hasCommand&&this.commandCapture.startCapture(i);break;case"precmd":i&&(this.commandCapture.setExitCode(i),this.commandCapture.finishCommand())}}}class m{constructor(t){this.commandCapture=t,this.oscParser=new l(t)}inst_p(t){this.commandCapture.writeToCapture(t)}inst_o(t){this.oscParser.parse(t)}inst_x(t){this.commandCapture.writeToCapture(t)}inst_c(t,e,s){}inst_e(t,e){}inst_H(t,e,s){}inst_P(t){}inst_U(){}inst_E(t){}}class u{constructor(){this.createTempDirectory(),this.commandCapture=new p(c.pendingFile,c.completedFile);const t=new m(this.commandCapture);this.parser=new(d())(t),this.ptyProcess=this.initializePty(),this.cleanupFiles()}createTempDirectory(){c.tempDir=i.mkdtempSync(r.join(n.tmpdir(),"termcapture-")),c.pendingFile=r.join(c.tempDir,"pending.bin"),c.completedFile=r.join(c.tempDir,"completed.bin"),process.env.CURSOR_AGENT_COMPLETED_PATH=c.completedFile}initializePty(){try{const t=r.join(process.argv[1],"..","spawn-helper"),e=a.cH("zsh",["-il"],{helperPath:t,name:"xterm-256color",cols:process.stdout.columns||80,rows:process.stdout.rows||24,cwd:process.cwd(),env:Object.assign(Object.assign({},process.env),{CURSOR_AGENT_COMPLETED_PATH:c.completedFile})});return e.onData((t=>{this.parser.parse(t),process.stdout.write(t)})),e.onExit((t=>{this.commandCapture.handleProcessExit(t.exitCode),this.cleanup(),process.exit(t.exitCode)})),e}catch(t){process.stderr.write("Error initializing PTY:"),t instanceof Error?(process.stderr.write(t.message),process.stderr.write(t.stack||"")):process.stderr.write(String(t)),process.exit(1)}}cleanupFiles(){try{i.existsSync(c.pendingFile)&&i.unlinkSync(c.pendingFile),i.existsSync(c.completedFile)&&i.unlinkSync(c.completedFile)}catch(t){}}setupStdin(){process.stdin.isTTY&&process.stdin.setRawMode(!0),process.stdin.resume(),process.stdin.setEncoding("utf8"),process.stdin.on("data",(t=>{this.ptyProcess.write(t)}))}setupResize(){process.stdout.on("resize",(()=>{process.stdout.columns&&process.stdout.rows&&this.ptyProcess.resize(process.stdout.columns,process.stdout.rows)})),process.stdout.columns&&process.stdout.rows&&this.ptyProcess.resize(process.stdout.columns,process.stdout.rows)}setupSignalHandlers(){const t=t=>{this.ptyProcess.kill(t)};process.on("SIGINT",(()=>t("SIGINT"))),process.on("SIGTERM",(()=>t("SIGTERM")))}cleanup(){if(process.stdin.isTTY&&process.stdin.setRawMode(!1),c.tempDir&&i.existsSync(c.tempDir))try{i.rmSync(c.tempDir,{recursive:!0,force:!0})}catch(t){}}start(){this.setupStdin(),this.setupResize(),this.setupSignalHandlers()}}function h(){(new u).start(),process.title="cursor-shell"}}};