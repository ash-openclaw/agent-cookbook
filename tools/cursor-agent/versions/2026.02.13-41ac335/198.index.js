try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="cde6a884-fb45-476e-937c-809c18f3599b",e._sentryDebugIdIdentifier="sentry-dbid-cde6a884-fb45-476e-937c-809c18f3599b")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.02.13-41ac335"}}catch(e){}}(),exports.id=198,exports.ids=[198],exports.modules={"./src/always-approve-decision-provider.ts":(e,t,n)=>{n.d(t,{I:()=>s});class s{requestApproval(e){return Promise.resolve({approved:!0})}}},"./src/commands/custom-commands.ts":(e,t,n)=>{n.d(t,{FD:()=>u,H8:()=>l,jI:()=>c});var s=n("node:fs/promises"),o=n("node:os"),r=n("node:path"),i=n("../proto/dist/generated/aiserver/v1/dashboard_pb.js"),a=n("./src/debug.ts"),d=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};function l(e,t){const n=t.join(" ");let s=e,o=!1;s.includes("$ARGUMENTS")&&(o=!0,s=s.replace(/\$ARGUMENTS/g,n));const r=/(?<!\w)\$(\d{1,2})\b/g;return r.test(s)&&(o=!0,r.lastIndex=0,s=s.replace(r,((e,n)=>{const s=parseInt(n,10);return s>0&&s<=t.length?t[s-1]:""}))),{result:s,hadPlaceholders:o}}function c(e,t){return{fullMessage:t?`${t} ${e} `:`${e} `,displayText:t?`${t} ${e}`:e}}class u{constructor(e){this.commands=new Map,this.skills=new Map,this.dashboardClient=e}loadCommands(e,t){return d(this,void 0,void 0,(function*(){var n;const s=null===(n=null==t?void 0:t.includeSkills)||void 0===n||n;this.commands.clear(),this.skills.clear(),yield this.loadTeamCommands(),yield this.loadCommandsFromDirectory((0,r.join)(e,".claude","commands"),"claude-workspace"),yield this.loadCommandsFromDirectory((0,r.join)(e,".cursor","commands"),"workspace"),yield this.loadCommandsFromDirectory((0,r.join)((0,o.homedir)(),".claude","commands"),"claude-user"),yield this.loadCommandsFromDirectory((0,r.join)((0,o.homedir)(),".cursor","commands"),"user"),yield this.loadSkillsFromDirectory((0,r.join)((0,o.homedir)(),".cursor","skills-cursor"),"builtin"),yield this.loadSkillsFromDirectory((0,r.join)(e,".cursor","skills"),"workspace"),yield this.loadSkillsFromDirectory((0,r.join)((0,o.homedir)(),".cursor","skills"),"user");const i=Array.from(this.commands.values()).map((e=>this.convertToSlashCommand(e)));if(!s)return i;const a=Array.from(this.skills.values()).map((e=>this.convertSkillToSlashCommand(e)));return[...i,...a]}))}findSkillReferences(e){const t=[],n=new Set,s=e.matchAll(/(?:^|\s)\/([a-zA-Z0-9_-]{1,30})/g);for(const e of s){const s=e[1];if(s&&!n.has(s)){const e=this.getSkillById(s);e&&(t.push(e),n.add(s))}}return{skills:t,cleanedMessage:e}}loadCommandsFromDirectory(e,t){return d(this,void 0,void 0,(function*(){if(!(yield this.exists(e)))return;const n=(yield this.readDirectory(e)).filter((e=>!e.isDirectory&&e.name.endsWith(".md")));for(const e of n){const n=yield this.readTextFile(e.path);if(!n)continue;const s=this.parseMarkdownCommand(e.name,n,t);s&&this.commands.set(s.id,s)}}))}loadSkillsFromDirectory(e,t){return d(this,void 0,void 0,(function*(){if(!(yield this.exists(e)))return;const n=(yield this.readDirectory(e)).filter((e=>e.isDirectory));for(const e of n){const n=(0,r.join)(e.path,"SKILL.md");if(yield this.exists(n)){const s=yield this.readTextFile(n);if(!s)continue;const o=this.parseSkillMarkdown(e.name,s,t,n);o&&this.skills.set(o.id,o)}}}))}parseSkillMarkdown(e,t,n,s){if(!e.trim())return null;let o=e,r="";const i=t.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(i){const e=i[1],t=e.match(/^name:\s*(.+)$/m),n=e.match(/^description:\s*(.+)$/m);t&&(o=t[1].trim()),n&&(r=n[1].trim())}if(!r){const e=t.split("\n");for(const t of e)if(t.startsWith("#")){const e=t.replace(/^#+\s*/,"").trim();if(e){r=e;break}}else if(t.trim()&&!t.startsWith("---")){r=t.trim();break}}return{id:e,title:o,description:r||o,content:t.trim(),source:n,path:s}}parseMarkdownCommand(e,t,n){const s=e.replace(/\.md$/,"");if(!s.trim())return null;const o=t.split("\n"),r=this.extractTitle(o[0])||s;return{id:s,title:r,description:r,content:t.trim(),source:n,filename:e}}extractTitle(e){if(!e)return null;const t=e.match(/^#+\s*(.+)$/);if(t)return t[1].trim();return e.trim()||null}convertToSlashCommand(e){const t=this.getScopeIndicator(e.source);return{id:e.id,title:e.title,description:`${e.description} ${t}`,inline:!0,run:(t,n,s)=>{var o,r,i,a;const d=null!==(r=null===(o=s.getPromptPrefix)||void 0===o?void 0:o.call(s))&&void 0!==r?r:"",c=n||[],u=c.join(" ").trim(),{result:h,hadPlaceholders:m}=l(e.content,c);let g;g=m?h:u?`${e.content}\n\n${u}`:e.content;const p=d?`${d}\n\n${g}`:g,f=u?`/${e.id} ${u}`:`/${e.id}`,v=d?`${d} ${f}`:f;s.submitMessage?(null===(i=s.clearInput)||void 0===i||i.call(s),s.submitMessage(p,{display:v})):(null===(a=s.clearInput)||void 0===a||a.call(s),s.insertText(p))}}}convertSkillToSlashCommand(e){const t=this.getSkillScopeIndicator(e.source);return{id:e.id,title:e.title,description:`${e.description} ${t}`,inline:!0,run:(t,n,s)=>{var o,r,i,a,d,l;const u=null!==(r=null===(o=s.getPromptPrefix)||void 0===o?void 0:o.call(s))&&void 0!==r?r:"",h=null!==(i=null==n?void 0:n.join(" ").trim())&&void 0!==i?i:"",m=`/${e.id}`,g=[u,h].filter(Boolean).join(" "),{fullMessage:p,displayText:f}=c(m,g);null===(a=s.clearInput)||void 0===a||a.call(s),null===(d=s.hidePalette)||void 0===d||d.call(s),null===(l=s.submitMessage)||void 0===l||l.call(s,p.trim(),{display:f})}}}getScopeIndicator(e){switch(e){case"team":return"(team)";case"workspace":case"claude-workspace":return"(project)";case"user":case"claude-user":return"(user)";default:return""}}getSkillScopeIndicator(e){switch(e){case"workspace":return"(project skill)";case"user":return"(user skill)";case"builtin":return"(builtin skill)";default:return"(skill)"}}exists(e){return d(this,void 0,void 0,(function*(){try{return yield(0,s.stat)(e),!0}catch(e){return!1}}))}readDirectory(e){return d(this,void 0,void 0,(function*(){try{return(yield(0,s.readdir)(e,{withFileTypes:!0})).map((t=>({path:(0,r.join)(e,t.name),name:t.name,isDirectory:t.isDirectory()})))}catch(e){return[]}}))}readTextFile(e){return d(this,void 0,void 0,(function*(){try{const t=yield(0,s.stat)(e);return t.size>1048576?((0,a.debugLog)(`Skipping large file (${t.size} bytes): ${e}`),null):yield(0,s.readFile)(e,"utf-8")}catch(e){return null}}))}getLoadedCommands(){return Array.from(this.commands.values())}getCommandById(e){return this.commands.get(e)}getSkillById(e){return this.skills.get(e)}slugify(e){return e.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}loadTeamCommands(){return d(this,void 0,void 0,(function*(){try{if(!(yield this.dashboardClient.getMe(new i.GetMeRequest({}))).teamId)return void(0,a.debugLog)("User does not belong to a team, skipping team commands");const e=yield this.dashboardClient.getTeamCommands(new i.GetTeamCommandsRequest({activeOnly:!0}));for(const t of e.commands){if(!t.isActive)continue;const e={id:this.slugify(t.name),title:t.name,description:t.description||t.content.trim(),content:t.content,source:"team",filename:t.name};this.commands.has(e.id)||this.commands.set(e.id,e)}(0,a.debugLog)("Loaded team commands:",e.commands.length)}catch(e){(0,a.debugLog)("Failed to load team commands:",e)}}))}}},"./src/cursor-blame/cli-ai-code-tracker.ts":(e,t,n)=>{n.d(t,{L:()=>h,e:()=>m});var s=n("node:fs/promises"),o=n("node:os"),r=n("node:path"),i=n("../agent-analytics/dist/index.js"),a=n("../agent-analytics/dist/commit-scoring/index.js"),d=n("../agent-analytics/dist/node.js"),l=n("./src/cursor-blame/format-lineage-callbacks.ts"),c=n("./src/cursor-blame/sqlite-adapter.ts"),u=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};function h(e,t){return(null==e?void 0:e.modelId)||(null==e?void 0:e.displayModelId)||(null==e?void 0:e.displayName)||t||"unknown"}class m{constructor(e){var t,n;this.initPromise=null,this.trackedContent=new Map,this.workspacePath=e.workspacePath,this.conversationId=e.conversationId,this.model=null!==(t=e.model)&&void 0!==t?t:"unknown",this.gitOperations=new d.Z;const s=null!==(n=e.dbPath)&&void 0!==n?n:(0,r.join)((0,o.homedir)(),".cursor","ai-tracking","ai-code-tracking.db"),a=(0,c.$)();this.storage=new i.Ou(a,s)}ensureInitialized(){return this.initPromise||(this.initPromise=this.storage.initialize()),this.initPromise}trackDelete(e){return u(this,void 0,void 0,(function*(){const{path:t}=e;yield this.ensureInitialized();const n=yield(0,i.Mz)(this.gitOperations,t,t.replace(/\\/g,"/"));yield this.storage.recordAiDeletedFile(n,{conversationId:this.conversationId,model:this.model})}))}trackWrite(e){return u(this,void 0,void 0,(function*(){var t;const{path:n,beforeContent:s,afterContent:o,metadata:d}=e;if(s===o)return;yield this.ensureInitialized();const l=yield(0,i.Mz)(this.gitOperations,n,n.replace(/\\/g,"/")),c=(null!=s?s:"").split("\n"),u=o.split("\n"),h=(0,a.ld)(c,u);if(0===h.length)return;const m=(0,a.Zd)(n),g={source:a.IA.CLI,conversationId:this.conversationId,requestId:null!==(t=d.toolCallId)&&void 0!==t?t:void 0,model:this.model,fileExtension:m||void 0,fileName:n},p=(0,a.hA)(l,c,u,h,g,{normalizeLines:!0});p.length>0&&(yield this.storage.storeHashes(p.map((e=>{var{operationType:t}=e;return function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]])}return n}(e,["operationType"])}))));const f=(0,r.resolve)(this.workspacePath,n);this.trackedContent.set(l,{content:o,absolutePath:f,gitPath:l,fileExtension:m||"txt",metadata:g,timestamp:Date.now()}),yield this.storage.storeTrackedFileContent(l,o,{conversationId:this.conversationId,model:this.model,fileExtension:m||void 0})}))}finalizeTracking(){return u(this,void 0,void 0,(function*(){yield this.ensureInitialized();let e=0;const t=[];for(const[n,o]of this.trackedContent)try{const r=yield(0,s.readFile)(o.absolutePath,"utf-8").catch((()=>null));if(null===r||r===o.content)continue;const i=o.content.split("\n"),d=r.split("\n"),c=(0,a.ld)(i,d);if(0===c.length)continue;const u=(0,a.yF)(o.content,r,o.fileExtension,c);if(0===u.size)continue;const h=yield(0,a.yY)(u,o.content,r,n,o.fileExtension,!0,(0,l.L)(this.storage));h>0&&(e+=h,t.push(n)),this.trackedContent.set(n,Object.assign(Object.assign({},o),{content:r,timestamp:Date.now()}))}catch(e){console.error(`[CliAiCodeTracker] Error processing format changes for ${n}:`,e)}return{filesProcessed:this.trackedContent.size,hashesAdded:e,filesWithFormatChanges:t}}))}clearTrackedContent(){this.trackedContent.clear()}getTrackedFileCount(){return this.trackedContent.size}close(){return u(this,void 0,void 0,(function*(){yield this.storage.close()}))}}},"./src/hang-detection.ts":(e,t,n)=>{n.d(t,{Dy:()=>c,M4:()=>u,ln:()=>d});var s=n("../../node_modules/.pnpm/@sentry+core@10.1.0/node_modules/@sentry/core/build/esm/currentScopes.js"),o=n("../../node_modules/.pnpm/@sentry+core@10.1.0/node_modules/@sentry/core/build/esm/exports.js"),r=n("./src/instrument.ts");let i,a;function d(e){i=Object.assign(Object.assign({},i),e)}function l(e){if(!e)return{};const t={};for(const[n,s]of Object.entries(e))t[`handler_${n}_state`]=s.state,t[`handler_${n}_duration_ms`]=s.durationMs,s.error&&(t[`handler_${n}_error`]=s.error);return t}function c(e,t="warning"){if(!(0,r.Fj)())return;const{category:n,waitingFor:d,lastActivityAgoMs:l,lastActivityType:c,requestId:u,conversationId:h,modelName:m,actionType:g,heartbeatsOnly:p,lastHeartbeatAgoMs:f,streamOpen:v,extra:y}=e,b=i,w=(a||(a={os_platform:"linux",os_arch:"x64",node_version:process.version}),a),M=(null==b?void 0:b.conversationCreatedAt)?Date.now()-b.conversationCreatedAt:void 0,k=function(e){const{category:t,waitingFor:n,lastActivityAgoMs:s}=e,o=void 0!==s?Math.round(s/1e3):void 0,r=void 0!==o?` - ${o}s`:"";switch(t){case"stream_stall":return`CLI hang: Stream stall detected - no activity for ${o}s while waiting for ${n}`;case"stream_stall_heartbeat_only":return`CLI hang: Stream receiving heartbeats only - no meaningful data for ${o}s while waiting for ${n}`;case"exec_pending":return`CLI hang: Tool execution pending - no result for ${o}s`;case"model_init":return`CLI hang: Model initialization stalled - no response for ${o}s`;case"queue_processing":return`CLI hang: Message queue not processing${r} - pending messages in queue`;case"background_composer":return`CLI hang: Background composer stalled - no messages for ${o}s`;default:return`CLI hang: Unknown hang type (${t})${r}`}}(e),I=new Error(k);I.name="CLIHangDetected",s.v4((e=>{e.setFingerprint(["cli-hang",n,d]),e.setLevel(t),e.setTag("hang.category",n),e.setTag("hang.waiting_for",d),g&&e.setTag("hang.action_type",g),m&&e.setTag("hang.model_name",m),p&&e.setTag("hang.heartbeats_only","true"),(null==b?void 0:b.agentMode)&&e.setTag("hang.agent_mode",b.agentMode),(null==b?void 0:b.isHeadless)&&e.setTag("hang.is_headless","true"),e.setContext("hang_details",Object.assign({category:n,waiting_for:d,last_activity_ago_ms:l,last_activity_type:c,request_id:u,conversation_id:null!=h?h:null==b?void 0:b.conversationId,model_name:m,action_type:g,heartbeats_only:p,last_heartbeat_ago_ms:f,stream_open:v},y)),e.setContext("conversation",{turn_count:null==b?void 0:b.turnCount,conversation_age_ms:M,conversation_created_at:null==b?void 0:b.conversationCreatedAt,agent_mode:null==b?void 0:b.agentMode,checkpoints_enabled:null==b?void 0:b.checkpointsEnabled,is_headless:null==b?void 0:b.isHeadless,background_composer_attached:null==b?void 0:b.backgroundComposerAttached,background_composer_id:null==b?void 0:b.backgroundComposerId}),e.setContext("system",w),o.Cp(I)}))}function u(e,t){const n="string"==typeof t?{actionType:t}:null!=t?t:{};return t=>{(0,r.Fj)()&&c({category:"heartbeat_only"===t.type?"stream_stall_heartbeat_only":"stream_stall",waitingFor:"any_stream_activity",lastActivityAgoMs:"heartbeat_only"===t.type?t.lastMeaningfulActivityAgoMs:t.lastActivityAgoMs,lastActivityType:t.lastActivityType,requestId:t.requestId,conversationId:e,modelName:t.modelName,actionType:n.actionType,heartbeatsOnly:"heartbeat_only"===t.type,lastHeartbeatAgoMs:t.lastServerHeartbeatAgoMs,streamOpen:!t.streamEnded,extra:Object.assign({lastMeaningfulActivityAgoMs:t.lastMeaningfulActivityAgoMs,lastInboundMessageType:t.lastInboundMessageType,lastOutboundMessageType:t.lastOutboundMessageType,aborted:t.aborted,lastClientHeartbeatAgoMs:t.lastClientHeartbeatAgoMs,thresholdMs:t.thresholdMs,execId:n.execId},l(t.handlers))},"warning")}}},"./src/models/index.ts":(e,t,n)=>{n.d(t,{P3:()=>l});var s=n("./src/console-io.ts"),o=n("./src/debug.ts"),r=n("./src/hang-detection.ts"),i=n("./src/models/model-service.ts"),a=n("./src/models/model-utils.ts"),d=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};class l{constructor(){this.availableModels=[],this.aliasMap=new Map,this.listeners=new Set}static init(e,t){return d(this,void 0,void 0,(function*(){const n=new l;return n.models=n.initializeModels(e,t),t.initialModel&&(yield n.models),n}))}initializeModels(e,t){return d(this,void 0,void 0,(function*(){const n=Date.now(),s=setTimeout((()=>{(0,r.Dy)({category:"model_init",waitingFor:"model_fetch_response",lastActivityAgoMs:Date.now()-n,extra:{initialModel:t.initialModel}},"warning")}),3e4);try{const{availableModels:n,defaultModel:o}=yield(0,i.aC)(e);clearTimeout(s),n&&(this.availableModels=n,this.buildAliasMap(n));const r=yield this.selectModel({options:t,defaultModel:o,availableModels:this.availableModels});if(!r)throw new Error("No model found. Please check your model settings.");return this.currentModel=r,this.notifyListeners(),r}catch(e){throw clearTimeout(s),e}}))}selectModel(e){return d(this,void 0,void 0,(function*(){var t;const{options:n,defaultModel:s,availableModels:o}=e,r=n.configProvider.get(),i=e=>{if((0,a.B)(e))return e;if(!0===r.maxMode){const t=(0,a.U)(e);return t.maxMode=!0,t}return e};if(n.initialModel)return i(yield this.handleInitialModel(n.initialModel,n.configProvider));if(!s)return r.model?i(r.model):r.model;if(!r.hasChangedDefaultModel||(null===(t=r.model)||void 0===t?void 0:t.modelId)===s.modelId){const e=i(s);return yield this.updateConfig(n.configProvider,e,!1),e}const d=o.some((e=>{var t;return e.modelId===(null===(t=r.model)||void 0===t?void 0:t.modelId)}));if(d&&r.model)return i(r.model);const l=i(s);return yield this.updateConfig(n.configProvider,l,!1),l}))}handleInitialModel(e,t){return d(this,void 0,void 0,(function*(){let n=this.normalizeModelId(e);return n||(e.startsWith("GENERICBASE")?n={modelId:e,displayModelId:e,displayName:e,displayNameShort:e}:(0,s.uQ)(1,`Cannot use this model: ${e}. Available models: ${this.availableModels.map((e=>e.displayModelId)).join(", ")}`)),yield this.updateConfig(t,n,!0),n}))}updateConfig(e,t,n){return d(this,void 0,void 0,(function*(){const s=e.get().maxMode,o=(0,a.B)(t)?s:!0===t.maxMode;yield e.transform((e=>Object.assign(Object.assign({},e),{model:t,hasChangedDefaultModel:n,maxMode:o})))}))}setCurrentModel(e,t){return d(this,void 0,void 0,(function*(){var n,s;if(yield this.awaitCurrentModel(),!(null!==(s=null===(n=e.modelId)||void 0===n?void 0:n.startsWith("GENERICBASE"))&&void 0!==s&&s||this.availableModels.some((t=>t.modelId===e.modelId))))return;const o=t.get().maxMode,r=(0,a.B)(e)?o:!0===e.maxMode;yield t.transform((t=>Object.assign(Object.assign({},t),{model:e,hasChangedDefaultModel:!0,maxMode:r}))),this.currentModel=e,this.notifyListeners()}))}getCurrentModel(){return this.currentModel}awaitCurrentModel(){return d(this,void 0,void 0,(function*(){if(this.models&&(yield this.models),!this.currentModel)throw new Error("We had an issue initializing the model. Please try again.");return this.currentModel}))}getAvailableModels(){return this.availableModels}awaitAvailableModels(){return d(this,void 0,void 0,(function*(){return yield this.awaitCurrentModel(),this.availableModels}))}normalizeModelId(e){return this.aliasMap.get(e.toLowerCase())}setCurrentModelWithoutPersistence(e){this.currentModel=e,this.notifyListeners()}setModelFromStoredId(e,t){return d(this,void 0,void 0,(function*(){if(!e||"string"!=typeof e)return(0,o.debugLog)("No stored model ID to restore"),!1;const n=t.get(),s=e=>{if((0,a.B)(e))return e;if(!0===n.maxMode){const t=(0,a.U)(e);return t.maxMode=!0,t}return e},r=(yield this.awaitAvailableModels()).find((t=>t.modelId===e));if(r){const e=s(r);return yield this.setCurrentModel(e,t),!0}const i=this.normalizeModelId(e);if(i){(0,o.debugLog)(`Stored model "${e}" resolved via alias to "${i.modelId}"`);const n=s(i);return yield this.setCurrentModel(n,t),!0}if(e.startsWith("GENERICBASE")){const n=s({modelId:e,displayModelId:e,displayName:e,displayNameShort:e});return yield this.setCurrentModel(n,t),!0}return(0,o.debugLog)(`Could not find model with ID: ${e} in available models, keeping current model`),!1}))}buildAliasMap(e){var t;const n=new Map;for(const s of e)if(s.modelId){n.set(s.modelId.toLowerCase(),s),n.set(s.displayModelId.toLowerCase(),s),s.displayName&&n.set(s.displayName.toLowerCase(),s),s.displayNameShort&&n.set(s.displayNameShort.toLowerCase(),s);for(const e of null!==(t=s.aliases)&&void 0!==t?t:[])n.set(e.toLowerCase(),s)}this.aliasMap=n}subscribe(e){return this.listeners.add(e),e(this.currentModel),()=>{this.listeners.delete(e)}}notifyListeners(){for(const e of this.listeners)e(this.currentModel)}static createForTesting(){const e=new l;return e.models=Promise.resolve(void 0),e}}},"./src/models/model-service.ts":(e,t,n)=>{n.d(t,{aC:()=>a});var s=n("../proto/dist/generated/agent/v1/agent_service_pb.js"),o=n("./src/debug.ts"),r=n("./src/utils/error-info.ts"),i=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};function a(e){return i(this,void 0,void 0,(function*(){const[t,n]=yield Promise.allSettled([d(e),l(e)]),s={};return"fulfilled"===t.status&&t.value?s.availableModels=t.value:"rejected"===t.status&&(0,o.debugLogJSON)("models.fetchUsableModels.error",(0,r.q)(t.reason),"ERROR"),"fulfilled"===n.status&&n.value?s.defaultModel=n.value:"rejected"===n.status&&(0,o.debugLogJSON)("models.fetchDefaultModel.error",(0,r.q)(n.reason),"ERROR"),s}))}function d(e){return i(this,void 0,void 0,(function*(){const{models:t}=yield e.getUsableModels(new s.KD({}));return t.length>0?t:void 0}))}function l(e){return i(this,void 0,void 0,(function*(){const{model:t}=yield e.getDefaultModelForCli(new s.Tu({}));return t}))}},"./src/models/model-utils.ts":(e,t,n)=>{function s(e){var t;return"default"===e.modelId||"auto"===e.displayModelId||"auto"===(null===(t=e.displayName)||void 0===t?void 0:t.toLowerCase())}function o(e){return"function"==typeof e.clone?e.clone():{modelId:e.modelId,displayModelId:e.displayModelId,displayName:e.displayName,displayNameShort:e.displayNameShort,maxMode:e.maxMode}}n.d(t,{B:()=>s,U:()=>o})},"./src/shared/cli-background-work-registry.ts":(e,t,n)=>{n.d(t,{t:()=>o});var s=n("../agent-exec/dist/index.js");class o extends s.R1{}},"./src/shared/cli-subagent-host-adapter.ts":(e,t,n)=>{n.d(t,{f:()=>m});var s=n("node:crypto"),o=n("../agent-core/dist/index.js"),r=n("../agent-exec/dist/index.js"),i=n("../agent-kv/dist/index.js"),a=n("../context/dist/index.js"),d=n("../proto/dist/generated/agent/v1/agent_pb.js"),l=n("../proto/dist/generated/agent/v1/selected_context_pb.js"),c=n("./src/utils/interaction-responses.ts"),u=n("./src/shared/cli-background-work-registry.ts"),h=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};class m{constructor(e,t,n=new u.t){this.agentClient=e,this.resources=t,this.backgroundWorkRegistry=n,this.sessions=new Map,this.backgroundRuns=new Map,this.backgroundAckTracker=new r._d,this.lifecycleStore=new r.VM({onStateChange:({sessionId:e,nextState:t})=>{this.syncBackgroundWorkRegistration(e,t)},onQueuedRunReady:({sessionId:e,sourceRunId:t,queuedResume:n})=>{this.startQueuedResumeRun(e,t,n)}})}createOrResumeSession(e,t){return h(this,void 0,void 0,(function*(){var e;if(this.isQueueableResumeMode(t)&&this.isBackgroundRunBusy(t.resumeAgentId))return this.enqueueOrMergeResumePrompt(t.resumeAgentId,t),this.backgroundAckTracker.increment(t.resumeAgentId),t.resumeAgentId;const n=null!==(e=t.resumeAgentId)&&void 0!==e?e:(0,s.randomUUID)();return this.ensureSession(n),n}))}runSession(e,t,n,s){return h(this,void 0,void 0,(function*(){try{if(this.backgroundAckTracker.consume(t))return{status:"background",finalMessage:this.getQueuedFollowUpBackgroundMessage(),toolCallCount:0};if(this.ensureSession(t),n.runInBackground){const s=new AbortController,o=this.runSubagent(e,t,n,s.signal).catch((e=>({status:"error",error:e instanceof Error?e.message:String(e)})));return this.registerBackgroundRun(t,o,s),{status:"background",finalMessage:this.getBackgroundMessage(),toolCallCount:0}}return this.runSubagent(e,t,n,e.signal)}catch(e){throw this.toHostError(e,t)}}))}releaseSession(e){this.isBackgroundRunBusy(e)||(this.sessions.delete(e),this.backgroundRuns.delete(e),this.lifecycleStore.release(e))}ensureSession(e){const t=this.sessions.get(e);if(t)return t;const n=function(e){const t=new i.pH(new i.ve,new i.We),n=(0,i.sh)();return t.setMetadata("agentId",e),t.setMetadata("latestRootBlobId",n.latestRootBlobId),t.setMetadata("name",n.name),t.setMetadata("createdAt",n.createdAt),t.setMetadata("mode",n.mode),t.setMetadata("lastUsedModel",n.lastUsedModel),t.setMetadata("resumeBcId",n.resumeBcId),{agentStore:t}}(e);return this.sessions.set(e,n),n}isBackgroundRunBusy(e){return this.lifecycleStore.isBusy(e)||this.backgroundRuns.has(e)}enqueueOrMergeResumePrompt(e,t){const n={prompt:t.prompt,args:new r.Pw(Object.assign(Object.assign({},t),{prompt:t.prompt,resumeAgentId:e}))};this.lifecycleStore.queueResume(e,{queuedResume:n,mergeQueuedResume:(t,n)=>{const s=(0,r.bx)({existingPrompt:t.prompt,newPrompt:n.prompt});return{prompt:s,args:new r.Pw(Object.assign(Object.assign({},n.args),{prompt:s,resumeAgentId:e}))}}})}registerBackgroundRun(e,t,n){const s=this.lifecycleStore.startRun(e,{abort:()=>n.abort()}),o={runId:s,promise:t,abortController:n,settled:!1};t.then((e=>{o.settled=!0,o.result=e}),(e=>{o.settled=!0;const t=e instanceof Error?e.message:String(e);o.result={status:"error",error:t}})),this.backgroundRuns.set(e,o),t.finally((()=>{const t=this.backgroundRuns.get(e);(null==t?void 0:t.runId)===s&&this.backgroundRuns.delete(e),this.lifecycleStore.finishRun(e,s)}))}startQueuedResumeRun(e,t,n){const s=this.lifecycleStore.getState(e);if("idle"!==s.status&&s.runId===t)try{const t=new AbortController,s=this.runSubagent((0,a.q6)(),e,new r.Pw(Object.assign(Object.assign({},n.args),{prompt:n.prompt,resumeAgentId:e,runInBackground:!0})),t.signal).catch((e=>({status:"error",error:e instanceof Error?e.message:String(e)})));this.registerBackgroundRun(e,s,t)}catch(n){this.lifecycleStore.finishRun(e,t)}}runSubagent(e,t,n,r){return h(this,void 0,void 0,(function*(){const i=this.sessions.get(t);if(!i)return{status:"error",error:`Subagent session not found: ${t}`};const a=new o.hg,u={handleCheckpoint:(e,t)=>h(this,void 0,void 0,(function*(){yield i.agentStore.handleCheckpoint(e,t)})),getLatestCheckpoint:()=>i.agentStore.getLatestCheckpoint()};let m="",g=0;const p={sendUpdate(e,t){return h(this,void 0,void 0,(function*(){switch(t.message.case){case"textDelta":m+=t.message.value.text;break;case"toolCallStarted":g+=1}}))},query(e,t){return h(this,void 0,void 0,(function*(){return(0,c.l)(t,{approveWebSearch:!1,approveWebFetch:!1,webSearchRejectReason:"User Rejected",webFetchRejectReason:"User Rejected",askQuestionRejectReason:"Interactive questions are not supported in cli subagent mode"})}))}},f=new l.xv,v=new d.UserMessageAction({userMessage:new d.UserMessage({text:n.prompt,selectedContext:f,messageId:(0,s.randomUUID)()})}),y=new d.ModelDetails({modelId:n.modelId,displayModelId:n.modelId,displayName:n.modelId}),[b,w]=e.withCancel();r.aborted?w():r.addEventListener("abort",w,{once:!0});try{return yield this.agentClient.run(b,i.agentStore.getConversationStateStructure(),new d.ConversationAction({action:{case:"userMessageAction",value:v}}),y,p,this.resources,i.agentStore.getBlobStore(),a,u,[],{conversationId:t,generationUUID:(0,s.randomUUID)(),subagentTypeName:n.subagentType,suggestNextPrompt:!1}),{status:"completed",finalMessage:m,toolCallCount:g}}catch(e){return r.aborted||b.canceled?{status:"error",error:"Subagent was aborted by the user"}:{status:"error",error:e instanceof Error?e.message:String(e)}}finally{r.removeEventListener("abort",w)}}))}isQueueableResumeMode(e){return Boolean(e.resumeAgentId&&(0,r.UO)(e.prompt))}getBackgroundMessage(){return r.Rt}getQueuedFollowUpBackgroundMessage(){return r.lb}syncBackgroundWorkRegistration(e,t=(0,r.rL)()){"running"!==t.status&&"runningWithQueuedResume"!==t.status?this.backgroundWorkRegistry.clearWork(e):this.backgroundWorkRegistry.upsertWork({id:e,kind:"subagent",state:"running",abort:()=>this.lifecycleStore.abort(e)})}toHostError(e,t){const n=e instanceof Error?e.message:String(e);return new r.aJ(n,{agentId:t,cause:e})}}},"./src/state/index.ts":(e,t,n)=>{n.d(t,{r:()=>i});var s=n("node:crypto"),o=n("node:path"),r=n("../cursor-config/dist/index.js");function i(){const e=(0,s.createHash)("md5").update(process.cwd()).digest("hex");return(0,o.join)((0,r.WI)(),"chats",e)}},"./src/state/session.ts":(e,t,n)=>{n.d(t,{d:()=>o});const s=Object.seal({lastRequest:null}),o=Object.seal({get lastRequest(){return s.lastRequest},recordLastRequest(e,t){const n={id:e,timestamp:Date.now(),path:null==t?void 0:t.path};s.lastRequest=n},getLastRequestId(){var e,t;return null!==(t=null===(e=s.lastRequest)||void 0===e?void 0:e.id)&&void 0!==t?t:null},getLastRequest:()=>s.lastRequest,clearLastRequest(){s.lastRequest=null}})},"./src/state/sqlite-blob-store.ts":(e,t,n)=>{n.d(t,{M:()=>h});var s=n("node:fs"),o=n("node:path"),r=n("../agent-kv/dist/index.js"),i=n("../utils/dist/index.js"),a=n("../../node_modules/.pnpm/sqlite3@5.1.7_patch_hash=aee4b045019cd42c3fc35610736c4496fa74db4d4a28d55c814724e29047da6a/node_modules/sqlite3/lib/sqlite3.js"),d=n.n(a),l=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};const c=new r.aY;class u extends d().Database{}class h extends i.jG{static initAndLoad(e){return l(this,void 0,void 0,(function*(){const t=new h(e);return yield t.getDb(),t}))}constructor(e){super(),this.dbPath=e,this.listeners={agentId:new Set,latestRootBlobId:new Set,name:new Set,createdAt:new Set,mode:new Set,lastUsedModel:new Set},this.isPersisting=!1,this.persistQueued=!1,this.isDisposing=!1,this.inFlightOps=0;const t=(0,o.basename)((0,o.dirname)(this.dbPath));this.metadata=(0,r.sh)(t)}getDb(){return l(this,void 0,void 0,(function*(){return this.dbPromise||(this.dbPromise=new Promise(((e,t)=>{const n=(0,o.dirname)(this.dbPath);(0,s.existsSync)(n)||(0,s.mkdirSync)(n,{recursive:!0});const i=new u(this.dbPath,(n=>{n?t(n):i.serialize((()=>{i.run("PRAGMA journal_mode = WAL"),i.run("PRAGMA synchronous = NORMAL"),i.run("PRAGMA user_version = 1"),i.run("CREATE TABLE IF NOT EXISTS blobs (id TEXT PRIMARY KEY, data BLOB)"),i.run("CREATE TABLE IF NOT EXISTS meta (key TEXT PRIMARY KEY, value TEXT)",(n=>{n?t(n):i.get("SELECT value FROM meta WHERE key = ?","0",((n,s)=>{if(n)t(n);else{if(null==s?void 0:s.value){const e=(0,r.aD)(s.value);this.metadata=c.deserialize(e)}else{const e=c.serialize(this.metadata),t=(0,r.nj)(e);i.run("INSERT OR REPLACE INTO meta (key, value) VALUES (?, ?)","0",t)}e(i)}}))}))}))}))}))),this.dbPromise}))}getBlob(e,t){return l(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),n=(0,r.nj)(t);return yield new Promise(((t,s)=>{e.get("SELECT data FROM blobs WHERE id = ?",n,((e,n)=>{e?s(e):n&&null!=n.data?t(new Uint8Array(n.data)):t(void 0)}))}))}finally{this.inFlightOps--}}}))}setBlob(e,t,n){return l(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),s=(0,r.nj)(t);return yield new Promise(((t,o)=>{e.run("INSERT OR REPLACE INTO blobs (id, data) VALUES (?, ?)",s,Buffer.from(n),(e=>{e?o(e):t()}))}))}finally{this.inFlightOps--}}}))}setBlobLocallyOnly(e,t,n){return l(this,void 0,void 0,(function*(){return Promise.resolve()}))}flush(e){return l(this,void 0,void 0,(function*(){return Promise.resolve()}))}get(e){return this.metadata[e]}valuesEqual(e,t,n){if("latestRootBlobId"===e){const e=t,s=n;if(e===s)return!0;if(!e||!s)return!1;if(e.length!==s.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==s[t])return!1;return!0}return t===n}schedulePersist(){this.dbPromise&&(this.isDisposing||(this.isPersisting?this.persistQueued=!0:(this.isPersisting=!0,this.persistMetadata().finally((()=>{this.isPersisting=!1,this.persistQueued&&(this.persistQueued=!1,this.schedulePersist())})))))}set(e,t){const n=this.metadata[e];if(this.valuesEqual(e,n,t))return;this.metadata=Object.assign(Object.assign({},this.metadata),{[e]:t}),this.dbPromise&&this.schedulePersist();const s=this.listeners[e];s&&s.size>0&&queueMicrotask((()=>{s.forEach((e=>{e()}))}))}persistMetadata(){return l(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),t=c.serialize(this.metadata),n=(0,r.nj)(t);return yield new Promise(((t,s)=>{e.run("INSERT OR REPLACE INTO meta (key, value) VALUES (?, ?)","0",n,(e=>{e?s(e):t()}))}))}finally{this.inFlightOps--}}}))}subscribe(e,t){const n=this.listeners[e];return n?(n.add(t),()=>n.delete(t)):()=>{}}dispose(){return l(this,void 0,void 0,(function*(){return this.disposePromise?this.disposePromise:this.dbPromise?(this.disposePromise=this.cleanup().then((()=>{this.dbPromise=void 0})),this.disposePromise):void 0}))}cleanup(){return l(this,void 0,void 0,(function*(){if(!this.dbPromise)return;for(this.isDisposing=!0,this.persistQueued=!1;this.isPersisting||this.inFlightOps>0;)yield new Promise((e=>setTimeout(e,10)));const e=yield this.dbPromise,t=yield new Promise(((t,n)=>{e.get("SELECT value FROM meta WHERE key = ?","0",((e,s)=>{e?n(e):t(s)}))}));let n=0;if(null==t?void 0:t.value){const e=(0,r.aD)(t.value);n=c.deserialize(e).latestRootBlobId.length}if(yield new Promise((t=>{e.close((()=>t()))})),0!==n);else{this.dbPromise=void 0;const e=(0,o.dirname)(this.dbPath);try{(0,s.rmSync)(e,{recursive:!0,force:!0})}catch(e){}}}))}}},"./src/team-hooks-sync.ts":(e,t,n)=>{n.d(t,{O:()=>l,a:()=>u});var s=n("node:fs/promises"),o=n("node:os"),r=n("node:path"),i=n.n(r),a=n("../proto/dist/generated/aiserver/v1/dashboard_pb.js"),d=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};function l(e,t,n){return Object.assign(Object.assign({},e),{teamHooks:t,configDirs:Object.assign(Object.assign({},e.configDirs),{team:n})})}function c(){return"win32"===(0,o.platform)()}function u(e){return d(this,void 0,void 0,(function*(){var t,n,r,d;const{dashboardClient:l,teamId:u}=e;try{const e=function(){switch((0,o.platform)()){case"darwin":return"Macintosh";case"win32":return"Windows";default:return"Linux"}}(),h=i().join((0,o.homedir)(),".cursor","managed",`team_${u}`,"hooks"),m=(null!==(t=(yield l.getTeamHooks(new a.GetTeamHooksRequest({activeOnly:!0}))).hooks)&&void 0!==t?t:[]).filter((t=>t.operatingSystems&&t.operatingSystems.length>0&&t.operatingSystems.includes(e)));yield(0,s.mkdir)(h,{recursive:!0});const g=new Set,p={};for(const e of m){let t=i().basename(e.scriptName||`team-hook-${e.id}`);c()&&(t.endsWith(".ps1")||t.endsWith(".bat")||t.endsWith(".cmd")||(t=`${t}.ps1`));const o=i().extname(t),a=o.length>0?t.slice(0,-o.length):t;let l=t,u=1;for(;g.has(l);)l=`${a}-${e.id}-${u}${o}`,u+=1;const m=i().join(h,l),f=null!==(n=e.scriptContent)&&void 0!==n?n:"";try{yield(0,s.writeFile)(m,f,"utf-8"),c()||(yield(0,s.chmod)(m,493)),g.add(l);const t=null!==(r=e.hookStep)&&void 0!==r?r:"beforeShellExecution",n=null!==(d=p[t])&&void 0!==d?d:[];n.push({command:m}),p[t]=n}catch(e){console.warn(`[team-hooks-sync] Failed to write ${t}:`,e)}}const f={version:1,hooks:p};try{const e=yield(0,s.readdir)(h,{withFileTypes:!0});for(const t of e)if(t.isFile()&&!g.has(t.name))try{yield(0,s.rm)(i().join(h,t.name))}catch(e){}}catch(e){}return{teamHooks:f,teamDir:h}}catch(e){return console.warn("Team hooks fetch/prepare failed; continuing without team hooks",e),null}}))}},"./src/tracing.ts":(e,t,n)=>{n.d(t,{H:()=>m});var s=n("node:os"),o=n.n(s),r=n("../../node_modules/.pnpm/@opentelemetry+api@1.9.0/node_modules/@opentelemetry/api/build/esm/diag-api.js"),i=n("../../node_modules/.pnpm/@opentelemetry+api@1.9.0/node_modules/@opentelemetry/api/build/esm/diag/types.js"),a=n("../../node_modules/.pnpm/@opentelemetry+exporter-trace-otlp-proto@0.203.0_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/exporter-trace-otlp-proto/build/esm/platform/node/OTLPTraceExporter.js"),d=n("../../node_modules/.pnpm/@opentelemetry+resources@2.0.1_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/resources/build/esm/ResourceImpl.js"),l=n("../../node_modules/.pnpm/@opentelemetry+sdk-node@0.203.0_@opentelemetry+api@1.9.0/node_modules/@opentelemetry/sdk-node/build/src/index.js"),c=n("./src/debug.ts"),u=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};let h=!1;function m(e){return u(this,void 0,void 0,(function*(){if(h)return;const t={verbose:(...e)=>{(0,c.debugLog)("otel.verbose",...e)},debug:(...e)=>{(0,c.debugLog)("otel.debug",...e)},info:(...e)=>{(0,c.debugLog)("otel.info",...e)},warn:(...e)=>{(0,c.debugLog)("otel.warn",...e)},error:(...e)=>{(0,c.debugLog)("otel.error",...e)}};let n;r.s.setLogger(t,i.u.ERROR);try{n=e?yield function(e){return u(this,void 0,void 0,(function*(){const t=e.backendUrl,n=yield e.credentialManager.getAccessToken();if(!n)throw new Error("No access token found for tracing exporter");const s={authorization:`Bearer ${n}`,"x-ghost-mode":(()=>{var t,n;try{const s=null===(n=null===(t=e.configProvider)||void 0===t?void 0:t.get().privacyCache)||void 0===n?void 0:n.ghostMode;return"boolean"!=typeof s||s}catch(e){return!0}})()?"true":"false","x-cursor-client-version":"agent-cli"},o=`${t}/v1/traces`;return new a.Q({url:o,headers:s})}))}(e):void 0}catch(e){return void(0,c.debugLog)("Failed to create OpenTelemetry exporter",e)}const s=e?function(e){var t,n,s;const r=o().platform(),i=o().arch(),a=o().release(),l=process.version,c=null!==(t="2026.02.13-41ac335")?t:"unknown",u=o().hostname();return(0,d.QZ)({"service.name":null!==(n=e.serviceName)&&void 0!==n?n:"cursor-agent-cli","service.version":null!==(s=e.serviceVersion)&&void 0!==s?s:c,"host.name":u,"os.type":r,"os.version":a,"process.runtime.name":"node","process.runtime.version":l,"client.os.platform":r,"client.os.release":a,"client.arch":i,"client.node.version":l,"client.cli.version":c})}(e):void 0,m=new l.P({autoDetectResources:!1,traceExporter:n,resource:s});try{m.start()}catch(e){(0,c.debugLog)("Failed to start OpenTelemetry SDK",e)}const g=()=>{m.shutdown().catch((e=>{(0,c.debugLog)("Error shutting down OpenTelemetry SDK",e)}))};process.once("beforeExit",g),process.once("SIGTERM",g),process.once("SIGINT",g),h=!0}))}},"./src/utils/clipboard.ts":(e,t,n)=>{n.d(t,{e:()=>d}),n("node:child_process"),n("node:fs");var s=n("node:os"),o=(n("node:path"),n("../utils/dist/index.js")),r=n("../../node_modules/.pnpm/rxjs@8.0.0-alpha.14/node_modules/rxjs/dist/cjs/index.js"),i=n("./src/debug.ts"),a=function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};function d(e){return a(this,void 0,void 0,(function*(){if("darwin"===(0,s.platform)())try{return yield(0,o.DP)("pbcopy",[],{stdin:(0,r.of)(e)}),!0}catch(e){return(0,i.debugLog)("clipboard","pbcopy failed",String(e)),!1}else if("linux"===(0,s.platform)()){const t=process.env.WAYLAND_DISPLAY?"wayland":process.env.DISPLAY?"x11":"none";if("none"===t)return(0,i.debugLog)("clipboard","No display environment detected (WAYLAND_DISPLAY and DISPLAY not set). Clipboard not available."),!1;if("wayland"===t)try{return yield(0,o.DP)("wl-copy",[],{stdin:(0,r.of)(e)}),!0}catch(e){return(0,i.debugLog)("clipboard","wl-copy failed",String(e)),!1}try{return yield(0,o.DP)("xclip",["-selection","clipboard"],{stdin:(0,r.of)(e)}),!0}catch(e){return(0,i.debugLog)("clipboard","xclip failed",String(e)),!1}}else if("win32"===(0,s.platform)())try{return yield(0,o.DP)("C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",["-c","[Console]::InputEncoding = [System.Text.Encoding]::UTF8; $input | Set-Clipboard"],{stdin:(0,r.of)(e)}),!0}catch(e){return(0,i.debugLog)("clipboard","PowerShell Set-Clipboard failed",String(e)),!1}return!1}))}},"./src/utils/interaction-responses.ts":(e,t,n)=>{n.d(t,{l:()=>a});var s=n("../agent-core/dist/index.js"),o=n("../proto/dist/generated/agent/v1/ask_question_tool_pb.js"),r=n("../proto/dist/generated/agent/v1/create_plan_tool_pb.js"),i=n("../proto/dist/generated/agent/v1/setup_vm_environment_tool_pb.js");const a=(e,t)=>{var n,a;switch(e.query.case){case"webSearchRequestQuery":return t.approveWebSearch?s.x1.webSearchApproved(e.id):s.x1.webSearchRejected(e.id,null!==(n=t.webSearchRejectReason)&&void 0!==n?n:"User Rejected");case"webFetchRequestQuery":return e.query.value.skipApproval||t.approveWebFetch?s.x1.webFetchApproved(e.id):s.x1.webFetchRejected(e.id,null!==(a=t.webFetchRejectReason)&&void 0!==a?a:"User Rejected");case"switchModeRequestQuery":return s.x1.switchModeApproved(e.id);case"askQuestionInteractionQuery":{const n=new o.tz({result:{case:"rejected",value:new o.ox({reason:t.askQuestionRejectReason})}});return s.x1.askQuestion(e.id,n)}case"createPlanRequestQuery":{const t=new r.bK({result:{case:"success",value:new r.Jo},planUri:""});return s.x1.createPlan(e.id,t)}case"setupVmEnvironmentArgs":{const t=new i.r$({result:{case:"success",value:new i.JH}});return s.x1.setupVmEnvironment(e.id,t)}case"prManagementRequestQuery":return s.x1.prManagement(e.id,(0,s.p_)());case"mcpAuthRequestQuery":return s.x1.mcpAuthRejected(e.id,"MCP authentication is not supported in CLI mode");case void 0:throw new Error("Missing interaction query type");default:throw new Error("Unhandled interaction query type")}}},"./src/utils/interaction-utils.ts":(e,t,n)=>{n.d(t,{AX:()=>r,Kx:()=>l,N$:()=>a,cT:()=>c,dy:()=>d,iX:()=>i,mb:()=>u});var s=n("../proto/dist/generated/agent/v1/agent_pb.js"),o=n("../proto/dist/generated/agent/v1/ask_question_tool_pb.js");const r=e=>{const t={};for(const n of e.questions)t[n.id]=[];return{activeQuestionIndex:0,activeOptionIndex:0,selectionsByQuestionId:t}},i=(e,t)=>{const n=e.questions.map((e=>{var n;const s=null!==(n=t.selectionsByQuestionId[e.id])&&void 0!==n?n:[];return new o.wh({questionId:e.id,selectedOptionIds:s})}));return new o.tz({result:{case:"success",value:new o.dE({answers:n})}})},a=e=>new o.tz({result:{case:"rejected",value:new o.ox({reason:null!=e?e:"Questions skipped by user"})}}),d=e=>{switch(e){case"agent":return"Agent";case"plan":return"Plan";case"debug":return"Debug";case"chat":case"ask":case"search":return"Ask";case"background":return"Background";case"triage":return"Triage";case"project":return"Project";case"spec":return"Spec";default:return e}},l=(e,t)=>{switch(e){case"plan":return"plan";case"background":return"background";case"chat":case"ask":case"search":return"search";default:return"plan"===t?"default":t}},c=e=>{switch(e){case"plan":return s.AgentMode.PLAN;case"search":return s.AgentMode.ASK;default:return s.AgentMode.AGENT}},u=e=>{switch(e){case"default":case"auto-run":case"background":default:return"agent";case"plan":return"plan";case"search":return"ask"}}},"./src/utils/url-utils.ts":(e,t,n)=>{function s(e){var t;try{let t=e;return e.includes("://")||(t=`https://${e}`),new URL(t).hostname}catch(n){const s=e.match(/(?:https?:\/\/)?([^/\s:]+)/);return null!==(t=null==s?void 0:s[1])&&void 0!==t?t:e}}function o(e,t){return t.some((t=>{var n,s;const o=t.match(/^\s*WebFetch\s*\((.*)\)\s*$/);if(!o)return!1;const r=null!==(s=null===(n=o[1])||void 0===n?void 0:n.trim())&&void 0!==s?s:"";return function(e,t){if("*"===t)return!0;if(t.startsWith("*.")){const n=t.slice(2);return e===n||e.endsWith(`.${n}`)}return t===e}(e,r)}))}n.d(t,{BF:()=>s,hD:()=>o})}};