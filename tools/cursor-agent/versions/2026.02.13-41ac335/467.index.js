try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="51f06b8d-6108-42d7-a970-ffe83093ae4a",e._sentryDebugIdIdentifier="sentry-dbid-51f06b8d-6108-42d7-a970-ffe83093ae4a")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.02.13-41ac335"}}catch(e){}}(),exports.id=467,exports.ids=[156,467],exports.modules={"./src/always-deny-decision-provider.ts":(e,t,n)=>{n.d(t,{N:()=>o});class o{requestApproval(e){return Promise.resolve({approved:!1})}}},"./src/commands/sandbox-debug.ts":(e,t,n)=>{n.r(t),n.d(t,{handleSandboxDebug:()=>b});var o=n("node:child_process"),r=n("node:fs/promises"),s=n("node:os"),i=n("node:path"),a=n.n(i),c=n("../context/dist/index.js"),d=n("../cursor-config/dist/index.js"),l=n("../local-exec/dist/index.js"),u=n("../shell-exec/dist/index.js"),p=n("./src/always-deny-decision-provider.ts"),h=n("./src/console-io.ts"),g=n("./src/shared/resources.ts"),f=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},m=function(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var o,r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(void 0===o){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose],n&&(r=o)}if("function"!=typeof o)throw new TypeError("Object not disposable.");r&&(o=function(){try{r.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:o,async:n})}else n&&e.stack.push({async:!0});return t},v=function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var o,r=0;return function e(){for(;o=t.stack.pop();)try{if(!o.async&&1===r)return r=0,t.stack.push(o),Promise.resolve().then(e);if(o.dispose){var s=o.dispose.call(o.value);if(o.async)return r|=2,Promise.resolve(s).then(e,(function(t){return n(t),e()}))}else r|=1}catch(e){n(e)}if(1===r)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}}("function"==typeof SuppressedError?SuppressedError:function(e,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=e,o.suppressed=t,o}),y=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise((function(o,r){!function(e,t,n,o){Promise.resolve(o).then((function(t){e({value:t,done:n})}),t)}(o,r,(t=e[n](t)).done,t.value)}))}}};function b(e,t,n,i){return f(this,void 0,void 0,(function*(){var b,w,k,x;const S={stack:[],error:void 0,hasError:!1};try{const v=m(S,(0,c.VI)(e.withName("handleSandboxDebug")),!1),O=String(i.allowPaths||"").split(",").map((e=>e.trim())).filter((e=>e.length>0)),I=String(i.readonlyPaths||"").split(",").map((e=>e.trim())).filter((e=>e.length>0)),E=String(i.blockedPatterns||"").split(",").map((e=>e.trim())).filter((e=>e.length>0)),T=(e=>{try{const t=(0,o.execFileSync)("git",["rev-parse","--show-toplevel"],{cwd:e,stdio:["ignore","pipe","ignore"]}).toString("utf8").trim();if(t&&t.length>0)return t}catch(e){}return(0,d.Xq)(e)})(process.cwd()),C=yield function(e){return f(this,void 0,void 0,(function*(){const t=new l.xK,n=new l.E1(t,void 0,[e]),o=yield n.getCursorIgnoreMapping();return Object.assign({},o)}))}(T),A=(0,u.nq)(E,T),D=Object.assign(Object.assign({},C),A),_=i.sbDebug?`${s.tmpdir()}/cursor-sandbox-${Date.now()}`:void 0;if(_&&_.length>0)try{yield r.mkdir(_,{recursive:!0})}catch(e){(0,h.OT)(`Error creating debug directory: ${_}`)}const M=n&&n.length>0?`${t} ${n.join(" ")}`:t;try{const t=yield d.FO.loadFromDefaults(e),n=new p.N;yield(0,g._Y)(v.ctx,{configProvider:t,decisionProvider:n,workingDirectory:process.cwd(),getIsAutoRun:()=>!1}),(0,h.OT)(`Executing command: ${M}`),(0,h.OT)(`Working directory: ${process.cwd()}`);const o=i.sandbox?{type:"workspace_readwrite",networkPolicy:i.network?(0,u.T6)():(0,u.Po)(),additionalReadwritePaths:O,additionalReadonlyPaths:I,debugOutputDir:_,ignoreMapping:D}:{type:"insecure_none",debugOutputDir:_};(0,h.OT)(`Sandbox policy: ${JSON.stringify(o,null,2)}\n`);const s=(0,u.Fn)(),c=new l.MX(s);let f="",m="",S=null,E=[];try{for(var R,P=!0,j=y(c.execute(v.ctx,{command:M,workingDirectory:process.cwd(),sandboxPolicy:{perRepo:o},captureSandboxDenies:!0}));!(b=(R=yield j.next()).done);P=!0){x=R.value,P=!1;const e=x;"stdout"===e.type?f+=e.data:"stderr"===e.type?m+=e.data:"exit"===e.type?S=e.code:"sandbox_denies"===e.type&&(E=e.events)}}catch(e){w={error:e}}finally{try{P||b||!(k=j.return)||(yield k.call(j))}finally{if(w)throw w.error}}let T="",C="";if(_){const e=(new Date).toISOString().replace(/[:.]/g,"-");T=a().join(_,`stdout-${e}.log`),C=a().join(_,`stderr-${e}.log`);try{yield r.writeFile(T,null!=f?f:""),yield r.writeFile(C,null!=m?m:"")}catch(e){}}const A=(e,t)=>(e||"").split(/\r?\n/).slice(-t).join("\n");if(0===S){if((0,h.OT)("\n=== COMMAND SUCCESS ==="),(0,h.OT)("Exit code: 0"),f){const e=A(f,500);(0,h.OT)(`\nSTDOUT (last 500 lines):\n${e}`),_&&T&&(0,h.OT)(`Full STDOUT saved to: ${T}`)}if(m){const e=A(m,500);(0,h.OT)(`\nSTDERR (last 500 lines):\n${e}`),_&&C&&(0,h.OT)(`Full STDERR saved to: ${C}`)}}else{if((0,h.OT)("\n=== COMMAND FAILURE ==="),(0,h.OT)(`Exit code: ${null!=S?S:-1}`),f){const e=A(f,500);(0,h.OT)(`\nSTDOUT (last 500 lines):\n${e}`),_&&T&&(0,h.OT)(`Full STDOUT saved to: ${T}`)}if(m){const e=A(m,500);(0,h.OT)(`\nSTDERR (last 500 lines):\n${e}`),_&&C&&(0,h.OT)(`Full STDERR saved to: ${C}`)}}if(E.length>0)try{const e=new Map;for(const t of E){const{processName:n,operation:o,target:r,timestamp:s,relationship:i}=t;if(!(n&&o&&r&&s))continue;const a=`${n}|||${o}|||${r}`,c=e.get(a);c?new Date(s).getTime()<new Date(c.timestamp).getTime()&&e.set(a,{processName:n,timestamp:s,operation:o,target:r,relationship:i}):e.set(a,{processName:n,timestamp:s,operation:o,target:r,relationship:i})}const t=Array.from(e.values()),n=t.filter((e=>"related"===e.relationship)),o=t.filter((e=>"maybe_related"===e.relationship)),r=t.filter((e=>"probably_unrelated"===e.relationship)),s=e=>e.sort(((e,t)=>e.processName.localeCompare(t.processName)||e.operation.localeCompare(t.operation)||e.target.localeCompare(t.target)||e.timestamp.localeCompare(t.timestamp))),i=s(n),a=s(o),c=s(r),d=["process","timestamp","action","target"],l=[...i.map((e=>[e.processName,e.timestamp,e.operation,e.target])),...a.map((e=>[e.processName,e.timestamp,e.operation,e.target])),...c.map((e=>[e.processName,e.timestamp,e.operation,e.target]))],u=d.map(((e,t)=>Math.max(e.length,...l.map((e=>{var n,o;return null!==(o=null===(n=e[t])||void 0===n?void 0:n.length)&&void 0!==o?o:0}))))),p=e=>e.map(((e,t)=>(null!=e?e:"").padEnd(u[t]))).join("  ");if((0,h.OT)("\n=== SANDBOX DENIES ==="),i.length>0){(0,h.OT)(`\nðŸ”´ RELATED EVENTS (${i.length}):`),(0,h.OT)(p(d)),(0,h.OT)(u.map((e=>"-".repeat(e))).join("  "));for(const e of i)(0,h.OT)(p([e.processName,e.timestamp,e.operation,e.target]))}if(a.length>0){(0,h.OT)(`\nðŸŸ¡ MAYBE RELATED EVENTS (${a.length}):`),(0,h.OT)(p(d)),(0,h.OT)(u.map((e=>"-".repeat(e))).join("  "));for(const e of a)(0,h.OT)(p([e.processName,e.timestamp,e.operation,e.target]))}if(c.length>0){(0,h.OT)(`\nðŸŸ¢ PROBABLY UNRELATED EVENTS (${c.length}):`),(0,h.OT)(p(d)),(0,h.OT)(u.map((e=>"-".repeat(e))).join("  "));for(const e of c)(0,h.OT)(p([e.processName,e.timestamp,e.operation,e.target]))}0===t.length&&(0,h.OT)("No denies captured")}catch(e){(0,h.OT)(`Failed to display sandbox denies: ${e}`)}if(_)try{const e=yield r.readdir(_);if(e.length>0){(0,h.OT)("\n=== DEBUG FILES CREATED ===");for(const t of e){const e=a().join(_,t);(0,h.OT)(`  ${e}`)}}else(0,h.OT)(`\nNo debug files created in: ${_}`)}catch(e){(0,h.OT)(`Error reading debug directory: ${e}`)}process.exit(null!=S?S:0)}catch(e){(0,h.OT)(`Failed to execute command: ${e}`),process.exit(1)}}catch(e){S.error=e,S.hasError=!0}finally{v(S)}}))}},"./src/cursor-blame/cli-ai-code-tracker.ts":(e,t,n)=>{n.d(t,{L:()=>p,e:()=>h});var o=n("node:fs/promises"),r=n("node:os"),s=n("node:path"),i=n("../agent-analytics/dist/index.js"),a=n("../agent-analytics/dist/commit-scoring/index.js"),c=n("../agent-analytics/dist/node.js"),d=n("./src/cursor-blame/format-lineage-callbacks.ts"),l=n("./src/cursor-blame/sqlite-adapter.ts"),u=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};function p(e,t){return(null==e?void 0:e.modelId)||(null==e?void 0:e.displayModelId)||(null==e?void 0:e.displayName)||t||"unknown"}class h{constructor(e){var t,n;this.initPromise=null,this.trackedContent=new Map,this.workspacePath=e.workspacePath,this.conversationId=e.conversationId,this.model=null!==(t=e.model)&&void 0!==t?t:"unknown",this.gitOperations=new c.Z;const o=null!==(n=e.dbPath)&&void 0!==n?n:(0,s.join)((0,r.homedir)(),".cursor","ai-tracking","ai-code-tracking.db"),a=(0,l.$)();this.storage=new i.Ou(a,o)}ensureInitialized(){return this.initPromise||(this.initPromise=this.storage.initialize()),this.initPromise}trackDelete(e){return u(this,void 0,void 0,(function*(){const{path:t}=e;yield this.ensureInitialized();const n=yield(0,i.Mz)(this.gitOperations,t,t.replace(/\\/g,"/"));yield this.storage.recordAiDeletedFile(n,{conversationId:this.conversationId,model:this.model})}))}trackWrite(e){return u(this,void 0,void 0,(function*(){var t;const{path:n,beforeContent:o,afterContent:r,metadata:c}=e;if(o===r)return;yield this.ensureInitialized();const d=yield(0,i.Mz)(this.gitOperations,n,n.replace(/\\/g,"/")),l=(null!=o?o:"").split("\n"),u=r.split("\n"),p=(0,a.ld)(l,u);if(0===p.length)return;const h=(0,a.Zd)(n),g={source:a.IA.CLI,conversationId:this.conversationId,requestId:null!==(t=c.toolCallId)&&void 0!==t?t:void 0,model:this.model,fileExtension:h||void 0,fileName:n},f=(0,a.hA)(d,l,u,p,g,{normalizeLines:!0});f.length>0&&(yield this.storage.storeHashes(f.map((e=>{var{operationType:t}=e;return function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(e,["operationType"])}))));const m=(0,s.resolve)(this.workspacePath,n);this.trackedContent.set(d,{content:r,absolutePath:m,gitPath:d,fileExtension:h||"txt",metadata:g,timestamp:Date.now()}),yield this.storage.storeTrackedFileContent(d,r,{conversationId:this.conversationId,model:this.model,fileExtension:h||void 0})}))}finalizeTracking(){return u(this,void 0,void 0,(function*(){yield this.ensureInitialized();let e=0;const t=[];for(const[n,r]of this.trackedContent)try{const s=yield(0,o.readFile)(r.absolutePath,"utf-8").catch((()=>null));if(null===s||s===r.content)continue;const i=r.content.split("\n"),c=s.split("\n"),l=(0,a.ld)(i,c);if(0===l.length)continue;const u=(0,a.yF)(r.content,s,r.fileExtension,l);if(0===u.size)continue;const p=yield(0,a.yY)(u,r.content,s,n,r.fileExtension,!0,(0,d.L)(this.storage));p>0&&(e+=p,t.push(n)),this.trackedContent.set(n,Object.assign(Object.assign({},r),{content:s,timestamp:Date.now()}))}catch(e){console.error(`[CliAiCodeTracker] Error processing format changes for ${n}:`,e)}return{filesProcessed:this.trackedContent.size,hashesAdded:e,filesWithFormatChanges:t}}))}clearTrackedContent(){this.trackedContent.clear()}getTrackedFileCount(){return this.trackedContent.size}close(){return u(this,void 0,void 0,(function*(){yield this.storage.close()}))}}},"./src/sandbox-gate.ts":(e,t,n)=>{n.d(t,{Y:()=>c});var o=n("./src/statsig.ts");const r="composer_sandbox_settings_visible",s="sandbox_force_disable_linux",i="sandbox_force_disable_win32";function a(e,t){return(0,o.mD)()?(0,o.QF)(e):t}function c(e="linux"){return!(!a(r,!0)||"linux"===e&&a(s,!1)||"win32"===e&&a(i,!0))}},"./src/shared/autorun-mode.ts":(e,t,n)=>{n.d(t,{Fo:()=>a,Hs:()=>c,eM:()=>d});var o=n("../shell-exec/dist/index.js"),r=n("./src/debug.ts"),s=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};const i=new WeakMap;function a(e){return s(this,void 0,void 0,(function*(){let t=i.get(e);if(t)return t;try{const n=yield e.getAutoRunControls(),o=!0===(null==n?void 0:n.enabled)&&!0!==n.enableRunEverything;return t=Promise.resolve(!o),i.set(e,t),t}catch(e){return(0,r.debugLogJSON)("Warning: Could not fetch team admin settings for auto-run check:",e),!0}}))}function c(e){return s(this,void 0,void 0,(function*(){const t=function(e){var t,n;const{configProvider:r,sandboxOverride:s,sandboxDefaultEnabled:i=!1,sandboxFeatureGateEnabled:a=!0}=e;if(!a)return!1;if(!(0,o.K3)())return!1;const c=r.get(),d=i?"enabled":"disabled";return"enabled"===(null!==(n=null!=s?s:null===(t=c.sandbox)||void 0===t?void 0:t.mode)&&void 0!==n?n:d)}(e);return e.getIsAutoRun()?{approvalMode:(yield a(e.autoRunControlsProvider))?"unrestricted":"allowlist",sandboxAvailable:t}:{approvalMode:"allowlist",sandboxAvailable:t}}))}function d(e){return s(this,void 0,void 0,(function*(){const{approvalMode:t}=yield c(e);return"unrestricted"===t}))}},"./src/shared/cli-background-work-registry.ts":(e,t,n)=>{n.d(t,{t:()=>r});var o=n("../agent-exec/dist/index.js");class r extends o.R1{}},"./src/shared/cli-subagent-host-adapter.ts":(e,t,n)=>{n.d(t,{f:()=>h});var o=n("node:crypto"),r=n("../agent-core/dist/index.js"),s=n("../agent-exec/dist/index.js"),i=n("../agent-kv/dist/index.js"),a=n("../context/dist/index.js"),c=n("../proto/dist/generated/agent/v1/agent_pb.js"),d=n("../proto/dist/generated/agent/v1/selected_context_pb.js"),l=n("./src/utils/interaction-responses.ts"),u=n("./src/shared/cli-background-work-registry.ts"),p=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};class h{constructor(e,t,n=new u.t){this.agentClient=e,this.resources=t,this.backgroundWorkRegistry=n,this.sessions=new Map,this.backgroundRuns=new Map,this.backgroundAckTracker=new s._d,this.lifecycleStore=new s.VM({onStateChange:({sessionId:e,nextState:t})=>{this.syncBackgroundWorkRegistration(e,t)},onQueuedRunReady:({sessionId:e,sourceRunId:t,queuedResume:n})=>{this.startQueuedResumeRun(e,t,n)}})}createOrResumeSession(e,t){return p(this,void 0,void 0,(function*(){var e;if(this.isQueueableResumeMode(t)&&this.isBackgroundRunBusy(t.resumeAgentId))return this.enqueueOrMergeResumePrompt(t.resumeAgentId,t),this.backgroundAckTracker.increment(t.resumeAgentId),t.resumeAgentId;const n=null!==(e=t.resumeAgentId)&&void 0!==e?e:(0,o.randomUUID)();return this.ensureSession(n),n}))}runSession(e,t,n,o){return p(this,void 0,void 0,(function*(){try{if(this.backgroundAckTracker.consume(t))return{status:"background",finalMessage:this.getQueuedFollowUpBackgroundMessage(),toolCallCount:0};if(this.ensureSession(t),n.runInBackground){const o=new AbortController,r=this.runSubagent(e,t,n,o.signal).catch((e=>({status:"error",error:e instanceof Error?e.message:String(e)})));return this.registerBackgroundRun(t,r,o),{status:"background",finalMessage:this.getBackgroundMessage(),toolCallCount:0}}return this.runSubagent(e,t,n,e.signal)}catch(e){throw this.toHostError(e,t)}}))}releaseSession(e){this.isBackgroundRunBusy(e)||(this.sessions.delete(e),this.backgroundRuns.delete(e),this.lifecycleStore.release(e))}ensureSession(e){const t=this.sessions.get(e);if(t)return t;const n=function(e){const t=new i.pH(new i.ve,new i.We),n=(0,i.sh)();return t.setMetadata("agentId",e),t.setMetadata("latestRootBlobId",n.latestRootBlobId),t.setMetadata("name",n.name),t.setMetadata("createdAt",n.createdAt),t.setMetadata("mode",n.mode),t.setMetadata("lastUsedModel",n.lastUsedModel),t.setMetadata("resumeBcId",n.resumeBcId),{agentStore:t}}(e);return this.sessions.set(e,n),n}isBackgroundRunBusy(e){return this.lifecycleStore.isBusy(e)||this.backgroundRuns.has(e)}enqueueOrMergeResumePrompt(e,t){const n={prompt:t.prompt,args:new s.Pw(Object.assign(Object.assign({},t),{prompt:t.prompt,resumeAgentId:e}))};this.lifecycleStore.queueResume(e,{queuedResume:n,mergeQueuedResume:(t,n)=>{const o=(0,s.bx)({existingPrompt:t.prompt,newPrompt:n.prompt});return{prompt:o,args:new s.Pw(Object.assign(Object.assign({},n.args),{prompt:o,resumeAgentId:e}))}}})}registerBackgroundRun(e,t,n){const o=this.lifecycleStore.startRun(e,{abort:()=>n.abort()}),r={runId:o,promise:t,abortController:n,settled:!1};t.then((e=>{r.settled=!0,r.result=e}),(e=>{r.settled=!0;const t=e instanceof Error?e.message:String(e);r.result={status:"error",error:t}})),this.backgroundRuns.set(e,r),t.finally((()=>{const t=this.backgroundRuns.get(e);(null==t?void 0:t.runId)===o&&this.backgroundRuns.delete(e),this.lifecycleStore.finishRun(e,o)}))}startQueuedResumeRun(e,t,n){const o=this.lifecycleStore.getState(e);if("idle"!==o.status&&o.runId===t)try{const t=new AbortController,o=this.runSubagent((0,a.q6)(),e,new s.Pw(Object.assign(Object.assign({},n.args),{prompt:n.prompt,resumeAgentId:e,runInBackground:!0})),t.signal).catch((e=>({status:"error",error:e instanceof Error?e.message:String(e)})));this.registerBackgroundRun(e,o,t)}catch(n){this.lifecycleStore.finishRun(e,t)}}runSubagent(e,t,n,s){return p(this,void 0,void 0,(function*(){const i=this.sessions.get(t);if(!i)return{status:"error",error:`Subagent session not found: ${t}`};const a=new r.hg,u={handleCheckpoint:(e,t)=>p(this,void 0,void 0,(function*(){yield i.agentStore.handleCheckpoint(e,t)})),getLatestCheckpoint:()=>i.agentStore.getLatestCheckpoint()};let h="",g=0;const f={sendUpdate(e,t){return p(this,void 0,void 0,(function*(){switch(t.message.case){case"textDelta":h+=t.message.value.text;break;case"toolCallStarted":g+=1}}))},query(e,t){return p(this,void 0,void 0,(function*(){return(0,l.l)(t,{approveWebSearch:!1,approveWebFetch:!1,webSearchRejectReason:"User Rejected",webFetchRejectReason:"User Rejected",askQuestionRejectReason:"Interactive questions are not supported in cli subagent mode"})}))}},m=new d.xv,v=new c.UserMessageAction({userMessage:new c.UserMessage({text:n.prompt,selectedContext:m,messageId:(0,o.randomUUID)()})}),y=new c.ModelDetails({modelId:n.modelId,displayModelId:n.modelId,displayName:n.modelId}),[b,w]=e.withCancel();s.aborted?w():s.addEventListener("abort",w,{once:!0});try{return yield this.agentClient.run(b,i.agentStore.getConversationStateStructure(),new c.ConversationAction({action:{case:"userMessageAction",value:v}}),y,f,this.resources,i.agentStore.getBlobStore(),a,u,[],{conversationId:t,generationUUID:(0,o.randomUUID)(),subagentTypeName:n.subagentType,suggestNextPrompt:!1}),{status:"completed",finalMessage:h,toolCallCount:g}}catch(e){return s.aborted||b.canceled?{status:"error",error:"Subagent was aborted by the user"}:{status:"error",error:e instanceof Error?e.message:String(e)}}finally{s.removeEventListener("abort",w)}}))}isQueueableResumeMode(e){return Boolean(e.resumeAgentId&&(0,s.UO)(e.prompt))}getBackgroundMessage(){return s.Rt}getQueuedFollowUpBackgroundMessage(){return s.lb}syncBackgroundWorkRegistration(e,t=(0,s.rL)()){"running"!==t.status&&"runningWithQueuedResume"!==t.status?this.backgroundWorkRegistry.clearWork(e):this.backgroundWorkRegistry.upsertWork({id:e,kind:"subagent",state:"running",abort:()=>this.lifecycleStore.abort(e)})}toHostError(e,t){const n=e instanceof Error?e.message:String(e);return new s.aJ(n,{agentId:t,cause:e})}}},"./src/shared/resources.ts":(e,t,n)=>{n.d(t,{A1:()=>E,Pb:()=>O,_Y:()=>T});var o=n("node:os"),r=n("node:path"),s=n.n(r),i=n("../agent-exec/dist/index.js"),a=n("../cli-credentials/dist/index.js"),c=n("../context/dist/index.js"),d=n("../cursor-config/dist/index.js"),l=n("../hooks-exec/dist/index.js"),u=n("../local-exec/dist/index.js"),p=n("../shell-exec/dist/index.js"),h=n("./src/cursor-blame/cli-ai-code-tracker.ts"),g=n("./src/mcp/disabled-store.ts"),f=n("./src/mcp/project-paths.ts"),m=n("./src/sandbox-gate.ts"),v=n("./src/statsig.ts"),y=n("./src/team-hooks-sync.ts"),b=n("./src/utils/api-endpoint.ts"),w=n("./src/utils/git.ts"),k=n("./src/utils/git-diffs.ts"),x=n("./src/shared/autorun-mode.ts"),S=n("./src/shared/cli-background-work-registry.ts"),R=n("./src/shared/cli-subagent-host-adapter.ts"),P=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};const j=(0,c.h)("shared-resources");function O(){return P(this,arguments,void 0,(function*(e={}){const{workingDirectory:t,teamId:n,dashboardClient:o}=e,r=null!=t?t:process.cwd(),s=(0,w.ky)(r);let i;null!=n&&o&&(i=(0,y.a)({dashboardClient:o,teamId:n}));const a=(0,l.Ve)(s),c=new l.IF,d=new l.gY(c,a),u=yield d.load();return i?{hooksConfig:u,projectDir:s,teamHooksResultPromise:i}:{hooksConfig:u,projectDir:s}}))}const I={getDefaultNetworkAllowlist:()=>Promise.resolve((0,v.z)("sandbox_default_network_allowlist","allowlist",[]))};function E(e,t){const n=(0,a.jo)(null!=="cursor"?"cursor":"cursor-dev"),o=(0,d.Vi)({credentialManager:n,endpoint:(0,b.G6)(t),configProvider:e});return new u.w(new u.zM(o),I)}function T(e,t){return P(this,void 0,void 0,(function*(){var n,r,c,w,O,E,T,C,A,D,_,M;const F=null!==(n=t.workingDirectory)&&void 0!==n?n:process.cwd(),$=(0,a.jo)(null!=="cursor"?"cursor":"cursor-dev"),N=(0,d.Vi)({credentialManager:$,endpoint:(0,b.G6)(t.endpoint),configProvider:t.configProvider}),U=null!==(r=t.teamSettingsService)&&void 0!==r?r:new u.w(new u.zM(N),I),B=U.getAutoRunControls().catch((()=>{})),W=new u.$1(F);if(t.withDiffs){const e=(0,k.buildFileChanges)((0,k.collectGitStatuses)());for(const t of e)yield W.trackChange(t.path,t.before,t.after)}try{yield(0,u.Rh)(e)}catch(t){j.warn(e,"Failed to sync built-in skills",{error:t})}const q=()=>!0,L=new u.xK,Q=new u.KO(e,L,F,!1,q,void 0),H=new u.EV(e,[F],(0,o.homedir)(),void 0,q),z=new u.Px([Q,H]),V=new u.NB([H]),G=new u.o_([new u.Vz(F,q),new u.di(z)]),Y=new u.E1(L,U),K=(0,m.Y)(),J=[],X=new class{constructor(e,t,n=()=>!1,o,r=!1,s,i=!0){this.configProvider=e,this.getIsAutoRun=t,this.getIsAskMode=n,this.teamSettingsService=o,this.sandboxDefaultEnabled=r,this.sandboxOverride=s,this.sandboxFeatureGateEnabled=i,this.baseProvider=new d.QX(e)}getPermissions(){return P(this,void 0,void 0,(function*(){var e,t;const n=yield this.baseProvider.getPermissions(),o=null!==(t=null===(e=this.configProvider.get().sandbox)||void 0===e?void 0:e.networkAccess)&&void 0!==t?t:"user_config_with_defaults",r="allow_all"===o?(0,p.T6)():(0,p.Po)(),s="user_config_only"===o,{approvalMode:i,sandboxAvailable:a}=yield(0,x.Hs)({getIsAutoRun:this.getIsAutoRun,autoRunControlsProvider:this.teamSettingsService,configProvider:this.configProvider,sandboxOverride:this.sandboxOverride,sandboxDefaultEnabled:this.sandboxDefaultEnabled,sandboxFeatureGateEnabled:this.sandboxFeatureGateEnabled});let c;return c="unrestricted"===i?{type:"insecure_none"}:a?this.getIsAskMode()?{type:"workspace_readonly",networkPolicy:r,skipStatsigDefaults:s}:{type:"workspace_readwrite",networkPolicy:r,skipStatsigDefaults:s}:{type:"insecure_none"},Object.assign(Object.assign({},n),{approvalMode:i,userConfiguredPolicy:c})}))}updatePermissions(e){return P(this,void 0,void 0,(function*(){return this.baseProvider.updatePermissions(e)}))}}(t.configProvider,t.getIsAutoRun,null!==(c=t.getIsAskMode)&&void 0!==c?c:()=>!1,U,null!==(w=t.sandboxDefaultEnabled)&&void 0!==w&&w,t.sandboxOverride,K);J.push(X);const Z=yield(0,u.ky)(e,L,F),ee=!!Z,te=null!=Z?Z:F,ne=yield d.N2.loadFromPath(s().join(te,".claude","settings.json"));ne&&J.push(ne);const oe=yield d.N2.loadFromPath(s().join((0,o.homedir)(),".claude","settings.json"));oe&&J.push(oe);const re=new d.Ol(J),{projectRoot:se,projectDir:ie,disabledPath:ae}=(0,f.C)(F,null!=Z?Z:F),ce=new g.P(ae),de=d.aK.init(U,se,ie,null!==(O=t.ignoreApproveMcps)&&void 0!==O&&O,ce),le=t.configProvider.get(),ue=!0===t.sandboxDefaultEnabled?"enabled":"disabled",pe=null!==(C=null!==(E=t.sandboxOverride)&&void 0!==E?E:null===(T=le.sandbox)||void 0===T?void 0:T.mode)&&void 0!==C?C:ue,he=K?pe:"disabled",ge=null!==(D=null===(A=le.sandbox)||void 0===A?void 0:A.networkAccess)&&void 0!==D?D:"user_config_with_defaults",fe=new u.kh(Y,t.decisionProvider,re,U,void 0,(0,v.QF)("admin_network_controls")),me={executeIndexedGrep:void 0};let ve,ye=t.teamHooksResultPromise;if(t.hooksConfig)ve=t.hooksConfig;else{const e=null===(_=t.configProvider.get().authInfo)||void 0===_?void 0:_.teamId;null!=e&&N&&!ye&&(ye=(0,y.a)({dashboardClient:N,teamId:e}));const n=(0,l.Ve)(te),o=new l.IF,r=new l.gY(o,n);ve=yield r.load()}const be=new l.HW(ve);let we,ke=()=>{};ye&&(we=new Promise((e=>{ke=e})));const xe=null!==(M=t.hookExecutor)&&void 0!==M?M:(()=>{var e,n;const o={cursor_version:null!=="2026.02.13-41ac335"?"2026.02.13-41ac335":"1.0.0",user_email:null!==(n=null===(e=t.configProvider.get().authInfo)||void 0===e?void 0:e.email)&&void 0!==n?n:null},r=(0,p.Fn)();return new l.WL(ve,te,o,r,t.promptHookClient,we)})();ye&&we&&ye.then((t=>{if(null!=t){const n=(0,y.O)(ve,t.teamHooks,t.teamDir);be.setConfig(n),xe.updateConfig(n),j.info(e,"Team hooks config merged after fetch")}})).finally((()=>ke()));const Se=K&&(0,p.K3)()&&"enabled"===he;let Re={type:"run-everything"};try{const e=yield B;!0===(null==e?void 0:e.enabled)&&!0!==e.enableRunEverything&&(Re=Se?{type:"sandbox-only"}:{type:"disabled"})}catch(e){}const Pe=s().join((0,o.homedir)(),".cursor","sandbox.json"),je=yield(0,p.tv)(Pe,(0,o.homedir)()),Oe=je?{perUser:je}:void 0;return{permissionsService:fe,grepProvider:me,fileChangeTracker:W,dashboardClient:N,teamSettingsService:U,mcpLoader:de,disabledStore:ce,isRepository:ee,hooksConfigLease:be,hookExecutor:xe,hooksConfig:ve,autoRunAvailability:Re,createLocalResourceProvider:({diagnosticsProvider:e,mcpLease:n,codebaseReferenceProvider:r,agentClient:s,shellManager:a,pendingDecisionProviderOverride:c,conversationId:d="",generationId:g="",model:f="unknown"})=>{const m=new h.e({workspacePath:F,conversationId:d,model:f}),v=new S.t,y=new u.Dv({pendingDecisionStore:null!=c?c:t.decisionProvider,fileChangeTracker:W,gitExecutor:L,ignoreService:Y,grepProvider:me,permissionsService:fe,workspacePaths:[F],diagnosticsProvider:e,mcpLease:n,cursorRulesService:z,subagentsService:G,repositoryProvider:r,projectDir:ie,shellManager:a,_sandboxPolicyResolver:void 0,_defaultSandboxPolicy:"enabled"===he?{type:"workspace_readwrite",networkPolicy:"allow_all"===ge?(0,p.T6)():(0,p.Po)(),skipStatsigDefaults:"user_config_only"===ge}:{type:"insecure_none"},_defaultSandboxPolicySources:Oe,getSandboxEnabled:()=>!!K&&((0,p.K3)()&&"enabled"===he),getSandboxSupported:()=>K&&(0,p.K3)(),getNetworkAllowlistInfo:()=>(0,u.mA)(U,(0,o.homedir)(),F),attributionConfigProvider:t.configProvider,getAgentSkills:e=>V.getAllAgentSkills(e),askpassConfig:t.askpassConfig,onWriteForAiTracking:e=>m.trackWrite(e),onDeleteForAiTracking:e=>m.trackDelete(e),backgroundWorkRegistry:v});return y.register(i.Zn,(0,i.hv)(new R.f(s,y,v))),new l.ae(y,xe,(()=>({conversation_id:d,generation_id:g,model:f})),n,t.hooksAdditionalContextPromise,we,be)}}}))}},"./src/team-hooks-sync.ts":(e,t,n)=>{n.d(t,{O:()=>d,a:()=>u});var o=n("node:fs/promises"),r=n("node:os"),s=n("node:path"),i=n.n(s),a=n("../proto/dist/generated/aiserver/v1/dashboard_pb.js"),c=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};function d(e,t,n){return Object.assign(Object.assign({},e),{teamHooks:t,configDirs:Object.assign(Object.assign({},e.configDirs),{team:n})})}function l(){return"win32"===(0,r.platform)()}function u(e){return c(this,void 0,void 0,(function*(){var t,n,s,c;const{dashboardClient:d,teamId:u}=e;try{const e=function(){switch((0,r.platform)()){case"darwin":return"Macintosh";case"win32":return"Windows";default:return"Linux"}}(),p=i().join((0,r.homedir)(),".cursor","managed",`team_${u}`,"hooks"),h=(null!==(t=(yield d.getTeamHooks(new a.GetTeamHooksRequest({activeOnly:!0}))).hooks)&&void 0!==t?t:[]).filter((t=>t.operatingSystems&&t.operatingSystems.length>0&&t.operatingSystems.includes(e)));yield(0,o.mkdir)(p,{recursive:!0});const g=new Set,f={};for(const e of h){let t=i().basename(e.scriptName||`team-hook-${e.id}`);l()&&(t.endsWith(".ps1")||t.endsWith(".bat")||t.endsWith(".cmd")||(t=`${t}.ps1`));const r=i().extname(t),a=r.length>0?t.slice(0,-r.length):t;let d=t,u=1;for(;g.has(d);)d=`${a}-${e.id}-${u}${r}`,u+=1;const h=i().join(p,d),m=null!==(n=e.scriptContent)&&void 0!==n?n:"";try{yield(0,o.writeFile)(h,m,"utf-8"),l()||(yield(0,o.chmod)(h,493)),g.add(d);const t=null!==(s=e.hookStep)&&void 0!==s?s:"beforeShellExecution",n=null!==(c=f[t])&&void 0!==c?c:[];n.push({command:h}),f[t]=n}catch(e){console.warn(`[team-hooks-sync] Failed to write ${t}:`,e)}}const m={version:1,hooks:f};try{const e=yield(0,o.readdir)(p,{withFileTypes:!0});for(const t of e)if(t.isFile()&&!g.has(t.name))try{yield(0,o.rm)(i().join(p,t.name))}catch(e){}}catch(e){}return{teamHooks:m,teamDir:p}}catch(e){return console.warn("Team hooks fetch/prepare failed; continuing without team hooks",e),null}}))}},"./src/utils/git-diffs.ts":(e,t,n)=>{n.r(t),n.d(t,{buildFileChanges:()=>m,buildUnifiedDiff:()=>l,collectGitStatuses:()=>f});var o=n("node:child_process"),r=n("node:fs"),s=n.n(r),i=n("node:os"),a=n.n(i),c=n("node:path"),d=n.n(c);const l=e=>{const t=s().mkdtempSync(d().join(a().tmpdir(),"delta-full-")),n=d().join(t,"before"),r=d().join(t,"after");s().mkdirSync(n,{recursive:!0}),s().mkdirSync(r,{recursive:!0});const i=(e,t,n)=>{const o=d().join(e,t);s().mkdirSync(d().dirname(o),{recursive:!0}),s().writeFileSync(o,n)};for(const t of e){const e=d().isAbsolute(t.path)?d().relative(process.cwd(),t.path):t.path;void 0!==t.before&&i(n,e,t.before),void 0!==t.after&&i(r,e,t.after)}const c=["diff","--no-index","--no-prefix","--diff-algorithm=patience","--unified=3","--","before","after"];let l="";try{l=(0,o.execFileSync)("git",c,{encoding:"utf8",cwd:t})}catch(e){const t=e;if(!(null==t?void 0:t.stdout))throw e;l=t.stdout}const u=(e=>{const t=d().join(n,""),o=d().join(r,"");let s=e.split(t).join("").split(o).join("");const i=d().join("before",""),a=d().join("after","");return s=s.split(i).join("").split(a).join(""),s})(l);return s().rmSync(t,{recursive:!0,force:!0}),u};function u(e){return(0,o.execFileSync)("git",e,{encoding:"utf8"}).trim()}function p(e){try{return(0,o.execFileSync)("git",["show",`HEAD:${e}`],{encoding:"utf8"})}catch(e){return}}let h=null;function g(e){const t=h||(h=u(["rev-parse","--show-toplevel"]),h),n=d().isAbsolute(e)?e:d().join(t,e);try{return(0,r.readFileSync)(n,"utf8")}catch(e){return""}}function f(){const e=u(["diff","--name-status","HEAD"]),t=(""===e?[]:e.split("\n")).filter(Boolean).map((e=>{var t,n,o,r,s;const i=e.split("\t"),a=(null!==(t=i[0])&&void 0!==t?t:"")[0];if("R"===a||"C"===a){const e=null!==(n=i[1])&&void 0!==n?n:"";return{code:a,path:null!==(o=i[2])&&void 0!==o?o:e,oldPath:e}}return{code:a,path:null!==(s=null!==(r=i[1])&&void 0!==r?r:i[0])&&void 0!==s?s:""}})),n=u(["ls-files","--others","--exclude-standard"]),o=""===n?[]:n.split("\n");for(const e of o)e&&t.push({code:"A",path:e});return t}function m(e){var t,n,o;const r=[];for(const s of e)if(s.path)switch(s.code){case"A":{const e=g(s.path);r.push({path:s.path,before:void 0,after:e});break}case"M":{const e=null!==(t=p(s.path))&&void 0!==t?t:"",n=g(s.path);r.push({path:s.path,before:e,after:n});break}case"D":{const e=null!==(n=p(s.path))&&void 0!==n?n:"";r.push({path:s.path,before:e,after:void 0});break}case"R":{const e=s.oldPath&&null!==(o=p(s.oldPath))&&void 0!==o?o:"",t=g(s.path);r.push({path:s.path,before:e,after:t});break}}return r}},"./src/utils/interaction-responses.ts":(e,t,n)=>{n.d(t,{l:()=>a});var o=n("../agent-core/dist/index.js"),r=n("../proto/dist/generated/agent/v1/ask_question_tool_pb.js"),s=n("../proto/dist/generated/agent/v1/create_plan_tool_pb.js"),i=n("../proto/dist/generated/agent/v1/setup_vm_environment_tool_pb.js");const a=(e,t)=>{var n,a;switch(e.query.case){case"webSearchRequestQuery":return t.approveWebSearch?o.x1.webSearchApproved(e.id):o.x1.webSearchRejected(e.id,null!==(n=t.webSearchRejectReason)&&void 0!==n?n:"User Rejected");case"webFetchRequestQuery":return e.query.value.skipApproval||t.approveWebFetch?o.x1.webFetchApproved(e.id):o.x1.webFetchRejected(e.id,null!==(a=t.webFetchRejectReason)&&void 0!==a?a:"User Rejected");case"switchModeRequestQuery":return o.x1.switchModeApproved(e.id);case"askQuestionInteractionQuery":{const n=new r.tz({result:{case:"rejected",value:new r.ox({reason:t.askQuestionRejectReason})}});return o.x1.askQuestion(e.id,n)}case"createPlanRequestQuery":{const t=new s.bK({result:{case:"success",value:new s.Jo},planUri:""});return o.x1.createPlan(e.id,t)}case"setupVmEnvironmentArgs":{const t=new i.r$({result:{case:"success",value:new i.JH}});return o.x1.setupVmEnvironment(e.id,t)}case"prManagementRequestQuery":return o.x1.prManagement(e.id,(0,o.p_)());case"mcpAuthRequestQuery":return o.x1.mcpAuthRejected(e.id,"MCP authentication is not supported in CLI mode");case void 0:throw new Error("Missing interaction query type");default:throw new Error("Unhandled interaction query type")}}}};