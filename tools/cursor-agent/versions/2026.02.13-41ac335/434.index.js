try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="dee706b7-d96b-4dcd-931d-fe859b0c469b",e._sentryDebugIdIdentifier="sentry-dbid-dee706b7-d96b-4dcd-931d-fe859b0c469b")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.02.13-41ac335"}}catch(e){}}(),exports.id=434,exports.ids=[156,302,434],exports.modules={"../agent-ui-state/dist/index.js":(e,t,n)=>{n.d(t,{VX:()=>o,ZY:()=>l,RN:()=>F,b:()=>E,Du:()=>z,qX:()=>N,M:()=>Z,II:()=>W,n6:()=>U,_z:()=>c,OE:()=>H,t6:()=>a,N1:()=>T,dl:()=>V,W5:()=>q,HG:()=>O,Yb:()=>Y,cp:()=>J,ti:()=>Q,as:()=>R,k4:()=>G,bE:()=>X,BR:()=>K,Wm:()=>B,Gv:()=>L,HE:()=>oe,P4:()=>re});class o extends Error{constructor(e){super(e),this.name="MergeError"}}var r=n("../proto/dist/generated/agent/v1/agent_pb.js"),s=n("../proto/dist/generated/agent/v1/shell_exec_pb.js"),i=n("../proto/dist/generated/agent/v1/shell_tool_pb.js");const l={USER_CANCELLED:"user_cancelled",SYSTEM_INTERRUPTED:"system_interrupted",INTERRUPTED_BY_FOLLOWUP:"interrupted_by_followup"};function a(e){return e===l.USER_CANCELLED}function c(e){return e===l.INTERRUPTED_BY_FOLLOWUP}function d(e){const t=e.call;return!("readToolCall"!==t.tool.case&&"lsToolCall"!==t.tool.case&&"globToolCall"!==t.tool.case&&"grepToolCall"!==t.tool.case&&"readLintsToolCall"!==t.tool.case&&"semSearchToolCall"!==t.tool.case)}function u(e){return"taskToolCall"===e.call.tool.case}function p(e,t){return!(!d(t)||!function(e){return e.calls.every(d)}(e))||!(!u(t)||!function(e){return e.calls.every(u)}(e))}function h(e){const t=e.toolCall;if(!t)throw new o("Tool call is missing from started update");const n={id:e.callId,call:t,completed:!1,aborted:!1};if("taskToolCall"===t.tool.case){const e=t.tool.value.args,o=null==e?void 0:e.agentId,r=Object.assign({type:"task",status:"running"},o?{agentId:o}:{});return Object.assign(Object.assign({},n),{additionalData:r})}return n}function g(e,t){const n=e.groups[e.groups.length-1],o=h(t);return void 0===n?{type:"tool-call-segment",groups:[{type:"tool-call-group",calls:[o]}]}:p(n,o)?Object.assign(Object.assign({},e),{groups:[...e.groups.slice(0,-1),Object.assign(Object.assign({},n),{calls:[...n.calls,o]})]}):Object.assign(Object.assign({},e),{groups:[...e.groups,{type:"tool-call-group",calls:[o]}]})}function m(e){return{type:"tool-call-segment",groups:[{type:"tool-call-group",calls:[h(e)]}]}}function f(e,t){const n=t.toolCall;if(!n)throw new o("Tool call is missing from completed update");return{type:"tool-call-segment",groups:e.groups.map((e=>Object.assign(Object.assign({},e),{calls:e.calls.map((e=>e.id===t.callId?Object.assign(Object.assign({},e),{call:n,completed:!0}):e))})))}}function v(e,t){const n=t.toolCallDelta;return n?{type:"tool-call-segment",groups:e.groups.map((e=>Object.assign(Object.assign({},e),{calls:e.calls.map((e=>{var o,l;if(e.id===t.callId&&"shellToolCallDelta"===n.delta.case&&"shellToolCall"===e.call.tool.case){const t=n.delta.value,a=e.call.tool.value,c=null===(o=a.result)||void 0===o?void 0:o.result;let d="",u="";"success"===(null==c?void 0:c.case)&&(d=c.value.stdout||"",u=c.value.stderr||""),"stdout"===t.delta.case?d+=t.delta.value.content:"stderr"===t.delta.case&&(u+=t.delta.value.content);const p=new i.$M({args:a.args,result:new s.W4({result:{case:"success",value:new s.QR({stdout:d,stderr:u})},sandboxPolicy:null===(l=a.result)||void 0===l?void 0:l.sandboxPolicy})});return Object.assign(Object.assign({},e),{call:new r.ToolCall({tool:{case:"shellToolCall",value:p}})})}return e}))})))}:e}function x(e,t=l.USER_CANCELLED){return{type:"tool-call-segment",groups:e.groups.map((e=>Object.assign(Object.assign({},e),{calls:e.calls.map((e=>Object.assign(Object.assign({},e),{completed:!1,aborted:!0,abortReason:t})))})))}}function b(e){return void 0===e?[]:"text"===e.type?[{type:"text",content:e.content,completed:!0}]:"plan"===e.type?[{type:"plan",tool:e.tool,status:e.status}]:"tool-call-segment"===e.type?e.groups:[]}function y(e,t){var n;const r=t.toolCall;if(!r)throw new o("Tool call is missing from completed update");if("createPlanToolCall"===r.tool.case)return Object.assign({},e);if("tool-call-segment"===(null===(n=e.pendingState)||void 0===n?void 0:n.type))return Object.assign(Object.assign({},e),{pendingState:f(e.pendingState,t)});throw new o("No pending state")}function w(e,t){var n;const r=t.toolCall;if(!r)throw new o("Tool call is missing from started update");if("createPlanToolCall"===r.tool.case)return Object.assign(Object.assign({},e),{pendingState:{type:"plan",tool:r,status:"accepted",decisionIndex:0}});switch(null===(n=e.pendingState)||void 0===n?void 0:n.type){case"tool-call-segment":return Object.assign(Object.assign({},e),{pendingState:g(e.pendingState,t)});case"plan":case"text":case void 0:return Object.assign(Object.assign({},e),{completedSteps:[...e.completedSteps,...b(e.pendingState)],pendingState:m(t)})}}function j(e,t){var n;switch(null===(n=e.pendingState)||void 0===n?void 0:n.type){case"text":return Object.assign(Object.assign({},e),{pendingState:{type:"text",content:e.pendingState.content+t.text,completed:!1}});case"plan":return Object.assign({},e);case"tool-call-segment":case void 0:return Object.assign(Object.assign({},e),{completedSteps:[...e.completedSteps,...b(e.pendingState)],pendingState:{type:"text",content:t.text,completed:!1}})}return e}function k(e,t){return{type:"agent",userMessage:e,isPlanExecution:t,completedSteps:[],pendingState:void 0,thinkingContent:void 0}}function C(e,t){var n;return"tool-call-segment"===(null===(n=e.pendingState)||void 0===n?void 0:n.type)?Object.assign(Object.assign({},e),{pendingState:v(e.pendingState,t)}):e}function S(e,t=l.USER_CANCELLED){var n;return"tool-call-segment"===(null===(n=e.pendingState)||void 0===n?void 0:n.type)?Object.assign(Object.assign({},e),{pendingState:x(e.pendingState,t)}):e}function E(e,t,n=0){var o;let r;const s=e=>{var t;const n=e.call.tool;if("editToolCall"===n.case)return null===(t=n.value.args)||void 0===t?void 0:t.path},i=e=>{for(let t=e.calls.length-1;t>=0;t--){const n=s(e.calls[t]);if(n)return n}},l=e=>{for(let t=e.length-1;t>=0;t--){const n=e[t];if("tool-call-group"===n.type){const e=i(n);if(e)return e}}};if("agent"===(null===(o=e.pendingTurn)||void 0===o?void 0:o.type)){const t=e.pendingTurn;if(t.pendingState){const e=(e=>{if("tool-call-segment"===e.type)for(let t=e.groups.length-1;t>=0;t--){const n=i(e.groups[t]);if(n)return n}})(t.pendingState);e&&(r=e)}if(!r){const e=l(t.completedSteps);e&&(r=e)}}if(!r)for(let t=e.completedTurns.length-1;t>=0;t--){const n=e.completedTurns[t];if("shell"===n.type)continue;const o=l(n.steps);if(o){r=o;break}}const a=r?t.findIndex((e=>e.path===r)):-1;return a>=0?a:n}function M(e){if(!e.result)return"running";switch(e.result.result.case){case"success":return"success";case"error":return"error";default:return"running"}}function $(e,t,n){var o,r,s,i;const l={id:t,call:e,completed:!0,aborted:!1};if("taskToolCall"!==e.tool.case)return l;const a=e.tool.value,c="success"===(null===(o=a.result)||void 0===o?void 0:o.result.case)?a.result.result.value.agentId:void 0,d=null===(r=a.args)||void 0===r?void 0:r.agentId,u=null!=c?c:d;if(!u)return Object.assign(Object.assign({},l),{additionalData:{type:"task",status:M(a)}});const p=null!==(i=null==n?void 0:n._visitedAgentIds)&&void 0!==i?i:new Set;if(p.has(u))return Object.assign(Object.assign({},l),{additionalData:{type:"task",status:M(a),agentId:u}});const h=null===(s=null==n?void 0:n.subagentStates)||void 0===s?void 0:s[u];let g;if(h){const e=new Set(p).add(u);g=T(h.conversationState,Object.assign(Object.assign({},n),{_visitedAgentIds:e}))}return Object.assign(Object.assign({},l),{additionalData:{type:"task",status:M(a),subagentState:g,agentId:u}})}function T(e,t){var n,o;const r=function(e,t){return e.turns?e.turns.map(((e,n)=>function(e,t,n){switch(e.turn.case){case"agentConversationTurn":return function(e,t,n){var o,r,s;const i=null!==(r=null===(o=e.userMessage)||void 0===o?void 0:o.text)&&void 0!==r?r:"",l=[];let a;for(let o=0;o<e.steps.length;o++){const r=e.steps[o];switch(r.message.case){case"assistantMessage":a&&(l.push(a),a=void 0),l.push({type:"text",content:r.message.value.text,completed:!0});break;case"thinkingMessage":{a&&(l.push(a),a=void 0);const e=r.message.value,t=null!==(s=e.text)&&void 0!==s?s:"";if(t){const n=null!=e.durationMs&&e.durationMs>0?e.durationMs:void 0;l.push({type:"thinking",content:t,durationMs:n})}break}case"toolCall":{const e=$(r.message.value,`loaded-${t}-${o}`,n);a&&p(a,e)?a.calls.push(e):(a&&l.push(a),a={type:"tool-call-group",calls:[e]});break}}}return a&&l.push(a),{type:"agent",userMessage:i,steps:l}}(e.turn.value,t,n);case"shellConversationTurn":return{type:"shell",shellCommand:null!==(a=null===(r=(o=e.turn.value).shellCommand)||void 0===r?void 0:r.command)&&void 0!==a?a:"",stdout:null!==(c=null===(s=o.shellOutput)||void 0===s?void 0:s.stdout)&&void 0!==c?c:"",stderr:null!==(d=null===(i=o.shellOutput)||void 0===i?void 0:i.stderr)&&void 0!==d?d:"",exitCode:null!==(u=null===(l=o.shellOutput)||void 0===l?void 0:l.exitCode)&&void 0!==u?u:0};case void 0:throw new Error(`Turn at index ${t} has no case`);default:{const n=e.turn;throw console.error(`Turn at index ${t} has unknown type:`,{turnCase:n.case}),new Error(`Unknown turn type at index ${t}: ${n.case}`)}}var o,r,s,i,l,a,c,d,u}(e,n,t))):[]}(e,t);return Object.assign(Object.assign({},{summary:void 0,completedTurns:[],pendingTurn:void 0,summarizing:!1,liveTokens:0,rejectedPlan:!1}),{summary:null!==(o=null===(n=e.summary)||void 0===n?void 0:n.summary)&&void 0!==o?o:void 0,completedTurns:r})}function I(e,t){if("stdout"===t.event.case)return Object.assign(Object.assign({},e),{stdout:e.stdout+t.event.value.data});if("stderr"===t.event.case)return Object.assign(Object.assign({},e),{stderr:e.stderr+t.event.value.data});if("exit"===t.event.case)return Object.assign(Object.assign({},e),{exitCode:t.event.value.code});throw new o("Invalid shell output delta update")}function P(e){return{type:"shell",shellCommand:e,stdout:"",stderr:"",exitCode:void 0}}function A(e){if("agent"===e.type)return{type:"agent",userMessage:e.userMessage,isPlanExecution:e.isPlanExecution,steps:[...e.completedSteps,...b(e.pendingState)]};if("shell"===e.type)return{type:"shell",shellCommand:e.shellCommand,stdout:e.stdout,stderr:e.stderr,exitCode:e.exitCode};throw new o("Turn is not an agent turn")}function D(e,t){var n;return Object.assign(Object.assign({},e),{thinkingContent:(null!==(n=e.thinkingContent)&&void 0!==n?n:"")+t.text})}function _(e,t){var n;const o=null!==(n=e.thinkingContent)&&void 0!==n?n:"",r=null!=t.thinkingDurationMs&&t.thinkingDurationMs>0?t.thinkingDurationMs:void 0;return Object.assign(Object.assign({},e),{completedSteps:o?[...e.completedSteps,{type:"thinking",content:o,durationMs:r}]:e.completedSteps,thinkingContent:""})}function R(e,t){switch(t.message.case){case"summary":return{summary:t.message.value.summary,completedTurns:[],pendingTurn:void 0,summarizing:!1,liveTokens:0,rejectedPlan:!1};case"summaryStarted":return Object.assign(Object.assign({},e),{summarizing:!0});case"summaryCompleted":return Object.assign(Object.assign({},e),{summarizing:!1});case"tokenDelta":return Object.assign(Object.assign({},e),{liveTokens:e.liveTokens+t.message.value.tokens});case"textDelta":return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return Object.assign(Object.assign({},e),{pendingTurn:j(e.pendingTurn,t)})}(e,t.message.value);case"toolCallStarted":return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return Object.assign(Object.assign({},e),{pendingTurn:w(e.pendingTurn,t)})}(e,t.message.value);case"toolCallCompleted":return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");const n=t.toolCall;if(!n)throw new o("Tool call is missing from completed update");return"createPlanToolCall"===n.tool.case?Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{pendingState:{type:"plan",tool:n,status:"accepted",decisionIndex:0}})}):Object.assign(Object.assign({},e),{pendingTurn:y(e.pendingTurn,t)})}(e,t.message.value);case"toolCallDelta":{if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");const n=t.message.value,r=n.toolCallDelta;return r?"taskToolCallDelta"===r.delta.case?function(e,t,n){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");const r=e.pendingTurn.pendingState;if("tool-call-segment"!==(null==r?void 0:r.type))return e;const s=n.interactionUpdate;if(!s||void 0===s.message.case)return e;const i=t.callId,{segment:l,tokenDelta:a}=function(e,t,n){let r=0;const s=e.groups.map((e=>Object.assign(Object.assign({},e),{calls:e.calls.map((e=>{if(e.id!==t)return e;const s=function(e,t){var n,r;const s=e.additionalData,i=null!==(n=null==s?void 0:s.subagentState)&&void 0!==n?n:{completedTurns:[],pendingTurn:{type:"agent",userMessage:"",completedSteps:[],pendingState:void 0,thinkingContent:void 0},liveTokens:0,summarizing:!1,summary:void 0,rejectedPlan:!1},l=i.liveTokens;let a;try{a=R(i,t)}catch(e){if(!(e instanceof o))throw e;a=i}const c=a.liveTokens-l,d={type:"task",status:null!==(r=null==s?void 0:s.status)&&void 0!==r?r:"running",subagentState:a,agentId:null==s?void 0:s.agentId};return{call:Object.assign(Object.assign({},e),{additionalData:d}),tokenDelta:c}}(e,n);return r+=s.tokenDelta,s.call}))})));return{segment:{type:"tool-call-segment",groups:s},tokenDelta:r}}(r,i,s);return Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{pendingState:l}),liveTokens:e.liveTokens+a})}(e,n,r.delta.value):Object.assign(Object.assign({},e),{pendingTurn:C(e.pendingTurn,n)}):e}case"userMessageAppended":return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");const n=t.userMessage;if(!n)throw new o("User message is missing from appended update");const s=n.simulatedMsgReason===r.SimulatedMsgReason.PLAN_EXECUTION,i=k(n.text,s);return Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,A(e.pendingTurn)],pendingTurn:i,liveTokens:0})}(e,t.message.value);case"thinkingDelta":return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return Object.assign(Object.assign({},e),{pendingTurn:D(e.pendingTurn,t)})}(e,t.message.value);case"thinkingCompleted":return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return Object.assign(Object.assign({},e),{pendingTurn:_(e.pendingTurn,t)})}(e,t.message.value);case"shellOutputDelta":return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("shell"!==e.pendingTurn.type)throw new o("Pending turn is not a shell turn");return Object.assign(Object.assign({},e),{pendingTurn:I(e.pendingTurn,t)})}(e,t.message.value);default:return e}}function L(e){var t;const n=e.pendingTurn;return"agent"===(null==n?void 0:n.type)&&"plan"===(null===(t=n.pendingState)||void 0===t?void 0:t.type)?e:Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,...e.pendingTurn?[A(e.pendingTurn)]:[]],pendingTurn:void 0})}function O(e,t,n){return Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,...e.pendingTurn?[A(e.pendingTurn)]:[]],pendingTurn:k(t,null==n?void 0:n.isPlanExecution),liveTokens:0,rejectedPlan:!1})}function Y(e,t){return Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,...e.pendingTurn?[A(e.pendingTurn)]:[]],pendingTurn:P(t),liveTokens:0,rejectedPlan:!1})}function F(e,t=l.USER_CANCELLED){return e.pendingTurn?"agent"===e.pendingTurn.type?Object.assign(Object.assign({},e),{pendingTurn:S(e.pendingTurn,t),liveTokens:0}):"shell"===e.pendingTurn.type?Object.assign(Object.assign({},e),{pendingTurn:(n=e.pendingTurn,Object.assign(Object.assign({},n),{exitCode:130})),liveTokens:0}):e:e;var n}function z(){return{completedTurns:[],pendingTurn:void 0,liveTokens:0,summarizing:!1,summary:void 0,rejectedPlan:!1}}function N(e){var t,n;const o=e=>{var t,n;for(let o=e.calls.length-1;o>=0;o--){const r=e.calls[o];if("createPlanToolCall"===(null===(n=null===(t=null==r?void 0:r.call)||void 0===t?void 0:t.tool)||void 0===n?void 0:n.case))return r.call}};if("agent"===(null===(t=e.pendingTurn)||void 0===t?void 0:t.type)){if("plan"===(null===(n=e.pendingTurn.pendingState)||void 0===n?void 0:n.type))return e.pendingTurn.pendingState.tool;for(let t=e.pendingTurn.completedSteps.length-1;t>=0;t--){const n=e.pendingTurn.completedSteps[t];if("plan"===(null==n?void 0:n.type))return n.tool;if("tool-call-group"===(null==n?void 0:n.type)){const e=o(n);if(e)return e}}}for(let t=e.completedTurns.length-1;t>=0;t--){const n=e.completedTurns[t];if("agent"===(null==n?void 0:n.type))for(let e=n.steps.length-1;e>=0;e--){const t=n.steps[e];if("plan"===(null==t?void 0:t.type))return t.tool;if("tool-call-group"===(null==t?void 0:t.type)){const e=o(t);if(e)return e}}}}function U(e){var t,n;if(null===(t=e.planFileBlock)||void 0===t?void 0:t.planUri)return e.planFileBlock.planUri;const o=N(e),r="createPlanToolCall"===(null===(n=null==o?void 0:o.tool)||void 0===n?void 0:n.case)?o.tool.value.result:void 0;return null==r?void 0:r.planUri}function B(e,t){return Object.assign(Object.assign({},e),{planFileBlock:{planUri:t}})}function q(e){return e.planFileBlock?Object.assign(Object.assign({},e),{planFileBlock:void 0}):e}function H(e){var t;if(e.planFileBlock)return!0;const n=e.pendingTurn;return"agent"===(null==n?void 0:n.type)&&"plan"===(null===(t=n.pendingState)||void 0===t?void 0:t.type)}function W(e){var t;const n=e.pendingTurn;if("agent"===(null==n?void 0:n.type)&&"plan"===(null===(t=n.pendingState)||void 0===t?void 0:t.type)){const e=n.pendingState.decisionIndex;return void 0!==e?e:"accepted"===n.pendingState.status?0:2}return 0}function G(e,t){var n,o;return"agent"===(null===(n=e.pendingTurn)||void 0===n?void 0:n.type)&&"plan"===(null===(o=e.pendingTurn.pendingState)||void 0===o?void 0:o.type)?Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{pendingState:Object.assign(Object.assign({},e.pendingTurn.pendingState),{status:t<2?"accepted":"rejected",decisionIndex:t})})}):e}function X(e){var t,n;return"agent"===(null===(t=e.pendingTurn)||void 0===t?void 0:t.type)&&"plan"===(null===(n=e.pendingTurn.pendingState)||void 0===n?void 0:n.type)?Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,A({type:"agent",userMessage:e.pendingTurn.userMessage,completedSteps:[...e.pendingTurn.completedSteps,{type:"plan",tool:e.pendingTurn.pendingState.tool,status:"rejected"}],pendingState:void 0,thinkingContent:void 0})],pendingTurn:void 0,rejectedPlan:!0}):e}function K(e,t){return e.planFileBlock?Object.assign(Object.assign({},e),{planFileBlock:void 0,completedTurns:[...e.completedTurns,A({type:"agent",userMessage:"Propose changes",completedSteps:[{type:"plan",tool:t,status:"rejected"}],pendingState:void 0,thinkingContent:void 0})],pendingTurn:void 0,rejectedPlan:!0}):e}function Q(e){var t,n;return e.planFileBlock?Object.assign(Object.assign({},e),{planFileBlock:void 0}):"agent"===(null===(t=e.pendingTurn)||void 0===t?void 0:t.type)&&"plan"===(null===(n=e.pendingTurn.pendingState)||void 0===n?void 0:n.type)?Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{completedSteps:[...e.pendingTurn.completedSteps,{type:"plan",tool:e.pendingTurn.pendingState.tool,status:"accepted"}],pendingState:void 0,thinkingContent:void 0})}):e}function J(e){return Object.assign(Object.assign({},e),{rejectedPlan:!1})}function V(e){if(!e.rejectedPlan)return e;const t=e.completedTurns.at(-1);if("agent"!==(null==t?void 0:t.type))return Object.assign(Object.assign({},e),{rejectedPlan:!1});const n=t.steps,o=n.at(-1);if("plan"!==(null==o?void 0:o.type)||"rejected"!==o.status)return Object.assign(Object.assign({},e),{rejectedPlan:!1});const r=n.slice(0,-1);return Object.assign(Object.assign({},e),{completedTurns:e.completedTurns.slice(0,-1),pendingTurn:{type:"agent",userMessage:t.userMessage,isPlanExecution:t.isPlanExecution,completedSteps:r,pendingState:{type:"plan",tool:o.tool,status:"rejected",decisionIndex:2},thinkingContent:void 0},rejectedPlan:!1})}function Z(e,t){var n,o;switch(e.type){case"shell":return`${t}-pending-shell`;case"agent":return`${t}-pending-${null!==(o=null===(n=e.pendingState)||void 0===n?void 0:n.type)&&void 0!==o?o:"none"}-steps-${e.completedSteps.length}`;default:return e}}function ee(e,t,n,o,r){const s=`${e}-step-${t}`;return"text"===n.type?[{type:"agent-text",text:n.content,key:s}]:"thinking"===n.type?[{type:"agent-thinking",content:n.content,thoughtIndex:null!=r?r:1,durationMs:n.durationMs,key:s}]:"plan"===n.type?[{type:"plan",call:n.tool,decisionIndex:"accepted"===n.status?0:1,key:s}]:[{type:"agent-tool-calls",calls:n.calls,key:s,isLastTurn:o}]}function te(e,t,n){if("agent"===t.type){const o=!0===t.isPlanExecution?{type:"plan-execution",message:t.userMessage,key:`${e}-plan-execution`}:{type:"user-message",message:t.userMessage,key:`${e}-user-message`};let r=0;return[o,...t.steps.flatMap(((t,o)=>"thinking"===t.type?(r++,ee(e,o,t,n,r)):ee(e,o,t,n)))]}return"shell"===t.type?[{type:"shell-turn",command:t.shellCommand,key:`${e}-shell-turn`,stdout:t.stdout,stderr:t.stderr,exitCode:t.exitCode}]:[]}function ne(e,t,n){var o;return"text"===t.type?[{type:"agent-text",text:t.content,completed:t.completed,key:e,pendingStateKey:n}]:"plan"===t.type?[{type:"plan",call:t.tool,decisionIndex:null!==(o=t.decisionIndex)&&void 0!==o?o:"accepted"===t.status?0:1,key:e,pendingStateKey:n}]:t.groups.flatMap(((t,o)=>({type:"agent-tool-calls",calls:t.calls,isLastStepOfTurn:!0,key:`${e}-pending-state-${o}`,isLastTurn:!0,pendingStateKey:n})))}function oe(e,t,n){var o,r;const s=[{type:"header",key:"header",isRepository:null!==(o=null==n?void 0:n.isRepository)&&void 0!==o&&o,folderMode:null!==(r=null==n?void 0:n.folderMode)&&void 0!==r?r:"cwd"}];t&&s.push({type:"debug-info",serverUrl:t.serverUrl,key:"debug-info"}),e.summary&&s.push({type:"summary",summary:e.summary,key:"summary"});const i=[];let l=0;for(const t of e.completedTurns){const n=!e.pendingTurn&&l===e.completedTurns.length-1;s.push(...te(`turn-${l}`,t,n)),l++}if(e.pendingTurn){const{static:t,dynamic:n}=(a=`turn-${l}`,"agent"===(c=e.pendingTurn).type?function(e,t){var n;const o=Z(t,e);if(void 0===t.pendingState&&0===t.completedSteps.length)return{static:[],dynamic:[!0===t.isPlanExecution?{type:"plan-execution",message:t.userMessage,key:`${e}-plan-execution`,pendingStateKey:o}:{type:"user-message",message:t.userMessage,key:`${e}-user-message`,pendingStateKey:o}]};if("text"===(null===(n=t.pendingState)||void 0===n?void 0:n.type)&&0===t.completedSteps.length)return{static:[],dynamic:[!0===t.isPlanExecution?{type:"plan-execution",message:t.userMessage,key:`${e}-plan-execution`,pendingStateKey:o}:{type:"user-message",message:t.userMessage,key:`${e}-user-message`,pendingStateKey:o},...void 0!==t.pendingState?ne(e,t.pendingState,o):[]]};const r=!0===t.isPlanExecution?{type:"plan-execution",message:t.userMessage,key:`${e}-plan-execution`}:{type:"user-message",message:t.userMessage,key:`${e}-user-message`};let s=0;return{static:[r,...t.completedSteps.flatMap(((t,n)=>"thinking"===t.type?(s++,ee(e,n,t,!0,s)):ee(e,n,t,!0)))],dynamic:void 0!==t.pendingState?ne(e,t.pendingState,o):[]}}(a,c):"shell"===c.type?function(e,t){const n=Z(t,e);return{static:[],dynamic:[{type:"shell-turn",command:t.shellCommand,key:`${e}-shell-turn`,stdout:t.stdout,stderr:t.stderr,exitCode:t.exitCode,pendingStateKey:n}]}}(a,c):{static:[],dynamic:[]});s.push(...t),i.push(...n)}var a,c;return{staticItems:s,dynamicItems:i}}function re(e,t){if(t<0)throw new Error("maxTurns must be non-negative");if(0===t)return Object.assign(Object.assign({},e),{completedTurns:[],pendingTurn:void 0});if(t>e.completedTurns.length+(e.pendingTurn?1:0))return e;const n=e.completedTurns.slice(0,t);return Object.assign(Object.assign({},e),{completedTurns:n,pendingTurn:void 0})}},"./src/always-deny-decision-provider.ts":(e,t,n)=>{n.d(t,{N:()=>o});class o{requestApproval(e){return Promise.resolve({approved:!1})}}},"./src/autorun-aware-decision-provider.ts":(e,t,n)=>{n.d(t,{w:()=>r});var o=n("./src/shared/unified-approval-policy.ts");class r{constructor(e,t){this.params=e,this.fallback=t,this.approvalPolicy=new o.y(e)}requestApproval(e){return t=this,n=void 0,r=function*(){return this.approvalPolicy.requestOperationApproval(e,this.fallback)},new((o=void 0)||(o=Promise))((function(e,s){function i(e){try{a(r.next(e))}catch(e){s(e)}}function l(e){try{a(r.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,l)}a((r=r.apply(t,n||[])).next())}));var t,n,o,r}}},"./src/background.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{y:()=>$});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),l=n("../proto/dist/generated/aiserver/v1/tools_pb.js"),a=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),c=n("./src/components/animated-dots.tsx"),d=n("./src/components/app-header.tsx"),u=n("./src/components/background-edit-tool-ui.tsx"),p=n("./src/components/background-prompt-bar.tsx"),h=n("./src/components/background-shell-tool-ui.tsx"),g=n("./src/components/background-thinking-ui.tsx"),m=n("./src/components/background-tool-group-ui.tsx"),f=n("./src/components/hexagon-loader.tsx"),v=n("./src/components/markdown.tsx"),x=n("./src/components/prompt/ephemeral-lines-view.tsx"),b=n("./src/components/step-container.tsx"),y=n("./src/components/user-message-ui.tsx"),w=n("./src/constants.ts"),j=n("./src/context/config-context.tsx"),k=n("./src/debug.ts"),C=n("./src/hooks/prompt/use-ephemeral.ts"),S=n("./src/hooks/use-send-to-background.ts"),E=e([s,c,d,u,p,h,g,m,f,v,x,b,y]);[s,c,d,u,p,h,g,m,f,v,x,b,y]=E.then?(await E)():E;const M=e=>{const t=[],n=new Set([l.XaY.EDIT_FILE,l.XaY.EDIT_FILE_V2]),o=[],r=()=>{0!==o.length&&(t.push({type:"tool-group",toolCalls:[...o],index:t.length}),o.length=0)};let s=0,i=0;for(let l=0;l<e.length;l++){const a=e[l];if("text"===a.type){if(!a.isDone)continue;r(),t.push({type:"markdown",text:a.text,index:l})}else if("thinking"===a.type)r(),i++,t.push({type:"thinking",text:a.text,isDone:a.isDone,thinkingDurationMs:a.thinkingDurationMs,thoughtIndex:i,index:l});else if("tool"===a.type)n.has(a.toolCall.tool)?(o.length>0&&r(),t.push({type:"individual-tool",call:a.toolCall,result:a.toolResult,index:l})):o.push({call:a.toolCall,result:a.toolResult});else if("user"===a.type){r();const e=s>0;s++,t.push({type:"user-message",content:a.text,index:l,isFollowup:e})}}return r(),t},$=({bcId:e,isAttached:t,backgroundComposerClient:n,isRepository:o,debugInfo:E,modelManager:$,modelDetails:T,responses:I,status:P,isLoadingConversation:A,addOptimisticFollowup:D,removeOptimisticFollowup:_,repoUrl:R,branchName:L,onRequestReview:O,onOpenComposerPicker:Y,onSwitchComposer:F,changes:z,isLoadingDiffs:N})=>{const{sendFollowupToBackground:U,isSubmittingFollowup:B}=(0,S.$)(n),q=(0,a.useMemo)((()=>{var e,t;if(T&&T.modelName)return null!==(t=null===(e=$.normalizeModelId(T.modelName))||void 0===e?void 0:e.displayName)&&void 0!==t?t:T.modelName}),[T,$]),[H,W]=(0,a.useState)(""),G=(0,C.N)(),X=(0,j.HS)();(0,a.useEffect)((()=>{if(e)try{n.notifyBackgroundComposerShown({bcId:e},{timeoutMs:1e4}).catch((()=>{}))}catch(e){}}),[e,n]);const K=(0,a.useMemo)((()=>{const e=[];return e.push({id:"resume",title:"Resume Session",description:"Open the picker or switch by id with '/resume <id>'",args:[{id:"id",required:!1}],run:(e,t)=>{const n=(t[0]||"").trim();n?null==F||F(n):null==Y||Y(),W("")}}),e.push({id:"switch",title:"Switch Background",description:"Switch to a cloud agent by id",args:[{id:"id",required:!0}],run:(e,t)=>{const n=(t[0]||"").trim();n&&(null==F||F(n),W(""))}}),e}),[Y,F]),{itemsToDisplay:Q,firstLiveStepIndex:J}=(0,a.useMemo)((()=>{const e=M(I.bubbles),n=[{type:"header",debugInfo:E,index:1}];for(let t=0;t<e.length;t++)n.push(Object.assign(Object.assign({},e[t]),{index:n.length}));(0,k.debugLogJSON)("computed",n),(0,k.debugLogJSON)("responses",I);let o=0;if(t){for(let e=0;e<n.length;e++){switch(n[e].type){case"header":case"markdown":case"user-message":case"individual-tool":case"thinking":break;case"tool-group":if(e===n.length-1){o=e;break}break;default:throw new Error("Unhandled UIBackgroundItem")}if(-1!==o)break}o=n.length}return{itemsToDisplay:n,firstLiveStepIndex:o}}),[I,E,t]),V=e=>{var t,n,i,a,c,p,f,x;const j=e.index>0&&("individual-tool"===(null===(t=Q[e.index-1])||void 0===t?void 0:t.type)||"tool-group"===(null===(n=Q[e.index-1])||void 0===n?void 0:n.type)||"markdown"===(null===(i=Q[e.index-1])||void 0===i?void 0:i.type)||"thinking"===(null===(a=Q[e.index-1])||void 0===a?void 0:a.type));switch(e.type){case"header":return(0,r.jsx)(d.j,{isBackground:!0,debugInfo:e.debugInfo||void 0,isRepository:o,folderMode:"git",locationDisplayOverride:R,branchDisplayOverride:L});case"markdown":return(0,r.jsx)(b.C,{shouldPadTop:j,paddingRight:4,children:(0,r.jsx)(v.oz,{content:e.text})});case"thinking":return!X&&e.isDone?null:(0,r.jsx)(s.az,{paddingLeft:w.rd,children:(0,r.jsx)(b.C,{shouldPadTop:j,children:(0,r.jsx)(g.H,{text:e.text,isDone:e.isDone,thinkingDurationMs:e.thinkingDurationMs,thoughtIndex:e.thoughtIndex})})});case"user-message":return(0,r.jsx)(s.az,{paddingLeft:w.rd,children:(0,r.jsx)(y.H,{content:e.content,isFollowup:e.isFollowup})});case"individual-tool":{const t=e.call.tool;if((0,k.debugLog)("tool",l.XaY[t]),t===l.XaY.EDIT_FILE||t===l.XaY.EDIT_FILE_V2){let t;"editFileResult"===(null===(c=e.result)||void 0===c?void 0:c.result.case)&&(t=e.result.result.value);const n=e.call.params;let o;n.case,o=n.value.relativeWorkspacePath;const i=o.startsWith("/workspace/")?o.slice(11):o;return(0,r.jsx)(s.az,{paddingLeft:w.rd,children:(0,r.jsx)(b.C,{shouldPadTop:j,children:(0,r.jsx)(u.l,{path:i,result:t})})})}if(t===l.XaY.RUN_TERMINAL_COMMAND_V2){const t=e.call.params,n="runTerminalCommandV2Params"===t.case?t.value:void 0,o=null!==(p=null==n?void 0:n.command)&&void 0!==p?p:"",i=null!==(f=null==n?void 0:n.cwd)&&void 0!==f?f:void 0;let l;return"runTerminalCommandV2Result"===(null===(x=e.result)||void 0===x?void 0:x.result.case)&&(l=e.result.result.value),(0,r.jsx)(s.az,{paddingLeft:w.rd,children:(0,r.jsx)(b.C,{shouldPadTop:j,children:(0,r.jsx)(h.d,{command:o,cwd:i,result:l})})})}return(0,r.jsx)(s.az,{paddingLeft:w.rd,children:(0,r.jsx)(b.C,{shouldPadTop:j,children:(0,r.jsxs)(s.EY,{children:["Tool: ",e.call.tool]})})})}case"tool-group":{const t=e.index===Q.length-1;return(0,r.jsx)(s.az,{paddingLeft:w.rd,children:(0,r.jsx)(b.C,{shouldPadTop:j,children:(0,r.jsx)(m.i,{toolCalls:e.toolCalls,forceCompleted:!t})})})}default:throw new Error("Unhandled UIBackgroundItem")}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.jC,{items:Q.slice(0,J),children:e=>"thinking"===e.type&&!X&&e.isDone?null:(0,r.jsx)(s.az,{children:V(e)},`static-bg-item-${e.index}`)}),J<Q.length&&(0,r.jsx)(s.az,{flexDirection:"column",children:Q.slice(J).map((e=>"thinking"===e.type&&!X&&e.isDone?null:(0,r.jsx)(s.az,{children:V(e)},`live-bg-item-${e.index}`)))}),(A||N&&P!==i.R6p.CREATING)&&(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,paddingTop:A?2:0,paddingLeft:2,children:[(0,r.jsx)(s.az,{width:1,children:(0,r.jsx)(f.A,{customInterval:210,activeColor:"cyan"},"bg-load-hex")}),(0,r.jsx)(s.az,{flexDirection:"row",children:(0,r.jsx)(s.EY,{bold:!0,children:A?"Loading conversation":"Loading diffs"})})]})}),(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsx)(p.m,{prompt:H,setPrompt:W,onSubmit:t=>{const n=t.trim();if(!n)return;if(!e)return;const o=n,r=D(o);U(e,o,{synchronous:!0,bubbleId:r}).then((e=>{"error"===e.type&&_(r)})).catch((()=>{_(r)})),W("")},isDisabled:!e,isProcessing:!1,topStatusMarginTop:Q.length>0?3:1,topStatus:(()=>{const e=(()=>{const e=I.bubbles;for(let t=e.length-1;t>=0;t--){const n=e[t];if("thinking"===n.type)return!n.isDone}return!1})(),t=e||P===i.R6p.RUNNING||P===i.R6p.CREATING;return B||t?(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,children:[(0,r.jsx)(s.az,{width:1,children:(0,r.jsx)(f.A,{customInterval:210,activeColor:"green"},"bg-gen-hex")}),(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsx)(s.EY,{bold:!0,children:B?"Pending":e?"Thinking":P===i.R6p.RUNNING?"Generating":"Starting VM"}),(0,r.jsx)(s.EY,{bold:!0,children:(0,r.jsx)(c.U,{})})]})]}):null})(),modelLabel:q,branchName:L,repoUrl:R,onRequestReview:O,bcId:e,changes:z,isLoadingDiffs:N,slashCommands:K,backgroundComposerClient:n,printEphemeral:(e,t)=>G.set(e,t)})},"prompt"),(0,r.jsx)(x.A,{lines:G.lines})]})};o()}catch(e){o(e)}}))},"./src/commands/chat.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.r(t),n.d(t,{runChat:()=>_});var r=n("node:fs"),s=n("node:path"),i=n("../cursor-config/dist/index.js"),l=n("../shell-exec/dist/index.js"),a=n("./src/analytics.ts"),c=n("./src/api-key-auth.ts"),d=n("./src/client.ts"),u=n("./src/console-io.ts"),p=n("./src/constants.ts"),h=n("./src/debug.ts"),g=n("./src/execution-mode/approval.tsx"),m=n("./src/instrument.ts"),f=n("./src/mcp/approval.tsx"),v=n("./src/mcp/project-paths.ts"),x=n("./src/onboarding.tsx"),b=n("./src/run-agent.tsx"),y=n("./src/sandbox-gate.ts"),w=n("./src/startup-timing.ts"),j=n("./src/statsig.ts"),k=n("./src/tracing.ts"),C=n("./src/utils/api-endpoint.ts"),S=n("./src/utils/auth-errors.ts"),E=n("./src/utils/command-name.ts"),M=n("./src/utils/output-format.ts"),$=n("./src/workspace/approval.tsx"),T=n("./src/commands/resume.tsx"),I=e([g,f,x,b,$,T]);[g,f,x,b,$,T]=I.then?(await I)():I;var P=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function A(e){if(!e)return;const t={},n=Array.isArray(e)?e:[e];for(const e of n){const n=e.indexOf(":");-1===n&&(0,u.uQ)(1,`Error: Invalid header format "${e}". Expected format: "Header-Name: Header-Value"`);const o=e.substring(0,n).trim(),r=e.substring(n+1).trim();o||(0,u.uQ)(1,`Error: Invalid header format "${e}". Header name cannot be empty.`),t[o]=r}return Object.keys(t).length>0?t:void 0}function D(e){return P(this,void 0,void 0,(function*(){const t=(0,v.C)(e);try{const{servers:e,error:n}=yield(0,f.Vh)(t);if(n&&(0,h.debugLogJSON)("Failed to read MCP approvals:",n),0===Object.keys(e.mcpServers).length)return;yield(0,f.Cz)(e,t)}catch(e){(0,h.debugLogJSON)("Failed to auto-approve MCP servers:",e instanceof Error?e.message:String(e))}}))}function _(e,t,o,h){return P(this,arguments,void 0,(function*(e,t,o,{diagnosticsProvider:h,codebaseReferenceProvider:v,configProvider:I,credentialManager:P}){var _,R,L;performance.mark(w.Y.WILL_INIT_TRACING),yield(0,k.H)({backendUrl:(0,C.G6)(o.endpoint),credentialManager:P,configProvider:I}),performance.mark(w.Y.DID_INIT_TRACING);const O=(0,C.G6)(o.endpoint);performance.mark(w.Y.WILL_INIT_ANALYTICS);try{(0,d.Bu)(P,{endpoint:O,insecure:o.insecure,configProvider:I})}catch(e){}performance.mark(w.Y.DID_INIT_ANALYTICS),(0,m.F0)({credentialManager:P,backendUrl:O,insecure:o.insecure,channel:I.get().channel});const Y=!0===o.printenv;let F,z;if(!1!==o.resume)if(!0===o.resume){const e=(0,d.c3)(P,O,I),t=yield(0,T.oh)(e);t||process.exit(0),"chat"===t.kind?F=t.id:"background"===t.kind&&(z=t.id)}else if("string"==typeof o.resume){const e=o.resume.match(/^-(\d+)$/);if(e){const t=Number(e[1]),n=Number.isFinite(t)&&t>0?t:1,o=yield(0,T.xT)(n);o||(0,u.uQ)(1,"No previous chats found."),F=o||void 0}else if("-1"===o.resume){const e=yield(0,T.$0)();e||(0,u.uQ)(1,"No previous chats found."),F=e}else F=o.resume}const N=!process.stdin.isTTY,U=Boolean(process.stdout.isTTY),B=!0===o.print||!U||N,q=!0===o.force||!0===o.yolo,H=!0===o.approveMcps,W=q||H;Y&&!B&&(0,u.uQ)(1,"Error: --printenv can only be used with --print/headless mode"),o.trust&&!B&&(0,u.uQ)(1,"Error: --trust can only be used with --print/headless mode"),performance.mark(w.Y.WILL_AUTH);const{isAuthenticated:G,usingAuthTokenFromEnv:X}=yield(0,c.D)(P,{authToken:o.authToken}),{isAuthenticated:K,usingApiKeyFromEnv:Q}=G?{isAuthenticated:!1,usingApiKeyFromEnv:!1}:yield(0,c.T)(P,{apiKey:o.apiKey,endpoint:O});if(!(G||K||(yield(0,x.h4)(P,x.hT.LOGIN)))){B&&(0,u.uQ)(1,`Error: Authentication required. Please run '${(0,E.mf)()} login' first, or set CURSOR_API_KEY environment variable.`);const e=(0,i.Vi)({credentialManager:P,endpoint:O,configProvider:I});(yield(0,x.f4)(P,I,e))||(0,u.uQ)(1,`Authentication required to use Cursor Agent. Please run '${(0,E.mf)()} login' to authenticate.`)}performance.mark(w.Y.DID_AUTH);let J=t.join(" ");if(N){const e=(yield new Promise((e=>{let t="";try{process.stdin.setEncoding("utf8")}catch(e){}process.stdin.on("data",(e=>{t+=String(e)})),process.stdin.on("end",(()=>e(t))),process.stdin.on("error",(()=>e(t)))}))).trim();e.length>0&&(J=e)}if(o.toolGallery){const{runToolGallery:e}=yield n.e(722).then(n.bind(n,"./src/tool-gallery.tsx"));return void(yield e())}if(o.ianDev){const{runIanDev:e}=yield n.e(743).then(n.bind(n,"./src/ian-dev.tsx"));if(o.debug){const{initDebug:e}=yield Promise.resolve().then(n.bind(n,"./src/debug.ts"));yield e()}return void(yield e())}if(o.markdownTest){const{runMarkdownTest:e}=yield n.e(309).then(n.bind(n,"./src/markdown-test.tsx"));return void(yield e())}if(o.colorGallery){const{runColorGallery:e}=yield n.e(549).then(n.bind(n,"./src/color-gallery.tsx"));return void(yield e())}const V=Q||X?"env":o.apiKey||o.authToken?"flag":"login";let Z;process.argv.some((e=>e.startsWith("--output-format")))&&!B&&(0,u.uQ)(1,"Error: --output-format can only be used with --print"),process.argv.some((e=>e.startsWith("--stream-partial-output")))&&!B&&(0,u.uQ)(1,"Error: --stream-partial-output can only be used with --print");try{Z=B?(0,M.nt)(o.outputFormat):void 0}catch(e){const t=e instanceof Error?e.message:String(e);(0,u.uQ)(1,t)}o.streamPartialOutput&&"stream-json"!==Z&&(0,u.uQ)(1,"Error: --stream-partial-output requires --output-format stream-json");const ee=(0,j.QF)("nal_cli_agent_retries"),te=o.endlessRetries?()=>(0,j.QF)("nal_agent_endless_retries"):void 0;try{(0,a.sx)("cli.run.mode",{headless:B||!U||N,print_flag:!0===o.print,output_text:"text"===Z,output_json:"json"===Z,output_stream_json:"stream-json"===Z,stream_partial_output:!0===o.streamPartialOutput,api_key_env:Q})}catch(e){}if(B){const e=o.workspace?(0,s.resolve)(o.workspace):process.cwd();if(!(0,$.PX)(e))if(o.trust)try{yield(0,$.I)(e)}catch(t){(0,u.uQ)(1,`Error: Failed to trust workspace at ${e}. Please check permissions.`)}else if(q);else{const t=process.stderr.isTTY,n=t?p.Dk:"",o=t?p.oH:"",r=t?p.Ip:"",s=t?p.Sj:"",i=["",`${n}⚠ Workspace Trust Required${s}`,"","  Cursor Agent can execute code and access files in this directory.","  Do you trust the contents of this directory?","",`    ${o}${e}${s}`,"",`  ${r}To proceed, you can either:${s}`,`    ${r}•${s} Run '${(0,E.mf)()}' interactively to decide`,`    ${r}•${s} Pass ${o}--trust${s}, ${o}--yolo${s}, or ${o}-f${s} if you trust this directory`,""].join("\n");(0,u.uQ)(1,i)}H&&(yield D(e))}else{const e=o.workspace?(0,s.resolve)(o.workspace):process.cwd(),t=yield(0,$.c1)(e,{skipMcpApproval:W});if("quit"===t&&process.exit(0),"already_approved"!==t||W||"quit"===(yield(0,f.Ny)(e))&&process.exit(0),H&&(yield D(e)),(yield(0,g.K)(I))&&process.exit(0),"enabled"===(null!==(R=null===(_=I.get().sandbox)||void 0===_?void 0:_.mode)&&void 0!==R?R:"disabled")){const e=(0,y.Y)(),t=(0,l.K3)();e&&t||(process.env.AGENT_CLI_SESSION_WARNING_SANDBOX_UNSUPPORTED="1")}}let ne;o.cloud||o.background?ne="background":o.plan||"plan"===o.mode?ne="plan":"ask"===o.mode&&(ne="ask");const oe={backendUrl:O,endpoint:o.endpoint,insecure:null!==(L=o.insecure)&&void 0!==L&&L,print:B,outputFormat:Z,streamPartialOutput:o.streamPartialOutput,debug:Boolean(o.debug),withDiffs:Boolean(o.withDiffs),resumeChatId:F,resumeBcId:z,configProvider:I,diagnosticsProvider:h,codebaseReferenceProvider:v,model:o.model,usingApiKeyFromEnv:Q,apiKeySource:V,isBrowserUseEnabled:Boolean(o.browser),force:q,sandboxOverride:o.sandbox,approveMcps:H,mode:ne,workspace:o.workspace,headers:A(o.header),agentEndpoint:o.agentEndpoint,enableRetries:ee,endlessRetries:te,customSystemPrompt:(()=>{const e=o.systemPrompt;if("string"==typeof e&&e.trim().length>0){const t=(0,s.resolve)(e);(0,r.existsSync)(t)||(0,u.uQ)(1,`Error: --system-prompt file not found: ${t}`);try{const e=(0,r.readFileSync)(t,"utf8");return e&&0!==e.trim().length||(0,u.uQ)(1,`Error: --system-prompt file is empty: ${t}`),e.trim()}catch(e){(0,u.uQ)(1,`Error: failed to read --system-prompt file: ${t}`)}}})(),printEnv:Y,disableAutoUpdate:o.disableAutoUpdate};try{yield(0,b.J)(e,J,oe,P)}catch(t){if(!(t instanceof S.hY))throw t;{B&&(0,u.uQ)(1,`${t.message}\n\nPlease run '${(0,E.mf)()} login' to authenticate.`);const n=(0,i.Vi)({credentialManager:P,endpoint:O,configProvider:I});(yield(0,x.f4)(P,I,n,t.message))||(0,u.uQ)(1,`Authentication required. Please run '${(0,E.mf)()} login' to authenticate.`),yield(0,b.J)(e,J,oe,P)}}}))}o()}catch(R){o(R)}}))},"./src/commands/install-core-posix.ts":(e,t,n)=>{n.d(t,{BV:()=>u});var o=n("node:child_process"),r=n("node:fs"),s=n("node:os"),i=n("node:path"),l=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const a=6e4;function c(e){const t=i.join(s.homedir(),".local","bin");r.mkdirSync(t,{recursive:!0});const n=i.join(e,"cursor-agent"),o=i.join(t,"agent"),l=i.join(t,"cursor-agent"),a=(e,t)=>{try{r.unlinkSync(t)}catch(e){}r.symlinkSync(e,t)};a(n,o),a(n,l)}function d(){const e=i.join(s.homedir(),".local","bin");r.mkdirSync(e,{recursive:!0});const t=i.join(e,"cursor"),n=["#!/bin/sh","set -eu","","# Find cursor executable in PATH, excluding the current shim","find_cursor() {",'  old_IFS="$IFS"',"  IFS=:","  for dir in $PATH; do",'    [ -n "$dir" ] || continue','    cursor_path="$dir/cursor"','    if [ "$cursor_path" != "$HOME/.local/bin/cursor" ] && [ -x "$cursor_path" ]; then','      IFS="$old_IFS"','      echo "$cursor_path"',"      return 0","    fi","  done",'  IFS="$old_IFS"',"  return 1","}","","OTHER_CURSOR=$(find_cursor || true)","",'if [ -n "${OTHER_CURSOR:-}" ]; then','  exec "$OTHER_CURSOR" "$@"',"else",'  if [ "$1" != "agent" ]; then',"    echo \"Error: No Cursor IDE installation found. Use 'cursor agent' or 'agent' to run the agent.\" 1>&2",'    echo "Or, install Cursor at https://cursor.com/download" 1>&2',"    exit 1","  fi",'  exec "$HOME/.local/bin/agent" "$@"',"fi",""].join("\n");r.writeFileSync(t,n,{mode:493});try{r.chmodSync(t,493)}catch(e){}}function u(e){return l(this,void 0,void 0,(function*(){const{version:t,urlPrefix:n,showProgress:l=!1,skipIfLocked:u=!1}=e,p=i.join(s.homedir(),".local","share","cursor-agent",".install.lock"),h=function(e){const t=i.dirname(e);try{r.mkdirSync(t,{recursive:!0})}catch(e){}try{if(r.existsSync(e)){const t=r.statSync(e);if(Date.now()-t.mtimeMs>a)try{r.statSync(e).ino===t.ino&&r.unlinkSync(e)}catch(e){}}return r.openSync(e,"wx")}catch(e){if(e&&"object"==typeof e&&"code"in e&&"EEXIST"===e.code)return null;throw e}}(p);if(null===h){if(u)return;throw new Error("Another CLI update is already in progress. Wait for it to finish or remove ~/.local/share/cursor-agent/.install.lock if no update is running.")}try{const{os:a,arch:u}=function(){const e=s.platform(),t=s.arch();let n,o;switch(e){case"linux":n="linux";break;case"darwin":n="darwin";break;default:throw new Error(`Unsupported operating system: ${e}`)}switch(t){case"x64":o="x64";break;case"arm64":o="arm64";break;default:throw new Error(`Unsupported architecture: ${t}`)}return{os:n,arch:o}}(),p=i.join(s.homedir(),".local","share","cursor-agent","versions"),h=i.join(p,t),g=i.join(p,`.${t}`);if(r.existsSync(h))return c(h),void d();try{r.rmSync(g,{recursive:!0,force:!0})}catch(e){}r.mkdirSync(g,{recursive:!0});const m=`${n.endsWith("/")?n:`${n}/`}${a}/${u}/agent-cli-package.tar.gz`;try{const t=l?["-fSL","--progress-bar",m]:["-fSL","-s",m];yield new Promise(((n,r)=>{const s=e.showProgress?"inherit":"ignore",i=(0,o.spawn)("tar",["--strip-components=1","-xzf","-","-C",g],{stdio:["pipe","ignore",s]}),l=(0,o.spawn)("curl",t,{stdio:["ignore","pipe",s]});l.stdout.pipe(i.stdin);let a=null,c=null,d=!1;const u=()=>{null===a||null===c||d||(d=!0,0===a?0===c?n():r(new Error(`Extraction failed (tar exit ${c})`)):r(new Error(`Download failed (curl exit ${a})`)))};l.on("error",(e=>{if(!d){d=!0;try{i.kill("SIGTERM")}catch(e){}r(e)}})),i.on("error",(e=>{if(!d){d=!0;try{l.kill("SIGTERM")}catch(e){}r(e)}})),l.on("close",(e=>{var t;a=null!=e?e:1;try{null===(t=i.stdin)||void 0===t||t.end()}catch(e){}if(0!==a)try{i.kill("SIGTERM")}catch(e){}u()})),i.on("close",(e=>{if(c=null!=e?e:1,0!==c)try{l.kill("SIGTERM")}catch(e){}u()}))}));try{r.rmSync(h,{recursive:!0,force:!0})}catch(e){}r.renameSync(g,h)}catch(e){try{r.rmSync(g,{recursive:!0,force:!0})}catch(e){}throw new Error(`Download failed: ${e instanceof Error?e.message:String(e)}`)}c(h),d()}finally{!function(e,t){try{r.closeSync(t)}catch(e){}try{r.unlinkSync(e)}catch(e){}}(p,h)}}))}},"./src/commands/logout.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.r(t),n.d(t,{handleLogout:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../keychain/dist/index.js"),l=n("./src/components/login-ui.tsx"),a=n("./src/statsig.ts"),c=e([s,l]);[s,l]=c.then?(await c)():c;var d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function u(e,t){return d(this,void 0,void 0,(function*(){const{rerender:n}=(0,s.XX)((0,r.jsx)(l.L,{status:"starting"}));try{(yield e.getAccessToken())||(n((0,r.jsx)(l.L,{status:"success",message:"Authentication tokens removed."})),process.exit(0))}catch(e){e instanceof i.fI&&(n((0,r.jsx)(l.L,{status:"success",message:"Authentication tokens removed."})),process.exit(0))}try{n((0,r.jsx)(l.L,{status:"in-progress"})),yield e.clearAuthentication(),yield t.transform((e=>Object.assign(Object.assign({},e),{privacyCache:void 0,authInfo:void 0}))),(0,a.yX)(),n((0,r.jsx)(l.L,{status:"success",message:"Authentication tokens removed."}))}catch(e){n((0,r.jsx)(l.L,{status:"error",message:`Failed to remove authentication tokens: ${e}`})),process.exit(1)}process.exit(0)}))}o()}catch(p){o(p)}}))},"./src/commands/resume.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{$0:()=>g,oh:()=>h,xT:()=>m});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:fs"),i=n("node:path"),l=n("../ink/build/index.js"),a=n("./src/components/unified-list-pager.tsx"),c=n("./src/state/index.ts"),d=n("./src/state/sqlite-blob-store.ts"),u=e([l,a]);[l,a]=u.then?(await u)():u;var p=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function h(e){return p(this,void 0,void 0,(function*(){return new Promise((t=>{const n=(0,l.XX)((0,r.jsx)(a.W,{client:e,onClose:()=>{n.unmount(),t(null)},onSelectChat:e=>{n.unmount(),t({kind:"chat",id:e})},onSelectBackground:e=>{n.unmount(),t({kind:"background",id:e})}}))}))}))}function g(){return p(this,void 0,void 0,(function*(){return yield m(1)}))}function m(e){return p(this,void 0,void 0,(function*(){var t,n;try{if(!Number.isFinite(e)||e<=0)return null;const o=(0,c.r)(),r=(0,s.readdirSync)(o,{withFileTypes:!0}),l=(yield Promise.all(r.filter((e=>e.isDirectory())).map((e=>p(this,void 0,void 0,(function*(){const t=(0,i.join)(o,e.name);try{const n=(0,i.join)(t,"store.db");let o=0;try{const e=(0,s.statSync)(n);o=Math.floor(e.mtimeMs)}catch(e){}if(o<=0)return null;const r=(yield d.M.initAndLoad(n)).get("latestRootBlobId");return r&&0!==r.length?{name:e.name,lastInteractionMs:o}:null}catch(e){return null}})))))).filter((e=>null!==e));return l.sort(((e,t)=>(t.lastInteractionMs||0)-(e.lastInteractionMs||0))),null!==(n=null===(t=l[Math.max(0,Math.min(l.length-1,e-1))])||void 0===t?void 0:t.name)&&void 0!==n?n:null}catch(e){return null}}))}o()}catch(f){o(f)}}))},"./src/commands/set-line-numbers.ts":(e,t,n)=>{n.d(t,{x:()=>r});var o=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function r(e){return o(this,void 0,void 0,(function*(){var t,n;const r=!(null!==(n=null===(t=e.get().display)||void 0===t?void 0:t.showLineNumbers)&&void 0!==n&&n);return yield function(e,t){return o(this,void 0,void 0,(function*(){yield e.transform((e=>{var n,o;return Object.assign(Object.assign({},e),{display:{showLineNumbers:t,showThinkingBlocks:null!==(o=null===(n=e.display)||void 0===n?void 0:n.showThinkingBlocks)&&void 0!==o&&o}})}))}))}(e,r),r}))}},"./src/commands/set-thinking-blocks.ts":(e,t,n)=>{n.d(t,{f:()=>r});var o=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function r(e){return o(this,void 0,void 0,(function*(){var t,n;const r=!(null!==(n=null===(t=e.get().display)||void 0===t?void 0:t.showThinkingBlocks)&&void 0!==n&&n);return yield function(e,t){return o(this,void 0,void 0,(function*(){yield e.transform((e=>{var n,o;return Object.assign(Object.assign({},e),{display:{showLineNumbers:null!==(o=null===(n=e.display)||void 0===n?void 0:n.showLineNumbers)&&void 0!==o&&o,showThinkingBlocks:t}})}))}))}(e,r),r}))}},"./src/commands/update-core.ts":(e,t,n)=>{n.d(t,{N:()=>a});var o=n("./src/analytics.ts"),r=n("./src/console-io.ts"),s=n("./src/commands/install-core-posix.ts");n("node:child_process");var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function l(e){const t=e.match(/^(\d{4})\.(\d{2})\.(\d{2})/);if(!t)throw new Error(`Invalid version format: ${e}`);const[,n,o,r]=t;return 1e6*parseInt(n,10)+1e3*parseInt(o.replace(/^0/,""),10)+parseInt(r.replace(/^0/,""),10)}function a(e){return i(this,void 0,void 0,(function*(){const{dashboardClient:t,showProgress:n=!0,isAutoUpdate:a=!1}=e,c=null!=="2026.02.13-41ac335"?"2026.02.13-41ac335":"unknown",d=null!=="2026.02.13-41ac335"?"2026.02.13-41ac335":"";n&&(0,r.p2)("Checking for updates...");const u=yield function(e,t){return i(this,void 0,void 0,(function*(){const n="prod-stable-internal"===t?"prod":t,o=yield e.getCliDownloadUrl({channel:n});if(!o.url||!o.version)throw new Error("Invalid response from server: missing URL or version information");return{version:o.version,url:o.url}}))}(t,e.channel);if(!function(e,t,n=!1){try{const o=l(e),r=l(t);return o!==r?o<r:!n&&e!==t}catch(n){return(0,r.p2)(`Invalid version format: ${e} or ${t}`),e!==t}}(d,u.version,a))return void(n&&(0,r.p2)("Already up to date"));n&&(0,r.p2)(`Latest version available: ${u.version}`);let p=!1;try{yield(0,s.BV)({version:u.version,urlPrefix:u.url,showProgress:n,skipIfLocked:a}),n&&(0,r.p2)("Done"),p=!0}finally{(0,o.sx)("cli.updated",{update_type:a?"auto":"manual",from_version:c,to_version:u.version,success:p})}}))}},"./src/components/alt-screen.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{I:()=>h,m:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/context/terminal-state-context.tsx"),c=n("./src/hooks/use-debounced-callback.ts"),d=n("./src/hooks/use-mounted-effect.ts"),u=e([s,a]);[s,a]=u.then?(await u)():u;const p=e=>{e.write("[H[2J[3J")},h=({children:e,clearScreenTrigger:t,clearOnMount:n=!0})=>{const{stdout:o}=(0,s.t$)(),u=(0,a.PH)(),[h,g]=(0,i.useState)(n),m=(0,c.Y)((()=>{g(!0),p(o),setImmediate((()=>{g(!1)}))}),l.Zo,{leading:!0,trailing:!0}),f=(0,c.Y)((()=>{p(o)}),l.Zo,{leading:!0,trailing:!0});return(0,i.useEffect)((()=>{n&&(p(o),setImmediate((()=>{g(!1)})))}),[n,o]),(0,d.H)((()=>{o&&m()}),[o,u,m]),(0,d.H)((()=>{o&&f()}),[t,o,f]),(0,r.jsx)(r.Fragment,{children:h?null:e})};o()}catch(e){o(e)}}))},"./src/components/animated-dots.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{U:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=({interval:e=160})=>{const[t,n]=(0,i.useState)(1);(0,i.useEffect)((()=>{const t=setInterval((()=>{n((e=>3===e?0:e+1))}),e);return()=>clearInterval(t)}),[e]);const o=".".repeat(t).padEnd(3," ");return(0,r.jsx)(s.EY,{children:o})};o()}catch(e){o(e)}}))},"./src/components/app-header.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{j:()=>v});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:os"),i=n.n(s),l=n("node:path"),a=n.n(l),c=n("../ink/build/index.js"),d=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),u=n("./src/constants.ts"),p=n("./src/hooks/use-current-branch.ts"),h=n("./src/hooks/use-git-root.ts"),g=n("./src/utils/path-utils.ts"),m=n("./src/utils/version.ts"),f=e([c]);c=(f.then?(await f)():f)[0];const v=({debugInfo:e,isRepository:t,folderMode:n="cwd",badge:o,locationDisplayOverride:s,branchDisplayOverride:l,isBackground:f})=>{const v=(0,d.useMemo)((()=>{const e=process.cwd(),t=i().homedir(),n=e.startsWith(t)?`~${e.slice(t.length)}`:e;return{root:e,displayPath:n,name:a().basename(e)||e}}),[]),x=(0,m.x)(),b=(0,p.h)(v),y=(0,h._)(v),w=(0,d.useMemo)((()=>{if(!y)return"";const e=i().homedir();return y.startsWith(e)?`~${y.slice(e.length)}`:y}),[y]);return(0,r.jsxs)(c.az,{flexDirection:"column",children:[e&&(0,r.jsx)(c.az,{marginX:1,marginBottom:1,paddingX:1,children:(0,r.jsxs)(c.az,{flexDirection:"row",alignItems:"center",gap:1,children:[(0,r.jsx)(c.EY,{color:"gray",bold:!0,children:"DEBUG MODE"}),(0,r.jsx)(c.EY,{color:"gray",children:"•"}),(0,r.jsx)(c.EY,{color:"yellow",children:e.serverUrl})]})}),"true"!==process.env.AGENT_CLI_HIDE_HEADER&&(0,r.jsxs)(c.az,{marginX:1,paddingX:1,flexDirection:"column",flexGrow:1,marginTop:e?0:1,borderLeft:!0,children:[(0,r.jsxs)(c.EY,{color:"foreground",children:[f?"Cursor Cloud Agent":"Cursor Agent",(0,r.jsxs)(c.EY,{dimColor:!0,children:[" ","unknown"!==x?`v${x}`:""]}),o?(0,r.jsxs)(r.Fragment,{children:[" ",o]}):null]}),(0,r.jsxs)(c.EY,{color:"foreground",dimColor:!0,children:[(0,r.jsx)(c.EY,{wrap:"truncate-start",children:(0,g.tk)(null!=s?s:"cwd"===n?v.displayPath:w,u.DN)}),(null!=l?l:b)?(0,r.jsxs)(c.EY,{children:[" · ",null!=l?l:b]}):null]}),t?null:(0,r.jsx)(c.EY,{color:"gray",children:"(cwd is not a git repository, cursor rules and ignore files don't apply)"})]})]})};o()}catch(e){o(e)}}))},"./src/components/approval-dialog.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{b:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];var l=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function a({title:e,description:t,content:n,options:o,selectedOption:i,variant:l="warning"}){const a="info"===l,c=a?"blue":"yellow",d=a?"blue":"yellow",u=a?"ℹ ":"⚠ ";return(0,r.jsx)(s.az,{flexDirection:"column",marginTop:1,marginX:2,children:(0,r.jsxs)(s.az,{flexDirection:"column",borderStyle:"round",borderColor:c,paddingX:2,paddingY:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:d,bold:!0,children:u}),(0,r.jsx)(s.EY,{color:"foreground",bold:!0,children:e})]})}),(0,r.jsxs)(s.az,{marginTop:1,flexDirection:"column",children:[(0,r.jsx)(s.az,{flexDirection:"column",gap:1,children:t.map((e=>(0,r.jsx)(s.EY,{color:"foreground",children:e},e)))}),n&&(0,r.jsx)(s.az,{marginTop:1,marginLeft:2,flexDirection:"column",children:n})]}),(0,r.jsx)(s.az,{marginTop:2,flexDirection:"column",children:o.map(((e,t)=>(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:i===t?"green":"gray",children:i===t?"▶ ":"  "}),(0,r.jsxs)(s.EY,{color:i===t?"foreground":"gray",bold:i===t,children:["[",e.key,"] ",e.label]})]},e.value)))}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"Use arrow keys to navigate, Enter to select, or press the key shown"})})]})})}function c(e){return l(this,arguments,void 0,(function*({title:e,description:t,content:n,options:o,onAction:i,variant:c}){return new Promise((d=>{let u=0;const{rerender:p,waitUntilExit:h}=(0,s.XX)((0,r.jsx)(a,{title:e,description:t,content:n,options:o,selectedOption:u,variant:c}),{exitOnCtrlC:!1}),g=e=>l(this,void 0,void 0,(function*(){yield i(e),d(e)}));process.stdin.setRawMode(!0),process.stdin.resume();const m=s=>{const i=s.toString(),l=s[0];if(3===s.length&&27===s[0]&&91===s[1]){if(66===s[2])return u=(u+1)%o.length,void p((0,r.jsx)(a,{title:e,description:t,content:n,options:o,selectedOption:u,variant:c}));if(65===s[2])return u=(u-1+o.length)%o.length,void p((0,r.jsx)(a,{title:e,description:t,content:n,options:o,selectedOption:u,variant:c}))}if(13===l)return process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),void g(o[u].value);const d=i.toLowerCase(),h=o.find((e=>e.key.toLowerCase()===d));return h?(process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),void g(h.value)):27===l||3===l?(process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),void g(o[o.length-1].value)):void 0};process.stdin.on("data",m),h().then((()=>{process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),d(o[o.length-1].value)})).catch((()=>{process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),d(o[o.length-1].value)}))}))}))}o()}catch(d){o(d)}}))},"./src/components/ask-question-form.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{o:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/tool-row-box.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=e=>{var t;const n=null!==(t=null==e?void 0:e.trim())&&void 0!==t?t:"";return n.length>0?n:"Clarifying Questions"},c=(e,t)=>e&&t?"› [x]":e?"› [ ]":t?"  [x]":"  [ ]",d=({args:e,selection:t,isAsync:n})=>{const o=a(e.title);return(0,r.jsx)(i.Y,{flexDirection:"column",borderColor:"cyan",borderDimColor:!1,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,gap:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{bold:!0,color:"cyan",children:[o,n?" (async)":""]})}),(0,r.jsx)(s.az,{flexDirection:"column",gap:1,children:e.questions.map(((e,n)=>{var o;const i=n===t.activeQuestionIndex,l=null!==(o=t.selectionsByQuestionId[e.id])&&void 0!==o?o:[];return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{color:i?"cyan":"foreground",children:[n+1,". ",e.prompt,e.allowMultiple?" (multi-select)":""]}),(0,r.jsx)(s.az,{flexDirection:"column",marginLeft:2,children:e.options.map(((e,n)=>{const o=l.includes(e.id),a=i&&n===t.activeOptionIndex,d=c(a,o);return(0,r.jsxs)(s.EY,{color:a?"cyan":"gray",children:[d," ",e.label]},e.id)}))})]},e.id)}))}),(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:"gray",children:"↑/↓ option · ←/→ question · Space/Enter select · Enter to submit · Esc to skip"})})]})})};o()}catch(e){o(e)}}))},"./src/components/ask-question-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=e=>{const t={};if("success"!==(null==e?void 0:e.result.case))return t;for(const n of e.result.value.answers)t[n.questionId]=n.selectedOptionIds.slice();return t},d=e=>{switch(null==e?void 0:e.result.case){case"success":return{status:"success"};case"rejected":return{status:"rejected",note:(null==e?void 0:e.result.value.reason)||"Questions skipped by user"};case"error":return{status:"error",errorMessage:(null==e?void 0:e.result.value.errorMessage)||"Unknown error"};case"async":return{status:"pending",note:"Awaiting async responses"};default:return{status:"pending"}}},u=({tool:{args:e,result:t}})=>{var n;if(!e)return null;const o=c(t),{status:a,note:u,errorMessage:p}=d(t),h=(null===(n=e.title)||void 0===n?void 0:n.trim())||"Clarifying Questions",g=e.questions.length;return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"AskQuestion",primary:`${h} (${g})`,status:a,note:u}),p&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",p]})}),(0,r.jsx)(s.az,{flexDirection:"column",marginLeft:i.SK,gap:1,children:e.questions.map(((e,t)=>{var n;const i=null!==(n=o[e.id])&&void 0!==n?n:[],l=e.allowMultiple?" (multi-select)":"";return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{children:[t+1,". ",e.prompt,(0,r.jsx)(s.EY,{color:"gray",children:l})]}),(0,r.jsx)(s.az,{flexDirection:"column",marginLeft:2,children:e.options.map((e=>{const t=i.includes(e.id);return(0,r.jsxs)(s.EY,{color:t?"green":"gray",children:[t?"[x]":"[ ]"," ",e.label]},e.id)}))})]},e.id)}))})]})};o()}catch(e){o(e)}}))},"./src/components/background-edit-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{l:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/components/highlighted-code.tsx"),c=n("./src/components/inline-delta.tsx"),d=n("./src/components/tool-row-box.tsx"),u=e([s,a,c,d]);[s,a,c,d]=u.then?(await u)():u;const p=({path:e,result:t})=>{var n;const o=null==t?void 0:t.diff,u=(0,i.useMemo)((()=>(null==o?void 0:o.chunks)&&0!==o.chunks.length?o.chunks.map((e=>{var t;return null!==(t=e.linesAdded)&&void 0!==t?t:0})).reduce(((e,t)=>e+t),0):0),[null==o?void 0:o.chunks]),p=(0,i.useMemo)((()=>(null==o?void 0:o.chunks)&&0!==o.chunks.length?o.chunks.map((e=>{var t;return null!==(t=e.linesRemoved)&&void 0!==t?t:0})).reduce(((e,t)=>e+t),0):0),[null==o?void 0:o.chunks]),h=(0,i.useMemo)((()=>{var e,t,n,r,s;const i=o;if(!i||!i.chunks||0===i.chunks.length)return;let l="";for(const o of i.chunks){l+=`@@ -${null!==(e=o.oldStart)&&void 0!==e?e:0},${null!==(t=o.oldLines)&&void 0!==t?t:0} +${null!==(n=o.newStart)&&void 0!==n?n:0},${null!==(r=o.newLines)&&void 0!==r?r:0} @@\n`;const i=null!==(s=o.diffString)&&void 0!==s?s:"";if(i)for(const e of i.split("\n"))e?e.startsWith("@@")||(l+=`${e}\n`):l+="\n"}return l.trimEnd()}),[o]),g=(0,i.useMemo)((()=>{var e;if(t)return t.rejected?"Edit rejected":(null===(e=t.recoverableError)||void 0===e?void 0:e.modelMessage)?t.recoverableError.modelMessage:u>0||p>0?(0,r.jsx)(c._,{added:u,removed:p}):void 0}),[t,u,p]),m=(0,i.useMemo)((()=>(null==t?void 0:t.rejected)?"yellow":"gray"),[null==t?void 0:t.rejected]);return e?(0,r.jsxs)(d.Y,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,paddingX:1,children:[(0,r.jsx)(s.az,{flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:e})}),"string"==typeof g?(0,r.jsx)(s.EY,{color:m,wrap:"truncate",children:g}):g?(0,r.jsx)(s.az,{children:g}):null]}),h?(0,r.jsx)(a.d,{content:h,language:null!==(n=(0,l.Ak)(e))&&void 0!==n?n:"diff",isDiff:!0,showLineNumbers:!1,maxLines:12,truncationHint:l.hD?"ctrl+r to review":void 0,paddingX:1}):null]}):null};o()}catch(e){o(e)}}))},"./src/components/background-prompt-bar.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{m:()=>j});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/console-io.ts"),a=n("./src/constants.ts"),c=n("./src/context/vim-mode-context.tsx"),d=n("./src/exit.ts"),u=n("./src/hooks/prompt/use-at-palette.ts"),p=n("./src/hooks/prompt/use-slash-palette.ts"),h=n("./src/hooks/use-background-actions.ts"),g=n("./src/utils/input-keys.ts"),m=n("./src/components/prompt/decision-dropdown.tsx"),f=n("./src/components/prompt/palette-at-list.tsx"),v=n("./src/components/prompt/palette-slash-list.tsx"),x=n("./src/components/prompt/prompt-footer.tsx"),b=n("./src/components/text-input.tsx"),y=e([s,m,f,v,x,b]);[s,m,f,v,x,b]=y.then?(await y)():y;var w=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const j=({prompt:e,setPrompt:t,onSubmit:n,topStatus:o,topStatusMarginTop:y,isDisabled:j=!1,isProcessing:k=!1,modelLabel:C="Loading...",isMaxMode:S,placeholder:E="Add a follow-up",promptSymbol:M="→",branchName:$,onRequestReview:T,bcId:I,changes:P,slashCommands:A=[],backgroundComposerClient:D,printEphemeral:_})=>{var R;const{exit:L}=(0,s.nm)(),[O,Y]=(0,i.useState)(!1),[F,z]=(0,i.useState)(null),[N,U]=(0,i.useState)(!0),{vimEnabled:B,mode:q}=(0,c.v)(),H=null!==(R=null==P?void 0:P.length)&&void 0!==R?R:0,[W,G]=(0,i.useState)(0),X=i.useRef(null),K=(0,i.useCallback)((e=>{X.current?X.current(e):t(e)}),[t]),Q=i.useMemo((()=>{if(H>0){const e="Try /apply-changes-locally or /checkout-locally";return E?`${E} — ${e}`:e}return E}),[E,H]),[J,V]=(0,i.useState)(!1),[Z,ee]=(0,i.useState)(""),[te,ne]=(0,i.useState)(void 0),[oe,re]=(0,i.useState)("Continue"),[se,ie]=(0,i.useState)("Cancel"),le=(0,i.useRef)(null),[ae,ce]=(0,i.useState)(0),de=(0,i.useCallback)((e=>new Promise((t=>{var n,o;ee(e.title),ne(e.detail),re(null!==(n=e.continueLabel)&&void 0!==n?n:"Continue"),ie(null!==(o=e.cancelLabel)&&void 0!==o?o:"Cancel"),le.current=t,ce(0),V(!0)}))),[]),ue=(0,u.g)(e),pe=(0,h.V)(D),he=i.useMemo((()=>[...H>0?[{id:"checkout-locally",title:"Checkout Locally",description:"Check out the current cloud agent's branch",run:()=>w(void 0,void 0,void 0,(function*(){if(I){null==_||_([[{text:"⟲ ",color:"cyan"},{text:"Preparing checkout…",dim:!0}]]),K("");try{yield pe.checkoutLocally(I,{print:_,confirm:de})}catch(e){null==_||_([[{text:"Error:",color:"red",bold:!0},{text:` ${e instanceof Error?e.message:String(e)}`}]])}}else null==_||_([[{text:"Error:",color:"red",bold:!0},{text:" No active cloud agent"}]])}))},{id:"apply-changes-locally",title:"Apply Changes Locally",description:"Apply this cloud agent's diffs into the working tree",run:()=>w(void 0,void 0,void 0,(function*(){if(I){null==_||_([[{text:"⟲ ",color:"cyan"},{text:"Merging changes… (conflicts will be shown)",dim:!0}]]),K("");try{yield pe.applyChangesLocally(I,{print:_,confirm:de})}catch(e){null==_||_([[{text:"Error:",color:"red",bold:!0},{text:` ${e instanceof Error?e.message:String(e)}`}]])}}else null==_||_([[{text:"Error:",color:"red",bold:!0},{text:" No active cloud agent"}]])}))}]:[]]),[I,pe,de,_,K,H]),ge=i.useMemo((()=>[...A,...he]),[A,he]),me=i.useMemo((()=>({insertText:K})),[K]),fe=(0,p.e)(e,ge,me),ve=ue.active||fe.active,xe=(0,i.useDeferredValue)(fe.items),be=(0,i.useDeferredValue)(ue.suggestions),ye=(0,i.useCallback)((e=>{const t=ue.acceptExpansion(e);return null!=t&&t!==e?(K(t),G((e=>e+1)),t):null}),[ue,K]);(0,i.useEffect)((()=>{if(!O)return;const e=setTimeout((()=>Y(!1)),a.kd);return()=>clearTimeout(e)}),[O]),(0,i.useEffect)((()=>{O&&e.length>0&&(Y(!1),z(null))}),[e,O]);const we=(0,i.useCallback)(((e=!1)=>{U(!1),setTimeout((()=>{if(I){const e=`https://cursor.com/agents/${I}`;(0,l.p2)(`\n  [90mOpen Cloud Agent in:[0m [1m[36m${e}[0m`)}L(),(0,d.GZ)({code:d.yU.SUCCESS})}),100)}),[I,L]),je=(0,i.useCallback)((()=>{e.length>0?K(""):O?(K(""),we()):(Y(!0),z("ctrlC"))}),[e.length,O,K,we]),ke=(0,i.useCallback)((()=>{H>0&&(null==T||T())}),[H,T]),Ce=(0,i.useCallback)((()=>{if(O||!k)return K(""),void we();Y(!0),z("ctrlD")}),[O,k,we,K]),Se=0===e.length,Ee="ctrlD"===F?"Press Ctrl+D again to exit":"ctrlC"===F?"Press Ctrl+C again to exit":void 0;(0,s.Ge)(((e,t)=>{const n=(0,g.u$)(e,t),o=(0,g.Po)(e,t),r=(0,g.xv)(e,t);if(J){if(n||"j"===e||"J"===e)return void ce((e=>Math.min(e+1,1)));if(o||"k"===e||"K"===e)return void ce((e=>Math.max(e-1,0)));if(r||t.ctrl&&"c"===e||"n"===e||"N"===e){const e=le.current;return le.current=null,V(!1),void(null==e||e(!1))}if(t.return){const e=le.current,t=0===ae;return le.current=null,V(!1),void(null==e||e(t))}if("y"===e||"Y"===e){const e=le.current;return le.current=null,V(!1),void(null==e||e(!0))}}else{if(fe.active&&fe.items.length>0){if(n)return void fe.next();if(o)return void fe.prev();if(r)return void fe.hide()}if(ue.active&&ue.suggestions.length>0){if(n)return void ue.next();if(o)return void ue.prev();if(r)return void ue.suppress()}}}),{isActive:J||ue.active||fe.active});if(!N)return null;if(j)return(0,r.jsx)(s.az,{flexDirection:"column",borderColor:"foreground",borderTop:!0,borderStyle:"single",paddingLeft:1,marginX:1,children:(0,r.jsx)(s.az,{flexDirection:"row",children:(0,r.jsx)(s.EY,{color:"gray",children:"Input disabled"})})});const Me=!J&&o;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.az,{marginTop:null!=y?y:0,marginBottom:0,marginX:1,paddingLeft:1,children:Me?o:null}),(0,r.jsxs)(s.az,{flexDirection:"column",borderColor:J?"yellow":"foreground",borderTop:!0,borderStyle:"single",paddingLeft:1,marginX:1,children:[J&&(0,r.jsx)(s.az,{marginBottom:0,flexDirection:"column",children:(0,r.jsx)(m.A,{title:Z,highlightColor:"yellow",options:[{label:oe,hint:"y"},{label:se,hint:"esc/n"}],selectedIndex:ae,subtitle:te})}),!J&&(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsxs)(s.EY,{color:"foreground",dimColor:0===e.length,children:[M," "]}),(0,r.jsx)(s.az,{flexGrow:1,children:(0,r.jsx)(b.A,{value:e,onChange:t,onSubmit:e=>{if(!J){if(ue.active&&null!=ye(e))return;if(e.startsWith("/")){if(fe.active){const t=fe.acceptExpansion(e);if(null!=t&&t!==e)return K(t),void G((e=>e+1))}return w(void 0,void 0,void 0,(function*(){const t=yield fe.runIfExecutable(e,ge,{insertText:e=>K(e),clearInput:()=>K("")});"handled"!==t&&"executed"!==t&&n(e)})),ue.hide(),void fe.hide()}n(e),ue.hide(),fe.hide()}},placeholder:Q,rightPlaceholder:k?"ctrl+c to stop":0===e.length&&B?"insert"===q?"INSERT":"NORMAL":void 0,onCtrlC:je,onCtrlD:Se?Ce:void 0,onCtrlR:ke,allowExplicitNewline:!0,onTab:()=>{if(fe.active){const t=fe.acceptExpansion(e);if(null!=t)return K(t),void G((e=>e+1))}if(null==ye(e))return!e.startsWith("/")||e.endsWith(" ")||(e=>{const t=(e=>{if(!e.startsWith("/"))return null;const t=e.slice(1).split(/\s+/).filter(Boolean),n=t[0]||"",o=t.slice(1),r=ge.find((e=>e.id.toLowerCase()===n.toLowerCase())),s=((null==r?void 0:r.args)||[]).filter((e=>!1!==e.required)).length;return{cmdId:n,args:o,required:s,hasCmd:!!r}})(e);return Boolean((null==t?void 0:t.hasCmd)&&t.args.length>=t.required)})(e)?void 0:(K(`${e} `),void G((e=>e+1)))},showCursor:!0,focus:!0,cursorToEndSignal:W,replaceValueRef:X,onReplace:t})})]})]}),!J&&(0,r.jsx)(s.az,{height:ve?Math.min(fe.active?Math.min(fe.items.length,a.kQ):Math.min(ue.suggestions.length,a.kQ),a.kQ):0,flexDirection:"column",marginTop:0,children:ve&&(fe.active?(0,r.jsx)(v.A,{items:xe,activeIndex:fe.index,windowStart:fe.windowStart,highlightColor:"foreground"}):(0,r.jsx)(f.A,{suggestions:be,activeIndex:ue.index,windowStart:ue.windowStart,highlightColor:"foreground"}))}),!J&&(0,r.jsx)(x.A,{show:!ve,hasText:e.length>0,exitMode:O,modelLabel:C,isMaxMode:S,changedFilesCount:H,showReviewHint:H>0,exitHintText:Ee,headlineLabel:(0,r.jsxs)(s.EY,{color:"magenta",children:["^ Cloud Agent",$?(0,r.jsxs)(s.EY,{color:"foreground",dimColor:!0,children:[" ","· ",$]}):null]}),headlineColor:"magenta"})]})};o()}catch(e){o(e)}}))},"./src/components/background-shell-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{d:()=>g});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/utils/characters.ts"),c=n("./src/utils/durations.ts"),d=n("./src/utils/path-utils.ts"),u=n("./src/components/highlighted-code.tsx"),p=n("./src/components/tool-row-box.tsx"),h=e([s,u,p]);[s,u,p]=h.then?(await h)():h;const g=({command:e,cwd:t,result:n,expand:o})=>{var h;const g=(0,i.useMemo)((()=>(e||"").trim()),[e]),m=(0,i.useMemo)((()=>{const e=t||(null==n?void 0:n.resultingWorkingDirectory)||void 0;if(!e)return;const o=(0,d.fw)(e),r="."===o?"current dir":o;return(0,d.tk)(r,l.DN)}),[t,null==n?void 0:n.resultingWorkingDirectory]),f=(0,i.useMemo)((()=>{var e;if(!n)return;if(n.rejected)return"Rejected";const t=null!==(e=n.exitCodeV2)&&void 0!==e?e:n.exitCode;return null!=t?`exit ${t}`:void 0}),[n]),[v,x]=(0,i.useState)(null),[b,y]=(0,i.useState)(0),w=(0,i.useMemo)((()=>!n),[n]);(0,i.useEffect)((()=>{w?null===v&&x(Date.now()):(null!==v&&x(null),y(0))}),[w,v]),(0,i.useEffect)((()=>{if(null===v)return;const e=setInterval((()=>{y(Date.now()-v)}),100);return()=>clearInterval(e)}),[v]);const j=(0,i.useMemo)((()=>{if(!n)return null;if(n.rejected)return{text:"Request rejected",color:"yellow"};return{text:(e=>e.replace(/(\S{80})(?=\S)/g,"$1​"))((e=n.outputRaw||n.output||"",(0,a.aJ)(e))),color:void 0};var e}),[n]);return(0,r.jsxs)(p.Y,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",paddingX:1,children:[(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:"$ "})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsxs)(s.EY,{wrap:"wrap",children:[(0,r.jsx)(s.EY,{color:"foreground",children:g}),f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:f})]}):null,w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:null!==(h=(0,c.u)(b))&&void 0!==h?h:void 0})]}):null,m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.EY,{color:"gray",children:["in ",m]})]}):null]})})]}),n&&j?"yellow"===j.color?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"yellow",wrap:"wrap",children:j.text})}):j.text?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.d,{content:j.text,language:"plaintext",showLineNumbers:!1,maxLines:o?l.U5:l.Ok,truncationHint:o?void 0:"ctrl+o to expand"}),o?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"ctrl+o to collapse"})}):null]}):null:null]})};o()}catch(e){o(e)}}))},"./src/components/background-thinking-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{H:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/context/agent-state-context.tsx"),a=n("./src/utils/durations.ts"),c=n("./src/components/overflow-markdown.tsx"),d=n("./src/components/tool-row-box.tsx"),u=e([s,c,d]);[s,c,d]=u.then?(await u)():u;const p=({text:e,isDone:t,thinkingDurationMs:n,thoughtIndex:o})=>{var u;const p=!(0,l.tO)(),h=t&&n>0?`Thought for ${null!==(u=(0,a.u)(n))&&void 0!==u?u:"0ms"}`:t?"Thought":"Thinking…";return(0,r.jsxs)(d.Y,{flexDirection:"column",gap:0,children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",paddingX:1,children:[(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"gray",children:"…"})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsx)(s.EY,{color:"gray",wrap:"wrap",children:h})})]}),e?(0,r.jsxs)(s.az,{paddingX:1,flexDirection:"column",children:[(0,r.jsx)(c.m,{content:e,maxLines:p?i.U5:i.WT,showHiddenIndicator:!0,truncationHint:p?void 0:"ctrl+o to expand",dimmed:!0,preserveParagraphBreaks:!0,compact:!0}),p?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"ctrl+o to collapse"})}):null]}):null]})};o()}catch(e){o(e)}}))},"./src/components/background-tool-group-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{i:()=>h});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../proto/dist/generated/aiserver/v1/tools_pb.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/constants.ts"),c=n("./src/components/tool-call-header.tsx"),d=e([s,c]);function u(e){if(null==e)return"UNKNOWN";const t=i.XaY[e];return"string"==typeof t?t:`TOOL_${String(e)}`}function p(e,t){const n=e.toUpperCase();return n.includes("SEMSEARCH")||n.includes("SEMANTIC_SEARCH")?(0,a.F_)("semSearchToolCall",t)||(t?"Searched":"Searching"):n.includes("GREP")?(0,a.F_)("grepToolCall",t)||(t?"Grepped":"Grepping"):n.includes("READ")?(0,a.F_)("readToolCall",t)||(t?"Read":"Reading"):n.includes("GLOB")?(0,a.F_)("globToolCall",t)||(t?"Globbed":"Globbing"):n.includes("LIST")?(0,a.F_)("lsToolCall",t)||(t?"Listed":"Listing"):n.includes("EDIT")?(0,a.F_)("editToolCall",t)||(t?"Edited":"Editing"):n.includes("SHELL")||n.includes("TERMINAL")?(0,a.F_)("shellToolCall",t)||(t?"Ran":"Running"):t?e:`${e}…`}[s,c]=d.then?(await d)():d;const h=({toolCalls:e,forceCompleted:t})=>{const n=e.every((e=>!!e.result)),o=(0,l.useMemo)((()=>{const t=new Set,n=[];for(const o of e){const e=o.call.tool;t.has(e)||(t.add(e),n.push(e))}return n}),[e]),i=(0,l.useMemo)((()=>{var t;const n={};for(const o of e){const e=o.call.tool;n[e]=(null!==(t=n[e])&&void 0!==t?t:0)+1}return n}),[e]),a=(0,l.useMemo)((()=>{const t={};for(const n of e){const e=n.call.tool,o=!!n.result;void 0===t[e]?t[e]=o:t[e]=t[e]&&o}return t}),[e]),d=(0,l.useMemo)((()=>{var e;const t=[];for(const n of o){const o=null!==(e=i[n])&&void 0!==e?e:0;if(o<=0)continue;const r=u(n).toUpperCase(),s=r.includes("EDIT")?`${o} edit${1===o?"":"s"}`:r.includes("SHELL")||r.includes("TERMINAL")?`${o} shell${1===o?"":"s"}`:r.includes("SEMSEARCH")||r.includes("SEMANTIC_SEARCH")?`${o} search${1===o?"":"es"}`:r.includes("GREP")?`${o} grep${1===o?"":"s"}`:r.includes("READ")?`${o} file${1===o?"":"s"}`:r.includes("GLOB")?`${o} glob${1===o?"":"s"}`:r.includes("LIST")?`${o} director${1===o?"y":"ies"}`:`${o} call${1===o?"":"s"}`;t.push(s)}return t.join(", ")}),[o,i]),h=(0,l.useMemo)((()=>{var n;const o=[],r=new Set;for(const s of e){const e=s.call.tool;if(r.has(e))continue;r.add(e);const i=u(e),l=!!t||null!==(n=a[e])&&void 0!==n&&n;o.push(p(i,l))}const s=o.join(", ");return s?s.charAt(0).toUpperCase()+s.slice(1):"Tools"}),[e,a,t]),g=n||t?"success":"pending";return e&&0!==e.length?(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(c.C,{name:h,primary:d,status:g})}):null};o()}catch(g){o(g)}}))},"./src/components/create-plan-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{U:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/markdown.tsx"),l=n("./src/components/prompt/decision-dropdown.tsx"),a=n("./src/components/tool-row-box.tsx"),c=e([s,i,l,a]);[s,i,l,a]=c.then?(await c)():c;const d=12,u=800,p=({tool:{args:e,result:t},isSuggestingPlan:n=!1,planDecisionIndex:o=0,state:c,expand:p=!0,isRepository:h=!1})=>{var g,m,f;const v="success"===(null===(g=null==t?void 0:t.result)||void 0===g?void 0:g.case),x=function(e){if(!e||"string"!=typeof e)return null;const t=e.replace(/^file:\/\/+/,"");return t.length>0?t:null}(null==t?void 0:t.planUri);if(!(null==e?void 0:e.plan))return null;const b="rejected"===c,y=e.plan.replace(/^\s*<!-- [^>]* -->\s*\n?/,"").trimStart(),w=p||n?null:function(e){const t=e.split("\n");let n=e,o=!1;return t.length>d&&(n=t.slice(0,d).join("\n"),o=!0),n.length>u&&(n=n.slice(0,u),o=!0),{text:n.trimEnd(),wasTruncated:o}}(y),j=null!==(m=null==w?void 0:w.text)&&void 0!==m?m:y,k=null!==(f=null==w?void 0:w.wasTruncated)&&void 0!==f&&f;if(b&&!n)return(0,r.jsx)(a.Y,{flexDirection:"column",borderColor:"gray",borderDimColor:!0,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{dimColor:!0,children:"Plan (rejected)"})}),(0,r.jsx)(s.az,{paddingTop:1,children:(0,r.jsx)(i.oz,{content:j,compact:!0})}),k?(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"…(plan truncated) ctrl+o to expand"})}):null]})});if((n||!b)&&v){const e=function(e){return e?[{label:"1. Yes, build locally",hint:"(b)"},{label:"2. Yes, build in cloud",hint:"(c)"},{label:"3. No, propose changes",hint:"(p or Esc)"}]:[{label:"1. Yes, build locally",hint:"(b)"},{label:"2. No, propose changes",hint:"(p or Esc)"}]}(h),t=n?"Suggested Plan":"Plan",c=n?y:j,d=!n&&k;return(0,r.jsx)(a.Y,{flexDirection:"column",borderColor:"yellow",borderDimColor:!1,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{bold:!0,color:"yellow",children:t})}),(0,r.jsx)(s.az,{paddingTop:1,children:(0,r.jsx)(i.oz,{content:c,compact:!0})}),d?(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"…(plan truncated) ctrl+o to expand"})}):null,x?(0,r.jsx)(s.az,{paddingTop:1,paddingLeft:1,children:(0,r.jsxs)(s.EY,{color:"gray",dimColor:!0,children:["Saved to ",x]})}):null,(0,r.jsx)(s.az,{height:1,borderStyle:"single",borderTop:!1,borderLeft:!1,borderRight:!1,borderBottomColor:"gray",borderBottomDimColor:!0}),(0,r.jsxs)(s.az,{paddingY:1,flexDirection:"column",children:[(0,r.jsx)(s.az,{paddingBottom:1,children:(0,r.jsx)(s.EY,{color:"yellow",children:"Ready to build?"})}),(0,r.jsx)(l.A,{title:"",highlightColor:"yellow",options:e,selectedIndex:Math.min(o,e.length-1)})]})]})})}const C=b?"Plan (rejected)":"Plan (failed)";return(0,r.jsx)(a.Y,{flexDirection:"column",borderColor:"gray",borderDimColor:!0,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:C})}),(0,r.jsx)(s.az,{paddingTop:1,children:(0,r.jsx)(i.oz,{content:j,compact:!0})}),k?(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"…(plan truncated) ctrl+o to expand"})}):null]})})};o()}catch(e){o(e)}}))},"./src/components/cube-overlay.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{a:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/assets/ascii.json"),a=n("./src/ephemeral-bridge.ts"),c=n("./src/utils/input-keys.ts"),d=n("./src/components/onboarding-ui.tsx"),u=e([s,d]);[s,d]=u.then?(await u)():u;const p=({onClose:e})=>{var t,n;const o=(0,i.useMemo)((()=>l),[]),[u]=(0,i.useState)(.6),[p]=(0,i.useState)(1),[h]=(0,i.useState)(0),g=(0,i.useMemo)((()=>(0,d.Wv)(o)),[o]);(0,s.Ge)(((t,n)=>{((0,c.xv)(t,n)||n.return||"q"===t||"Q"===t||n.ctrl&&"c"===t)&&e()}));const{stdout:m}=(0,s.t$)(),f=Math.max(1,null!==(t=null==m?void 0:m.columns)&&void 0!==t?t:80),v=Math.max(1,null!==(n=null==m?void 0:m.rows)&&void 0!==n?n:24),x=(0,i.useMemo)((()=>(0,d.vY)(o,p,h,g)),[o,p,h,g]),b=(0,i.useMemo)((()=>(0,d.W7)(o,u)),[o,u]);return(0,i.useEffect)((()=>((0,a.al)((()=>{})),()=>(0,a.al)(null))),[]),(0,r.jsx)(s.az,{width:f,height:v,flexDirection:"row",alignItems:"center",justifyContent:"center",children:(0,r.jsx)(s.az,{width:x,height:b,children:(0,r.jsx)(d.Hk,{frames:o,intervalMs:50,verticalScale:u,horizontalScale:p,offsetColumns:h,trimLeftColumns:g})})})};o()}catch(e){o(e)}}))},"./src/components/delete-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Y:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;const c=(0,l.Kr)(e.path);let d,u="pending";const p=null==t?void 0:t.result,h=null==p?void 0:p.case;switch(h){case void 0:u="pending";break;case"success":u="success";break;case"rejected":u="rejected";break;case"permissionDenied":u="error",d=String(null!==(o=null===(n=null==p?void 0:p.value)||void 0===n?void 0:n.clientVisibleError)&&void 0!==o?o:"")||"Permission denied";break;case"fileNotFound":case"notFile":case"fileBusy":case"error":u="error";break;default:u="pending"}const g=(0,i.F_)("deleteToolCall","success"===u)||("success"===u?"Deleted":"Deleting");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:g,primary:c,status:u}),"fileNotFound"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"File not found"})}),"notFile"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"Path is not a file"})}),"permissionDenied"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:d})}),"fileBusy"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"File is busy"})}),"error"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"Delete failed"})}),"rejected"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"yellow",children:"Request rejected"})}),"success"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"Completed"})})]})};o()}catch(e){o(e)}}))},"./src/components/edit-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{N:()=>h});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/abort-label.ts"),a=n("./src/utils/path-utils.ts"),c=n("./src/components/highlighted-code.tsx"),d=n("./src/components/inline-delta.tsx"),u=n("./src/components/tool-row-box.tsx"),p=e([s,c,d,u]);[s,c,d,u]=p.then?(await p)():p;const h=({tool:e,aborted:t,abortedReason:n})=>{var o,p,h;const g=e.args,m=e.result;if(!g||!g.path)return null;const f=(0,a.Kr)(g.path);if(!m||!m.result){const e=(0,i.F_)("editToolCall",!1)||"Editing";return(0,r.jsx)(u.Y,{flexDirection:"column",paddingRight:2,paddingLeft:1,children:(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{color:"foreground",children:[(0,r.jsx)(s.EY,{bold:!0,children:e})," ",f,t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:(0,l.P)(n)})]}):null]})})})}const v=m.result;let x,b,y="gray";if(t)x=(0,l.P)(n),y="gray";else switch(v.case){case"success":{const e=null!==(o=v.value.linesRemoved)&&void 0!==o?o:0,t=null!==(p=v.value.linesAdded)&&void 0!==p?p:0;x=(0,r.jsx)(d._,{removed:e,added:t}),b=v.value.diffString;break}case"fileNotFound":x="File not found",y="gray";break;case"readPermissionDenied":x="Permission denied reading",y="gray";break;case"writePermissionDenied":x=String(v.value.error)||"Permission denied writing",y="gray";break;case"rejected":x="Edit rejected",y="yellow";break;case"error":x=v.value.error||"Edit error",y="gray";break;default:v.case,x="Unknown edit result",y="gray"}return(0,r.jsxs)(u.Y,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,paddingX:1,children:[(0,r.jsx)(s.az,{flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:f})}),"string"==typeof x?(0,r.jsx)(s.EY,{color:y,wrap:"truncate",children:x}):x?(0,r.jsx)(s.az,{children:x}):null]}),b?(0,r.jsx)(c.d,{content:b,language:null!==(h=(0,i.Ak)(g.path))&&void 0!==h?h:"diff",isDiff:!0,showLineNumbers:!1,maxLines:12,truncationHint:i.hD?"ctrl+r to review":void 0,paddingX:1}):null]})};o()}catch(e){o(e)}}))},"./src/components/fetch-mcp-resource-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{J:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o,a;const c=null==e?void 0:e.server,d=null==e?void 0:e.uri,u=null==e?void 0:e.downloadPath;let p,h,g="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:g="pending";break;case"error":g="error",h=(null==t?void 0:t.result.value.error)||"Unknown error";break;case"success":{g="success";const e=null==t?void 0:t.result.value;(null==e?void 0:e.downloadPath)?p=`Downloaded to ${e.downloadPath}`:"text"===(null===(o=null==e?void 0:e.content)||void 0===o?void 0:o.case)?p=`${e.content.value.length} characters`:"blob"===(null===(a=null==e?void 0:e.content)||void 0===a?void 0:a.case)&&(p=`${e.content.value.length} bytes`);break}case"rejected":g="rejected",p=(null==t?void 0:t.result.value.reason)||"Rejected";break;case"notFound":g="error",h=`Resource not found: ${(null==t?void 0:t.result.value.uri)||d}`;break;default:g="pending"}const m=c?`(${c})`:"",f=u?`${d} → ${u}`:d;return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"FetchMcpResource",primary:m,status:g,note:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{color:"gray",children:f}),p&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:p})]})]})}),h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",h]})})]})};o()}catch(e){o(e)}}))},"./src/components/file-change-review.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Z:()=>M});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/chalk@5.4.1/node_modules/chalk/source/index.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/constants.ts"),c=n("./src/context/agent-state-context.tsx"),d=n("./src/context/theme-context.tsx"),u=n("./src/context/vim-mode-context.tsx"),p=n("./src/debug.ts"),h=n("./src/hooks/use-screen-size.ts"),g=n("./src/hooks/use-shared-animation.ts"),m=n("./src/hooks/use-text-input.ts"),f=n("./src/utils/characters.ts"),v=n("./src/utils/color-mixing.ts"),x=n("./src/utils/diff-colors.ts"),b=n("./src/utils/diff-sequences.ts"),y=n("./src/utils/inline-diff.ts"),w=n("./src/utils/input-keys.ts"),j=n("./src/utils/path-utils.ts"),k=n("./src/utils/prompt-utils.ts"),C=e([s,d,h,m]);[s,d,h,m]=C.then?(await C)():C;var S=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function E(e,t,n,o){if(!t||0===t.length)return e;const r=(0,v.PT)();let s;const i=null!=o&&o;if("truecolor"===r){const e=i?a.Qn:a.Yb,t="added"===n?e.addBgHex:e.removeBgHex,o="added"===n?e.addFgHex:e.removeFgHex,r=(0,v.E2)(t),l=(0,v.E2)(o);s=r&&l?`[48;2;${r.r};${r.g};${r.b}m[38;2;${l.r};${l.g};${l.b}m`:"[1m[4m"}else if("ansi256"===r){const e=i?a.f2:a.$n;s=`[48;5;${"added"===n?e.addBg:e.removeBg}m[38;5;${"added"===n?e.addFg:e.removeFg}m`}else s="[1m[4m";let l="",c=0;for(const n of t)n.start>c&&(l+=e.slice(c,n.start)),l+=`${s}${e.slice(n.start,n.end)}[0m`,c=n.end;return c<e.length&&(l+=e.slice(c)),l}const M=({fileChangeTracker:e,changes:t,onExit:o,onSubmitPrompt:C,initialSelectedIndex:M,wrapLines:$=!0,isGenerating:T})=>{var P,A,D;const{isGenerating:_}=(0,c.C9)(),R=null!=T?T:_,L=(0,l.useMemo)((()=>[/(^|\/)yarn\.lock$/,/(^|\/)pnpm-lock\.yaml$/,/(^|\/)package-lock\.json$/,/(^|\/)bun\.lockb$/,/(^|\/)Cargo\.lock$/,/(^|\/)Gemfile\.lock$/,/(^|\/)poetry\.lock$/,/(^|\/)Pipfile\.lock$/,/(^|\/)composer\.lock$/,/(^|\/)go\.sum$/,/(^|\/)Podfile\.lock$/,/(^|\/)gradle\.lockfile$/,/\.(png|jpe?g|gif|bmp|webp|ico|pdf|zip|tar|tgz|gz|rar|7z|jar|wasm|woff2?|ttf|otf)$/i,/\.min\.js$/]),[]),O=(0,l.useCallback)((e=>{var t,n,o,r;if(a.ye.has(e.path))return{gated:!0,reason:"Forced gated for testing"};const s=e.path;for(const e of L)if(e.test(s))return{gated:!0,reason:"Lock file diff hidden"};const i=null!==(n=null===(t=e.before)||void 0===t?void 0:t.length)&&void 0!==n?n:0,l=null!==(r=null===(o=e.after)||void 0===o?void 0:o.length)&&void 0!==r?r:0;return e.before&&-1!==e.before.indexOf("\0")||e.after&&-1!==e.after.indexOf("\0")?{gated:!0,reason:"Binary file diff hidden"}:i+l>a.Le||i>a.Le||l>a.Le?{gated:!0,reason:"File too large to render diff"}:{gated:!1,reason:""}}),[L]),Y=(0,l.useCallback)((e=>["",`   ${i.Ay.dim(`${e} — not shown`)}`,`   ${i.Ay.dim("You can still keep or undo this change.")}`,""]),[]),[F,z]=(0,l.useState)(null!=M?M:0),[N,U]=(0,l.useState)(""),[B,q]=(0,l.useState)(!1),[H,W]=(0,l.useState)(!1),[G,X]=(0,l.useState)(""),[K,Q]=(0,l.useState)({}),{stdout:J}=(0,s.t$)(),V=(0,h.l)(),{setReviewSelectedIndex:Z,pendingDecisions:ee,rejectPendingDecision:te}=(0,c.C9)(),{vimEnabled:ne,mode:oe,setMode:re}=(0,u.v)(),se=a.Eo||R||ee.length>0,ie=(0,g.e)(g.q,!se),[le,ae]=(0,l.useState)(null),ce=(0,l.useRef)(null),de=(0,l.useRef)([]),ue=(0,l.useCallback)(((e,t)=>{de.current.push({name:e,data:t,ts:Date.now()})}),[]),pe=(0,l.useRef)(null),he=(0,l.useCallback)((()=>S(void 0,void 0,void 0,(function*(){return pe.current||(pe.current=n.e(891).then(n.bind(n,"../../node_modules/.pnpm/shiki@3.21.0/node_modules/shiki/dist/index.mjs"))),(yield pe.current).codeToTokens}))),[]),ge=(0,l.useRef)(new Map);(0,l.useEffect)((()=>{const e=()=>{var e,t,n;const o=de.current.splice(0);if(0===o.length)return;const r={};for(const s of o){const o=null===(e=null==s?void 0:s.data)||void 0===e?void 0:e.durMs;if("number"==typeof o&&Number.isFinite(o)){const e=null!==(t=null==s?void 0:s.name)&&void 0!==t?t:"unknown";r[e]=(null!==(n=r[e])&&void 0!==n?n:0)+o}}Object.keys(r).length>0&&(0,p.debugLogJSON)("perf.summary",r)},t=setTimeout(e,800);return()=>{clearTimeout(t),e()}}),[]);const me=(0,l.useMemo)((()=>(0,v.PT)()),[]),fe=(0,l.useCallback)((e=>{if(!e)return"";const t=(0,v.E2)(e);return t?"truecolor"===me?`[38;2;${t.r};${t.g};${t.b}m`:"ansi256"===me?`[38;5;${(0,v.LQ)(t.r,t.g,t.b)}m`:"":""}),[me]),ve=(0,l.useCallback)((e=>{if(!e)return"";const t=(0,v.E2)(e);return t?"truecolor"===me?`[48;2;${t.r};${t.g};${t.b}m`:"ansi256"===me?`[48;5;${(0,v.LQ)(t.r,t.g,t.b)}m`:"":""}),[me]);(0,l.useEffect)((()=>{if(J){try{J.write("[?1049h[?7l[?1h=[?25l")}catch(e){}return()=>{try{J.write("[?1l>[?7h[?1049l")}catch(e){}}}}),[J]),(0,l.useEffect)((()=>{null!=M&&Z(M)}),[M,Z]),(0,l.useEffect)((()=>{0===t.length&&o()}),[t.length,o]);const xe=(0,l.useCallback)(((e,t)=>{const n=e.split(/\r?\n/),o=t.split(/\r?\n/),r=[];let s=0,i=0;const l=(e,t)=>n[e]===o[t],a=(e,t,l)=>{for(let e=s;e<t;e++)r.push({type:"removed",content:n[e],beforeLineNumber:e+1});for(let e=i;e<l;e++)r.push({type:"added",content:o[e],afterLineNumber:e+1});for(let o=0;o<e;o++)r.push({type:"common",content:n[t+o],beforeLineNumber:t+o+1,afterLineNumber:l+o+1});s=t+e,i=l+e};try{(0,b.A)(n.length,o.length,l,a)}catch(e){return o.map((e=>({type:"added",content:e})))}for(let e=s;e<n.length;e++)r.push({type:"removed",content:n[e],beforeLineNumber:e+1});for(let e=i;e<o.length;e++)r.push({type:"added",content:o[e],afterLineNumber:e+1});const c=(0,y.f)(r);for(const{removedIdx:e,addedIdx:t}of c){const n=r[e],o=r[t],{before:s,after:i}=(0,y.U)(n.content,o.content);n.inlineChanges=s,o.inlineChanges=i}return r}),[]),be=(0,l.useCallback)(((e,t)=>{const n=[];if(e.forEach(((e,t)=>{"common"!==e.type&&n.push(t)})),0===n.length)return[];const o=[];let r=null;n.forEach((e=>{r?e<=r.end+2*t+1?r.end=e:(o.push(r),r={start:e,end:e}):r={start:e,end:e}})),r&&o.push(r);const s=[];for(let n=0;n<o.length;n++){const r=o[n],i=Math.max(0,r.start-t),l=Math.min(e.length-1,r.end+t);for(let t=i;t<=l;t++)s.push(e[t]);if(n<o.length-1){const e=Math.max(0,o[n+1].start-t),r=Math.max(0,e-l-1);r>0&&s.push({type:"gap",content:"",gapCount:r})}}return s}),[]),ye=(0,l.useCallback)((e=>e.reduce(((e,t)=>"common"!==t.type?e+1:e),0)<=10&&e.length<=400?10:a.oy),[]),[we,je]=(0,l.useState)({}),ke=(0,l.useRef)(new Set),Ce=(0,l.useRef)(we);(0,l.useEffect)((()=>{Ce.current=we}),[we]);const Se=(0,l.useCallback)((e=>{var t;const n=Date.now(),o=O(e);if(o.gated){const t=Y(o.reason),r={lines:t,kinds:new Array(t.length).fill("other"),total:2,added:0,removed:0},s=Date.now()-n;return ue("computePrecomputed",{path:e.path,gated:!0,durMs:s}),r}if(void 0===e.after){const o=(null!==(t=e.before)&&void 0!==t?t:"").split(/\r?\n/),r={lines:["[deleted]"],kinds:["removed"],total:1,added:0,removed:Math.max(0,o.length)},s=Date.now()-n;return ue("computePrecomputed",{path:e.path,type:"deleted",durMs:s}),r}if(void 0===e.before){const t=e.after.split(/\r?\n/),o=t.map(((e,t)=>`${(t+1).toString().padStart(4," ")} ${a.rW}[2m [0m ${e}`)),r={lines:o,kinds:new Array(o.length).fill("added"),total:o.length,added:t.length,removed:0},s=Date.now()-n;return ue("computePrecomputed",{path:e.path,type:"created",lines:o.length,durMs:s}),r}let r=Pe.current.get(e.path);if(!r){const t=xe(e.before,e.after),n=ye(t);r={diffLines:t,filtered:be(t,n),contextLines:n},Pe.current.set(e.path,r)}const{diffLines:s,filtered:i}=r;let l=0,c=0;for(const e of s)"added"===e.type?l++:"removed"===e.type&&c++;const d=new Array(i.length),u=i.map(((e,t)=>{var n;const o=e.beforeLineNumber?e.beforeLineNumber.toString().padStart(4," "):"    ",r=e.afterLineNumber?e.afterLineNumber.toString().padStart(4," "):"    ";switch(e.type){case"added":{d[t]="added";const n=E(e.content,e.inlineChanges,"added",void 0);return`${o} ${r} ${a.rW}[32m+[39m ${n}[0m`}case"removed":{d[t]="removed";const n=E(e.content,e.inlineChanges,"removed",void 0);return`${o} ${r} ${a.rW}[31m-[39m ${n}[0m`}case"gap":return d[t]="other",`${o} ${r} ${a.rW}[2m⋯ ${null!==(n=e.gapCount)&&void 0!==n?n:0} lines truncated ⋯[0m`;default:return d[t]="other",`${o} ${r} ${a.rW}[2m [0m ${e.content}`}})),p={lines:u,kinds:d,total:u.length,added:l,removed:c},h=Date.now()-n;return ue("computePrecomputed",{path:e.path,type:"modified",total:u.length,added:l,removed:c,durMs:h}),p}),[O,Y,xe,ye,be,ue]),[Ee,Me]=(0,l.useState)({}),$e=(0,l.useRef)(new Set),Te=(0,l.useRef)([]),Ie=(0,l.useRef)([]),Pe=(0,l.useRef)(new Map),Ae=(0,l.useCallback)((e=>{const t=globalThis.requestIdleCallback;t?t(e):setTimeout(e,0)}),[]),De=(0,l.useCallback)((()=>new Promise((e=>{const t=globalThis.requestIdleCallback;t?t((()=>e())):setTimeout((()=>e()),0)}))),[]),_e=(0,l.useCallback)((e=>{const t=e.path;if(Ce.current[t]||ke.current.has(t))return;ke.current.add(t);const n=Date.now();Ae((()=>{const o=Se(e);if(je((e=>Object.assign(Object.assign({},e),{[t]:o}))),Ie.current.push(t),Ie.current.length>60){const e=Ie.current.shift();e&&je((t=>{const n=Object.assign({},t);return delete n[e],n}))}ke.current.delete(t);const r=Date.now()-n;ue("ensurePrecomputed",{path:t,durMs:r})}))}),[Se,ue,Ae]),[Re,Le]=(0,l.useState)(!1),Oe=(0,l.useCallback)(((e,t)=>{const n=(()=>{const n=t.lines.length,o=t.kinds.length;if(n!==o){let r=t.kinds.slice(0,n);return r.length<n&&(r=r.concat(new Array(n-r.length).fill("other"))),r=r.map((e=>"added"===e||"removed"===e||"other"===e?e:"other")),null===p.debugLogJSON||void 0===p.debugLogJSON||(0,p.debugLogJSON)("highlight.kinds_mismatch",{path:e,lines:n,kinds:o}),{lines:t.lines,kinds:r,total:t.total}}const r=t.kinds.map((e=>"added"===e||"removed"===e||"other"===e?e:"other"));return{lines:t.lines,kinds:r,total:t.total}})();Me((t=>{const o=Object.assign(Object.assign({},t),{[e]:n});for(Te.current.push(e);Te.current.length>60;){const e=Te.current.shift();e&&e in o&&delete o[e]}return o}))}),[]);(0,l.useEffect)((()=>{const e=setTimeout((()=>Le(!0)),250);return()=>clearTimeout(e)}),[]);const Ye=(0,d.pW)(),Fe=(0,l.useMemo)((()=>{if("truecolor"===me){const e=null!=Ye&&Ye?a.B0.addHex:a.Fv.addHex;return fe(e)}return"ansi256"===me?`[38;5;${null!=Ye&&Ye?a.Kj.add:a.yp.add}m`:a.ki}),[me,Ye,fe]),ze=(0,l.useMemo)((()=>{if("truecolor"===me){const e=null!=Ye&&Ye?a.B0.removeHex:a.Fv.removeHex;return fe(e)}return"ansi256"===me?`[38;5;${null!=Ye&&Ye?a.Kj.remove:a.yp.remove}m`:a.s0}),[me,Ye,fe]);(0,l.useEffect)((()=>{Me({}),$e.current.clear()}),[]);const Ne=(e,t)=>t.length>10?`Sent a new follow-up: ${t.slice(0,10)}...`:`Sent a new follow-up: ${t}`,Ue=(0,l.useMemo)((()=>{if("basic"===me)return"[42m";if("ansi256"===me)return`[48;5;${null!=Ye&&Ye?a.Xh.add:a.XM.add}m`;const{addHex:e}=(0,x.a)(Ye);return ve(e)}),[me,Ye,ve]),Be=(0,l.useMemo)((()=>{if("basic"===me)return"[41m";if("ansi256"===me)return`[48;5;${null!=Ye&&Ye?a.Xh.remove:a.XM.remove}m`;const{removeHex:e}=(0,x.a)(Ye);return ve(e)}),[me,Ye,ve]),qe=(0,l.useMemo)((()=>ie%2==0?"⬡":ee.length>0?i.Ay.yellow("⬢"):i.Ay.green("⬢")),[ie,ee.length]),He=(0,l.useCallback)((e=>(0,f.aJ)(e)),[]),We=(0,l.useMemo)((()=>[`${i.Ay.white.bold("↑/↓")} ${i.Ay.dim("scroll ·")} ${i.Ay.white.bold("←/→")} ${i.Ay.dim("switch file")}`,(t.length>1?"←/→ switch file, ":"")+"q exit","j/k scroll, Space/f page, b back","Ctrl-d/u half, Ctrl-e/y line, g/G top/bot","",i.Ay.dim("Press q, Esc, Ctrl-C, or Ctrl-R to close")]),[t.length]),[Ge,Xe]=(0,l.useState)(!1),[,Ke]=(0,l.useTransition)();(0,l.useEffect)((()=>{Xe(!1)}),[]);const[Qe,Je]=(0,l.useState)(!1);(0,l.useEffect)((()=>{Je(!1),Ke((()=>Je(!0)))}),[]);const Ve=t[F];(0,l.useEffect)((()=>{Ve&&_e(Ve)}),[Ve,_e]);const Ze=(0,l.useMemo)((()=>{var e,n,o,r,s;const l=[],c=[],d=[];for(let u=0;u<t.length;u++){const p=u!==F&&Ge,h=t[u],g=l.length,m=Math.max(10,null!==(n=null!==(e=null==V?void 0:V.width)&&void 0!==e?e:null==J?void 0:J.columns)&&void 0!==n?n:80),f=Math.max(0,m-2),v=(0,j.fw)(h.path),x=void 0===h.before,b=void 0===h.after,y=we[h.path]||{lines:[],total:0,added:0,removed:0},w="reject"===K[h.path]?` ${a.s0}✖${a.Sj}`:"accept"===K[h.path]?` ${a.ki}✔${a.Sj}`:"",k=w?" ":"",C=(()=>{const e=[];return y.added>0&&e.push(`${Fe}+${y.added}${a.Sj}`),y.removed>0&&e.push(`${ze}-${y.removed}${a.Sj}`),e.length?`[2m${e.join(" ")}[0m`:""})(),S=`${u+1}/${t.length} `,E=x?` ${a.ki}[new]${a.Sj}`:"",M=`[1m ${S}${"reject"===K[h.path]?"[9m[29m":""}${E}${w}${k} [0m`,$=He(C?`${M} ${C}`:M).length,T=Math.max(0,f-$),I=v.length<=T?v:(0,j.RZ)(v,Math.max(0,T)),P=`[1m ${S}${"reject"===K[h.path]?`[9m${I}[29m`:I}${E}${w}${k} [0m`,A=C?`${P} ${C}`:P;l.push(A),c.push("other"),l.push(""),c.push("other");let D=[],_=[];p||(D=(null===(o=Ee[h.path]||we[h.path])||void 0===o?void 0:o.lines)||[]),p||(_=(null===(r=Ee[h.path]||we[h.path])||void 0===r?void 0:r.kinds)||new Array(D.length).fill("other")),p||D&&0!==D.length||_e(h),"reject"===K[h.path]&&(D=D.map((e=>i.Ay.dim(e))));for(let e=0;e<D.length;e++)l.push(D[e]),c.push(null!==(s=_[e])&&void 0!==s?s:"other");l.push(""),c.push("other");const R=l.length;d.push({path:h.path,start:g,end:R,defaultKind:x?"added":b?"removed":"other",isNew:x}),u<t.length-1&&(l.push(""),c.push("other"))}return{lines:l,kinds:c,sections:d}}),[t,we,Ee,null==V?void 0:V.width,null==J?void 0:J.columns,K,Ge,F,_e,Fe,ze,He]),et=(0,l.useRef)(0),tt=Ze.lines.length,nt=B,ot=Math.max(10,null!==(A=null!==(P=null==V?void 0:V.width)&&void 0!==P?P:null==J?void 0:J.columns)&&void 0!==A?A:80),rt=Math.max(0,ot-2),st=!H&&0===G.length,it=i.Ay.grey("i to insert"),lt=He(it).length,at=1,ct=(st&&Math.max(0,rt-lt-at),H?G.length>0?`${G} `:`For ${(null==Ve?void 0:Ve.path)&&Ve.path.split("/").pop()||"this file"}${ne&&"normal"!==oe?"":" (Esc cancel)"}`:N.length>0?N:"Add a follow-up"),dt=2,ut=3,pt=Math.max(0,rt-dt-ut),ht=((e,t,n)=>{let o=0,r=0,s=!1,i=1;for(;o<e.length;){if(27===e.charCodeAt(o)&&"["===e[o+1]){let t=o+2;for(;t<e.length&&"m"!==e[t];)t++;o=Math.min(e.length,t+1);continue}o++,r++;const l=s?n:t;(l<=0||r>l)&&(i++,s=!0,r=1)}return Math.max(1,i)})(ct,st?Math.max(0,pt-lt-at+2):pt,pt),gt=Ve?ht+4+(le?1:0):0,mt=((null!==(D=null==V?void 0:V.height)&&void 0!==D?D:null==J?void 0:J.rows)||24)-gt-1,ft=Math.max(1,mt);(0,l.useEffect)((()=>{const e=Ve;if(!e)return;if(!Re)return;const t=e.path,n=(0,a.Ak)(t);if(O(e).gated)return;const o=`${t}|${Ye?"L":"D"}`;if(Ee[t]||$e.current.has(t)||ge.current.has(o))return;$e.current.add(t);const r=S(void 0,void 0,void 0,(function*(){try{const o=Date.now(),r=yield he();if(ue("import.shiki",{durMs:Date.now()-o}),void 0===e.after)return void Oe(t,{lines:["[deleted]"],kinds:["removed"],total:1});if(void 0===e.before){const o=(yield r(e.after,{lang:n,theme:Ye?"light-plus":"github-dark-default"})).tokens.map(((e,t)=>{const n=`[2m${(t+1).toString().padStart(4," ")}[0m`,o=e.map((e=>`${fe(e.color)}${ve(e.bgColor)}${e.content}[0m`)).join("");return`${n} ${a.rW}[2m [0m ${o}`})),s=new Array(o.length).fill("added");return void Oe(t,{lines:o,kinds:s,total:o.length})}const s=Ye?"light-plus":"github-dark-default";let i=Pe.current.get(t);if(!i){const n=xe(e.before,e.after),o=ye(n);i={diffLines:n,filtered:be(n,o),contextLines:o},Pe.current.set(t,i)}const{filtered:l}=i,c=[],d=[];for(const e of l)null!=e.afterLineNumber&&c.push(e.afterLineNumber-1),null!=e.beforeLineNumber&&d.push(e.beforeLineNumber-1);const u=[],p=[],h=new Set,g=new Set;for(const e of c)h.has(e)||(h.add(e),u.push(e));for(const e of d)g.has(e)||(g.add(e),p.push(e));const m=e.after.split(/\r?\n/),f=e.before.split(/\r?\n/),v=u.map((e=>{var t;return null!==(t=m[e])&&void 0!==t?t:""})).join("\n"),x=p.map((e=>{var t;return null!==(t=f[e])&&void 0!==t?t:""})).join("\n"),b=new Map,y=new Map;for(let e=0;e<u.length;e++)b.set(u[e]+1,e+1);for(let e=0;e<p.length;e++)y.set(p[e]+1,e+1);let w=null,j=null,k=0;if(yield De(),u.length>0){const e=Date.now();j=yield r(v,{lang:n,theme:s}),k+=Date.now()-e}if(yield De(),p.length>0){const e=Date.now();w=yield r(x,{lang:n,theme:s}),k+=Date.now()-e}ue("shiki.tokens",{path:t,durMs:k});const C=new Array(l.length),S=l.map(((e,t)=>{var n;const o=`[2m${e.beforeLineNumber?e.beforeLineNumber.toString().padStart(4," "):"    "}[0m`,r=`[2m${e.afterLineNumber?e.afterLineNumber.toString().padStart(4," "):"    "}[0m`;let s;if("common"===e.type&&e.afterLineNumber&&j){const t=b.get(e.afterLineNumber);t&&t-1>=0&&t-1<j.tokens.length&&(s=j.tokens[t-1])}else if("added"===e.type&&e.afterLineNumber&&j){const t=b.get(e.afterLineNumber);t&&t-1>=0&&t-1<j.tokens.length&&(s=j.tokens[t-1])}else if("removed"===e.type&&e.beforeLineNumber&&w){const t=y.get(e.beforeLineNumber);t&&t-1>=0&&t-1<w.tokens.length&&(s=w.tokens[t-1])}s||(s=[{content:e.content}]);const i=s.map((t=>{return`${fe(t.color)}${n=t,"added"===e.type||"removed"===e.type?"":ve(n.bgColor)}${t.content}[0m`;var n})).join("");switch(e.type){case"added":return C[t]="added",`${o} ${r} ${a.rW}${Fe}+${a.Sj} ${i}`;case"removed":return C[t]="removed",`${o} ${r} ${a.rW}${ze}-${a.Sj} ${i}`;case"gap":return C[t]="other",`${o} ${r} ${a.rW}[2m⋯ ${null!==(n=e.gapCount)&&void 0!==n?n:0} lines truncated ⋯[0m`;default:return C[t]=(e.type,"other"),`${o} ${r} ${a.rW}[2m [0m ${i}`}})),E=Date.now();Oe(t,{lines:S,kinds:C,total:S.length}),ue("shiki.cacheSet",{path:t,durMs:Date.now()-E,lines:S.length})}catch(e){$e.current.delete(t)}finally{$e.current.delete(t)}}));ge.current.set(o,r),r.finally((()=>ge.current.delete(o))).catch((()=>ge.current.delete(o)))}),[Ve,xe,Ye,he,Re,Ee[null==Ve?void 0:Ve.path],ve,ye,fe,be,O,De,ue,Oe,Fe,ze]);const vt=e=>{if(!Re)return;const t=e.path,n=`${t}|${Ye?"L":"D"}`;Ee[t]||$e.current.has(t)||ge.current.has(n)||O(e).gated||($e.current.add(t),S(void 0,void 0,void 0,(function*(){try{const n=Date.now(),o=yield he();ue("import.shiki.preload",{durMs:Date.now()-n});const r=(0,a.Ak)(t);if(void 0===e.after)return void Oe(t,{lines:["[deleted]"],kinds:["removed"],total:1});if(void 0===e.before){const n=Date.now(),s=yield o(e.after,{lang:r,theme:Ye?"light-plus":"github-dark-default"});ue("shiki.tokens.preload",{path:t,durMs:Date.now()-n});const i=s.tokens.map(((e,t)=>{const n=(t+1).toString().padStart(4," "),o=e.map((e=>`${fe(e.color)}${ve(e.bgColor)}${e.content}[0m`)).join("");return`${n} ${a.rW}[2m [0m ${o}`})),l=new Array(i.length).fill("added"),c=Date.now();return Oe(t,{lines:i,kinds:l,total:i.length}),void ue("shiki.cacheSet.preload",{path:t,durMs:Date.now()-c,lines:i.length})}const s=Ye?"light-plus":"github-dark-default";let i=Pe.current.get(t);if(!i){const n=xe(e.before,e.after),o=ye(n);i={diffLines:n,filtered:be(n,o),contextLines:o},Pe.current.set(t,i)}const{filtered:l}=i,c=[],d=[];for(const e of l)null!=e.afterLineNumber&&c.push(e.afterLineNumber-1),null!=e.beforeLineNumber&&d.push(e.beforeLineNumber-1);const u=[],p=[],h=new Set,g=new Set;for(const e of c)h.has(e)||(h.add(e),u.push(e));for(const e of d)g.has(e)||(g.add(e),p.push(e));const m=e.after.split(/\r?\n/),f=e.before.split(/\r?\n/),v=u.map((e=>{var t;return null!==(t=m[e])&&void 0!==t?t:""})).join("\n"),x=p.map((e=>{var t;return null!==(t=f[e])&&void 0!==t?t:""})).join("\n"),b=new Map,y=new Map;for(let e=0;e<u.length;e++)b.set(u[e]+1,e+1);for(let e=0;e<p.length;e++)y.set(p[e]+1,e+1);let w=null,j=null,k=0;if(yield De(),u.length>0){const e=Date.now();j=yield o(v,{lang:r,theme:s}),k+=Date.now()-e}if(yield De(),p.length>0){const e=Date.now();w=yield o(x,{lang:r,theme:s}),k+=Date.now()-e}ue("shiki.tokens.preload",{path:t,durMs:k});const C=new Array(l.length),S=l.map(((e,t)=>{var n;const o=e.beforeLineNumber?e.beforeLineNumber.toString().padStart(4," "):"    ",r=e.afterLineNumber?e.afterLineNumber.toString().padStart(4," "):"    ";let s;if("common"===e.type&&e.afterLineNumber&&j){const t=b.get(e.afterLineNumber);t&&t-1>=0&&t-1<j.tokens.length&&(s=j.tokens[t-1])}else if("added"===e.type&&e.afterLineNumber&&j){const t=b.get(e.afterLineNumber);t&&t-1>=0&&t-1<j.tokens.length&&(s=j.tokens[t-1])}else if("removed"===e.type&&e.beforeLineNumber&&w){const t=y.get(e.beforeLineNumber);t&&t-1>=0&&t-1<w.tokens.length&&(s=w.tokens[t-1])}s||(s=[{content:e.content}]);const i=s.map((t=>{return`${fe(t.color)}${n=t,"added"===e.type||"removed"===e.type?"":ve(n.bgColor)}${t.content}[0m`;var n})).join("");switch(e.type){case"added":return C[t]="added",`${o} ${r} ${a.rW}${a.ki}+${a.Sj} ${i}`;case"removed":return C[t]="removed",`${o} ${r} ${a.rW}${a.s0}-${a.Sj} ${i}`;case"gap":return C[t]="other",`${o} ${r} ${a.rW}[2m⋯ ${null!==(n=e.gapCount)&&void 0!==n?n:0} lines truncated ⋯[0m`;default:return C[t]="other",`${o} ${r} ${a.rW}[2m [0m ${i}`}})),E=Date.now();Oe(t,{lines:S,kinds:C,total:S.length}),ue("shiki.cacheSet.preload",{path:t,durMs:Date.now()-E,lines:S.length})}catch(e){}finally{$e.current.delete(t)}})))},{cursorOffset:xt}=(0,m.t)(G,X,{focus:H,showCursor:!0,highlightPastedText:!1,allowExplicitNewline:!1,onSubmit:e=>{const t=e.trim();if(t.length>0&&Ve){const e=Ze.sections[F],n=et.current;if(e){const o=Math.max(e.start,n),r=Math.min(e.end-1,n+ft-1),s=Math.max(1,o-e.start+1),l=Math.max(s,r-e.start+1),a=(0,k.C)(Ve.path,t,{startLine:s,endLine:l});if(ee.length>0)for(const e of ee)te(e.id,"auto-rejected before follow-up");C(a),ae(i.Ay.dim(Ne(0,t))),ce.current&&clearTimeout(ce.current),ce.current=setTimeout((()=>ae(null)),1800),X("")}else{const e=(0,k.C)(Ve.path,t);if(ee.length>0)for(const e of ee)te(e.id,"auto-rejected before follow-up");C(e),ae(i.Ay.dim(Ne(0,t))),ce.current&&clearTimeout(ce.current),ce.current=setTimeout((()=>ae(null)),1800),X("")}}},onCtrlC:()=>{X(""),W(!1)}});(0,l.useEffect)((()=>()=>{ce.current&&clearTimeout(ce.current)}),[]);const bt=e=>{const n=t.length;if(0===n)return;const o=(e%n+n)%n;z(o),Z(o)};(0,s.Ge)(((e,n)=>{if(Re||Le(!0),H)return n.ctrl&&("r"===e||"R"===e)||""===e?void o():(0,w.xv)(e,n)?void(ne?"normal"===oe&&(X(""),W(!1)):(X(""),W(!1))):n.return?void G.trim().length:n.ctrl&&"c"===e?(X(""),void W(!1)):void 0;if(n.ctrl&&("r"===e||"R"===e)||""===e)o();else{if("i"===e)return U(""),X(""),W(!0),q(!1),void re("insert");if(n.return)return U(""),X(""),W(!0),q(!1),void re("insert");if(B&&("q"===e||n.ctrl&&"c"===e||(0,w.xv)(e,n)||n.backspace))q(!1);else if((0,w.xv)(e,n)||"q"===e||n.ctrl&&"c"===e)o();else if("?"!==e)if(!n.tab&&"\t"!==e||H)if((!n.shift||!n.tab&&"\t"!==e)&&"[Z"!==e||H)if("h"!==e&&"H"!==e||H)if("l"!==e&&"L"!==e||H){if(n.leftArrow){const e=F-1<0?t.length-1:F-1;bt(e)}else if(n.rightArrow){const e=(F+1)%t.length;bt(e)}}else{const e=(F+1)%t.length;bt(e)}else{const e=F-1<0?t.length-1:F-1;bt(e)}else{const e=F-1<0?t.length-1:F-1;bt(e)}else{const e=(F+1)%t.length;bt(e)}else q((e=>!e))}}));const yt=(0,l.useRef)(null);return Ve?(0,r.jsx)(I,{ref:yt,contentHeight:ft,totalLines:tt,topHeaderLeft:`${t.length} ${1===t.length?"file":"files"} edited`,topHeaderRight:"esc when done",precomputedLines:Ze.lines,precomputedKinds:Ze.kinds,sections:Ze.sections.map((e=>({start:e.start,end:e.end,defaultKind:e.defaultKind}))),activeSectionIndex:F,commandBuffer:N,onCommandBufferChange:U,inputDisabled:!1,wrapLines:$,wrapDeferRest:!Qe,overlayTitle:nt?"Help":void 0,overlayLines:nt?We:null,onViewportTopChange:e=>{et.current=e;const n=e+ft;for(let o=0;o<Ze.sections.length;o++){const r=Ze.sections[o];if(r.start<n+5&&r.end>e-5){const e=t[o],n=null==e?void 0:e.path;n&&_e(e),!n||Ee[n]||$e.current.has(n)||ge.current.has(`${n}|${Ye?"L":"D"}`)||vt(e)}}},onUserScroll:()=>{},onJumpApplied:()=>{},bottomLines:(()=>{var e;const t=` ${i.Ay.white.bold("↑/↓")} ${i.Ay.dim("scroll ·")} ${i.Ay.white.bold("←/→")} ${i.Ay.dim("switch file")}`,n=` ${qe} ${i.Ay.bold("Generating")}${i.Ay.dim("  — ")} ${i.Ay.white.bold("↑/↓")} ${i.Ay.dim("scroll")}`,o=a.Eo||R,r=ee.length,s=r>0?` ${i.Ay.yellow(qe)} ${i.Ay.yellow.bold("Pending decision")} ${i.Ay.yellow(`(${r})`)}${i.Ay.dim("  — ")} ${i.Ay.yellow("ctrl-r to respond")}`:null,l=`${a.Sj}`+(s||(o?n:t))+`${a.Sj}`,c=(()=>{const e=ne&&"normal"===oe?i.Ay.bgGray:i.Ay.inverse;if(H){if(G.length>0){let t="",n=0,o=0,r=!1;const s=0,i=Math.max(0,rt-dt-ut-(st?lt+at:0)),l=Math.max(0,rt-dt-ut);for(const a of G){const c=r?l:i;t+=0===s&&xt===G.length&&c>0&&o===c-1&&n===G.length-1||n>=xt-s&&n<=xt?e(a):a,n++,o++,c>0&&o>=c&&(r=!0,o=0)}return xt===G.length&&(t+=e(" ")),t}{const t=`For ${(null==Ve?void 0:Ve.path)&&Ve.path.split("/").pop()||"this file"}${ne&&"normal"!==oe?"":" (Esc cancel)"}`,n=t.slice(0,1),o=t.slice(1);return`${e(n)}${i.Ay.grey(o)}`}}return N.length>0?N:i.Ay.grey("Add a follow-up")})(),d=Ye?i.Ay.black:i.Ay.white,u=i.Ay.gray,p=0===G.length?d.dim("→"):d("→"),h=`${c}`,g=He,m=rt,f=H?d:u,v=f(`┌${"─".repeat(m)}┐`),x=f("│"),b=[];le&&b.push(` ${le}`);const y=(()=>{const e=h,t=[];let n=0,o=0,r=0,s=!1;const i=()=>{const e=m-dt-ut;if(s)return Math.max(0,e);const t=st?Math.max(0,e-lt-at+2):e;return Math.max(0,t)};for(;n<e.length;){if(27===e.charCodeAt(n)&&"["===e[n+1]){let t=n+2;for(;t<e.length&&"m"!==e[t];)t++;n=Math.min(e.length,t+1);continue}n++,o++;const l=i();l<=0?(t.push(""),s=!0,o=0,r=n):o>l&&(t.push(e.slice(r,n-1)),s=!0,r=n-1,o=1)}return t.push(e.slice(r)),t})();b.push(v);for(let t=0;t<y.length;t++){const n=null!==(e=y[t])&&void 0!==e?e:"",o=g(n).length,r=0===t,s=` ${p} `;if(r&&st){const e=Math.max(0,at+dt-2),t=Math.max(0,m-ut-o-lt-e),r=`${x}${s}${n}[0m${" ".repeat(t)}${it}${" ".repeat(e)}${x}`;b.push(r)}else{const e=r?s:" ".repeat(ut),t=Math.max(0,m-ut-o-dt),i=`${x}${e}${n}[0m${" ".repeat(t+dt)}${x}`;b.push(i)}}const w=f(`└${"─".repeat(m)}┘`),j=l;return b.push(w,j),b})(),promptActive:H,rowBgAdd:Ue,rowBgRemove:Be}):null},$=e=>e>=768&&e<=879||e>=65056&&e<=65071||8205===e||e>=65038&&e<=65039,T=e=>e>=4352&&(e<=4447||9001===e||9002===e||e>=11904&&e<=42191||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65135||e>=65281&&e<=65376||e>=65504&&e<=65510),I=l.forwardRef((({contentHeight:e,totalLines:t,topHeaderLeft:n,topHeaderRight:o,precomputedLines:r,precomputedKinds:c,sections:d,activeSectionIndex:u,commandBuffer:p,onCommandBufferChange:g,inputDisabled:m,promptActive:f,bottomLines:v,wrapLines:x,wrapDeferRest:b,onViewportTopChange:y,onViewportStatsChange:j,onJumpApplied:k,onUserScroll:C,overlayTitle:S,overlayLines:E,rowBgAdd:M,rowBgRemove:I},P)=>{const[A,D]=(0,l.useState)(0),_=(0,l.useRef)(3),R=(0,l.useRef)(r),L=(0,l.useRef)(c),O=/\x1b\[[0-9;]*m/g,Y=l.useMemo((()=>{try{return/\p{Extended_Pictographic}/u}catch(e){return null}}),[]),F=(0,l.useCallback)((e=>{const t=e.replace(O,"");let n=0;for(const e of t){const t=e.codePointAt(0);$(t)||((null==Y?void 0:Y.test(e))?n+=2:n+=T(t)?2:1)}return n}),[Y]),z=(0,l.useCallback)((n=>{const o=x&&(W.lines.length||r.length)||t,s=Math.max(0,o-e);return Math.min(Math.max(0,n),s)}),[x,r.length,t,e]),N=(0,l.useCallback)((e=>{D((t=>{const n=z(t+e);return n!==t?(null==C||C(),n):t}))}),[z,C]);(0,l.useEffect)((()=>{const t=Math.max(1,Math.floor(e/10));_.current=t}),[e]),(0,s.Ge)(((n,o)=>{var r,s;if(m)return;if(f)return(0,w.Po)(n,o)?void N(-1):(0,w.u$)(n,o)?void N(1):o.ctrl&&"f"===n?void N(Math.max(1,e-1)):o.ctrl&&"b"===n?void N(-Math.max(1,e-1)):o.ctrl&&"d"===n?void N(Math.max(1,Math.floor(e/2))):o.ctrl&&"u"===n?void N(-Math.max(1,Math.floor(e/2))):void 0;if(/^[0-9]$/.test(n))return void g(p+n);if(o.backspace||o.delete)return void g(p.slice(0,-1));if(" "===n){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,e-1))}if("f"===n){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,e-1))}if("b"===n){const t=parseInt(p||"1",10);return g(""),void N(-t*Math.max(1,e-1))}if("j"===n){const e=parseInt(p||"1",10);return g(""),void N(e)}if("k"===n){const e=parseInt(p||"1",10);return g(""),void N(-e)}if((0,w.Po)(n,o)){const e=parseInt(p||"1",10);return g(""),void N(-e)}if((0,w.u$)(n,o)){const e=parseInt(p||"1",10);return g(""),void N(e)}if(o.ctrl&&"f"===n){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,e-1))}if(o.ctrl&&"b"===n){const t=parseInt(p||"1",10);return g(""),void N(-t*Math.max(1,e-1))}if(o.ctrl&&"d"===n){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,Math.floor(e/2)))}if(o.ctrl&&"u"===n){const t=parseInt(p||"1",10);return g(""),void N(-t*Math.max(1,Math.floor(e/2)))}if(o.ctrl&&"e"===n){const e=parseInt(p||"1",10);return g(""),void N(e)}if(o.ctrl&&"y"===n){const e=parseInt(p||"1",10);return g(""),void N(-e)}const i=o;if(i.pageDown){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,e-1))}if(i.pageUp){const t=parseInt(p||"1",10);return g(""),void N(-t*Math.max(1,e-1))}if("g"===n)return g(""),void D(0);if("G"!==n);else{const e=parseInt(p||"0",10);if(g(""),e>0)D(z(e-1));else{const e=x&&null!==(s=null===(r=R.current)||void 0===r?void 0:r.length)&&void 0!==s?s:t;D(z(e))}}}));const{stdout:U}=(0,s.t$)(),B=(0,h.l)(),q=(0,l.useRef)({start:[],count:[]}),H=(0,l.useRef)([]),W=(0,l.useMemo)((()=>{var e,t,n,o,s,i;if(!x){const e=r.length,t=new Array(e),n=new Array(e);for(let o=0;o<e;o++)t[o]=o,n[o]=1;return{lines:r,kinds:c,start:t,count:n}}const l=Math.max(1,(null!==(t=null!==(e=null==B?void 0:B.width)&&void 0!==e?e:null==U?void 0:U.columns)&&void 0!==t?t:80)-4),p=[],h=[],g=new Array(r.length),m=new Array(r.length);let f=0;const v=d[u]||{start:0,end:0},y=Math.max(1,a.rW.length),w=new RegExp(`^\\s*\\d{4}\\s\\d{4}\\s{${y}}(?:[+-]\\s)?`),j=new RegExp(`^\\s{5}\\d{4}\\s{${y}}`);for(let e=0;e<r.length;e++){const t=r[e];g[e]=f;let a=0;const d=e>=v.start&&e<v.end;if(b&&!d){p.push(t),h.push(null!==(n=c[e])&&void 0!==n?n:"other"),a++,f++,m[e]=a;continue}if(0===t.length){p.push(""),h.push(null!==(o=c[e])&&void 0!==o?o:"other"),a++,f++,m[e]=a;continue}const u=t.replace(/\x1b\[[0-9;]*m/g,"");let x=null;const y=u.match(w);if(y&&(x=y[0].length),null==x){const e=u.match(j);e&&(x=e[0].length)}null==x&&(x=12);const k=2,C=" ".repeat(x+k),S=x+k,E=Math.max(1,l-S);let M=0,I=0,P=0,A="",D="",_=!1,R=-1,L=-1;const O=(e,t)=>{const n=e.charCodeAt(t);if(Number.isNaN(n))return{advance:1,w:0,isSpace:!1};if(27===n&&91===e.charCodeAt(t+1)){let n=t+2;for(;n<e.length&&"m"!==e[n];)n++;return{advance:Math.min(e.length-t,n-t+1),w:0,isSpace:!1}}let o=1,r=n;if(n>=55296&&n<=56319&&t+1<e.length){const s=e.charCodeAt(t+1);s>=56320&&s<=57343&&(o=2,r=65536+(n-55296<<10)+(s-56320))}if(32===r)return{advance:o,w:1,isSpace:!0};if($(r)||8205===r)return{advance:o,w:0,isSpace:!1};if(T(r))return{advance:o,w:2,isSpace:!1};const s=e.slice(t,t+o);return(null==Y?void 0:Y.test(s))?{advance:o,w:2,isSpace:!1}:{advance:o,w:1,isSpace:!1}};for(;M<t.length;){if(""===t[M]&&"["===t[M+1]){let e=M+2;for(;e<t.length&&"m"!==t[e];)e++;if(e<t.length){const n=t.slice(M,e+1);"[0m"===n?A="":A+=n,M=e+1;continue}break}const{advance:n,w:o,isSpace:r}=O(t,M);M+=n,P+=o,r&&(R=M,L=P);const i=_?E:l;if(P>=i){const n=R>I?R:M,o=R>I?L:i;p.push(`${D+t.slice(I,n)}[0m`),h.push(null!==(s=c[e])&&void 0!==s?s:"other"),a++,I=n,P-=o,D=C+A,_=!0,R=-1,L=-1,f++}}I<t.length&&(p.push(`${D+t.slice(I)}[0m`),h.push(null!==(i=c[e])&&void 0!==i?i:"other"),a++,f++),m[e]=a}return{lines:p,kinds:h,start:g,count:m}}),[r,c,x,b,u,d,null==B?void 0:B.width,null==U?void 0:U.columns,Y]);(0,l.useEffect)((()=>{q.current={start:W.start,count:W.count}}),[W]),(0,l.useEffect)((()=>{var e;R.current=x?W.lines:r,L.current=x?null!==(e=W.kinds)&&void 0!==e?e:[]:c,D((e=>{const t=z(e);return t!==e?t:e}))}),[W,r,c,x,z]),(0,l.useEffect)((()=>{var e;const t=x?W.lines:r,n=new Array(t.length);for(let o=0;o<t.length;o++)n[o]=F(null!==(e=t[o])&&void 0!==e?e:"");H.current=n}),[W,r,x,F]);const G=(0,l.useMemo)((()=>{var e,t,n;const o=new Array(d.length),s=new Array(d.length);if(x)for(let r=0;r<d.length;r++){const i=d[r];o[r]=null!==(e=W.start[i.start])&&void 0!==e?e:0,s[r]=(null!==(t=W.start[i.end-1])&&void 0!==t?t:0)+(null!==(n=W.count[i.end-1])&&void 0!==n?n:1)}else for(let e=0;e<d.length;e++){const t=d[e];o[e]=t.start,s[e]=t.end}return{start:o,end:s,total:x?W.lines.length:r.length}}),[d,x,W,r]);(0,l.useEffect)((()=>{null==y||y(A);const t=G.total,n=G.start,o=G.end,r=A,s=Math.min(r+e,t),i=new Array(d.length).fill(0);for(let e=0;e<d.length;e++){const t=Math.max(0,Math.min(o[e],s)-Math.max(n[e],r));i[e]=t}let l=0,a=-1;const c=r+e/2;for(let e=0;e<i.length;e++){const t=i[e];if(t>a)a=t,l=e;else if(t===a&&t>0){const t=(n[e]+o[e])/2,r=(n[l]+o[l])/2;Math.abs(t-c)<Math.abs(r-c)&&(l=e)}}null==j||j({top:r,vis:i,dominantIndex:l})}),[A,y,j,d,e,G.end,G.start,G.total]);const X=(0,l.useCallback)((e=>{var t;if(e<0||e>=d.length)return;const n=null!==(t=G.start[e])&&void 0!==t?t:0;D(z(n)),null==k||k()}),[d,G,z,k]),K=(0,l.useCallback)((t=>{var n,o;if(t<0||t>=d.length)return;const r=null!==(n=G.start[t])&&void 0!==n?n:0,s=null!==(o=G.end[t])&&void 0!==o?o:r,i=Math.max(1,s-r),l=Math.max(0,Math.floor(r+i/2-e/2));D(z(l)),null==k||k()}),[d,G,e,z,k]);(0,l.useImperativeHandle)(P,(()=>({scrollToSectionStart:X,scrollToSectionCenter:K})),[X,K]);const Q=(0,l.useRef)(u);(0,l.useEffect)((()=>{var n;if(u<0||u>=d.length)return;if(Q.current===u)return;Q.current=u;const o=null!==(n=G.start[u])&&void 0!==n?n:0,s=x&&(W.lines.length||r.length)||t,i=Math.max(0,s-e),l=Math.min(Math.max(0,o),i);D(l),null==k||k()}),[u,e,k,r.length,W.lines.length,G.start,d.length,t,x]),(0,l.useEffect)((()=>{var t,s,l,a,c,u,p,h,g,m,f,v,b,y,w,j,k,C,S,E,$,T;if(!U)return;const P=x?W.lines:r,D=n?1:0;let _="";if(_+="[?2026h",1===D){const e=Math.max(10,null!==(s=null!==(t=null==B?void 0:B.width)&&void 0!==t?t:null==U?void 0:U.columns)&&void 0!==s?s:80),r=e=>e.replace(/\x1b\[[0-9;]*m/g,""),l=null!=n?n:"",a=null!=o?o:"",c=r(l).length,d=r(a).length,u=Math.max(0,e-2),p=Math.max(0,u-c-d),h=i.Ay.dim(l);let g;if(/^esc(\s|$)/.test(a)){const e=a.slice(3);g=i.Ay.white("esc")+i.Ay.dim(e)}else g=i.Ay.dim(a);_+=`[1;1H[2K ${h}${" ".repeat(p)}${g} [0m`}const R=A,O=Math.min(P.length,R+e),Y=P.slice(R,O),z=L.current.slice(R,O),N=Math.max(10,null!==(a=null!==(l=null==B?void 0:B.width)&&void 0!==l?l:null==U?void 0:U.columns)&&void 0!==a?a:80),X=/\x1b\[(?:49|48;5;\d{1,3}|48;2;\d{1,3};\d{1,3};\d{1,3})m/g,K=/\x1b\[[0-9;]*m/g;let Q=null,J=null;for(let e=0;e<d.length;e++){const t=null!==(c=G.start[e])&&void 0!==c?c:0,n=null!==(u=G.end[e])&&void 0!==u?u:0;if(R>=t&&R<n){const t=d[e].start,o=null!==(p=q.current.start[t])&&void 0!==p?p:t,r=null!==(h=q.current.count[t])&&void 0!==h?h:1;Math.max(1,r),R>o&&R<n&&(Q=null!==(g=P[o])&&void 0!==g?g:null,J=e);break}}let V=(()=>{var e,t,n;let o=0;for(;o<d.length&&!(R>=(null!==(e=G.start[o])&&void 0!==e?e:0)&&R<(null!==(t=G.end[o])&&void 0!==t?t:0))&&R>=(null!==(n=G.end[o])&&void 0!==n?n:0);)o++;return o})();for(let t=0;t<e;t++){const e=R+t,n=D+t+1;for(;V<d.length&&e>=(null!==(m=G.end[V])&&void 0!==m?m:0);)V++;const o=V<d.length&&e>=(null!==(f=G.start[V])&&void 0!==f?f:0)&&e<(null!==(v=G.end[V])&&void 0!==v?v:0)?V:-1;_+=`[${n};1H[2K`;const r=null!==(b=Y[t])&&void 0!==b?b:"";let s=null!==(y=z[t])&&void 0!==y?y:"other";if(0===t&&null!=Q&&o===J){_+=Q,_+=`[${n+1};1H[2K`;continue}if(-1===o){_+=r;continue}const i=d[o].start,l=null!==(w=q.current.start[i])&&void 0!==w?w:i,a=null!==(j=q.current.count[i])&&void 0!==j?j:1,c=l+Math.max(1,a);if(e>=l&&e<c)_+=null!==(C=null!==(k=P[l+Math.max(0,e-l)])&&void 0!==k?k:P[l])&&void 0!==C?C:r;else{if(("other"===s||null==s)&&o>=0){const e=d[o];"added"!==(null==e?void 0:e.defaultKind)&&"removed"!==(null==e?void 0:e.defaultKind)||(s=e.defaultKind)}if("added"!==s&&"removed"!==s||"added"===(null===(S=d[o])||void 0===S?void 0:S.defaultKind))_+=r;else{const t="added"===s?M:I;if(t){const n=null!==(E=H.current[e])&&void 0!==E?E:F(r),o=Math.max(0,N-n),s=r.replace(X,"").replace(K,(e=>`${e}${t}`));_+=`${t}${s}${" ".repeat(o)}[0m`}else _+=r}}}_+="[?2026l";try{null===($=U.cork)||void 0===$||$.call(U)}catch(e){}U.write(_);try{null===(T=U.uncork)||void 0===T||T.call(U)}catch(e){}}),[U,W,r,A,e,B,n,o,M,I,d,G,F,x]);const J=null!=E?E:[],V=J.length>0;return(0,l.useEffect)((()=>{var t,o,r,s,l,a,c,d;if(!U)return;const u=n?1:0;let p="[?2026h";if(V){const n=Math.max(10,null!==(o=null!==(t=null==B?void 0:B.width)&&void 0!==t?t:null==U?void 0:U.columns)&&void 0!==o?o:80),l=e=>e.replace(/\x1b\[[0-9;]*m/g,""),a=Math.max(24,Math.min(Math.floor(.6*n),80)),c=J.length+3,d=Math.max(1,Math.floor((e-c)/2)),h=Math.max(1,Math.floor((n-(a+2))/2)),g=S?` ${i.Ay.bold(S)} `:"",m=l(g).length,f=Math.max(0,a-m),v=`${i.Ay.yellow("┌")}${i.Ay.yellow(g)}${i.Ay.yellow("─".repeat(f))}${i.Ay.yellow("┐")}`,x=d+(J.length+3)-1;for(let e=d;e<=x;e++){h>1&&(p+=`[${u+e};${h-1}H `);const t=h+a+2;t<=(null!==(s=null!==(r=null==B?void 0:B.width)&&void 0!==r?r:null==U?void 0:U.columns)&&void 0!==s?s:80)&&(p+=`[${u+e};${t}H `)}p+=`[${u+d};${h}H${v}`,p+=`[${u+d+1};${h}H${i.Ay.yellow("│")} ${" ".repeat(Math.max(0,a-2))} ${i.Ay.yellow("│")}`;let b=d+2;for(const e of J){const t=l(e).length,n=Math.max(0,a-t-2);p+=`[${u+b};${h}H${i.Ay.yellow("│")} ${e}${" ".repeat(n)} ${i.Ay.yellow("│")}`,b++}p+=`[${u+b};${h}H${i.Ay.yellow("└")}${i.Ay.yellow("─").repeat(a)}${i.Ay.yellow("┘")}`}let h=u+e+1;for(const e of v)p+=`[${h};1H[2K${e}`,h++;const g=null!==(a=null!==(l=null==B?void 0:B.height)&&void 0!==l?l:U.rows)&&void 0!==a?a:24;for(let e=h;e<=g;e++)p+=`[${e};1H[2K`;p+=`[${Math.min(h,g)};1H`,p+="[?2026l";try{null===(c=U.cork)||void 0===c||c.call(U)}catch(e){}U.write(p);try{null===(d=U.uncork)||void 0===d||d.call(U)}catch(e){}}),[U,v,S,B,e,n,V,J]),null}));o()}catch(P){o(P)}}))},"./src/components/glob-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{P:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;if(!e.globPattern)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.EY,{color:"gray",children:"Failed to search - Missing required parameters: globPattern"})});const c=(null===(n=e.globPattern)||void 0===n?void 0:n.length)>40?`...${e.globPattern.slice(-37)}`:e.globPattern||"",d=(0,l.Kr)(e.targetDirectory||".");let u="pending";switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:u="pending";break;case"error":u="error";break;case"success":u="success";break;default:u="pending"}const p=(0,i.F_)("globToolCall","success"===u)||("success"===u?"Globbed":"Globbing");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:p,primary:`"${c}"`,status:u,note:`in ${d}`}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.error]})}):null})(),(()=>{const e=null==t?void 0:t.result;return"success"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Found ",e.value.totalFiles||0," file",1===(e.value.totalFiles||0)?"":"s",e.value.clientTruncated&&" (truncated)"]})}):null})()]})};o()}catch(e){o(e)}}))},"./src/components/grep-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{h:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n,o;if(!e||!e.pattern)return null;const c=(null===(n=e.pattern)||void 0===n?void 0:n.length)>40?`...${e.pattern.slice(-37)}`:e.pattern||"",d=(0,l.Kr)(e.path||"");let u="pending";switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:u="pending";break;case"error":u="error";break;case"success":u="success";break;default:u="pending"}const p=(0,i.F_)("grepToolCall","success"===u)||("success"===u?"Grepped":"Grepping");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:p,primary:`"${c}"`,status:u,note:`in ${d}`}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.error]})}):null})(),(()=>{const e=null==t?void 0:t.result;if("success"===(null==e?void 0:e.case)){let t=0;const n=Object.values(e.value.workspaceResults).at(0);if(!n)return null;const{result:o}=n;if(!o.value)return null;const l=o.value.ripgrepTruncated||o.value.clientTruncated;switch(o.case){case"count":t=o.value.totalMatches;break;case"files":t=o.value.totalFiles;break;case"content":t=o.value.totalMatchedLines}return(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Found ",t," matches ",l?" (truncated)":""]})})}return null})()]})};o()}catch(e){o(e)}}))},"./src/components/hexagon-loader.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/hooks/use-shared-animation.ts"),a=e([s]);s=(a.then?(await a)():a)[0];const c=(0,i.memo)((function({customInterval:e,activeColor:t="white",inactiveColor:n}){const o=null!=e?e:l.q,a=(0,l.e)(o),c=(0,i.useMemo)((()=>a%2==0?"⬡":"⬢"),[a]);return(0,r.jsx)(s.EY,{color:a%2==1?t:n,children:c})}));o()}catch(e){o(e)}}))},"./src/components/highlighted-code.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>ne,d:()=>te});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../utils/dist/index.js"),l=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/shellscript.mjs"),a=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/c.mjs"),c=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/cpp.mjs"),d=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/csharp.mjs"),u=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/css.mjs"),p=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/dart.mjs"),h=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/docker.mjs"),g=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/go.mjs"),m=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/html.mjs"),f=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/ini.mjs"),v=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/java.mjs"),x=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/javascript.mjs"),b=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/json.mjs"),y=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/jsx.mjs"),w=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/kotlin.mjs"),j=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/less.mjs"),k=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/lua.mjs"),C=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/make.mjs"),S=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/markdown.mjs"),E=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/php.mjs"),M=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/powershell.mjs"),$=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/python.mjs"),T=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/r.mjs"),I=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/ruby.mjs"),P=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/rust.mjs"),A=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/scss.mjs"),D=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/sql.mjs"),_=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/swift.mjs"),R=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/toml.mjs"),L=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/tsx.mjs"),O=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/typescript.mjs"),Y=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/xml.mjs"),F=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/yaml.mjs"),z=n("../../node_modules/.pnpm/@shikijs+themes@3.9.2/node_modules/@shikijs/themes/dist/github-dark-default.mjs"),N=n("../../node_modules/.pnpm/@shikijs+themes@3.9.2/node_modules/@shikijs/themes/dist/light-plus.mjs"),U=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),B=n("../../node_modules/.pnpm/@shikijs+core@3.21.0/node_modules/@shikijs/core/dist/index.mjs"),q=n("../../node_modules/.pnpm/@shikijs+engine-javascript@3.21.0/node_modules/@shikijs/engine-javascript/dist/engine-compile.mjs"),H=n("./src/constants.ts"),W=n("./src/context/theme-context.tsx"),G=n("./src/utils/color-mixing.ts"),X=n("./src/utils/diff-colors.ts"),K=n("./src/utils/inline-diff.ts"),Q=e([s,W]);[s,W]=Q.then?(await Q)():Q;const J=({lineNumber:e,showLineNumbers:t,lineNumberWidth:n,children:o,isDiff:i=!1,rowBgHex:l,rowBgAnsi256Index:a,signChar:c,signColor:d})=>{const u="number"==typeof a?`[48;5;${a}m`:void 0,p="number"==typeof a?"[49m":void 0,h=Boolean(l&&!u);return(0,r.jsxs)(s.az,{flexDirection:"row",backgroundColor:l,flexGrow:1,width:"100%",children:[t&&(0,r.jsx)(s.az,{width:n+2,borderRight:!i,borderLeft:!1,borderTop:!1,borderBottom:!1,borderColor:"gray",borderStyle:"single",justifyContent:"flex-end",flexShrink:0,children:(0,r.jsxs)(s.EY,{dimColor:!0,backgroundColor:h?l:void 0,children:[u?(0,r.jsx)(s.EY,{children:u}):null,e.toString().padStart(n," ")," ",p?(0,r.jsx)(s.EY,{children:p}):null]})}),c?(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsxs)(s.EY,{backgroundColor:h?l:void 0,children:[u?(0,r.jsx)(s.EY,{children:u}):null,(0,r.jsx)(s.EY,{color:d,bold:!0,children:c})," ",p?(0,r.jsx)(s.EY,{children:p}):null]})}):null,(0,r.jsx)(s.az,{paddingLeft:c?0:i?1:0,flexShrink:1,flexGrow:1,children:(0,r.jsxs)(s.EY,{backgroundColor:h?l:void 0,children:[u?(0,r.jsx)(s.EY,{children:u}):null,o,p?(0,r.jsx)(s.EY,{children:p}):null]})})]})},V=(0,B.gX)({themes:[z.A,N.A],langs:[x.A,O.A,L.A,y.A,b.A,m.A,u.A,A.A,j.A,l.A,l.A,F.A,R.A,S.A,g.A,P.A,v.A,a.A,c.A,d.A,E.A,I.A,_.A,w.A,D.A,T.A,p.A,k.A,h.A,C.A,Y.A,f.A,M.A,$.A],engine:(0,q.l)()}),Z=new i.qK({max:300}),ee=(e,t,n)=>`${t}::${e}::${n}`,te=e=>{var{content:t,language:n,showLineNumbers:o=!0,lineNumberWidth:i=4,startLineNumber:l=1,maxLines:a,isDiff:c=!1,truncationHint:d,tabSize:u=4,dimmed:p=!1}=e,h=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(e,["content","language","showLineNumbers","lineNumberWidth","startLineNumber","maxLines","isDiff","truncationHint","tabSize","dimmed"]);const g=(0,U.useMemo)((()=>t.split("\n")),[t]),m=(0,W.pW)(),f=(0,U.useMemo)((()=>(0,G.PT)()),[]),v=(0,U.useMemo)((()=>{const e=new Map;if(!c)return e;const t=g.map(((e,t)=>{const n=(0,X.U)(e);return{type:"added"===n?"added":"removed"===n?"removed":"common",content:e.slice(1),originalIndex:t}})),n=(0,K.f)(t);for(const{removedIdx:o,addedIdx:r}of n){const n=t[o],s=t[r],{before:i,after:l}=(0,K.U)(n.content,s.content);i.length>0&&e.set(n.originalIndex,i),l.length>0&&e.set(s.originalIndex,l)}return e}),[g,c]),x=(0,U.useMemo)((()=>{if("truecolor"===f)return m?H.Qn:H.Yb;const e=m?H.f2:H.$n;return{addBgHex:(0,G.LR)(e.addBg),addFgHex:(0,G.LR)(e.addFg),removeBgHex:(0,G.LR)(e.removeBg),removeFgHex:(0,G.LR)(e.removeFg)}}),[f,m]),b=(0,U.useMemo)((()=>m?"light-plus":"github-dark-default"),[m]),y=(0,U.useMemo)((()=>{if("truecolor"===f)return m?H.iP:H.eh;const e=m?H.Xh.add:H.XM.add,t=m?H.Xh.remove:H.XM.remove;return{addHex:(0,G.LR)(e),removeHex:(0,G.LR)(t)}}),[f,m]),w=(0,U.useMemo)((()=>"ansi256"!==f?null:m?{add:H.Xh.add,remove:H.Xh.remove}:{add:H.XM.add,remove:H.XM.remove}),[f,m]),j=(0,U.useMemo)((()=>{if("truecolor"===f)return m?H.B0:H.Fv;const e=m?H.Kj:H.yp;return{addHex:(0,G.LR)(e.add),removeHex:(0,G.LR)(e.remove)}}),[f,m]),k=(0,U.useMemo)((()=>{try{const e=ee(n,b,t),o=Z.get(e);if(o)return o;const r=V.codeToTokens(t,{lang:n,theme:b});return Z.set(e,r),r}catch(e){return null}}),[t,n,b]),C=(e,t)=>{for(const n of t)if(e>=n.start&&e<n.end)return!0;return!1},S=(e,t,n)=>{var o,i,l,a,c;if(!n||0===n.length)return(0,r.jsx)(r.Fragment,{children:e.map(((e,n)=>{var o,i,l,a;return(0,r.jsx)(s.EY,{color:null!==(o=e.color)&&void 0!==o?o:void 0,backgroundColor:"other"===t?e.bgColor:void 0,italic:Boolean(1&(null!==(i=e.fontStyle)&&void 0!==i?i:0)),bold:Boolean(2&(null!==(l=e.fontStyle)&&void 0!==l?l:0)),underline:Boolean(4&(null!==(a=e.fontStyle)&&void 0!==a?a:0)),children:e.content},`${e.content}-${n}`)}))});const d=[];let u=0;for(let p=0;p<e.length;p++){const h=e[p],g=null!==(o=h.content)&&void 0!==o?o:"";let m=0;for(;m<g.length;){const e=C(u+m,n);let o=m+1;for(;o<g.length&&C(u+o,n)===e;)o++;const f=g.slice(m,o),v=e?"added"===t?x.addBgHex:x.removeBgHex:"other"===t?h.bgColor:void 0,b=e?"added"===t?x.addFgHex:x.removeFgHex:null!==(i=h.color)&&void 0!==i?i:void 0;d.push((0,r.jsx)(s.EY,{color:b,backgroundColor:v,italic:Boolean(1&(null!==(l=h.fontStyle)&&void 0!==l?l:0)),bold:Boolean(2&(null!==(a=h.fontStyle)&&void 0!==a?a:0)),underline:Boolean(4&(null!==(c=h.fontStyle)&&void 0!==c?c:0)),children:f},`${p}-${u}-${m}`)),m=o}u+=g.length}return(0,r.jsx)(r.Fragment,{children:d})},E=k?k.tokens.length:g.length,M="number"==typeof a&&a>0?Math.min(E,a):E,$=E-M,T=(e,t,n)=>{if(n<=0)return t;const o=t=>{let o=0,r=0;for(let s=0;s<t&&s<e.length;s++)if("\t"===e[s]){const e=n-o%n,t=0===e?n:e;r+=t,o+=t}else r++,o++;return r};return t.map((e=>({start:o(e.start),end:o(e.end)})))},I=(e,t)=>{if(!e||u<=0)return{text:e,endColumn:t+Array.from(e).length};let n=t,o="";for(const t of Array.from(e))if("\t"===t){const e=u-n%u;o+=" ".repeat(0===e?u:e),n+=0===e?u:e}else o+=t,n+=1;return{text:o,endColumn:n}},P=e=>{let t=0;return e.map((e=>{var n;const o=null!==(n=e.content)&&void 0!==n?n:"",{text:r,endColumn:s}=I(o,t);return t=s,Object.assign(Object.assign({},e),{content:r})}))};return(0,r.jsxs)(s.az,Object.assign({flexDirection:"column",width:"100%"},h,{children:[Array.from({length:M},((e,t)=>{var n,a,d,h,m;const b=null!==(n=g[t])&&void 0!==n?n:"",C=c?(0,X.U)(b):"other",E="ansi256"===f?void 0:"added"===C?y.addHex:"removed"===C?y.removeHex:void 0,M="ansi256"===f?"added"===C?null==w?void 0:w.add:"removed"===C?null==w?void 0:w.remove:void 0:void 0,$=k?null!==(a=k.tokens[t])&&void 0!==a?a:[]:null;let A,D,_;if($)if("added"===C||"removed"===C){let e=1;const n=[];for(const t of $){if(e<=0){n.push(t);continue}const o=null!==(d=t.content)&&void 0!==d?d:"";o.length<=e?e-=o.length:(n.push(Object.assign(Object.assign({},t),{content:o.slice(e)})),e=0)}D=null!==(h=b[0])&&void 0!==h?h:"",_="added"===C?j.addHex:j.removeHex;const o=P(n),i=v.get(t),l=i&&i.length>0?T(b.slice(1),i,u):void 0;A=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:S(o,C,l)})}else{const e=P($);A=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:S(e,C)})}else if("added"===C||"removed"===C){D=null!==(m=b[0])&&void 0!==m?m:"";const e=b.slice(1);_="added"===C?j.addHex:j.removeHex;const n=v.get(t);if(n&&n.length>0){const t=I(e,0).text,o=T(e,n,u),i=[];let l=0;for(let e=0;e<o.length;e++){const n=o[e];n.start>l&&i.push((0,r.jsx)(s.EY,{children:t.slice(l,n.start)},`pre-${e}`));const a="added"===C?x.addBgHex:x.removeBgHex,c="added"===C?x.addFgHex:x.removeFgHex;i.push((0,r.jsx)(s.EY,{backgroundColor:a,color:c,children:t.slice(n.start,n.end)},`hl-${e}`)),l=n.end}l<t.length&&i.push((0,r.jsx)(s.EY,{children:t.slice(l)},"post")),A=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:i})}else A=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:(0,r.jsx)(s.EY,{children:I(e,0).text})})}else A=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:I(b,0).text});const R=l+t;return(0,r.jsx)(J,{lineNumber:R,showLineNumbers:o,lineNumberWidth:i,isDiff:c,rowBgHex:E,rowBgAnsi256Index:M,signChar:D,signColor:_,children:A},R)})),$>0&&(0,r.jsx)(J,{lineNumber:l+M,showLineNumbers:o,lineNumberWidth:i,isDiff:c,children:(0,r.jsxs)(s.EY,{dimColor:!0,children:["… truncated (",$," more line",1===$?"":"s",")",d?(0,r.jsxs)(s.EY,{children:[" · ",d]}):null]})})]}))},ne=te;o()}catch(e){o(e)}}))},"./src/components/index.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Hw:()=>S.H,mb:()=>h.m});var r=n("./src/components/approval-dialog.tsx"),s=n("./src/components/background-edit-tool-ui.tsx"),i=n("./src/components/background-shell-tool-ui.tsx"),l=n("./src/components/background-tool-group-ui.tsx"),a=n("./src/components/delete-tool-ui.tsx"),c=n("./src/components/grep-tool-ui.tsx"),d=n("./src/components/login-ui.tsx"),u=n("./src/components/merged-read-search-tool-ui.tsx"),p=n("./src/components/message-input.tsx"),h=n("./src/components/overflow-markdown.tsx"),g=n("./src/components/path-display.tsx"),m=n("./src/components/plan-execution-message.tsx"),f=n("./src/components/prompt-bar.tsx"),v=n("./src/components/read-todos-tool-ui.tsx"),x=n("./src/components/read-tool-ui.tsx"),b=n("./src/components/search-results-ui.tsx"),y=n("./src/components/sem-search-tool-ui.tsx"),w=n("./src/components/shell-tool-ui.tsx"),j=n("./src/components/task-tool-ui.tsx"),k=n("./src/components/todos-ui.tsx"),C=n("./src/components/update-todos-tool-ui.tsx"),S=n("./src/components/user-message-ui.tsx"),E=n("./src/components/web-search-tool-ui.tsx"),M=n("./src/components/write-shell-stdin-tool-ui.tsx"),$=e([r,s,i,l,a,c,d,u,p,h,g,m,f,v,x,b,y,w,j,k,C,S,E,M]);[r,s,i,l,a,c,d,u,p,h,g,m,f,v,x,b,y,w,j,k,C,S,E,M]=$.then?(await $)():$,o()}catch(e){o(e)}}))},"./src/components/inline-delta.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{_:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({added:e=0,removed:t=0})=>{const n=(null!=e?e:0)>0,o=(null!=t?t:0)>0;return n||o?(0,r.jsxs)(s.EY,{children:[n?(0,r.jsxs)(s.EY,{color:"green",children:["+",e]}):null,n&&o?(0,r.jsx)(s.EY,{children:" "}):null,o?(0,r.jsxs)(s.EY,{color:"red",children:["-",t]}):null]}):null};o()}catch(e){o(e)}}))},"./src/components/items-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{g:()=>w});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:fs"),i=n("node:os"),l=n("node:path"),a=n("../ink/build/index.js"),c=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),d=n("./src/hooks/use-screen-size.ts"),u=n("./src/utils/git.ts"),p=n("./src/utils/input-keys.ts"),h=n("./src/utils/rule-command-utils.ts"),g=n("./src/components/text-input.tsx"),m=e([a,d,g]);[a,d,g]=m.then?(await m)():m;const b={rules:"rule",commands:"command",skills:"skill"},y=10;function f(e){const t=[],n=(0,l.join)(e,".cursor","rules");if((0,s.existsSync)(n))try{const e=(0,s.readdirSync)(n).filter((e=>e.endsWith(".mdc")));for(const o of e)t.push({id:`project-${o}`,name:o.replace(".mdc",""),path:(0,l.join)(n,o),scope:"project"})}catch(e){}const o=(0,l.join)((0,i.homedir)(),".cursor","rules");if((0,s.existsSync)(o))try{const e=(0,s.readdirSync)(o).filter((e=>e.endsWith(".mdc")));for(const n of e)t.push({id:`user-${n}`,name:n.replace(".mdc",""),path:(0,l.join)(o,n),scope:"user"})}catch(e){}return t}function v(e){const t=[],n=(0,l.join)(e,".cursor","commands");if((0,s.existsSync)(n))try{const e=(0,s.readdirSync)(n).filter((e=>e.endsWith(".md")));for(const o of e)t.push({id:`project-${o}`,name:o.replace(".md",""),path:(0,l.join)(n,o),scope:"project"})}catch(e){}const o=(0,l.join)((0,i.homedir)(),".cursor","commands");if((0,s.existsSync)(o))try{const e=(0,s.readdirSync)(o).filter((e=>e.endsWith(".md")));for(const n of e)t.push({id:`user-${n}`,name:n.replace(".md",""),path:(0,l.join)(o,n),scope:"user"})}catch(e){}return t}function x(e){const t=[],n=(e,n)=>{if((0,s.existsSync)(e))try{const o=(0,s.readdirSync)(e,{withFileTypes:!0});for(const r of o)if(r.isDirectory()){const o=(0,l.join)(e,r.name,"SKILL.md");(0,s.existsSync)(o)&&t.push({id:`${n}-${r.name}`,name:r.name,path:o,scope:n})}}catch(e){}};return n((0,l.join)(e,".cursor","skills"),"project"),n((0,l.join)((0,i.homedir)(),".cursor","skills"),"user"),n((0,l.join)((0,i.homedir)(),".cursor","skills-cursor"),"builtin"),t}const w=({mode:e,onClose:t,onSelect:n,viewState:o,onViewStateChange:m,viewingItemPath:w,onViewingItemPathChange:j,editContent:k,onEditContentChange:C})=>{var S,E,M,$;const T=(0,c.useMemo)((()=>(0,u.ky)(process.cwd())||process.cwd()),[]),[I,P]=(0,c.useState)([]),[A,D]=(0,c.useState)(!1),[_,R]=(0,c.useState)(0),[L,O]=(0,c.useState)(0),Y=(0,c.useRef)(I),F=(0,c.useRef)(_),z=(0,c.useRef)(L);Y.current=I,F.current=_,z.current=L;const[N,U]=(0,c.useState)("list"),B=null!=o?o:N,q=(0,c.useCallback)((e=>{m?m(e):U(e)}),[m]),[H,W]=(0,c.useState)(""),[G,X]=(0,c.useState)(0),[K,Q]=(0,c.useState)(""),[J,V]=(0,c.useState)(""),[Z,ee]=(0,c.useState)(""),[te,ne]=(0,c.useState)(""),[oe,re]=(0,c.useState)(0),[se,ie]=(0,c.useState)(""),[le,ae]=(0,c.useState)(null),[ce,de]=(0,c.useState)(null),ue=null!=w?w:ce,pe=(0,c.useCallback)((e=>{j?j(e):de(e)}),[j]),he=(0,c.useMemo)((()=>{var e;return ue&&null!==(e=I.find((e=>e.path===ue)))&&void 0!==e?e:null}),[ue,I]),ge="builtin"!==(null==he?void 0:he.scope),[me,fe]=(0,c.useState)(0),[ve,xe]=(0,c.useState)(""),[be,ye]=(0,c.useState)(void 0),we=null!=k?k:be,je=(0,c.useCallback)((e=>{C?C(e):ye(e)}),[C]);(0,c.useEffect)((()=>{if(ue&&("view"===B||"edit"===B)&&!se)try{const e=(0,s.readFileSync)(ue,"utf-8");ie(e),"edit"===B&&void 0===we&&je(e)}catch(e){q("list"),pe(null)}}),[ue,B,q,pe,se,we,je]);const{stdout:ke}=(0,a.t$)(),Ce=(0,d.l)(),Se=null!==(E=null!==(S=null==Ce?void 0:Ce.height)&&void 0!==S?S:null==ke?void 0:ke.rows)&&void 0!==E?E:24,Ee=null!==($=null!==(M=null==Ce?void 0:Ce.width)&&void 0!==M?M:null==ke?void 0:ke.columns)&&void 0!==$?$:80,Me=Math.min(y,Math.max(5,Se-8)),$e=Math.max(20,Ee-14);(0,c.useEffect)((()=>{let t;switch(e){case"rules":t=f(T);break;case"commands":t=v(T);break;case"skills":t=x(T);break;default:throw new Error(`Unhandled mode: ${e}`)}const n={id:"create-new",name:`Create new ${b[e]}`,path:"",scope:"project",isCreateNew:!0};P([n,...t]),D(!0)}),[e,T]),(0,c.useEffect)((()=>{if(I.length>0){_>=I.length&&R(I.length-1);const e=Math.max(0,I.length-Me);L>e&&O(e)}}),[I.length,_,L,Me]);const Te=(0,c.useCallback)((()=>{q("create-description"),W("")}),[q]),Ie=(0,c.useCallback)((()=>{if(H.trim())switch(e){case"rules":q("create-rule-type"),X(0);break;case"commands":q("create-command-name"),V((0,h.Zc)(H)),ee("");break;case"skills":q("create-skill-name"),ne((0,h.uM)(H));break;default:throw new Error(`Unhandled mode: ${e}`)}}),[H,e,q]),Pe=(0,c.useCallback)((()=>{"glob"===h.TP[G].value?(q("create-glob-pattern"),Q("")):(q("create-scope"),re(0))}),[G,q]),Ae=(0,c.useCallback)((()=>{K.trim()&&(q("create-scope"),re(0))}),[K,q]),De=(0,c.useCallback)((e=>{V(e),(0,h.Ux)(e)?ee((0,h.nQ)()):ee("")}),[]),_e=(0,c.useCallback)((()=>{const e=(0,h._M)(J);e&&(V(e),ee(""),q("create-scope"),re(0))}),[J,q]),Re=(0,c.useCallback)((e=>{ne(e)}),[]),Le=(0,c.useCallback)((()=>{const e=(0,h.mc)(te);e&&(ne(e),q("create-scope"),re(0))}),[te,q]),Oe=(0,c.useCallback)((()=>{let t,n,o,r;const a="user"===(0,h.Zs)(e)[oe].value?(0,l.join)((0,i.homedir)(),".cursor"):(0,l.join)(T,".cursor");switch(e){case"rules":{t=(0,h.Fv)(H),t||(t=`new-rule-${Date.now()}`),n=(0,l.join)(a,"rules"),o=(0,l.join)(n,`${t}.mdc`);const e=h.TP[G].value;r=(0,h.jh)({description:H,name:t,ruleType:e,globPattern:K||void 0});break}case"commands":t=J||`new-command-${Date.now()}`,n=(0,l.join)(a,"commands"),o=(0,l.join)(n,`${t}.md`),r=(0,h.kt)({name:t,description:H});break;case"skills":t=te||`new-skill-${Date.now()}`,n=(0,l.join)(a,"skills",t),o=(0,l.join)(n,"SKILL.md"),r=(0,h.K8)({name:t,description:H});break;default:throw new Error(`Unhandled mode: ${e}`)}try{if((0,s.existsSync)(n)||(0,s.mkdirSync)(n,{recursive:!0}),(0,s.existsSync)(o))return xe(`Already exists: ${o}`),void q("success");let t;switch((0,s.writeFileSync)(o,r,"utf-8"),e){case"rules":t=f(T);break;case"commands":t=v(T);break;case"skills":t=x(T);break;default:throw new Error(`Unhandled mode: ${e}`)}const i={id:"create-new",name:`Create new ${b[e]}`,path:"",scope:"project",isCreateNew:!0};P([i,...t]),ie(r),pe(o),je(r),fe(0),q("edit")}catch(e){xe(`Error: ${e instanceof Error?e.message:String(e)}`),q("success")}}),[H,oe,e,T,G,K,J,te,q,pe,je]),Ye=(0,c.useCallback)((e=>{if(n)n(e);else try{const t=(0,s.readFileSync)(e.path,"utf-8");ie(t),pe(e.path),fe(0),q("view")}catch(t){xe(`Error reading file: ${e.path}`),q("success")}}),[n,q,pe]),Fe=(0,c.useCallback)((()=>{(null==he?void 0:he.path)?(je(se),q("edit")):(xe("No file selected to edit"),q("success"))}),[he,se,q,je]),ze=(0,c.useCallback)((()=>{if((null==he?void 0:he.path)&&void 0!==we)try{(0,s.writeFileSync)(he.path,we,"utf-8"),ie(we),xe(`Saved: ${he.path}`),q("success")}catch(e){xe(`Error saving: ${e instanceof Error?e.message:String(e)}`),q("success")}}),[he,we,q]),Ne=(0,c.useCallback)((()=>{q("view")}),[q]),Ue=(0,c.useCallback)((()=>{if(le)try{if("skills"===e){const e=(0,l.dirname)(le.path);(0,s.rmSync)(e,{recursive:!0,force:!0})}else(0,s.unlinkSync)(le.path);let t;switch(xe(`Deleted: ${le.name}`),ae(null),q("success"),e){case"rules":t=f(T);break;case"commands":t=v(T);break;case"skills":t=x(T);break;default:throw new Error(`Unhandled mode: ${e}`)}const n={id:"create-new",name:`Create new ${b[e]}`,path:"",scope:"project",isCreateNew:!0};P([n,...t]),_>=t.length+1&&R(Math.max(0,t.length))}catch(e){xe(`Error deleting: ${e instanceof Error?e.message:String(e)}`),ae(null),q("success")}}),[le,e,T,q,_]),Be=(0,c.useCallback)((()=>{ae(null),q(ue?"view":"list")}),[q,ue]),qe=(0,c.useCallback)((e=>e.includes("[M")||e.includes("[<")||e.includes("[?")||/\x1b\[<\d+;\d+;\d+[Mm]/.test(e)||/\x1b\[M[\x20-\xff]{3}/.test(e)),[]),He=Math.max(5,Se-10),We=se.split("\n"),Ge=Math.max(0,We.length-He),Xe=(0,c.useCallback)(((o,r)=>{if(qe(o))return;if(r.ctrl&&"c"===o)return void t();if((0,p.xv)(o,r)||"q"===o||"Q"===o)return void t();const i=Y.current,l=z.current,a=i.length;if((0,p.Po)(o,r)||"k"===o||"K"===o)R((e=>{const t=e>0?e-1:a-1;if(0===e&&t===a-1){const e=Math.max(0,a-Me);O(e)}else t<l&&O(t);return t}));else if((0,p.u$)(o,r)||"j"===o||"J"===o)R((e=>{const t=e<a-1?e+1:0;return e===a-1&&0===t?O(0):t>=l+Me&&O(t-Me+1),t}));else if(!r.ctrl||"u"!==o&&"b"!==o)if(!r.ctrl||"d"!==o&&"f"!==o){if("g"===o)return R(0),void O(0);if("G"!==o)if("d"===o||"D"===o||r.delete||r.backspace){const e=F.current,t=i[a>0?Math.min(Math.max(0,e),a-1):0];t&&!t.isCreateNew&&"builtin"!==t.scope&&(ae(t),q("delete-confirm"))}else if("v"!==o&&"V"!==o||"skills"!==e){if(r.return){const t=F.current,o=i[a>0?Math.min(Math.max(0,t),a-1):0];(null==o?void 0:o.isCreateNew)?Te():o&&("skills"===e&&n&&!o.isCreateNew?n(o):Ye(o))}}else{const e=Y.current,t=F.current,n=e[e.length>0?Math.min(Math.max(0,t),e.length-1):0];if(null==n?void 0:n.isCreateNew)Te();else if(n)try{const e=(0,s.readFileSync)(n.path,"utf-8");ie(e),pe(n.path),null==j||j(n.path),q("view"),null==m||m("view")}catch(e){}}else{R(a-1);const e=Math.max(0,a-Me);O(e)}}else R((e=>{const t=Math.min(a-1,e+Me),n=Math.max(0,a-Me);return O((e=>Math.min(n,Math.max(t-Me+1,e+Me)))),t}));else R((e=>{const t=Math.max(0,e-Me);return O((e=>Math.max(0,Math.min(t,e-Me)))),t}))}),[qe,t,Me,q,Te,Ye,e,n,m,j,pe]);(0,a.Ge)(Xe,{isActive:"list"===B});const Ke=(0,c.useCallback)(((e,n)=>{qe(e)||(n.ctrl&&"c"===e?t():(0,p.xv)(e,n)&&q("list"))}),[qe,t,q]);(0,a.Ge)(Ke,{isActive:"create-description"===B});const Qe=(0,c.useCallback)(((n,o)=>{if(qe(n))return;if(o.ctrl&&"c"===n)return void t();const r=(0,h.Zs)(e).length;if((0,p.Po)(n,o)||"k"===n||"K"===n)re((e=>e>0?e-1:r-1));else if((0,p.u$)(n,o)||"j"===n||"J"===n)re((e=>e<r-1?e+1:0));else if(o.return)Oe();else if((0,p.xv)(n,o))if("rules"===e){const e=h.TP[G].value;q("glob"===e?"create-glob-pattern":"create-rule-type")}else q("skills"===e?"create-skill-name":"create-command-name")}),[qe,t,e,G,q,Oe]);(0,a.Ge)(Qe,{isActive:"create-scope"===B});const Je=(0,c.useCallback)(((e,n)=>{qe(e)||(n.ctrl&&"c"===e?t():(0,p.Po)(e,n)||"k"===e||"K"===e?X((e=>e>0?e-1:h.TP.length-1)):(0,p.u$)(e,n)||"j"===e||"J"===e?X((e=>e<h.TP.length-1?e+1:0)):n.return?Pe():(0,p.xv)(e,n)&&q("create-description"))}),[qe,t,q,Pe]);(0,a.Ge)(Je,{isActive:"create-rule-type"===B});const Ve=(0,c.useCallback)(((e,n)=>{qe(e)||(n.ctrl&&"c"===e?t():(0,p.xv)(e,n)&&q("create-rule-type"))}),[qe,t,q]);(0,a.Ge)(Ve,{isActive:"create-glob-pattern"===B});const Ze=(0,c.useCallback)(((e,n)=>{qe(e)||(n.ctrl&&"c"===e?t():(0,p.xv)(e,n)&&q("create-description"))}),[qe,t,q]);(0,a.Ge)(Ze,{isActive:"create-command-name"===B});const et=(0,c.useCallback)(((e,n)=>{qe(e)||(n.ctrl&&"c"===e?t():(0,p.xv)(e,n)&&q("create-description"))}),[qe,t,q]);(0,a.Ge)(et,{isActive:"create-skill-name"===B});const tt=(0,c.useCallback)(((e,n)=>{if(!qe(e)){if(!n.ctrl||"c"!==e)return(0,p.xv)(e,n)||"q"===e||"Q"===e?(q("list"),void pe(null)):void((0,p.Po)(e,n)||"k"===e||"K"===e?fe((e=>Math.max(0,e-1))):(0,p.u$)(e,n)||"j"===e||"J"===e?fe((e=>Math.min(Ge,e+1))):!n.ctrl||"u"!==e&&"b"!==e?!n.ctrl||"d"!==e&&"f"!==e?"g"!==e?"G"!==e?"e"!==e&&"E"!==e?n.return||"\r"===e||"\n"===e?ge&&Fe():("d"===e||"D"===e||n.delete||n.backspace)&&he&&ge&&(ae(he),q("delete-confirm")):ge&&Fe():fe(Ge):fe(0):fe((e=>Math.min(Ge,e+He))):fe((e=>Math.max(0,e-He))));t()}}),[qe,t,q,pe,Ge,He,ge,Fe,he]);(0,a.Ge)(tt,{isActive:"view"===B});const nt=(0,c.useCallback)(((e,n)=>{qe(e)||(n.ctrl&&"c"===e?t():!n.ctrl||"s"!==e&&"S"!==e?(0,p.xv)(e,n)&&Ne():ze())}),[qe,t,ze,Ne]);(0,a.Ge)(nt,{isActive:"edit"===B});const ot=(0,c.useCallback)(((e,n)=>{qe(e)||(n.ctrl&&"c"===e||n.return||(0,p.xv)(e,n))&&t()}),[qe,t]);(0,a.Ge)(ot,{isActive:"success"===B});const rt=(0,c.useCallback)(((e,n)=>{qe(e)||(n.ctrl&&"c"===e?t():"y"!==e&&"Y"!==e?("n"===e||"N"===e||(0,p.xv)(e,n))&&Be():Ue())}),[qe,t,Ue,Be]);(0,a.Ge)(rt,{isActive:"delete-confirm"===B});const st=(0,c.useCallback)((e=>e.length<=$e?e:`${e.slice(0,$e-1)}…`),[$e]),it={rules:"Rules",commands:"Commands",skills:"Skills"}[e],{visibleItems:lt,adjustedScrollOffset:at,clampedActiveIndex:ct}=(0,c.useMemo)((()=>{if(0===I.length)return{visibleItems:[],adjustedScrollOffset:0,clampedActiveIndex:0};const e=Math.min(Math.max(0,_),I.length-1),t=Math.max(0,I.length-Me),n=Math.min(Math.max(0,L),t);return{visibleItems:I.slice(n,n+Me),adjustedScrollOffset:n,clampedActiveIndex:e}}),[I,Me,_,L]);if("delete-confirm"===B&&le)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"red",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{bold:!0,color:"red",children:["Delete ",b[e],"?"]})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{children:["Are you sure you want to delete"," ",(0,r.jsx)(a.EY,{bold:!0,color:"yellow",children:le.name}),"?"]})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{dimColor:!0,children:le.path})}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"y to confirm • n or Esc to cancel"})})]});if("success"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.EY,{color:ve.startsWith("Error")?"red":"green",children:ve}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to close"})})]});if("create-description"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{bold:!0,color:"cyan",children:["Create New"," ","rules"===e?"Rule":"skills"===e?"Skill":"Command"]})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{children:["Describe what this"," ","rules"===e?"rule":"skills"===e?"skill":"command"," ","should do:"]})}),(0,r.jsxs)(a.az,{children:[(0,r.jsx)(a.EY,{color:"gray",children:"› "}),(0,r.jsx)(g.A,{value:H,onChange:W,onSubmit:Ie,placeholder:"rules"===e?"e.g., Always use TypeScript strict mode":"e.g., Run tests for current file",focus:!0})]}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to continue • Esc to cancel"})})]});if("create-rule-type"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:"Create New Rule"})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{children:"When should this rule be applied?"})}),h.TP.map(((e,t)=>{const n=t===G;return(0,r.jsxs)(a.az,{paddingLeft:1,flexDirection:"column",children:[(0,r.jsx)(a.az,{children:(0,r.jsxs)(a.EY,{color:n?"cyan":"gray",bold:n,children:[n?"→ ":"  ",e.label]})}),(0,r.jsx)(a.az,{paddingLeft:4,children:(0,r.jsx)(a.EY,{dimColor:!0,children:e.description})})]},e.value)})),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"↑/↓ to select • Enter to confirm • Esc to cancel"})})]});if("create-glob-pattern"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:"Create New Rule"})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{children:"Enter the file pattern (glob) this rule should apply to:"})}),(0,r.jsxs)(a.az,{children:[(0,r.jsx)(a.EY,{color:"gray",children:"› "}),(0,r.jsx)(g.A,{value:K,onChange:Q,onSubmit:Ae,placeholder:"e.g., **/*.tsx, src/**/*.ts",focus:!0})]}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to continue • Esc to cancel"})})]});if("create-command-name"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:"Create New Command"})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{children:"Enter the command name (how you'll invoke it with /):"})}),(0,r.jsxs)(a.az,{children:[(0,r.jsx)(a.EY,{color:"cyan",children:"/"}),(0,r.jsx)(g.A,{value:J,onChange:De,onSubmit:_e,placeholder:"e.g., run-tests",focus:!0})]}),Z&&(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsxs)(a.EY,{color:"yellow",children:["⚠ ",Z]})}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to continue • Esc to cancel"})})]});if("create-skill-name"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:"Create New Skill"})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{children:"Enter the skill name (folder name for the skill):"})}),(0,r.jsx)(a.az,{children:(0,r.jsx)(g.A,{value:te,onChange:Re,onSubmit:Le,placeholder:"e.g., deploy-to-prod",focus:!0})}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to continue • Esc to cancel"})})]});if("create-scope"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{bold:!0,color:"cyan",children:["Create New"," ","rules"===e?"Rule":"skills"===e?"Skill":"Command"]})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{children:["Is this"," ","rules"===e?"rule":"skills"===e?"skill":"command"," ","just for you or for the project?"]})}),(0,h.Zs)(e).map(((e,t)=>{const n=t===oe;return(0,r.jsxs)(a.az,{paddingLeft:1,children:[(0,r.jsxs)(a.EY,{color:n?"cyan":"gray",bold:n,children:[n?"→ ":"  ",e.label]}),(0,r.jsxs)(a.EY,{dimColor:!0,children:[" (",e.hint,")"]})]},e.value)})),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"↑/↓ to select • Enter to confirm • Esc to cancel"})})]});if("view"===B&&he){const e=We.slice(me,me+He),t=me>0,n=me<Ge;return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(a.az,{marginBottom:1,children:[(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:he.name}),(0,r.jsxs)(a.EY,{dimColor:!0,children:[" ","(",he.scope,ge?"":" • read-only",")"]})]}),t&&(0,r.jsx)(a.az,{children:(0,r.jsx)(a.EY,{dimColor:!0,children:"↑ more above"})}),(0,r.jsx)(a.az,{flexDirection:"column",borderStyle:"single",borderColor:"gray",paddingX:1,children:e.map(((e,t)=>(0,r.jsxs)(a.az,{children:[(0,r.jsx)(a.EY,{dimColor:!0,children:String(me+t+1).padStart(3," ")}),(0,r.jsx)(a.EY,{dimColor:!0,children:" │ "}),(0,r.jsx)(a.EY,{children:st(e)})]},`line-${me+t}`)))}),n&&(0,r.jsx)(a.az,{children:(0,r.jsx)(a.EY,{dimColor:!0,children:"↓ more below"})}),(0,r.jsxs)(a.az,{marginTop:1,flexDirection:"column",children:[(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:ge?"↑/↓ to scroll • Enter to edit • d to delete • Esc to cancel":"↑/↓ to scroll • Esc to go back (read-only)"}),(0,r.jsx)(a.EY,{dimColor:!0,children:st(he.path)})]})]})}if("edit"===B&&he)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"green",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(a.az,{marginBottom:1,children:[(0,r.jsxs)(a.EY,{bold:!0,color:"green",children:["Editing: ",he.name]}),(0,r.jsxs)(a.EY,{dimColor:!0,children:[" (",he.scope,")"]})]}),(0,r.jsx)(a.az,{flexDirection:"column",borderStyle:"single",borderColor:"gray",paddingX:1,children:(0,r.jsx)(g.A,{value:null!=we?we:"",onChange:je,focus:!0,allowExplicitNewline:!0})}),(0,r.jsxs)(a.az,{marginTop:1,flexDirection:"column",children:[(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Ctrl+S to save • Esc to cancel"}),(0,r.jsx)(a.EY,{dimColor:!0,children:he.path})]})]});if(("view"===B||"edit"===B)&&ue&&!A)return(0,r.jsx)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,children:(0,r.jsx)(a.EY,{dimColor:!0,children:"Loading..."})});const dt=I.filter((e=>!e.isCreateNew)).length,ut=b[e],pt=`${dt} ${1===dt?ut:`${ut}s`}`;return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(a.az,{marginBottom:1,children:[(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:it}),(0,r.jsxs)(a.EY,{dimColor:!0,children:[" (",pt,")"]})]}),at>0&&(0,r.jsx)(a.az,{paddingLeft:2,children:(0,r.jsx)(a.EY,{dimColor:!0,children:"↑ more above"})}),lt.map(((e,t)=>{const n=at+t===ct,o=e.isCreateNew?"":` (${e.scope})`;return(0,r.jsx)(a.az,{paddingLeft:1,children:(0,r.jsxs)(a.EY,{color:n?"cyan":"white",bold:n,children:[n?"→ ":"  ",e.isCreateNew?(0,r.jsxs)(a.EY,{color:n?"green":"gray",children:["+ ",e.name]}):(0,r.jsxs)(r.Fragment,{children:[e.name,(0,r.jsx)(a.EY,{dimColor:!0,children:o})]})]})},e.id)})),at+lt.length<I.length&&(0,r.jsx)(a.az,{paddingLeft:2,children:(0,r.jsx)(a.EY,{dimColor:!0,children:"↓ more below"})}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"skills"===e?"↑/↓ to navigate • Enter to use • v to view • d to delete • Esc to cancel":"↑/↓ to navigate • Enter to select • d to delete • Esc to cancel"})})]})};o()}catch(j){o(j)}}))},"./src/components/list-mcp-resources-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o,a;const c=null==e?void 0:e.server;let d,u,p,h,g="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:g="pending";break;case"error":{const e=(null==t?void 0:t.result.value.error)||"Unknown error";e.includes("does not support MCP resources")?(g="success",p="No MCP resources available"):(g="error",u=e);break}case"success":g="success",h=null!==(a=null===(o=null==t?void 0:t.result.value.resources)||void 0===o?void 0:o.length)&&void 0!==a?a:0,d=0===h?"No resources found":`Found ${h} resource${1===h?"":"s"}`;break;case"rejected":g="rejected",d=(null==t?void 0:t.result.value.reason)||"Rejected";break;default:g="pending"}const m=c?`(${c})`:"";return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"ListMcpResources",primary:m,status:g,note:d}),p&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{dimColor:!0,children:p})}),u&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",u]})})]})};o()}catch(e){o(e)}}))},"./src/components/login-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{L:()=>a,a:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({status:e,message:t,userInfo:n,loginUrl:o})=>(0,r.jsx)(s.az,{flexDirection:"column",padding:1,children:(()=>{switch(e){case"starting":return(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{children:"Starting login process..."})});case"in-progress":return(0,r.jsxs)(s.az,{flexDirection:"column",gap:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{children:"Authenticating with Cursor..."})}),t&&(0,r.jsx)(s.EY,{children:t}),o&&(0,r.jsx)(s.EY,{color:"gray",wrap:"no-wrap",children:o})]});case"success":return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"green",children:"✓ "}),(null==n?void 0:n.email)?(0,r.jsxs)(s.EY,{children:["Logged in as ",n.email]}):(null==n?void 0:n.userId)?(0,r.jsxs)(s.EY,{children:["Logged in as user id ",n.userId]}):(0,r.jsx)(s.EY,{children:"Login successful!"})]}),t&&(0,r.jsx)(s.EY,{children:t})]});case"error":return(0,r.jsx)(s.az,{flexDirection:"column",children:t&&(0,r.jsx)(s.EY,{color:"red",children:t})})}})()}),a=({status:e,message:t})=>(0,r.jsx)(s.az,{flexDirection:"column",padding:1,children:(()=>{switch(e){case"starting":return(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{children:"Preparing to log out..."})});case"in-progress":return(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{children:"Logging out..."})});case"success":return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsx)(s.EY,{color:"green",children:"✓ Logout successful"}),t&&(0,r.jsx)(s.EY,{children:t})]});case"error":return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsx)(s.EY,{color:"red",children:"✗ Logout failed"}),t&&(0,r.jsx)(s.EY,{color:"red",children:t})]})}})()});o()}catch(e){o(e)}}))},"./src/components/ls-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{U:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;const c=(0,l.Kr)(e.path||""),d=e.ignore&&e.ignore.length>0?` (ignoring: ${e.ignore.join(", ")})`:"";let u,p="pending",h=0,g=0;if("success"===(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case)&&t.result.value.directoryTreeRoot){const e=t=>{h+=t.childrenFiles.length,g+=t.childrenDirs.length;for(const n of t.childrenDirs||[])e(n)};e(t.result.value.directoryTreeRoot)}switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:p="pending";break;case"error":p="error";break;case"success":case"timeout":p="success",u=`${h} file${1===h?"":"s"}, ${g} director${1===g?"y":"ies"}${d}`;break;case"rejected":p="rejected",u=(null==t?void 0:t.result.value.reason)||void 0;break;default:p="pending"}const m=(0,i.F_)("lsToolCall","success"===p)||("success"===p?"Listed":"Listing");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:m,primary:c,status:p,note:u}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.error]})}):null})()]})};o()}catch(e){o(e)}}))},"./src/components/markdown.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Ay:()=>T,oz:()=>$});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/ink-link@4.1.0_ink@6.0.0_@types+react@19.0.7_react-devtools-core@7.0.1_react@19.2.3_/node_modules/ink-link/dist/index.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/constants.ts"),c=n("./src/context/agent-state-context.tsx"),d=n("./src/context/config-context.tsx"),u=n("./src/context/theme-context.tsx"),p=n("./src/hooks/use-terminal-size.ts"),h=n("./src/statsig.ts"),g=n("./src/utils/color-mixing.ts"),m=n("./src/utils/mermaid-to-ascii.ts"),f=n("./src/components/highlighted-code.tsx"),v=e([s,i,u,p,f]);function x(e){var t;const n=null!==(t=e.split(/[\\/]/).pop())&&void 0!==t?t:e,o=n.lastIndexOf(".");if(o<=0||o===n.length-1)return null;switch(n.slice(o+1).toLowerCase()){case"ts":return"typescript";case"tsx":return"tsx";case"js":return"javascript";case"jsx":return"jsx";case"py":return"python";case"java":return"java";case"c":return"c";case"cc":case"cpp":case"cxx":return"cpp";case"cs":case"csharp":return"csharp";case"go":return"go";case"rs":return"rust";case"php":return"php";case"rb":return"ruby";case"swift":return"swift";case"kt":case"kts":return"kotlin";case"scala":return"scala";case"html":case"htm":return"html";case"css":return"css";case"scss":return"scss";case"json":return"json";case"yml":case"yaml":return"yaml";case"xml":return"xml";case"md":case"markdown":return"markdown";case"sh":case"bash":return"bash";case"sql":return"sql";case"dockerfile":case"docker":return"dockerfile";case"vue":return"vue";case"svelte":return"svelte";case"txt":case"text":return"text";default:return null}}function b(e,t){let n=e.indexOf("*",t);for(;-1!==n;){if("*"!==e[n+1])return n;n=e.indexOf("*",n+2)}return-1}function y(e,t,n){var o;const l=[];let a=0;const c=function(e){const t=[];let n=0;const o=e=>{e.length>0&&t.push({type:"text",content:e})};for(;n<e.length;){const r=e.indexOf("`",n),s=e.indexOf("*",n),i=e.indexOf("[",n);let l=-1,a=null;if(-1!==r&&(l=r,a="back"),-1!==s&&(-1===l||s<l)?e.startsWith("**",s)?(l=s,a="bold"):(l=s,a="italic"):-1!==s&&s===l&&e.startsWith("**",s)&&(a="bold"),-1!==i&&(-1===l||i<l)){const t=e.indexOf("]",i+1);-1!==t&&t+1<e.length&&"("===e[t+1]&&-1!==e.indexOf(")",t+2)&&(l=i,a="link")}if(-1===l||null===a){o(e.slice(n));break}if(l>n&&o(e.slice(n,l)),"link"===a){const o=e.indexOf("]",l+1),r=e.indexOf(")",o+2),s=e.slice(l+1,o),i=e.slice(o+2,r);t.push({type:"link",content:s,url:i}),n=r+1;continue}if("back"===a){const r=e.indexOf("`",l+1);if(-1!==r){t.push({type:"code",content:e.slice(l+1,r)}),n=r+1;continue}o("`"),n=l+1;continue}if("bold"===a){const r=e.indexOf("**",l+2);if(-1!==r){const o=e.slice(l+2,r);o.length>0&&t.push({type:"bold",content:o}),n=r+2;continue}o("*"),n=l+1;continue}const c=b(e,l+1);if(-1===c)o("*"),n=l+1;else{const r=e.slice(l+1,c);r.trim().length>0?t.push({type:"italic",content:r}):o(`*${r}*`),n=c+1}}return t}(e);for(const e of c)"text"===e.type?l.push((0,r.jsx)(s.EY,{wrap:"wrap",children:e.content},a++)):"code"===e.type?l.push((0,r.jsx)(s.EY,{wrap:"wrap",color:n,backgroundColor:t,children:e.content},a++)):"bold"===e.type?l.push((0,r.jsx)(s.EY,{bold:!0,wrap:"wrap",children:e.content},a++)):"italic"===e.type?l.push((0,r.jsx)(s.EY,{italic:!0,wrap:"wrap",children:e.content},a++)):"link"===e.type&&l.push((0,r.jsx)(i.A,{url:null!==(o=e.url)&&void 0!==o?o:"",children:(0,r.jsx)(s.EY,{wrap:"wrap",children:e.content})},a++));return(0,r.jsx)(r.Fragment,{children:l})}function w(e){var t;let n=0;for(const o of e){const e=null!==(t=o.codePointAt(0))&&void 0!==t?t:0;n+=e>=4352&&e<=4447||e>=11904&&e<=40959||e>=44032&&e<=55215||e>=63744&&e<=64255||e>=65072&&e<=65103||e>=65280&&e<=65376||e>=65504&&e<=65510||e>=127744&&e<=129535||e>=129536&&e<=129791||e>=9728&&e<=9983||e>=9984&&e<=10175?2:1}return n}function j(e,t){const n=[];let o=e;for(;o.length>0;){let e="",r=0;for(const n of o){const o=w(n);if(r+o>t&&e.length>0)break;e+=n,r+=o}if(0===e.length){const t=o.codePointAt(0);e=void 0!==t?String.fromCodePoint(t):o[0]}n.push(e),o=o.slice(e.length)}return n}function k(e){let t=e;return t=t.replace(/\*\*(?!\s)(.+?)(?<!\s)\*\*/g,"$1"),t=t.replace(/__(?!\s)(.+?)(?<!\s)__/g,"$1"),t=t.replace(/(?<!\*)\*(?!\s|\*)(.+?)(?<!\s|\*)\*(?!\*)/g,"$1"),t=t.replace(/(?<!\w)_(?!\s)(.+?)(?<!\s)_(?!\w)/g,"$1"),t=t.replace(/`([^`]+)`/g,"$1"),t}function C(e){return w(k(e))}[s,i,u,p,f]=v.then?(await v)():v;const S=l.memo((({headers:e,rows:t,renderInline:n,compact:o,containerPadding:i=0})=>{const{columns:a}=(0,p.H)(100),c=Math.max(1,(a||80)-i),{columnWidths:d,wrappedHeaders:u,wrappedRows:h}=(0,l.useMemo)((()=>function(e,t,n){var o;const r=Math.max(e.length,...t.map((e=>e.length))),s=[];for(let n=0;n<r;n++){const r=C(null!==(o=e[n])&&void 0!==o?o:""),i=t.reduce(((e,t)=>{var o;const r=C(null!==(o=t[n])&&void 0!==o?o:"");return Math.max(e,r)}),0);s.push(Math.max(r,i))}const i=3*r+1;if(s.reduce(((e,t)=>e+t),0)+i<=n)return{columnWidths:s,wrappedHeaders:e.map((e=>[e])),wrappedRows:t.map((e=>e.map((e=>[e])).concat(Array(Math.max(0,r-e.length)).fill([""]))))};const l=Math.max(r,n-i),a=Math.max(1,Math.min(3,Math.floor(l/r))),c=s.reduce(((e,t)=>e+t),0);let d;if(0===c){const e=Math.max(a,Math.floor(l/r));d=s.map((()=>e))}else d=s.map((e=>{const t=e/c;return Math.max(a,Math.floor(l*t))}));const u=d.reduce(((e,t)=>e+t),0);let p=l-u;if(p>0&&d.length>0){const e=d.indexOf(Math.max(...d));e>=0&&(d[e]+=p)}else if(p<0&&d.length>0)for(;p<0;){const e=Math.max(...d);if(e<=a)break;const t=d.indexOf(e),n=Math.min(-p,d[t]-a);d[t]-=n,p+=n}const h=(e,t)=>{if(0===e.length)return[""];const n=k(e);return 0===n.length?[""]:function(e,t){if(t<=0)return[e];const n=e.split(/(\s+)/),o=[];let r="",s=0;for(const e of n){const n=w(e);if(n>t&&""===r)o.push(...j(e,t));else if(s+n>t&&r.length>0)o.push(r.trimEnd()),r=e.trimStart(),s=w(r),s>t&&(o.push(...j(r,t)),r="",s=0);else{if(""===r&&/^\s+$/.test(e))continue;r+=e,s+=n}}return r.length>0&&o.push(r.trimEnd()),o.length>0?o:[""]}(n,t)},g=e.map(((e,t)=>{var n;return h(e,null!==(n=d[t])&&void 0!==n?n:a)})),m=t.map((e=>{var t,n;const o=[];for(let s=0;s<r;s++)o.push(h(null!==(t=e[s])&&void 0!==t?t:"",null!==(n=d[s])&&void 0!==n?n:a));return o}));return{columnWidths:d,wrappedHeaders:g,wrappedRows:m}}(e,t,c)),[e,t,c]),g=d.length,m=e=>{var t;const{line:o,colIndex:i,isHeader:l,originalCell:a,cellWrapped:c}=e,u=null!==(t=d[i])&&void 0!==t?t:0;if(a&&!c&&/[*`_]/.test(a)){const e=k(a),t=C(a),o=Math.max(0,u-t);return l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{bold:!0,children:e}),o>0&&(0,r.jsx)(s.EY,{children:" ".repeat(o)})]}):n?(0,r.jsxs)(r.Fragment,{children:[n(a),o>0&&(0,r.jsx)(s.EY,{children:" ".repeat(o)})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:e}),o>0&&(0,r.jsx)(s.EY,{children:" ".repeat(o)})]})}const p=function(e,t){const n=w(e),o=Math.max(0,t-n);return e+" ".repeat(o)}(o,u);return l?(0,r.jsx)(s.EY,{bold:!0,children:p}):(0,r.jsx)(s.EY,{children:p})},f=(e,t,n,o)=>{const i=Math.max(...e.map((e=>e.length))),a=[];for(let c=0;c<i;c++)a.push((0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsx)(s.EY,{color:"gray",children:"│ "}),e.map(((i,a)=>{var d;return(0,r.jsxs)(l.Fragment,{children:[m({line:null!==(d=i[c])&&void 0!==d?d:"",colIndex:a,isHeader:t,originalCell:0===c?null==o?void 0:o[a]:void 0,cellWrapped:i.length>1}),a<e.length-1?(0,r.jsx)(s.EY,{color:"gray",children:" │ "}):(0,r.jsx)(s.EY,{color:"gray",children:" │"})]},`${n}-line-${c}-cell-${a}`)}))]},`${n}-line-${c}`));return(0,r.jsx)(l.Fragment,{children:a},n)},v={topLeft:"┌",topRight:"┐",bottomLeft:"└",bottomRight:"┘",horizontal:"─",vertical:"│",leftT:"├",rightT:"┤",topT:"┬",bottomT:"┴",cross:"┼"},x=e=>{const t="top"===e?v.topLeft:"bottom"===e?v.bottomLeft:v.leftT,n="top"===e?v.topRight:"bottom"===e?v.bottomRight:v.rightT,o="top"===e?v.topT:"bottom"===e?v.bottomT:v.cross;return(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsx)(s.EY,{color:"gray",children:t}),d.map(((t,i)=>(0,r.jsxs)(l.Fragment,{children:[(0,r.jsx)(s.EY,{color:"gray",children:v.horizontal.repeat(t+2)}),(0,r.jsx)(s.EY,{color:"gray",children:i<d.length-1?o:n})]},`border-${e}-${i}`)))]})},b=[...e];for(;b.length<g;)b.push("");const y=[...u];for(;y.length<g;)y.push([""]);return(0,r.jsxs)(s.az,{flexDirection:"column",marginTop:1,marginBottom:o?0:1,children:[x("top"),f(y,!0,"header",b),x("middle"),h.map(((e,n)=>{var o;const r=[...null!==(o=t[n])&&void 0!==o?o:[]];for(;r.length<g;)r.push("");return f(e,!1,`row-${n}`,r)})),x("bottom")]})})),E=l.memo((({content:e})=>{var t;const n=(0,d.$i)(),o=(0,c.tO)(),i=e.split("\n").length,a=n&&i>1,u=null!==(t=e.trimStart().split(/\s/)[0])&&void 0!==t?t:"",{columns:g}=(0,p.H)(200),v=(0,l.useMemo)((()=>(0,h.QF)("cli_mermaid_previews")),[]),x=(0,l.useMemo)((()=>function(e){if(e<=0)return;const t=4*Math.floor(e/4);return Math.max(20,t-4)}(g)),[g]),b=(0,l.useMemo)((()=>v?(0,m.O)(e,{maxWidth:x}):null),[e,x,v]),y=!o||null==b,w=y?e:b,j=!!y&&a,k=null!=b,C=u?`mermaid ${u}`:"mermaid";return(0,r.jsxs)(s.az,{flexDirection:"column",children:[!k&&(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:"cyan",bold:!0,children:C})}),(0,r.jsx)(f.d,{content:w,language:"text",startLineNumber:1,showLineNumbers:j}),k&&(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{color:"gray",dimColor:!0,children:["ctrl+o to ",y?"render diagram":"show source"]})})]})})),M=l.memo((({content:e,language:t,startLineNumber:n,path:o,dimmed:i})=>{const l=(0,d.$i)()&&e.split("\n").length>1;return(0,r.jsxs)(s.az,{flexDirection:"column",children:[o&&(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsxs)(s.EY,{bold:!0,dimColor:null!=i&&i,children:[" ",o," ",n?`lines ${n}-${n+e.split("\n").length-1}`:""]})}),(0,r.jsx)(f.d,{content:e,language:t,startLineNumber:null!=n?n:1,showLineNumbers:l,dimmed:i})]})})),$=l.memo((({content:e,dimmed:t,preserveParagraphBreaks:n,compact:o})=>{const i=(0,l.useMemo)((()=>function(e,t=!1){var n,o;const r=e.split(/\r?\n/),s=[];let i=0,l=0,a=0;const c=()=>"md-"+a++;for(;i<r.length;){const e=r[i];if(e.trim().startsWith("```")){const t=e.trim().slice(3).trim();let n,o,l=t||"text";const a=t.match(/^(\d+):(\d+):(.+)$/);if(a){n=Number.parseInt(a[1],10),o=a[3].trim();const e=x(o);l=null!=e?e:"text"}else if(t&&/[/\\.]/.test(t)&&!/\s/.test(t)){o=t;const e=x(t);l=null!=e?e:l}const d=[];if(i++,!o&&i<r.length&&!r[i].trim().startsWith("```")){const e=r[i].trim().match(/^(?:⬢\s+)?Read\s+(.+)$/);if(e){const t=e[1].trim();if(/[/\\.]/.test(t)&&!/\s/.test(t)){o=t;const e=x(t);l=null!=e?e:l,i++}}}for(;i<r.length&&!r[i].trim().startsWith("```");)d.push(r[i]),i++;s.push({type:"code-block",id:c(),content:d.join("\n"),language:l,startLineNumber:n,path:o}),i++;continue}const a=e.match(/^(#{1,6})\s+(.+)$/);if(a){s.push({type:"heading",id:c(),content:a[2],level:a[1].length}),i++;continue}if(e.includes("|")&&i+1<r.length){const t=r[i+1];if(t&&/^\|?\s*:?-+:?\s*(\|\s*:?-+:?\s*)*\|?\s*$/.test(t.trim())){const t=e=>{const t="\0ESCAPED_BACKSLASH\0",n="\0ESCAPED_PIPE\0";let o=e.trim();return o=o.replace(/\\\\/g,t).replace(/\\\|/g,n),o.startsWith("|")&&(o=o.slice(1)),o.endsWith("|")&&(o=o.slice(0,-1)),o.split("|").map((e=>e.replace(new RegExp(t,"g"),"\\").replace(new RegExp(n,"g"),"|").trim()))},n=t(e),o=[];for(i+=2;i<r.length;){const e=r[i];if(!e.includes("|")||e.trim().startsWith("```"))break;if(!e.trim())break;o.push(t(e)),i++}s.push({type:"table",id:c(),content:"",tableData:{id:l++,headers:n,rows:o}});continue}}const d=e.match(/^(\s*)(\d+)[.)]\s+/);if(d){const t=null!==(n=d[1])&&void 0!==n?n:"";let o=0;for(const e of t)o+="\t"===e?2:1;const r=Math.max(0,Math.floor(o/2)),l=Number.parseInt(d[2],10);s.push({type:"list-item",id:c(),content:e.replace(/^(\s*)(\d+)[.)]\s+/,""),level:r,ordered:!0,index:Number.isFinite(l)?l:1}),i++;continue}if(/^(-{3,}|\*{3,}|_{3,})$/.test(e.trim())){s.push({type:"horizontal-rule",id:c(),content:""}),i++;continue}const u=e.match(/^(\s*)[-*+]\s+/);if(u){const t=null!==(o=u[1])&&void 0!==o?o:"";let n=0;for(const e of t)n+="\t"===e?2:1;const r=Math.max(0,Math.floor(n/2));s.push({type:"list-item",id:c(),content:e.replace(/^(\s*)[-*+]\s+/,""),level:r,ordered:!1}),i++}else e.trim().startsWith("> ")?(s.push({type:"blockquote",id:c(),content:e.replace(/^\s*>\s?/,"")}),i++):(e.trim()?s.push({type:"text",id:c(),content:e}):t&&s.push({type:"paragraph-break",id:c(),content:""}),i++)}return s}(e,n)),[e,n]),c=(0,u.pW)(),d=(0,l.useMemo)((()=>(0,g.PT)()),[]),p=(0,l.useMemo)((()=>{if("truecolor"===d)return c?a.dU.backgroundHex:a.F3.backgroundHex;const e=c?a.i1.background:a.sg.background;return(0,g.LR)(e)}),[c,d]),h=(0,l.useMemo)((()=>{if("truecolor"===d)return c?a.dU.foregroundHex:a.F3.foregroundHex;const e=c?a.i1.foreground:a.sg.foreground;return(0,g.LR)(e)}),[c,d]);return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:i.map(((e,n)=>{var l,u,m,f,v;const x=Boolean(o&&n===i.length-1);switch(e.type){case"code-block":{const n=e.language;if("mermaid"===n)return(0,r.jsx)(s.az,{marginTop:1,marginBottom:x?0:1,children:(0,r.jsx)(E,{content:e.content})},e.id);const o=["javascript","typescript","python","java","c","cpp","csharp","go","rust","php","ruby","swift","kotlin","scala","html","css","scss","json","yaml","xml","markdown","bash","shell","sql","dockerfile","tsx","jsx","vue","svelte","text"].includes(n);return(0,r.jsx)(s.az,{marginTop:1,marginBottom:x?0:1,children:(0,r.jsx)(M,{content:e.content,language:o?n:"text",startLineNumber:e.startLineNumber,path:e.path,dimmed:t})},e.id)}case"heading":{const n=c,i=d,u="truecolor"===i?1===e.level?n?a.cM.h1Hex:a.CV.h1Hex:2===e.level?n?a.cM.h2Hex:a.CV.h2Hex:n?a.cM.hnHex:a.CV.hnHex:null,p=(()=>{if("truecolor"!==i){const t=1===e.level?n?a.bR.h1:a.XQ.h1:2===e.level?n?a.bR.h2:a.XQ.h2:n?a.bR.hn:a.XQ.hn;return(0,g.LR)(t)}return null})(),h=null!==(l=null!=u?u:p)&&void 0!==l?l:void 0;return(0,r.jsx)(s.az,{marginBottom:x?0:1,marginTop:o?1:2,children:(0,r.jsx)(s.EY,Object.assign({bold:!0},h?{color:h}:{},t?{dimColor:!0}:{},{wrap:"wrap",children:e.content}))},e.id)}case"list-item":{const o="list-item"!==(null!==(m=null===(u=i[n+1])||void 0===u?void 0:u.type)&&void 0!==m?m:null),l=2*Math.max(0,null!==(f=e.level)&&void 0!==f?f:0),a=!0===e.ordered,c=a?`${(null!==(v=e.index)&&void 0!==v?v:1).toString()}.`:"•",d=a?Math.max(c.length+1,3):2,g=o&&!x?1:0;return(0,r.jsxs)(s.az,{flexDirection:"row",marginBottom:g,children:[(0,r.jsx)(s.az,{width:l}),(0,r.jsx)(s.az,{width:d,children:(0,r.jsx)(s.EY,Object.assign({color:"gray"},t?{dimColor:!0}:{},{children:c}))}),(0,r.jsx)(s.az,{flexGrow:1,paddingRight:2,children:(0,r.jsx)(s.EY,Object.assign({wrap:"wrap"},t?{dimColor:!0}:{},{children:y(e.content,p,h)}))})]},e.id)}case"blockquote":return(0,r.jsx)(s.az,{paddingLeft:2,borderLeft:!0,borderColor:"gray",children:(0,r.jsx)(s.EY,Object.assign({color:"gray",italic:!0,wrap:"wrap"},t?{dimColor:!0}:{},{children:y(e.content,p,h)}))},e.id);case"table":if(e.tableData){const{id:t,headers:n,rows:o}=e.tableData;return(0,r.jsx)(S,{headers:n,rows:o,renderInline:e=>y(e,p,h),compact:x,containerPadding:2},`table-${t}`)}return null;case"horizontal-rule":return(0,r.jsx)(s.az,{marginTop:o?0:1,marginBottom:x||o?0:1,children:(0,r.jsx)(s.EY,{dimColor:!0,children:"─".repeat(40)})},e.id);case"paragraph-break":return o&&x?null:(0,r.jsx)(s.az,{height:1},e.id);default:return(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:null!=t&&t,children:y(e.content,p,h)})},e.id)}}))})})),T=$;o()}catch(I){o(I)}}))},"./src/components/mcp-servers-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{g:()=>b});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:os"),i=n("node:path"),l=n("../ink/build/index.js"),a=n("../mcp-agent-exec/dist/index.js"),c=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),d=n("./src/hooks/use-screen-size.ts"),u=n("./src/mcp/project-paths.ts"),p=n("./src/utils/input-keys.ts"),h=n("./src/utils/oauth-callback.ts"),g=n("./src/utils/open-browser.ts"),m=e([l,d]);[l,d]=m.then?(await m)():m;var f=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const x=10;function v(e){try{if(!e||"object"!=typeof e)return[];const t=null==e?void 0:e.properties;return t&&"object"==typeof t?Object.keys(t):[]}catch(e){return[]}}const b=({ctx:e,mcpLoader:t,disabledStore:n,onClose:o})=>{var m,b;const y=(0,c.useMemo)((()=>{const{projectRoot:e}=(0,u.C)(process.cwd());return e}),[]),[w,j]=(0,c.useState)([]),[k,C]=(0,c.useState)(0),S=(0,c.useRef)(w),E=(0,c.useRef)(k);S.current=w,E.current=k;const[M,$]=(0,c.useState)("loading"),[T,I]=(0,c.useState)([]),[P,A]=(0,c.useState)(null),[D,_]=(0,c.useState)(null),[R,L]=(0,c.useState)(0),[O,Y]=(0,c.useState)(""),[F,z]=(0,c.useState)(!1),{stdout:N}=(0,l.t$)(),U=(0,d.l)(),B=null!==(b=null!==(m=null==U?void 0:U.height)&&void 0!==m?m:null==N?void 0:N.rows)&&void 0!==b?b:24,q=Math.min(x,Math.max(5,B-8)),H=(0,c.useCallback)((()=>f(void 0,void 0,void 0,(function*(){$("loading");try{const o=(0,i.join)(y,".cursor","mcp.json"),r=(0,i.join)((0,s.homedir)(),".cursor","mcp.json"),[l,c]=yield Promise.all([(0,a.h1)(r).catch((()=>({mcpServers:{}}))),(0,a.h1)(o).catch((()=>({mcpServers:{}})))]),d=(0,a.N_)(l,c),p=Object.keys(d.mcpServers);if(0===p.length)return j([]),void $("list");const h=yield n.getDisabledServers(),{approvalPath:g}=(0,u.C)(process.cwd()),m=new a.mF(g,y),v=yield m.getApprovals(),x=(yield t.load(e)).getClients(),b=yield Promise.all(p.map((t=>f(void 0,void 0,void 0,(function*(){if(h.includes(t))return{id:t,status:"disabled"};const n=d.mcpServers[t],o=(0,a.Ko)(t,n,y);if(!v.includes(o))return{id:t,status:"unapproved"};const r=x[t];if(!r)return{id:t,status:"error"};try{const n=yield r.getState(e);return{id:t,status:n.kind}}catch(e){return{id:t,status:"error"}}})))));j(b),$("list")}catch(e){Y(e instanceof Error?e.message:"Failed to load MCP servers"),$("error")}}))),[e,t,n,y]);(0,c.useEffect)((()=>{H()}),[H]),(0,c.useEffect)((()=>{k>=w.length&&w.length>0&&C(w.length-1)}),[w.length,k]);const W=(0,c.useCallback)((o=>f(void 0,void 0,void 0,(function*(){z(!0);try{const r=process.cwd(),{projectRoot:l,approvalPath:c}=(0,u.C)(r),d=new a.mF(c,l),p=(0,i.join)((0,s.homedir)(),".cursor","mcp.json"),h=(0,i.join)(l,".cursor","mcp.json"),[g,m]=yield Promise.all([(0,a.h1)(p).catch((()=>({mcpServers:{}}))),(0,a.h1)(h).catch((()=>({mcpServers:{}})))]),f=(0,a.N_)(g,m).mcpServers[o];if(f){const e=(0,a.Ko)(o,f,l);(yield d.getApprovals()).includes(e)||(yield d.addApproval(e))}yield n.removeDisabledServer(o),yield t.load(e,!1),yield H()}catch(e){yield H()}finally{z(!1)}}))),[e,t,n,H]),G=(0,c.useCallback)((n=>f(void 0,void 0,void 0,(function*(){var o;z(!0);try{let r;try{r=yield t.loadClient(e,n)}catch(e){return Y(`Failed to load MCP server '${n}': ${(0,h.u1)(e)}`),$("error"),void z(!1)}const s=yield r.getState(e);if("requires_authentication"===s.kind&&s.url){const e=s.url;Y(`Opening browser for authentication...\nListening on ${h.Yt} for OAuth callback...`),$("error"),(0,g.g1)(e)&&(0,g.ph)(e);try{const e=yield(0,h.T5)();yield s.callback(e),null===(o=t.clearClient)||void 0===o||o.call(t,n),yield H()}catch(e){Y(`Authentication callback failed: ${(0,h.u1)(e)}`),$("error")}}else"ready"===s.kind?yield H():"requires_authentication"===s.kind?(Y(`Authentication URL unavailable for '${n}'`),$("error")):(Y(`Cannot login to '${n}': server is in '${s.kind}' state`),$("error"))}catch(e){Y(e instanceof Error?e.message:"Login failed"),$("error")}finally{z(!1)}}))),[e,t,H]),X=(0,c.useCallback)((n=>f(void 0,void 0,void 0,(function*(){z(!0);try{let o;try{o=yield t.loadClient(e,n)}catch(e){return Y(`Failed to load MCP server '${n}'`),$("error"),void z(!1)}const[r,s,i]=yield Promise.all([o.getTools(e),o.listResources(e).catch((()=>({resources:[]}))),o.listPrompts(e).catch((()=>[]))]);I(r.map((e=>({name:e.name,args:v(e.inputSchema)}))).sort(((e,t)=>e.name.localeCompare(t.name))));const l=o.config;A({url:l&&"url"in l?l.url:void 0,command:l&&"command"in l?l.command:void 0,resourceCount:s.resources.length,promptCount:i.length}),_(n),L(0),$("tools")}catch(e){Y(e instanceof Error?e.message:"Failed to load tools"),$("error")}finally{z(!1)}}))),[e,t]),K=(0,c.useCallback)((()=>f(void 0,void 0,void 0,(function*(){const e=S.current,t=E.current;if(0===e.length||F)return;const n=e[t];if(n)switch(n.status){case"disabled":case"unapproved":yield W(n.id);break;case"requires_authentication":yield G(n.id);break;case"ready":yield X(n.id);break;case"error":case"loading":break;default:n.status}}))),[F,W,G,X]),Q=(0,c.useCallback)((e=>e.includes("[M")||e.includes("[<")||e.includes("[?")||/\x1b\[<\d+;\d+;\d+[Mm]/.test(e)||/\x1b\[M[\x20-\xff]{3}/.test(e)),[]),J=Math.max(5,B-10),V=Math.max(0,T.length-J),Z=(0,c.useCallback)(((e,t)=>{if(Q(e))return;if(t.ctrl&&"c"===e)return void o();if((0,p.xv)(e,t)||"q"===e||"Q"===e)return void o();const n=S.current.length;(0,p.Po)(e,t)||"k"===e||"K"===e?C((e=>e>0?e-1:Math.max(0,n-1))):(0,p.u$)(e,t)||"j"===e||"J"===e?C((e=>e<n-1?e+1:0)):!t.ctrl||"u"!==e&&"b"!==e?!t.ctrl||"d"!==e&&"f"!==e?"g"!==e?"G"!==e?t.return&&!F&&K():C(Math.max(0,n-1)):C(0):C((e=>Math.min(Math.max(0,n-1),e+q))):C((e=>Math.max(0,e-q)))}),[Q,o,q,F,K]);(0,l.Ge)(Z,{isActive:"list"===M});const ee=(0,c.useCallback)(((e,t)=>{if(!Q(e)){if(!t.ctrl||"c"!==e)return(0,p.xv)(e,t)||"q"===e||"Q"===e?($("list"),void _(null)):void((0,p.Po)(e,t)||"k"===e||"K"===e?L((e=>Math.max(0,e-1))):(0,p.u$)(e,t)||"j"===e||"J"===e?L((e=>Math.min(V,e+1))):!t.ctrl||"u"!==e&&"b"!==e?!t.ctrl||"d"!==e&&"f"!==e||L((e=>Math.min(V,e+J))):L((e=>Math.max(0,e-J))));o()}}),[Q,o,V,J]);(0,l.Ge)(ee,{isActive:"tools"===M});const te=(0,c.useCallback)(((e,t)=>{Q(e)||(t.ctrl&&"c"===e?o():(0,p.xv)(e,t)||"q"===e||"Q"===e?"error"===M?($("list"),Y("")):o():t.return&&"error"===M&&($("list"),Y("")))}),[Q,o,M]);(0,l.Ge)(te,{isActive:"loading"===M||"error"===M});const{visibleItems:ne,adjustedScrollOffset:oe,clampedActiveIndex:re}=(0,c.useMemo)((()=>{if(0===w.length)return{visibleItems:[],adjustedScrollOffset:0,clampedActiveIndex:0};const e=Math.min(Math.max(0,k),w.length-1),t=Math.max(0,w.length-q);let n;return n=e>=t+q?t:e<q?0:Math.min(e-q+1,t),{visibleItems:w.slice(n,n+q),adjustedScrollOffset:n,clampedActiveIndex:e}}),[w,q,k]);if("loading"===M)return(0,r.jsxs)(l.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(l.az,{marginBottom:1,children:(0,r.jsx)(l.EY,{bold:!0,color:"cyan",children:"MCP Servers"})}),(0,r.jsx)(l.EY,{color:"cyan",children:"Loading MCP servers..."})]});if("error"===M)return(0,r.jsxs)(l.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(l.az,{marginBottom:1,children:(0,r.jsx)(l.EY,{bold:!0,color:"cyan",children:"MCP Servers"})}),(0,r.jsx)(l.EY,{color:O.startsWith("✓")?"green":O.includes("Browser")?"cyan":"red",children:O}),(0,r.jsx)(l.az,{marginTop:1,children:(0,r.jsx)(l.EY,{dimColor:!0,italic:!0,children:"Enter to continue • Esc to go back"})})]});if("tools"===M&&D){const e=T.slice(R,R+J),t=R>0,n=R<V;return(0,r.jsxs)(l.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(l.az,{flexDirection:"column",marginBottom:1,children:[(0,r.jsx)(l.EY,{bold:!0,color:"cyan",children:D}),(null==P?void 0:P.url)&&(0,r.jsxs)(l.EY,{dimColor:!0,children:["URL: ",P.url]}),(null==P?void 0:P.command)&&(0,r.jsxs)(l.EY,{dimColor:!0,children:["Command: ",P.command]}),(0,r.jsxs)(l.EY,{dimColor:!0,children:[T.length," tools",P&&P.resourceCount>0&&` • ${P.resourceCount} resources`,P&&P.promptCount>0&&` • ${P.promptCount} prompts`]})]}),t&&(0,r.jsx)(l.az,{children:(0,r.jsx)(l.EY,{dimColor:!0,children:"↑ more above"})}),0===T.length?(0,r.jsx)(l.EY,{color:"yellow",children:"No tools available for this server"}):(0,r.jsx)(l.az,{flexDirection:"column",children:e.map((e=>(0,r.jsx)(l.az,{gap:1,children:(0,r.jsxs)(l.EY,{children:[(0,r.jsxs)(l.EY,{color:"cyan",children:["• ",e.name]}),e.args.length>0&&(0,r.jsxs)(l.EY,{dimColor:!0,children:[" (",e.args.join(", "),")"]})]})},e.name)))}),n&&(0,r.jsx)(l.az,{children:(0,r.jsx)(l.EY,{dimColor:!0,children:"↓ more below"})}),(0,r.jsx)(l.az,{marginTop:1,children:(0,r.jsx)(l.EY,{dimColor:!0,italic:!0,children:"↑/↓ to scroll • Esc to go back"})})]})}const se=w.length,ie=`${se} ${1===se?"server":"servers"}`;return(0,r.jsxs)(l.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(l.az,{marginBottom:1,children:[(0,r.jsx)(l.EY,{bold:!0,color:"cyan",children:"MCP Servers"}),(0,r.jsxs)(l.EY,{dimColor:!0,children:[" (",ie,")"]})]}),0===w.length?(0,r.jsxs)(l.az,{flexDirection:"column",children:[(0,r.jsx)(l.EY,{color:"yellow",children:"No MCP servers configured"}),(0,r.jsx)(l.az,{marginTop:1,children:(0,r.jsx)(l.EY,{dimColor:!0,children:"Configure servers in .cursor/mcp.json or ~/.cursor/mcp.json"})})]}):(0,r.jsxs)(r.Fragment,{children:[oe>0&&(0,r.jsx)(l.az,{paddingLeft:2,children:(0,r.jsx)(l.EY,{dimColor:!0,children:"↑ more above"})}),ne.map(((e,t)=>{const n=oe+t===re,o=function(e){switch(e){case"ready":return"green";case"disabled":default:return"gray";case"unapproved":case"requires_authentication":case"loading":return"yellow";case"error":return"red"}}(e.status),s=function(e){switch(e){case"ready":return"enabled";case"disabled":return"disabled";case"unapproved":return"needs approval";case"requires_authentication":return"requires auth";case"loading":return"loading";case"error":return"error";default:return"unknown"}}(e.status),i=function(e){switch(e){case"ready":return"view tools";case"disabled":case"unapproved":return"enable";case"requires_authentication":return"login";case"loading":return"loading...";default:return""}}(e.status);return(0,r.jsxs)(l.az,{paddingLeft:1,children:[(0,r.jsxs)(l.EY,{color:n?"cyan":"white",bold:n,children:[n?"→ ":"  ",e.id]}),(0,r.jsx)(l.EY,{children:" - "}),(0,r.jsx)(l.EY,{color:o,children:s}),n&&i&&(0,r.jsxs)(l.EY,{dimColor:!0,children:[" (Enter to ",i,")"]})]},e.id)})),oe+q<w.length&&(0,r.jsx)(l.az,{paddingLeft:2,children:(0,r.jsx)(l.EY,{dimColor:!0,children:"↓ more below"})})]}),(0,r.jsx)(l.az,{marginTop:1,children:(0,r.jsx)(l.EY,{dimColor:!0,italic:!0,children:"↑/↓ to navigate • Enter to select • Esc to close"})})]})};o()}catch(y){o(y)}}))},"./src/components/mcp-tool-decision-preview.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{t:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/highlighted-code.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=({providerIdentifier:e,toolName:t,args:n})=>{const o=Object.keys(n).length>0;return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"cyan",bold:!0,children:e}),(0,r.jsx)(s.EY,{color:"gray",children:": "}),(0,r.jsx)(s.EY,{color:"magenta",children:t})]}),o&&(0,r.jsx)(s.az,{marginLeft:2,children:(0,r.jsx)(i.A,{content:JSON.stringify(n,null,2),language:"json",showLineNumbers:!1})})]})};o()}catch(e){o(e)}}))},"./src/components/mcp-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{v:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o,a;if(!e)return null;const c=null!==(n=e.providerIdentifier)&&void 0!==n?n:"MCP",d=null!==(o=e.toolName)&&void 0!==o?o:"<Unknown Tool>";Object.entries(e.args||{}).length>0&&JSON.stringify(e.args,null,2);let u,p,h,g="pending";switch(null===(a=null==t?void 0:t.result)||void 0===a?void 0:a.case){case void 0:g="pending";break;case"error":g="error",p=(null==t?void 0:t.result.value.error)||"Unknown error";break;case"success":g="success",h="Success";break;case"rejected":g="rejected",u="MCP tool rejected";break;case"permissionDenied":g="error",p="Permission denied";break;default:g="pending"}return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:c,primary:d,status:g,note:u}),p&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",p]})})]})};o()}catch(e){o(e)}}))},"./src/components/merged-read-search-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{r:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/utils/path-utils.ts"),c=n("./src/components/tool-call-header.tsx"),d=e([s,c]);[s,c]=d.then?(await d)():d;const u=({tools:e,treatAsPending:t=!1})=>{var n;const o=e.every((e=>e.completed)),d=[],u=[],p=[],h=[],g=[];e.forEach((e=>{"readToolCall"===e.call.tool.case?d.push(e.call.tool.value):"grepToolCall"===e.call.tool.case?u.push(e.call.tool.value):"semSearchToolCall"===e.call.tool.case?p.push(e.call.tool.value):"globToolCall"===e.call.tool.case?h.push(e.call.tool.value):"lsToolCall"===e.call.tool.case&&g.push(e.call.tool.value)}));const m=(0,i.useMemo)((()=>{const t=new Set,n=[];for(const o of e){const e=o.call.tool.case;e&&(t.has(e)||(t.add(e),n.push(e)))}return n}),[e]),f={readToolCall:d.length,grepToolCall:u.length,semSearchToolCall:p.length,globToolCall:h.length,lsToolCall:g.length},v={readToolCall:e=>`${e} file${1===e?"":"s"}`,grepToolCall:e=>`${e} ${1===e?"grep":"greps"}`,semSearchToolCall:e=>`${e} ${1===e?"search":"searches"}`,globToolCall:e=>`${e} ${1===e?"glob":"globs"}`,lsToolCall:e=>`${e} director${1===e?"y":"ies"}`},x=[];for(const e of m){const t=null!==(n=f[e])&&void 0!==n?n:0,o=v[e];t>0&&o&&x.push(o(t))}const b=x.join(", "),y=o&&!t?"success":"pending",w=m.map((e=>(0,l.F_)(e,o&&!t)||void 0)).filter((e=>Boolean(e))).join(", ")||"Read",j=w.charAt(0).toUpperCase()+w.slice(1).toLowerCase(),k=(0,i.useMemo)((()=>{const t=e.map((e=>{var t,n,o,r,s,i,c,d,u;const p=Boolean(e.completed),h=e.call.tool.case;if("readToolCall"===h){const n=e.call.tool.value.args,o=(0,a.Kr)(null!==(t=null==n?void 0:n.path)&&void 0!==t?t:""),r=(0,a.me)(null==n?void 0:n.offset,null==n?void 0:n.limit);return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Read":"Reading"),rest:`${o}${r?` ${r}`:""}`}}if("grepToolCall"===h){const t=e.call.tool.value.args,r=null!==(n=null==t?void 0:t.pattern)&&void 0!==n?n:"",s=r.length>40?`...${r.slice(-37)}`:r,i=(0,a.Kr)(null!==(o=null==t?void 0:t.path)&&void 0!==o?o:"");return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Grepped":"Grepping"),rest:`"${s}" in ${i}`}}if("semSearchToolCall"===h){const t=e.call.tool.value.args,n=null!==(r=null==t?void 0:t.query)&&void 0!==r?r:"",o=n.length>40?`...${n.slice(-37)}`:n,i=null!==(s=null==t?void 0:t.targetDirectories)&&void 0!==s?s:[],c=i.length>0?(0,a.Kr)(i[0]||"."):"",d=c?` in ${c}`:"";return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Searched":"Searching"),rest:`"${o}"${d}`}}if("globToolCall"===h){const t=e.call.tool.value.args,n=null!==(i=null==t?void 0:t.globPattern)&&void 0!==i?i:"",o=n.length>40?`...${n.slice(-37)}`:n,r=(0,a.Kr)(null!==(c=null==t?void 0:t.targetDirectory)&&void 0!==c?c:"");return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Globbed":"Globbing"),rest:`"${o}" in ${r}`}}if("lsToolCall"===h){const t=null!==(u=null===(d=e.call.tool.value.args)||void 0===d?void 0:d.path)&&void 0!==u?u:"",n=(0,a.Kr)(t);return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Listed":"Listing"),rest:`${n}`}}return null})).filter(Boolean),n=t.length;let o=Math.max(0,n-3);return n-3==1&&(o=Math.max(0,o-1)),{visible:t.slice(o),collapsed:o,earlierHiddenLabel:o>0?`${o} earlier ${1===o?"item":"items"} hidden`:""}}),[e]);return 0===e.length?null:(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,paddingLeft:1,children:[(0,r.jsx)(c.C,{name:j,primary:b,status:y}),0===k.visible.length?null:(0,r.jsxs)(s.az,{flexDirection:"column",marginLeft:l.SK,children:[k.collapsed>0?(0,r.jsxs)(s.EY,{color:"gray",wrap:"truncate",children:[(0,r.jsx)(s.EY,{bold:!0,children:"…"})," ",k.earlierHiddenLabel]}):null,k.visible.map((e=>(0,r.jsxs)(s.EY,{color:"gray",children:[(0,r.jsx)(s.EY,{bold:!0,children:e.verb}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{wrap:"truncate-start",children:e.rest})]},e.id)))]})]})};o()}catch(e){o(e)}}))},"./src/components/message-input.tsx":(e,t,n)=>{n.a(e,(async(e,t)=>{try{n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js");var o=n("../ink/build/index.js"),r=n("./src/components/text-input.tsx"),s=e([o,r]);[o,r]=s.then?(await s)():s,t()}catch(e){t(e)}}))},"./src/components/overflow-markdown.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{m:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/markdown.tsx"),l=e([s,i]);function a(e,t){const n=Math.max(1,t),o=e.split(" "),r=[];let s="";for(const e of o)if(e.length>n){s&&(r.push(s.trim()),s="");let t=e;for(;t.length>n;)r.push(t.slice(0,n)),t=t.slice(n);s=`${t} `}else s.length+e.length+1>n?s?(r.push(s.trim()),s=`${e} `):s=`${e} `:s+=`${e} `;return s.trim()&&r.push(s.trim()),r.join("\n")}[s,i]=l.then?(await l)():l;const c=({content:e,maxLines:t,showHiddenIndicator:n=!0,width:o,truncationHint:l,dimmed:c,preserveParagraphBreaks:d,compact:u})=>{var p;const{stdout:h}=(0,s.t$)(),g=Math.max(1,(null!==(p=null!=o?o:null==h?void 0:h.columns)&&void 0!==p?p:80)-4),m=e.split(/\n\n+/).map((e=>{const t=e.trim();return""===t?"":/^(#{1,6}\s|[\s]*[-*+]\s|[\s]*\d+[.)]\s|[\s]*>\s)/m.test(t)?t.split("\n").map((e=>a(e,g))).join("\n"):a(t.replace(/\n/g," ").trim(),g)})).join("\n\n").split("\n"),f=1===Math.max(0,m.length-t)?t+1:t,v=m.slice(0,f),x=Math.max(0,m.length-f),b=v.join("\n");return(0,r.jsxs)(s.az,{flexDirection:"column",children:[n&&x>0&&(0,r.jsxs)(s.EY,{dimColor:!0,children:["... (",x," lines hidden below)",l?(0,r.jsxs)(r.Fragment,{children:[" ",(0,r.jsx)(s.EY,{children:"· "}),(0,r.jsx)(s.EY,{children:l})]}):null]}),(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsx)(i.oz,{content:b,dimmed:c,preserveParagraphBreaks:d,compact:u})})]})};o()}catch(d){o(d)}}))},"./src/components/path-display.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{g:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=({path:e,maxLength:t=50,separatorColor:n="#aaaaaa",segmentColor:o,ellipsisColor:l="#aaaaaa",dimSeparators:a=!0})=>{const{segments:c,ellipsisIndex:d,separator:u}=function(e,t){const n=e.includes("\\")?"\\":"/";if(e.length<=t)return{segments:e.split(n),separator:n};const o=e.split(n),r=o[o.length-1];if(r.length+3>t)return{segments:["...",r.substring(0,t-3)],ellipsisIndex:0,separator:n};const s=n.length,i=t-r.length-3;let l=0;const a=[];let c=-1;for(let e=0;e<o.length-1;e++){const t=o[e].length+(e>0?s:0);if(!(l+t<=i)){c=a.length;break}a.push(o[e]),l+=t}return-1!==c?(a.splice(c,0,"..."),a.push(r),{segments:a,ellipsisIndex:c,separator:n}):{segments:o,separator:n}}(e,t);return(0,r.jsx)(s.EY,{children:c.map(((e,t)=>{const c=t===d;return(0,r.jsxs)(i.Fragment,{children:[t>0&&!c&&(0,r.jsx)(s.EY,{color:n,dimColor:a,children:u}),c?(0,r.jsx)(s.EY,{color:l,dimColor:!0,children:e}):(0,r.jsx)(s.EY,{color:o,children:e})]},e)}))})};o()}catch(e){o(e)}}))},"./src/components/plan-execution-message.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{p:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/tool-row-box.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=({content:e})=>{const t=function(e){var t;if(e.includes("\n\n")){const n=null===(t=e.split("\n\n")[0])||void 0===t?void 0:t.trim();if(n&&n.length>0)return`Building: ${n}`}return e||"Building plan..."}(e);return(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(i.Y,{flexDirection:"column",borderColor:"gray",borderDimColor:!0,children:(0,r.jsx)(s.az,{flexDirection:"row",alignItems:"center",paddingX:1,paddingY:0,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:t})})})})};o()}catch(e){o(e)}}))},"./src/components/plan-file-block.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{W:()=>g,l:()=>m});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../proto/dist/generated/agent/v1/agent_pb.js"),l=n("../proto/dist/generated/agent/v1/create_plan_tool_pb.js"),a=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),c=n("./src/debug.ts"),d=n("./src/plan-file-utils.ts"),u=n("./src/components/create-plan-tool-ui.tsx"),p=n("./src/components/tool-row-box.tsx"),h=e([s,u,p]);function g(e){(0,c.debugLog)("plan.loadPlanToolCallFromUri",{planUri:e});const t=(0,d.X)(e);if(null===t)return(0,c.debugLog)("plan.loadPlanToolCallFromUri.readFailed",{planUri:e}),null;const n=new l.zC({plan:t}),o=new l.bK({result:{case:"success",value:new l.Jo},planUri:e}),r=new l.Ih({args:n,result:o});return(0,c.debugLog)("plan.loadPlanToolCallFromUri.success",{planUri:e}),new i.ToolCall({tool:{case:"createPlanToolCall",value:r}})}[s,u,p]=h.then?(await h)():h;const m=({planUri:e,planDecisionIndex:t,isRepository:n,onLoadFailed:o})=>{const[i,l]=(0,a.useState)("loading");if((0,a.useEffect)((()=>{(0,c.debugLog)("plan.PlanFileBlock.useEffect",{planUri:e});const t=g(e);t?((0,c.debugLog)("plan.PlanFileBlock.loaded",{planUri:e}),l(t)):((0,c.debugLog)("plan.PlanFileBlock.loadFailed",{planUri:e}),l(null),null==o||o())}),[e,o]),null===i)return null;if("loading"===i)return(0,r.jsx)(p.Y,{flexDirection:"column",borderColor:"gray",borderDimColor:!0,children:(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"Loading plan…"})})});const d="createPlanToolCall"===i.tool.case?i.tool.value:null;return d?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(u.U,{tool:d,isSuggestingPlan:!0,planDecisionIndex:t,state:"pending",isRepository:n})}):null};o()}catch(f){o(f)}}))},"./src/components/prompt-bar.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{q:()=>Z});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:fs"),i=n.n(s),l=n("node:path"),a=n.n(l),c=n("../agent-kv/dist/index.js"),d=n("../ink/build/index.js"),u=n("../local-exec/dist/index.js"),p=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),h=n("./src/analytics.ts"),g=n("./src/console-io.ts"),m=n("./src/constants.ts"),f=n("./src/context/agent-state-context.tsx"),v=n("./src/context/sudo-password-context.tsx"),x=n("./src/context/vim-mode-context.tsx"),b=n("./src/debug.ts"),y=n("./src/ephemeral-bridge.ts"),w=n("./src/exit.ts"),j=n("./src/hooks/prompt/use-at-palette.ts"),k=n("./src/hooks/prompt/use-ephemeral.ts"),C=n("./src/hooks/prompt/use-prompt-history.ts"),S=n("./src/hooks/prompt/use-slash-palette.ts"),E=n("./src/hooks/use-sudo-password-requests.ts"),M=n("./src/pending-decision-store.ts"),$=(n("./src/utils/clipboard.ts"),n("./src/utils/command-name.ts")),T=n("./src/utils/input-keys.ts"),I=n("./src/utils/open-browser.ts"),P=n("./src/utils/path-utils.ts"),A=n("./src/components/prompt/decision-dropdown.tsx"),D=n("./src/components/prompt/ephemeral-lines-view.tsx"),_=n("./src/components/prompt/palette-at-list.tsx"),R=n("./src/components/prompt/palette-slash-list.tsx"),L=n("./src/components/prompt/pending-decisions-banner.tsx"),O=n("./src/components/prompt/prompt-footer.tsx"),Y=n("./src/components/text-input.tsx"),F=e([d,A,D,_,R,L,O,Y]);[d,A,D,_,R,L,O,Y]=F.then?(await F)():F;var z=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const B=200,q=(e,t,n)=>{var o,r,s;const i=null!==(r=null===(o=null==n?void 0:n.operation)||void 0===o?void 0:o.details)&&void 0!==r?r:{},l=null!==(s=i.notAllowedCommands)&&void 0!==s?s:[];if(!1!==i.canAllowlist&&l.length>0){const n=`Add ${l.map((e=>`${t}(${e})`)).join(", ")} to allowlist?`;e.push({label:n,hint:"(tab)",action:"allowlistApprove"})}},H=(e,t)=>{var n,o,r;const s=[],i="sandbox-only"===(null==t?void 0:t.type)?"Auto-run in sandbox":"Run Everything",l="disabled"!==(null==t?void 0:t.type);switch(null===(n=null==e?void 0:e.operation)||void 0===n?void 0:n.type){case u.S5.Shell:e.operation.details.isSandboxAvailable?s.push({label:"Run outside sandbox (once)",hint:"(y)",action:"approve"}):s.push({label:"Run (once)",hint:"(y)",action:"approve"}),q(s,"Shell",e),l&&s.push({label:i,hint:"(shift+tab)",action:"autoRunApprove"}),s.push({label:"Skip",hint:"(esc or n)",action:"propose"});break;case u.S5.Mcp:{const t=null===(o=null==e?void 0:e.operation)||void 0===o?void 0:o.details;s.push({label:"Run (once)",hint:"(y)",action:"approve"}),(null==t?void 0:t.toolName)&&(null==t?void 0:t.providerIdentifier)&&s.push({label:"Allowlist MCP Tool",hint:"(tab)",action:"allowlistApprove"}),s.push({label:"Reject & propose changes",hint:"(p)",action:"propose"}),s.push({label:"Skip",hint:"(esc or n)",action:"reject"});break}case u.S5.Delete:s.push({label:"Delete",hint:"(y)",action:"approve"}),s.push({label:"Keep",hint:"(n)",action:"reject"});break;case u.S5.Write:{const t=null===(r=null==e?void 0:e.operation)||void 0===r?void 0:r.details,n="string"==typeof(null==t?void 0:t.path)?t.path:void 0;s.push({label:"Proceed",hint:"(y)",action:"approve"}),s.push({label:"Reject & propose changes",hint:"(esc or n or p)",action:"propose"}),"string"==typeof n&&n.length>0?s.push({label:`Add Write(${(0,P.tk)(n,30)}) to allowlist?`,hint:"(tab)",action:"allowlistApprove"}):s.push({label:"Add to allowlist",hint:"(tab)",action:"allowlistApprove"}),l&&s.push({label:i,hint:"(shift+tab)",action:"autoRunApprove"});break}case M.yB:s.push({label:"Allow search",hint:"(y)",action:"approve"}),l&&s.push({label:i,hint:"(shift+tab)",action:"autoRunApprove"}),s.push({label:"Skip",hint:"(esc or n)",action:"reject"});break;case M.uS:{const t=e.operation.details.domain;s.push({label:"Fetch",hint:"(y)",action:"approve"}),s.push({label:`Always allow ${t}`,hint:"(tab)",action:"allowlistDomainApprove"}),s.push({label:"Skip",hint:"(esc or n)",action:"reject"});break}}return s},W={[u.S5.Shell]:"Run this command?",[u.S5.Mcp]:"Run this MCP tool?",[u.S5.Delete]:"Delete this file?",[u.S5.Write]:"Write to this file?",[M.yB]:"Allow this web search?",[M.uS]:"Allow this web fetch?"},G=e=>{switch(e.operation.type){case u.S5.Mcp:case M.yB:case M.uS:case u.S5.Delete:return"reject";default:return"propose"}},X=p.memo((function({prompt:e,setPrompt:t,placeholder:n,rightPlaceholder:o,ghostText:s,isDisabled:i,onSubmit:l,onTab:a,onShiftTab:c,onCtrlC:u,onCtrlD:p,onCtrlR:h,cursorToEndSignal:g,cursorToStartSignal:m,replaceValueRef:f,onReplace:v,onCursorInfoChange:x,onDownAtLastLine:b,onUpAtFirstLine:y,onPaste:w,focus:j=!0,visualFocus:k=!1,allowExplicitNewline:C,validSlashCommands:S,suppressArrowKeys:E=!1,disableTextInput:M=!1,debounceMs:$=0,onEscape:T}){return i?(0,r.jsx)(d.az,{children:(0,r.jsx)(Y.A,{value:e,onChange:()=>{},onSubmit:()=>{},placeholder:n,rightPlaceholder:o,onTab:()=>{},onShiftTab:()=>{},onCtrlC:()=>{},onCtrlD:()=>{},onCtrlR:()=>{},showCursor:!1,visualFocus:!1,focus:!1,cursorToEndSignal:g,replaceValueRef:f,onReplace:v,onCursorInfoChange:()=>{},onUpAtFirstLine:()=>{},onDownAtLastLine:()=>{},allowExplicitNewline:!1,dimmed:!0,debounceMs:$})}):(0,r.jsx)(d.az,{children:(0,r.jsx)(Y.A,{value:e,onChange:t,onSubmit:l,placeholder:n,rightPlaceholder:o,ghostText:s,onTab:a,onShiftTab:c,onCtrlC:u,onCtrlD:p,onCtrlR:h,showCursor:!0,visualFocus:k,cursorToEndSignal:g,cursorToStartSignal:m,replaceValueRef:f,onReplace:v,onCursorInfoChange:x,onUpAtFirstLine:y,onDownAtLastLine:b,focus:j,onPaste:w,allowExplicitNewline:C,validSlashCommands:S,suppressArrowKeys:E,disableTextInput:M,debounceMs:$,onEscape:T})})})),K="Pasted text",Q=new RegExp(`\\[${U=K,U.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")} #(\\d+)(?: \\+\\d+(?: lines)?)?\\]`,"g"),J=e=>{var t,n;return(null!==(n=null===(t=e.match(/\n/g))||void 0===t?void 0:t.length)&&void 0!==n?n:0)+1},V=(e,t)=>`[${K} #${e} +${J(t)} lines]`;function N(e,t){return 0===t.size?e:e.replace(Q,((e,n)=>{const o=Number(n),r=t.get(o);return null!=r?r:e}))}const Z=({value:e,onChange:t,onSubmit:n,onSubmitShell:o,topStatus:s,topStatusMarginTop:l,inputMode:P="message",isDisabled:Y=!1,isProcessing:F=!1,isSendingToBackground:U=!1,onCtrlC:q,borderColorFocused:K,borderColorBlurred:Q,promptSymbol:J="→",isEmptyChat:Z=!1,onRequestReview:le,onNoReviewAvailable:ae,slashCommands:ue,onBeginRejection:pe,onResumeChat:he,getChatId:ge,onSkipRejectionReason:me,onCancelRejectionReason:fe,onAddToAllowList:ve,onImagesUpdated:xe,onLogout:be,onNewChat:ye,onSummarize:we,onTransferToCloud:je,checkCloudAgentAccess:ke,isCloudHandoffEnabled:Ce=!1,disableModeSwitch:Se=!1,isRepository:Ee=!0,externalCursorToEndSignal:Me,isSuggestingPlan:$e=!1,onExecutePlan:Te,onRejectPlan:Ie,onDiscardPlan:Pe,onCancelPlanRevision:Ae,planDecisionIndex:De=0,onPlanDecisionIndexChange:_e,onShowExistingPlan:Re,isPlanFromFileBlock:Le=!1,onClearPlanFileBlock:Oe,hasPlanToReview:Ye=!1,askQuestionPrompt:Fe=null,onAskQuestionSelectionChange:ze,onAskQuestionSubmit:Ne,onAskQuestionSkip:Ue,switchModePrompt:Be=null,onSwitchModeDecisionIndexChange:qe,onSwitchModeApprove:He,onSwitchModeReject:We,onSendQueuedNow:Ge,onCancelFirstQueued:Xe,onPopLastForEdit:Ke,onClearPoppedForEdit:Qe,onOpenMcpPager:Je,onOpenSandboxPager:Ve,onOpenSkillsPager:Ze,inputDisabled:et=!1,isOverlayActive:tt=!1,onBeforeExit:nt,autoRunAvailability:ot})=>{const{currentModel:rt,mode:st,pendingDecisions:it,setCurrentModel:lt,changedFiles:at,rejectPendingDecision:ct,approvePendingDecision:dt,agentStore:ut,modelManager:pt,queuedMessages:ht,setIsCompact:gt,conversationTokenPercent:mt}=(0,f.C9)(),ft=ht.length>0,{mode:vt,vimEnabled:xt}=(0,x.v)(),{isFocused:bt}=(0,d.iQ)({autoFocus:!0}),{exit:yt}=(0,d.nm)(),wt=(0,v.h)(),{currentRequest:jt}=(0,E.k)(wt),kt=null!==jt,[Ct,St]=(0,p.useState)(!1),[Et,Mt]=(0,p.useState)(null),[$t,Tt]=(0,p.useState)(!1),[It,Pt]=(0,p.useState)(!0),[At,Dt]=(0,p.useState)(!1),[_t,Rt]=(0,p.useState)(!1),[Lt,Ot]=(0,p.useState)({active:!1}),Yt=(0,p.useRef)(null),Ft=(0,p.useRef)(!1);(0,p.useEffect)((()=>{if(!Ct)return;const e=setTimeout((()=>St(!1)),m.kd);return()=>clearTimeout(e)}),[Ct]),(0,p.useEffect)((()=>{Ct&&e.length>0&&(St(!1),Mt(null))}),[e,Ct]);const zt=(0,p.useCallback)(((e=!1)=>{Pt(!1),setTimeout((()=>{z(void 0,void 0,void 0,(function*(){const t=ut.getId(),n=ut.getMetadata("latestRootBlobId");yield ut.dispose(),t&&n.length>0&&(e&&((0,g.p2)("\n  [32m✓ Logout successful[0m"),(0,g.p2)("\n  [90mAuthentication tokens removed.[0m")),(0,g.p2)(`\n  [90mTo resume this session:[0m [1m[36m${(0,$.mf)()} --resume=${t}[0m`)),nt&&(yield nt()),yt(),yield(0,w.GZ)({code:w.yU.SUCCESS})}))}),100)}),[ut,yt,nt]),[Nt,Ut]=(0,p.useState)(0),[Bt,qt]=(0,p.useState)(0),Ht=(0,p.useRef)(null),[Wt,Gt]=(0,p.useState)(!0),[Xt,Kt]=(0,p.useState)(0),Qt=(0,p.useRef)(!1),Jt=(0,k.N)(),{set:Vt,clear:Zt}=Jt,en=(0,C.a)(),tn=(0,p.useRef)(0),nn=(0,p.useRef)(e),on=(0,p.useRef)(0);(0,p.useEffect)((()=>((0,y.al)((e=>{Vt(e)})),()=>(0,y.al)(null))),[Vt]),(0,p.useEffect)((()=>{on.current=Jt.lines.length}),[Jt.lines.length]);const rn=e=>e.length>0&&!e.endsWith(" ")?`${e} `:e;let sn="none";const ln=()=>{if("none"!==sn&&!en.inHistory)return;if(0===e.length&&Ke){const e=Ke();if(e)return xn(e),void Ut((e=>e+1))}if(null==Qe||Qe(),(()=>{const t=en.begin(e);if(null==t)return!1;const n=rn(t);return Jt.preserveNextClear(),xn(n),qt((e=>e+1)),!0})())return;const t=en.up();if(null!=t){const e=rn(t);Jt.preserveNextClear(),xn(e),qt((e=>e+1))}},an=()=>{("none"===sn||en.inHistory)&&en.inHistory&&(()=>{if("none"!==sn&&!en.inHistory)return;const t=en.down(e);if(!t)return;const n=rn(t.value);Jt.preserveNextClear(),xn(n),Ut((e=>e+1)),t.exited&&(Qt.current=!0)})()},cn=()=>{at.length>0?null==le||le():null==ae||ae()},dn=()=>{m.hD&&cn()},un=(0,j.g)(e,en.inHistory),pn=(0,p.useRef)((()=>{})),hn=(0,p.useRef)((e=>e)),gn=(0,p.useRef)(((e,t)=>t)),mn=(0,p.useCallback)((e=>{on.current>0&&!e.startsWith("/")&&e.trim().length>0&&Zt(),t(e),pn.current(e)}),[Zt,t]),fn=(0,p.useRef)(!1),vn=(0,p.useCallback)((t=>{if(!e&&"!"===t)return Dt(!0),mn(""),void Ut((e=>e+1));if(!e&&"&"===t&&Ee&&Ce)return ke?z(void 0,void 0,void 0,(function*(){var e;const t=yield ke();t.hasAccess?Rt(!0):Ot({active:!0,setupUrl:null!==(e=t.setupUrl)&&void 0!==e?e:"https://cursor.com/dashboard?tab=cloud-agents"})})):Rt(!0),mn(""),void Ut((e=>e+1));t.includes("")&&(t=t.replace(/\x1f/g,""));const n=Date.now(),o=nn.current,r=fn.current,s=((e,t)=>{if(e===t)return null;let n=0;const o=Math.min(e.length,t.length);for(;n<o&&e[n]===t[n];)n++;let r=e.length-1,s=t.length-1;for(;r>=n&&s>=n&&e[r]===t[s];)r--,s--;const i=s+1;return n>i?null:{start:n,end:i}})(o,t),i=r&&null!=s?hn.current(t,null!=s?s:void 0):t;mn(i),r&&(fn.current=!1),tn.current=n,nn.current=i,en.inHistory&&en.reset(),Qt.current=!1}),[mn,en,e,Ee,ke,Ce]),xn=(0,p.useCallback)((e=>{Ht.current?Ht.current(e):mn(e)}),[mn]),bn=(0,p.useCallback)((e=>z(void 0,void 0,void 0,(function*(){he?yield he(e):Vt([[{text:`Resuming chat ${e}...`,color:"cyan"}]])}))),[he,Vt]),yn=(0,p.useMemo)((()=>({onModelChange:lt,insertText:e=>xn(e),print:(e,t)=>{Vt(e,t)},onHistoryCleared:()=>en.clearAllLocal(),exit:e=>zt(e),onResumeChat:bn,getChatId:ge,logout:be,onNewChat:ye,onSummarize:we,onTransferToCloud:je,onOpenMcpPager:Je,onOpenSandboxPager:Ve,onOpenSkillsPager:Ze,onExecutePlan:Te,onShowExistingPlan:Re,submitMessage:(e,t)=>{const o=N(e,Bn.current);en.record(o),n(o,t),Zt()}})),[lt,xn,Vt,en,zt,bn,ge,be,ye,we,je,Je,Ve,Ze,Te,Re,n,Zt]),wn=(0,S.e)(e,ue,yn,en.inHistory,Xt),jn=(0,p.useMemo)((()=>new Set(ue.map((e=>e.id.toLowerCase())))),[ue]),kn=(0,p.useMemo)((()=>{var t,n;if(!wn.active||0===wn.items.length)return;const o=wn.items[wn.index];if(!o)return;const r=e.startsWith("/")?e.slice(1):"",s=r.split(/\s+/).filter(Boolean),i=null!==(n=null===(t=s[0])||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:"";return o.identifier.toLowerCase()===i&&o.ghostText&&1===s.length&&!r.endsWith(" ")?` ${o.ghostText}`:void 0}),[wn.active,wn.items,wn.index,e]),Cn=(()=>{var e;if(Ct||$t)return"gray";if(_t||Lt.active)return"magenta";if(At)return"yellow";if(K||Q)return null!==(e=null!=K?K:Q)&&void 0!==e?e:"foreground";switch(P){case"ask-question":case"switch-mode":case"plan-revision":return"cyan";case"decision":return"yellow";case"rejection-reason":return"red";default:return"foreground"}})(),Sn=(0,p.useCallback)((()=>({onModelChange:lt,insertText:e=>{""===e&&Jt.preserveNextClear(),xn(e)},enterShellMode:()=>{Dt(!0),xn(""),Ut((e=>e+1))},clearInput:()=>{Jt.preserveNextClear(),xn("")},print:(e,t)=>Jt.set(e,t),exit:e=>zt(e),onHistoryCleared:()=>en.clearAllLocal(),onResumeChat:bn,getChatId:ge,logout:be,onNewChat:ye,onSummarize:we,onTransferToCloud:je,submitMessage:(e,t)=>{const o=N(e,Bn.current);xn(""),n(o,t)},onOpenMcpPager:Je,onOpenSandboxPager:Ve,onOpenSkillsPager:Ze,onExecutePlan:Te,onShowExistingPlan:Re})),[xn,zt,bn,n,Jt,en,lt,be,ye,we,je,Te,Re,ge,Je,Ve,Ze]),En=(0,p.useCallback)((e=>{var t;let n,o=!1;if(e.startsWith("/"))n=e.slice(1);else{const r=/^(.*?)(\s+)\/(\S.*)$/.exec(e);if(!r)return null;n=null!==(t=r[3])&&void 0!==t?t:"",o=!0}const r=n.split(/\s+/).filter(Boolean),s=r[0]||"",i=r.slice(1),l=ue.find((e=>e.id.toLowerCase()===s.toLowerCase())),a=((null==l?void 0:l.args)||[]).filter((e=>!1!==e.required)).length,c=!(!l||o&&!0!==l.inline);return{cmdId:s,args:i,required:a,hasCmd:c,isInline:o}}),[ue]),Mn=(0,p.useCallback)((e=>{const t=En(e);return Boolean((null==t?void 0:t.hasCmd)&&t.args.length>=t.required)}),[En]),$n=(0,p.useCallback)((e=>z(void 0,void 0,void 0,(function*(){const t=yield wn.runIfExecutable(e,ue,Sn(),(e=>Tt(e)));return"unknown"!==t&&("executed"===t&&(yield en.record(e)),"handled"===t||"executed"===t)}))),[wn,ue,Sn,en]),Tn=(0,p.useCallback)((e=>z(void 0,void 0,void 0,(function*(){var t,r;if(0===e.trim().length&&ft&&Ge)return void(yield Ge());if(At&&0===e.trim().length)return;if(un.active){const t=un.acceptExpansion(e);if(null!=t){const n=gn.current(e,t);return xn(n),void Ut((e=>e+1))}}if(wn.active){const t=wn.acceptExpansion(e);if(null!=t&&t!==e&&(t!==`${e} `||!Mn(e)))return xn(t),void Ut((e=>e+1))}if(e.startsWith("/")){if(wn.active,Mn(e)){const n=En(e);if((!n||"help"!==n.cmdId.toLowerCase()||0!==n.args.length)&&!(wn.active&&(null===(t=wn.items[wn.index])||void 0===t?void 0:t.identifier)&&e.trimEnd().endsWith(wn.items[wn.index].identifier))&&(yield $n(e)))return}{const t=En(e);if((!t||"help"!==t.cmdId.toLowerCase()||0!==t.args.length)&&(yield $n(e)))return;if((null==t?void 0:t.hasCmd)&&"help"===t.cmdId.toLowerCase()&&0===t.args.length&&!e.endsWith(" "))return xn(`${e} `),void Ut((e=>e+1))}const n=En(e);if((null==n?void 0:n.hasCmd)&&n.args.length<n.required&&!e.endsWith(" "))return xn(`${e} `),void Ut((e=>e+1))}if(/^(.*?)(\s+)\/(\S.*)$/.exec(e)&&(yield $n(e)))return;const s=e.trim();if("quit"===s||"exit"===s)return void zt(!1);const i=N(e,Bn.current);"plan-revision"!==P&&en.record(i);let l=!1;if(At){if(!o)return void Jt.set(["Shell mode isn't available in this context.","Press Esc to exit shell mode or submit a normal message."]);Dt(!1),xn(""),Ut((e=>e+1)),l=!0,yield o(i)}else{if(Lt.active){const e=null!==(r=Lt.setupUrl)&&void 0!==r?r:"https://cursor.com/dashboard?tab=cloud-agents";try{yield(0,I.ph)(e)}catch(e){Jt.set([`Failed to open setup: ${String(e)}`])}return Ot({active:!1}),xn(""),void Ut((e=>e+1))}if(_t){if(!je)return void Jt.set(["Cloud transfer isn't available in this context.","Press Esc to exit cloud transfer mode or submit a normal message."]);Rt(!1),xn(""),Ut((e=>e+1)),l=!0,yield je(i||void 0)}else n(i,{display:e})}Jt.clear(),setTimeout((()=>{un.hide(),wn.hide(),l&&Nn.current.size>0&&(Nn.current.clear(),Un.current=[],null==xe||xe([]))}),0)}))),[un,wn,Jt,xe,en,n,o,je,At,_t,Lt,zt,xn,P,Mn,En,$n,ft,Ge]),In=(0,p.useCallback)((e=>{Tn(e).catch((e=>{(0,b.debugLog)("handleSubmitVoid error",e)}))}),[Tn]),Pn=(0,p.useRef)(0),An=(0,p.useCallback)((()=>{const t=Date.now();if("at"===sn&&un.active){if(t-Pn.current<B)return;const n=un.acceptExpansion(e);if(null!=n){const t=gn.current(e,n);return xn(t),Ut((e=>e+1)),Pn.current=Date.now(),void(en.inHistory&&en.reset())}}if("slash"===sn&&wn.active){if(t-Pn.current<B)return;const n=wn.acceptExpansion(e);if(null!=n)return xn(n),Ut((e=>e+1)),Pn.current=Date.now(),void(en.inHistory&&en.reset())}if("/"===e&&wn.active&&wn.items.length>0){const t=wn.acceptExpansion(e);if(null!=t)return xn(t),Ut((e=>e+1)),void(en.inHistory&&en.reset())}if(e.startsWith("/")&&!e.endsWith(" ")&&!Mn(e))return xn(`${e} `),void Ut((e=>e+1))}),[un,e,wn,xn,Mn,sn,en]),Dn=(0,p.useCallback)((()=>{if(Ct)return xn(""),null==q||q(),void zt();if((0,b.debugLog)("handleCtrlC",P),"decision"!==P){if("plan-revision"===P)return null==Pe||Pe(),t(""),un.hide(),wn.hide(),void en.reset();if($e)return t(""),null==Ie||Ie(),void(null==q||q());if(At)return Dt(!1),xn(""),un.hide(),wn.hide(),void en.reset();if(_t)return Rt(!1),xn(""),un.hide(),wn.hide(),void en.reset();if(Lt.active)return Ot({active:!1}),xn(""),un.hide(),wn.hide(),void en.reset();if("rejection-reason"===P)return null==me||me(),t(""),un.hide(),wn.hide(),void en.reset();if(e.length>0)return Jt.preserveNextClear(),xn(""),un.hide(),wn.hide(),en.reset(),St(!0),Mt("ctrlC"),void(0,h.B5)();if((0,b.debugLog)("handleCtrlC isProcessing",F),(0,b.debugLog)("handleCtrlC exitMode",Ct),F)return null==q||q(),St(!0),Mt("ctrlC"),void(0,h.B5)();St(!0),Mt("ctrlC"),(0,h.B5)()}}),[P,$e,At,_t,Lt.active,e.length,F,Ct,Pe,Ie,t,un,wn,en,q,xn,me,Jt,zt]),_n=(0,p.useCallback)((()=>{if(Ct||!F)return xn(""),null==q||q(),void zt();null==q||q(),St(!0),Mt("ctrlD"),(0,h.B5)()}),[Ct,F,zt,xn,q]),Rn=0===e.length,Ln="ctrlD"===Et?"Press Ctrl+D again to exit":"ctrlC"===Et?"Press Ctrl+C again to exit":void 0;sn=un.active?"at":wn.active?"slash":"none",(0,p.useEffect)((()=>{0===e.length&&(un.hide(),wn.hide(),en.reset())}),[e,un,wn,en]),wn.active||j.q.test(e)&&un.active;const On="decision"===P&&it.length>0,Yn=null!==Be||null!==Fe,[Fn,zn]=(0,p.useState)(0);(0,p.useEffect)((()=>{On&&!Ft.current&&null==Yt.current&&e.length>0&&(Yt.current=e,t("")),!On&&Ft.current&&"message"===P&&0===e.length&&null!=Yt.current&&(t(Yt.current),Yt.current=null),Ft.current=On}),[On,P,e,t]),(0,p.useEffect)((()=>{"message"!==P||On||0!==e.length||null==Yt.current||(t(Yt.current),Yt.current=null)}),[P,On,e,t]);const Nn=(0,p.useRef)(new Map),Un=(0,p.useRef)([]),Bn=((0,p.useRef)(0),(0,p.useRef)(new Map)),qn=(0,p.useRef)(1);(0,p.useEffect)((()=>{0===e.length&&Nn.current.size>0&&(Nn.current.clear(),Un.current=[],null==xe||xe([]))}),[e.length,xe]);const Hn=(0,p.useCallback)((e=>{const t=Nn.current.get(e);if(t)return t;const n=`@image[${a().basename(e).replace(/\s+/g,"_").replace(/[^A-Za-z0-9._-]/g,"")}]`;return Nn.current.set(e,n),Un.current.push(e),null==xe||xe(Un.current.map((e=>({token:Nn.current.get(e),path:e})))),n}),[xe]),Wn=(0,p.useCallback)((e=>{const t=new Set;for(const n of e.matchAll(/@image\[[^\]]+\]/g))t.add(n[0]);const n=Nn.current,o=[];for(const e of Un.current){const r=n.get(e);r&&t.has(r)&&o.push(e)}const r=new Map;for(const e of o){const t=n.get(e);r.set(e,t)}Nn.current=r,Un.current=o.slice(),null==xe||xe(Un.current.map((e=>({token:Nn.current.get(e),path:e}))))}),[xe]);pn.current=Wn;const Gn=(0,p.useCallback)(((e,t)=>{var n,o,r,s,l,a,c,d,u,p,h,g,m,f,v;if(!te(e))return e;let x=0;const b=e=>{if(x>=64)return e;const t=de(e),n=new Set([t]);n.add(t.replace(/\u00A0/g," ")),n.add(t.replace(/\u202F/g," ")),t.includes(" ")&&(n.add(t.replace(/ /g," ")),n.add(t.replace(/ /g," ")));let o=null;for(const e of n)try{if(i().existsSync(e)){o=e;break}}catch(e){}if(!o){if(!ce(t))return e;o=t}const r=Hn(o);return x++,r},y=[],w=(e,n)=>!t||n>t.start&&e<t.end;for(const t of e.matchAll(ie)){const e=null!==(n=t.index)&&void 0!==n?n:0,s=null!==(o=t[1])&&void 0!==o?o:"",i=null!==(r=t[2])&&void 0!==r?r:"",l=e+s.length,a=l+i.length;w(l,a)&&y.push({start:l,end:a,path:i.replace(/'\s'/g," ")})}for(const t of e.matchAll(ne)){const e=null!==(s=t.index)&&void 0!==s?s:0,n=null!==(l=t[0])&&void 0!==l?l:"",o=null!==(a=t[1])&&void 0!==a?a:"",r=e,i=e+n.length;w(r,i)&&y.push({start:r,end:i,path:o})}for(const t of e.matchAll(oe)){const e=null!==(c=t.index)&&void 0!==c?c:0,n=null!==(d=t[0])&&void 0!==d?d:"",o=null!==(u=t[1])&&void 0!==u?u:"",r=e,s=e+n.length;w(r,s)&&y.push({start:r,end:s,path:o})}for(const t of e.matchAll(re)){const e=null!==(p=t.index)&&void 0!==p?p:0,n=null!==(h=t[1])&&void 0!==h?h:"",o=null!==(g=t[2])&&void 0!==g?g:"",r=e+n.length,s=r+o.length;w(r,s)&&y.push({start:r,end:s,path:o})}for(const t of e.matchAll(se)){const e=null!==(m=t.index)&&void 0!==m?m:0,n=null!==(f=t[1])&&void 0!==f?f:"",o=null!==(v=t[2])&&void 0!==v?v:"",r=e+n.length,s=r+o.length;w(r,s)&&y.push({start:r,end:s,path:o})}if(0===y.length)return e;y.sort(((e,t)=>e.start-t.start||t.end-t.start-(e.end-e.start)));const j=[];let k=-1;for(const e of y)e.start<k||(j.push(e),k=e.end);let C="",S=0;for(const t of j)S<t.start&&(C+=e.slice(S,t.start)),C+=b(t.path),S=t.end;return C+=e.slice(S),C=C.replace(/(@image\[[^\]]+\])(?!\s)/g,"$1 "),C}),[Hn]);hn.current=Gn;const Xn=(0,p.useCallback)(((e,t)=>{var n,o,r;const s=((e,t)=>{if(e===t)return null;let n=0;const o=Math.min(e.length,t.length);for(;n<o&&e[n]===t[n];)n++;let r=e.length-1,s=t.length-1;for(;r>=n&&s>=n&&e[r]===t[s];)r--,s--;const i=s+1;return n>i?null:{start:n,end:i}})(e,t);if(null==s)return t;const l=new RegExp(String.raw`@((?:file://)?[^\s'"()]+?\.(${ee.join("|")}))`,"gi"),a=[];for(const e of t.matchAll(l)){const t=null!==(n=e.index)&&void 0!==n?n:0,i=null!==(o=e[0])&&void 0!==o?o:"",l=null!==(r=e[1])&&void 0!==r?r:"",c=t,d=t+i.length;d>s.start&&c<s.end&&a.push({start:c,end:d,path:l})}if(0===a.length)return t;a.sort(((e,t)=>e.start-t.start||t.end-e.end));const c=[];let d=-1;for(const e of a)e.start<d||(c.push(e),d=e.end);let u="",p=0;for(const e of c){p<e.start&&(u+=t.slice(p,e.start));const n=de(e.path);let o=null;const r=new Set([n]);r.add(n.replace(/\u00A0/g," ")),r.add(n.replace(/\u202F/g," "));try{for(const e of r)if(i().existsSync(e)){o=e;break}}catch(e){}!o&&ce(n)&&(o=n),u+=o?Hn(o):t.slice(e.start,e.end),p=e.end}return u+=t.slice(p),u=u.replace(/(@image\[[^\]]+\])(?!\s)/g,"$1 "),u}),[Hn]);gn.current=Xn,(0,d.Ge)(((n,o)=>{var r,s,i;const l=(0,T.Po)(n,o),a=(0,T.u$)(n,o),c=(0,T.xv)(n,o),d=o.ctrl&&("d"===n||"D"===n)||""===n;if(d&&Rn)return void _n();if(Be){const e=Be.decisionIndex;if(l)return void(null==qe||qe(Math.max(0,e-1)));if(a)return void(null==qe||qe(Math.min(1,e+1)));if(o.return)return void(0===e?null==He||He():null==We||We());if("y"===n||"Y"===n)return void(null==He||He());const t=c||o.ctrl&&("c"===n||"C"===n);return"n"===n||"N"===n||t?void(null==We||We()):void 0}if(Fe){const{args:e,selection:t}=Fe,s=e.questions,i=s[t.activeQuestionIndex];if(!i)return;const d=i.options.length,u=o.rightArrow||o.tab&&!o.shift,p=o.leftArrow||o.tab&&o.shift,h=t.activeQuestionIndex===s.length-1,g=(e,t)=>{var n;return 0===e.options.length||(null!==(n=t[e.id])&&void 0!==n?n:[]).length>0},m=e=>s.every((t=>g(t,e))),f=(e,n,o)=>{var r;const i=s[e];if(!i)return t;const l=null!==(r=n[i.id])&&void 0!==r?r:[];if(o)return Object.assign(Object.assign({},t),{selectionsByQuestionId:n,activeQuestionIndex:e,activeOptionIndex:0});const a=Math.max(0,Math.min(i.options.length-1,t.activeOptionIndex)),c=l.length>0?i.options.findIndex((e=>l.includes(e.id))):-1,d=c>=0?Math.min(i.options.length-1,c):a;return Object.assign(Object.assign({},t),{selectionsByQuestionId:n,activeQuestionIndex:e,activeOptionIndex:d})},v=(e,t,n)=>{const o=f(e,t,n);null==ze||ze(o)},x=e=>{h?m(e)&&(null==Ne||Ne()):v(t.activeQuestionIndex+1,e,!0)},b=(e,t,n,o)=>n?"toggle"===o?e.includes(t)?e.filter((e=>e!==t)):[...e,t]:e.includes(t)?e:[...e,t]:[t];if(u||p){const e=u?1:-1,n=Math.max(0,Math.min(s.length-1,t.activeQuestionIndex+e));return void v(n,t.selectionsByQuestionId,u)}if("s"===n||"S"===n)return void(null==Ne||Ne());const y=c||o.ctrl&&("c"===n||"C"===n);if("k"===n||"K"===n||y)return void(null==Ue||Ue());if(0===d)return void(o.return&&x(t.selectionsByQuestionId));if(l){const e=Object.assign(Object.assign({},t),{activeOptionIndex:Math.max(0,t.activeOptionIndex-1)});return void(null==ze||ze(e))}if(a){const e=Object.assign(Object.assign({},t),{activeOptionIndex:Math.min(d-1,t.activeOptionIndex+1)});return void(null==ze||ze(e))}if(o.return||" "===n){const e=i.options[t.activeOptionIndex];if(!e)return;const n=null!==(r=t.selectionsByQuestionId[i.id])&&void 0!==r?r:[],s=b(n,e.id,i.allowMultiple,o.return?"select":"toggle"),l=s===n?t.selectionsByQuestionId:Object.assign(Object.assign({},t.selectionsByQuestionId),{[i.id]:s});if(o.return)return h?(l!==t.selectionsByQuestionId&&(null==ze||ze(Object.assign(Object.assign({},t),{selectionsByQuestionId:l}))),void x(l)):void x(l);const a=Object.assign(Object.assign({},t),{selectionsByQuestionId:l});return void(null==ze||ze(a))}return}if($e){const e=""===n||o.ctrl&&("c"===n||"C"===n),r=c||o.ctrl&&("c"===n||"C"===n),s=("p"===n||"P"===n)&&!o.ctrl||"3"===n&&Ee||"2"===n&&!Ee;if(Le&&(e||c))return t(""),void(null==Oe||Oe());if(s)return t(""),null==Ie||Ie(),void(null==q||q());if(!Le&&r)return t(""),null==Ie||Ie(),void(null==q||q());if(e)return;const i=Ee?2:1;return l?void(null==_e||_e(Math.max(0,(null!=De?De:0)-1))):a?void(null==_e||_e(Math.min(i,(null!=De?De:0)+1))):o.return&&o.shift&&Ee?(t(""),void(null==Te||Te({cloud:!0}))):o.return?void(0===De?(t(""),null==Te||Te()):1===De&&Ee?(t(""),null==Te||Te({cloud:!0})):(t(""),null==Ie||Ie(),null==q||q())):"b"!==n&&"B"!==n&&"1"!==n||o.ctrl?"c"!==n&&"C"!==n&&"2"!==n||!Ee||o.ctrl?void 0:(t(""),void(null==Te||Te({cloud:!0}))):(t(""),void(null==Te||Te()))}if(d&&"decision"===P)return;const p=""===n,h=o.ctrl&&"/"===n,g=o.meta&&"/"===n;if(p||h||g)return e.includes("")&&xn(e.replace(/\x1f/g,"")),void z(void 0,void 0,void 0,(function*(){try{const e=yield pt.awaitAvailableModels(),t=yield pt.awaitCurrentModel();if(0===e.length)return;const n=t.modelId,o=Math.max(0,e.findIndex((e=>e.modelId===n))),r=e[(o+1)%e.length];if(!r||r.modelId===n)return;lt(r)}catch(e){}}));if(""===n||o.ctrl&&("y"===n||"Y"===n))return e.includes("")&&xn(e.replace(/\u0019/g,"")),void $n("/resume");if(""===n||o.ctrl&&("o"===n||"O"===n))return e.includes("")&&xn(e.replace(/\u000f/g,"")),void gt((e=>!e));switch(P){case"decision":{if(0===it.length)return;const e=it[0],r=xt&&"normal"===vt&&("j"===n||"J"===n),d=xt&&"normal"===vt&&("k"===n||"K"===n),p=H(e,ot),h=p.length;if(a||r)return void zn((e=>Math.min(e+1,h-1)));if(l||d)return void zn((e=>Math.max(e-1,0)));if(c)return"reject"===G(e)?ct(e.id,void 0):null==pe||pe(e.id),t(""),void zn(0);if(m.hD&&(o.ctrl&&("r"===n||"R"===n)||""===n)&&at.length>0)return void cn();const g=""===n;if(o.ctrl&&"c"===n||g)return ct(e.id,void 0),t(""),void zn(0);if(xt&&"normal"===vt&&("q"===n||"Q"===n))return ct(e.id,void 0),t(""),void zn(0);if("y"===n||"Y"===n)return dt(e.id),t(""),void zn(0);if("n"===n||"N"===n)return"reject"===G(e)?ct(e.id,void 0):null==pe||pe(e.id),t(""),void zn(0);if("p"===n||"P"===n)return null==pe||pe(e.id),t(""),void zn(0);if(o.tab&&o.shift){if(Se)return;if("disabled"===(null==ot?void 0:ot.type))return;ut.setMetadata("mode","auto-run");for(const e of it)dt(e.id);return t(""),void zn(0)}if(o.tab&&!o.shift){const n=e.operation.type;if(n===u.S5.Shell){const t=null!==(s=e.operation.details.notAllowedCommands)&&void 0!==s?s:[];for(const e of t)null==ve||ve("Shell",e);(0,b.debugLog)("allowlist-requested",Object.assign(Object.assign({},e.operation),{patterns:t}))}else if(n===u.S5.Write){const t=e.operation.details.path;null==ve||ve("Write",t),(0,b.debugLog)("allowlist-requested",e.operation)}else if(n===u.S5.Mcp){const t=e.operation.details;if((null==t?void 0:t.toolName)&&(null==t?void 0:t.providerIdentifier)){const e=`${t.providerIdentifier}:${t.toolName}`;null==ve||ve("Mcp",e),(0,b.debugLog)("mcp-allowlist-requested",{identifier:e})}}else if(n===M.uS){const t=e.operation.details.domain;null==ve||ve("WebFetch",t),(0,b.debugLog)("webfetch-domain-allowlist-requested",{domain:t})}return dt(e.id),t(""),void zn(0)}if(o.return){const n=p[Fn];if(!n)return;switch(n.action){case"approve":return dt(e.id),t(""),void zn(0);case"reject":return ct(e.id,void 0),t(""),void zn(0);case"propose":return null==pe||pe(e.id),t(""),void zn(0);case"allowlistApprove":if(e.operation.type===u.S5.Shell){const t=null!==(i=e.operation.details.notAllowedCommands)&&void 0!==i?i:[];for(const e of t)null==ve||ve("Shell",e);(0,b.debugLog)("allowlist-requested",Object.assign(Object.assign({},e.operation),{patterns:t}))}else if(e.operation.type===u.S5.Mcp){const t=e.operation.details;if((null==t?void 0:t.toolName)&&(null==t?void 0:t.providerIdentifier)){const e=`${t.providerIdentifier}:${t.toolName}`;null==ve||ve("Mcp",e),(0,b.debugLog)("mcp-allowlist-requested",{identifier:e})}}else if(e.operation.type===u.S5.Write){const t=e.operation.details.path;null==ve||ve("Write",t),(0,b.debugLog)("allowlist-requested",e.operation)}return dt(e.id),t(""),void zn(0);case"allowlistDomainApprove":if(e.operation.type===M.uS){const t=e.operation.details.domain;null==ve||ve("WebFetch",t),(0,b.debugLog)("webfetch-domain-allowlist-requested",{domain:t})}return dt(e.id),t(""),void zn(0);case"autoRunApprove":ut.setMetadata("mode","auto-run");for(const e of it)dt(e.id);return t(""),void zn(0);default:return}}return}case"message":if(At&&0===e.length&&c)return void Dt(!1);if(At&&0===e.length&&(o.backspace||o.delete))return void Dt(!1);if(_t&&0===e.length&&c)return void Rt(!1);if(_t&&0===e.length&&(o.backspace||o.delete))return void Rt(!1);if(Lt.active&&c)return void Ot({active:!1});if(Lt.active&&0===e.length&&(o.backspace||o.delete))return void Ot({active:!1});switch(sn){case"slash":{if(!wn.active||0===wn.items.length)return;const t=xt&&"normal"===vt&&"j"===n,r=xt&&"normal"===vt&&"k"===n;return m.hD&&(o.ctrl&&("r"===n||"R"===n)||""===n)?void dn():a||t?void wn.next():l||r?void wn.prev():c?("/"===e&&xn(""),void wn.hide()):void 0}case"at":{if(!un.active||0===un.suggestions.length)return;const e=xt&&"normal"===vt&&"j"===n,t=xt&&"normal"===vt&&"k"===n;return m.hD&&(o.ctrl&&("r"===n||"R"===n)||""===n)?void dn():a||e?void un.next():l||t?void un.prev():c?void un.suppress():void 0}default:if(c&&en.inHistory)return void en.reset()}if(c&&0===e.length&&ft&&Xe)return void Xe();if(m.hD&&(o.ctrl&&("r"===n||"R"===n)||""===n))return void dn();if(xt&&"normal"===vt){if("k"===n&&"none"===sn)return void ln();if("j"===n)return void an()}return;case"rejection-reason":return c||(o.backspace||o.delete)&&0===e.length?(null==fe||fe(),void t("")):void 0;case"plan-revision":return c?(null==Ae||Ae(),void t("")):void 0;default:return}}),{isActive:!tt&&(bt||"decision"===P||"rejection-reason"===P||"plan-revision"===P||"none"!==sn||!!$e||ft)});const Kn="none"!==sn,Qn=(0,p.useDeferredValue)(at.length),Jn=(0,p.useDeferredValue)(mt),Vn=(0,p.useDeferredValue)(wn.items),Zn=(0,p.useDeferredValue)(un.suggestions),eo=(0,p.useMemo)((()=>{if(null==Jn)return;const e=Jn.toFixed(1);return e.endsWith(".0")?`${Math.round(Jn)}%`:`${e}%`}),[Jn]);return It?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.az,{marginTop:null!=l?l:0,marginBottom:0,marginX:1,paddingLeft:1,children:null!=s?s:(0,r.jsx)(d.EY,{children:" "})}),it.length>0&&(0,r.jsx)(L.A,{decisions:it}),(0,r.jsxs)(d.az,{display:"true"===process.env.AGENT_CLI_HIDE_PROMPT_BAR&&0===it.length||$e||Yn?"none":"flex",flexDirection:"column",borderColor:Cn,borderTop:!0,borderStyle:"single",paddingLeft:1,marginX:1,children:[On?(()=>{var e;const t=it[0],n=t.operation.type,o=H(t,ot).map((e=>({label:e.label,hint:e.hint,disabled:e.disabled})));let s=null!==(e=W[n])&&void 0!==e?e:"Proceed with this edit?";t.operation.type===u.S5.Shell&&(s=t.operation.details.isSandboxAvailable?"Run this command outside the sandbox?":"Run this command?");const i=t.operation.type===u.S5.Shell?String(t.operation.details.reason):t.operation.type===u.S5.Write?`in ${String(t.operation.details.path)}`:void 0;return(0,r.jsx)(A.A,{title:s,highlightColor:Cn,options:o,selectedIndex:Fn,subtitle:i})})():null,(0,r.jsxs)(d.az,{flexDirection:"row",display:On||$e||Yn?"none":"flex",children:[(0,r.jsxs)(d.EY,{color:_t||Lt.active?"magenta":At?"yellow":"foreground",dimColor:!_t&&!Lt.active&&!At&&0===e.length,children:[_t||Lt.active?"&":At?"!":J," "]}),(0,r.jsx)(d.az,{flexGrow:1,children:(0,r.jsx)(X,{prompt:e,setPrompt:vn,placeholder:(()=>{var e;switch(P){case"ask-question":return"Answer questions (Enter to select/next, Esc to skip)";case"switch-mode":return"Approve mode switch (y/n)";case"decision":return"Waiting for decision (y/n/p)...";case"rejection-reason":return"Reason for rejection (Enter to submit, Esc to cancel)";case"plan-revision":return"Describe how to revise the plan (Enter to submit, Esc to cancel)";default:return At?("number"==typeof(null===(e=process.stdout)||void 0===e?void 0:e.columns)?process.stdout.columns:80)>=50?"Run a command — e.g., "+(Ee?"git status":"ls"):"Run a command":Ye&&!Z?"Add a follow-up — /plan to review and build":Z?"Plan, search, build anything":"Add a follow-up"}})(),rightPlaceholder:F?"ctrl+c to stop":xt?"insert"===vt?"INSERT":"NORMAL":void 0,ghostText:kn,isDisabled:Y||tt,onSubmit:In,onTab:An,onShiftTab:"decision"===P||Se||Yn?void 0:()=>{const e=c.yj.slice();if(Z&&m.xZ&&Ee||e.splice(e.indexOf("background"),1),m.S8||e.splice(e.indexOf("plan"),1),"disabled"===(null==ot?void 0:ot.type)){const t=e.indexOf("auto-run");-1!==t&&e.splice(t,1)}const t=ut.getMetadata("mode"),n=e.indexOf(t),o=e[(n+1)%e.length];ut.setMetadata("mode",o)},onCtrlC:Dn,onCtrlD:Rn?_n:void 0,onCtrlR:dn,visualFocus:"decision"===P&&it.length>0,cursorToEndSignal:Nt+(null!=Me?Me:0),cursorToStartSignal:Bt,replaceValueRef:Ht,onReplace:mn,onCursorInfoChange:({offset:e,isAtLastLine:t})=>{Kt(e),Gt(t)},onUpAtFirstLine:()=>{(en.inHistory||"none"===sn)&&ln()},onDownAtLastLine:an,onPaste:({kind:e,content:t})=>{try{const n=t,o=n.includes("\t")?n.replace(/\t/g,"  "):n,r=o.slice(0,64),s=Array.from(r).map((e=>e.charCodeAt(0).toString(16).padStart(2,"0"))).join(" ");if((0,b.debugLog)("paste-event",{kind:e,length:o.length,preview:r,hexSample:s}),o.length>800){const e=qn.current++;return Bn.current.set(e,o),V(e,o)}if(o.length,o.length>0){const e=(e=>{if(!te(e))return[];const t=[];for(const n of e.matchAll(ne))n[1]&&t.push(n[1]);for(const n of e.matchAll(oe))n[1]&&t.push(n[1]);for(const n of e.matchAll(re))n[2]&&t.push(n[2]);for(const n of e.matchAll(se))n[2]&&t.push(n[2]);for(const n of e.matchAll(ie))n[2]&&t.push(n[2].replace(/'\s'/g," "));return t})(o);e.length>0&&(fn.current=!0)}}catch(e){(0,b.debugLog)("paste-event-error",String(e))}return t.includes("\t")?t.replace(/\t/g,"  "):null},allowExplicitNewline:!0,focus:"decision"!==P&&!$e&&!Yn&&!kt,validSlashCommands:jn,suppressArrowKeys:"none"!==sn||et,disableTextInput:et,onEscape:"plan-revision"===P?()=>!0:void 0})})]})]}),m.hD&&On&&at.length>0?(0,r.jsx)(d.az,{marginTop:0,marginX:2,justifyContent:"flex-end",children:(0,r.jsx)(d.EY,{color:"gray",dimColor:!0,children:"ctrl+r to review changed files"})}):null,"message"===P&&"none"===sn&&!$e&&!Yn&&"true"!==process.env.AGENT_CLI_HIDE_PROMPT_BAR&&(0,r.jsx)(O.A,{show:!0,hasText:e.length>0,exitMode:Ct,modelLabel:(null==rt?void 0:rt.displayName)||"Starting...",isMaxMode:!0===(null==rt?void 0:rt.maxMode),tokenPercentLabel:eo,changedFilesCount:Qn,showReviewHint:!en.inHistory,exitHintText:Ln,headlineLabel:(()=>{if(U)return"Sending to background";if(_t)return process.stdout.columns>60?"^ Move to cloud agent":"^ Cloud agent";if(Lt.active)return process.stdout.columns>60?"^ Please set up cloud agents to move to cloud (Enter to open setup)":"^ Set up cloud agents (Enter)";if("auto-run"===st){const e="sandbox-only"===(null==ot?void 0:ot.type)?"Auto-run in sandbox":"Auto-run all commands";return Z?`▶︎ ${e} (shift+tab to cycle)`:`▶︎ ${e} (shift+tab to turn off)`}return"background"===st?Ee?process.stdout.columns>60?"^ Send to background (shift+tab to cycle)":"^ Background (shift+tab to cycle)":void 0:"plan"===st?"≡ Plan (shift+tab to cycle)":"search"===st?"? Ask (shift+tab to cycle)":void 0})(),headlineColor:U?"green":_t||Lt.active||"background"===st&&Ee?"magenta":"auto-run"===st?"blue":"plan"===st?"yellow":"search"===st?"green":void 0}),(0,r.jsx)(d.az,{height:Kn?Math.min(un.active?Math.min(un.suggestions.length,m.kQ):Math.min(wn.items.length,m.kQ),m.kQ):0,flexDirection:"column",marginTop:0,children:Kn&&(un.active?(0,r.jsx)(_.A,{suggestions:Zn,activeIndex:un.index,windowStart:un.windowStart,highlightColor:Cn}):(0,r.jsx)(R.A,{items:Vn,activeIndex:wn.index,windowStart:wn.windowStart,highlightColor:Cn}))}),(0,r.jsx)(D.A,{lines:Jt.lines})]}):null},ee=["png","jpg","jpeg","gif","webp","bmp","tif","tiff","heic","heif"],te=e=>{const t=e.toLowerCase();for(const e of ee)if(t.includes(`.${e}`))return!0;return t.includes("file://")},ne=new RegExp(String.raw`"((?:file://)?[^"\n]+?\.(${ee.join("|")}))"`,"gi"),oe=new RegExp(String.raw`'((?:file://)?[^'\n]+?\.(${ee.join("|")}))'`,"gi"),re=new RegExp(String.raw`(^|[^\w@-])((?:file://)?[^\s'"()]+?\.(${ee.join("|")}))`,"gi"),se=new RegExp(String.raw`(^|[^\w@-])((?:file://)?(?:/|~)[^\n]+?\.(${ee.join("|")}))`,"gi"),ie=/(^|[^\w@-])((?:file:\/\/)?[^\s'"()]+(?:'\s'[^\s'"()]+)+)/gi,le=e=>!!(/^(?:file:\/\/)?\//.test(e)||/^[A-Za-z]:[\\/]/.test(e)||/^\\\\/.test(e)||/^~\//.test(e)),ae=()=>{const e=[],t=[process.env.TMPDIR,process.env.TEMP,process.env.TMP];for(const n of t)n&&"string"==typeof n&&e.push(n);return e.push("/tmp","/var/tmp","/private/tmp","/var/folders","/private/var/folders"),Array.from(new Set(e.map((e=>e.replace(/\\/g,"/")))))},ce=e=>{if(!le(e))return!1;const t=e.replace(/\\/g,"/");for(const e of ae())if(t.startsWith(e.endsWith("/")?e:`${e}/`))return!0;return!1},de=e=>{let t=e.trim();if((t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'"))&&(t=t.slice(1,-1)),t.startsWith("file://"))try{const e=new URL(t);t=decodeURI(e.pathname)}catch(e){t=t.replace(/^file:\/\//,"")}return/^[A-Za-z]:[\\/]/.test(t)||/\\\\/.test(t)||(t=t.replace(/\\([\s()])/g,"$1"),t=t.replace(/'\s'/g," ")),t};o()}catch(ue){o(ue)}var U}))},"./src/components/prompt/decision-dropdown.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/context/theme-context.tsx"),c=n("./src/utils/color-mixing.ts"),d=e([s,a]);[s,a]=d.then?(await d)():d;const u=({title:e,highlightColor:t,options:n,selectedIndex:o,subtitle:d})=>{const u=(0,a.pW)(),p=(0,c.PT)(),h=(0,i.useMemo)((()=>{var e,t;if("ansi256"===p)return;const n=null!==(e=(0,c.E2)(null!=u&&u?l.bd:l.Ts))&&void 0!==e?e:null!=u&&u?{r:255,g:255,b:255}:{r:30,g:30,b:30},o=null!==(t=(0,c.E2)(null!=u&&u?l.Kp:l.Wn))&&void 0!==t?t:null!=u&&u?{r:255,g:243,b:223}:{r:245,g:217,b:159},r=null!=u&&u?l.FL:l.Rg;return(0,c.Ob)((0,c.Lh)(n,o,r))}),[u,p]),g=(0,i.useMemo)((()=>{if("ansi256"===p)return null!=u&&u?l.tg.activeBg:l.Lo.activeBg}),[p,u]),m=null!=u&&u?"black":"white";return(0,r.jsxs)(s.az,{flexDirection:"column",marginTop:0,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:t,children:e})}),d?(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:"gray",children:d})}):null,n.map(((e,n)=>{var i;const l=n===o,a=!!e.disabled,c=l?h:void 0,d=l?m:a?"gray":u?"black":"white",p=l?u?"black":"white":d,f=l&&!a?null!==(i=e.hint)&&void 0!==i?i:"(enter)":e.hint;return(0,r.jsxs)(s.az,{width:"100%",flexDirection:"row",alignItems:"center",backgroundColor:c,children:[(0,r.jsx)(s.az,{width:l?1:0,backgroundColor:l?t:void 0}),(0,r.jsx)(s.az,{paddingLeft:l?0:1,paddingY:0,children:l&&null!=g?(0,r.jsxs)(s.EY,{children:[`[48;5;${g}m`,(0,r.jsx)(s.EY,{color:d,children:"→ "}),(0,r.jsx)(s.EY,{color:d,bold:!0,children:e.label}),f?(0,r.jsxs)(s.EY,{color:p,children:[" ",f]}):null,"[49m"]}):(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:d,children:l?"→ ":"  "}),(0,r.jsx)(s.EY,{color:d,bold:l,children:e.label}),f?(0,r.jsxs)(s.EY,{color:p,children:[" ",f]}):null]})})]},`${e.label}-${n}`)}))]})};o()}catch(e){o(e)}}))},"./src/components/prompt/ephemeral-lines-view.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=({lines:e})=>0===e.length?null:(0,r.jsx)(s.az,{flexDirection:"column",marginTop:1,paddingX:2,children:e.map((e=>{const t=(e=>{if("string"!=typeof e)return(0,r.jsx)(s.EY,{children:e.map(((e,t)=>(0,r.jsx)(s.EY,{color:e.color,bold:e.bold,dimColor:e.dim,children:e.text},`${e.text}-${e.color}-${t}`)))},0);if(0===e.trim().length)return(0,r.jsx)(s.EY,{children:" "},0);const t=e.toLowerCase();if(t.startsWith("error:"))return(0,r.jsx)(s.EY,{color:"red",children:e},0);if(t.startsWith("unknown command:"))return(0,r.jsx)(s.EY,{color:"yellow",children:e},0);if(/^available models:/i.test(e))return(0,r.jsx)(s.EY,{color:"cyan",children:e},0);if(/^(commands:|examples:|usage:)/i.test(e))return(0,r.jsx)(s.EY,{color:"cyan",bold:!0,children:e},0);if(e.startsWith("/")){const[t,...n]=e.split(" - ");return n.length>0?(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"cyan",children:t}),(0,r.jsxs)(s.EY,{color:"gray",children:[" - ",n.join(" - ")]})]},0):(0,r.jsx)(s.EY,{color:"cyan",children:e},0)}return e.startsWith("  /")?(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"gray",children:" "}),(0,r.jsxs)(s.EY,{color:"cyan",children:["/",e.slice(3)]})]},0):(0,r.jsx)(s.EY,{color:"gray",children:e},0)})(e),n="string"==typeof e?e:JSON.stringify(e);return(0,r.jsx)(i.Fragment,{children:t},n)}))}),c=i.memo(a);o()}catch(e){o(e)}}))},"./src/components/prompt/palette-aligned-list.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/hooks/use-screen-size.ts"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=(e,t)=>{const n=e.trim();if(0===n.length||t<=0)return"";if(n.length<=t)return n;const o=n.split(/\s+/);let r="";for(let e=0;e<o.length;e++){const n=o[e],s=0===r.length?n:`${r} ${n}`,i=1;if(s.length+i>t)return r.length>0?`${r}…`:`${n.slice(0,Math.max(0,t-i))}…`;r=s}return r},d=({items:e,activeIndex:t,windowStart:n,pageSize:o=i.kQ,highlightColor:a,maxLabelCols:d=40})=>{const{width:u}=(0,l.l)(),p=n>0,h=n+o<e.length,g=o-((p?1:0)+(h?1:0)),m=e.slice(n,n+g),f=Math.min(m.reduce(((e,t)=>Math.max(e,t.label.length)),0),d),v=t-n;return(0,r.jsxs)(s.az,{paddingX:2,flexDirection:"column",children:[p&&(0,r.jsx)(s.az,{paddingLeft:3,children:(0,r.jsx)(s.EY,{dimColor:!0,children:"↑ more above"})}),m.map(((e,t)=>{const n=t===v,o=n?a:"gray",i=n?"foreground":"gray";return(0,r.jsxs)(s.az,{width:"100%",flexDirection:"row",alignItems:"center",children:[(0,r.jsx)(s.az,{width:1,backgroundColor:n?a:void 0}),(0,r.jsx)(s.az,{width:2,children:(0,r.jsx)(s.EY,{color:o,children:n?"→ ":"  "})}),f>0&&(0,r.jsx)(s.az,{width:f,marginRight:2,children:(0,r.jsx)(s.EY,{color:i,bold:n,wrap:"truncate-end",children:e.label})}),(0,r.jsx)(s.az,{flexGrow:1,children:e.description?(0,r.jsx)(s.EY,{color:i,bold:n,wrap:"truncate-end",children:(()=>{const t=3+(f>0?f+2:0),n=Math.max(0,u-4-t);return c(e.description,n)})()}):null})]},`${e.key}-${t}`)})),h&&(0,r.jsx)(s.az,{paddingLeft:3,children:(0,r.jsx)(s.EY,{dimColor:!0,children:"↓ more below"})})]})};o()}catch(e){o(e)}}))},"./src/components/prompt/palette-at-list.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("./src/constants.ts"),i=n("./src/components/prompt/palette-aligned-list.tsx"),l=e([i]);i=(l.then?(await l)():l)[0];const a=40,c=e=>{const t=e.endsWith("/"),n=t?e.slice(0,-1):e,o=n.lastIndexOf("/");if(-1===o)return{name:n+(t?"/":""),parent:"",isDir:t};const r=0===o?"/":n.slice(0,o);return{name:n.slice(o+1)+(t?"/":""),parent:r,isDir:t}},d=({suggestions:e,activeIndex:t,windowStart:n,pageSize:o=s.kQ,highlightColor:l})=>{const d=e.map(((e,t)=>{const{name:n,parent:o}=c(e);return{key:`at-${e}-${t}`,label:n,description:o}}));return(0,r.jsx)(i.A,{items:d,activeIndex:t,windowStart:n,pageSize:o,highlightColor:l,maxLabelCols:a})};o()}catch(e){o(e)}}))},"./src/components/prompt/palette-slash-list.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("./src/constants.ts"),i=n("./src/components/prompt/palette-aligned-list.tsx"),l=e([i]);i=(l.then?(await l)():l)[0];const a=({items:e,activeIndex:t,windowStart:n,pageSize:o=s.kQ,highlightColor:l})=>{const a=e=>{const t=e.isArgSuggestion&&e.parentCommandId,n=e.args.length>0?" "+e.args.map((e=>!1===e.required?`[${e.identifier}]`:`<${e.identifier}>`)).join(" "):"";return`/${t?`${e.parentCommandId} ${e.identifier}`:e.identifier}${n}`},c=e.map(((e,t)=>{var n;return{key:`${e.identifier}-${e.parentCommandId||"root"}-${t}`,label:a(e),description:null!==(n=e.description)&&void 0!==n?n:""}}));return(0,r.jsx)(i.A,{items:c,activeIndex:t,windowStart:n,pageSize:o,highlightColor:l,maxLabelCols:40})};o()}catch(e){o(e)}}))},"./src/components/prompt/pending-decisions-banner.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>h});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../local-exec/dist/index.js"),l=n("./src/pending-decision-store.ts"),a=n("./src/utils/path-utils.ts"),c=n("./src/components/highlighted-code.tsx"),d=n("./src/components/inline-delta.tsx"),u=n("./src/components/mcp-tool-decision-preview.tsx"),p=e([s,c,d,u]);[s,c,d,u]=p.then?(await p)():p;const h=({decisions:e})=>0===e.length?null:(0,r.jsx)(s.az,{flexDirection:"column",borderColor:"gray",borderStyle:"single",borderDimColor:!0,paddingX:1,marginX:1,children:e.map((e=>{const t=function(e){switch(e.operation.type){case i.S5.Shell:return function(e){const t=e.details.command||"",n=t.length>80?`${t.slice(0,77)}...`:t,o=e.details.reason,r="string"==typeof o?o:void 0;return r?`${n}\nReason: ${r}`:n}(e.operation);case i.S5.Delete:return`Delete file: ${(0,a.fw)(e.operation.details.path)}`;case i.S5.Write:return`Write file: ${(0,a.fw)(e.operation.details.path)}. Reason: ${e.operation.details.reason}\n\n${e.operation.details.diffString}`;case i.S5.Mcp:{const t=e.operation.details,n=Object.keys(t.args).length>0?`\nArgs: ${JSON.stringify(t.args,null,2)}`:"";return`MCP Provider: ${t.providerIdentifier}. MCP tool: ${t.toolName}${n}`}case l.yB:return`Web search: "${e.operation.details.searchTerm}"`;case l.uS:return`Web fetch: "${e.operation.details.url}"`;default:throw e.operation,new Error(`Unhandled operation type: ${e.operation.type}`)}}(e);let n;if(e.operation.type===i.S5.Shell){const t="$ ";n=(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:3,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:t})}),(0,r.jsx)(s.az,{flexGrow:1,children:(0,r.jsxs)(s.EY,{color:"foreground",wrap:"wrap",children:[e.operation.details.command," ",(0,r.jsxs)(s.EY,{color:"gray",children:["in"," ",(0,a.tk)((0,a.fw)(e.operation.details.workingDirectory),50)]})]})})]})}else if(e.operation.type===i.S5.Write){let t=0,o=0;for(const n of e.operation.details.diffString.split("\n"))n.startsWith("+")?t++:n.startsWith("-")&&o++;const i=(0,a.Kr)((0,a.fw)(e.operation.details.path));n=(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"center",gap:1,children:[(0,r.jsx)(s.EY,{color:"foreground",children:i}),(0,r.jsx)(d._,{added:t,removed:o})]}),(0,r.jsx)(s.az,{borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,borderColor:"gray",borderStyle:"single",borderDimColor:!0,children:(0,r.jsx)(c.A,{content:e.operation.details.diffString,language:"diff",showLineNumbers:!1,maxLines:40,isDiff:!0})})]})}else if(e.operation.type===i.S5.Mcp){const t=e.operation.details;n=(0,r.jsx)(u.t,{providerIdentifier:t.providerIdentifier,toolName:t.toolName,args:t.args})}else if(e.operation.type===l.yB){const t=e.operation.details;n=(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:3,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"cyan",children:"🔍 "})}),(0,r.jsx)(s.az,{flexGrow:1,children:(0,r.jsxs)(s.EY,{color:"foreground",wrap:"wrap",children:[(0,r.jsx)(s.EY,{bold:!0,children:"Web Search: "}),t.searchTerm]})})]})})}else if(e.operation.type===l.uS){const t=e.operation.details;n=(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:3,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"cyan",children:"🌐 "})}),(0,r.jsx)(s.az,{flexGrow:1,children:(0,r.jsxs)(s.EY,{color:"foreground",wrap:"wrap",children:[(0,r.jsx)(s.EY,{bold:!0,children:"Web Fetch: "}),t.url]})})]})})}else n=(0,r.jsx)(s.EY,{color:"foreground",dimColor:!0,children:t});return(0,r.jsx)(s.az,{flexDirection:"column",children:n},e.id)}))});o()}catch(e){o(e)}}))},"./src/components/prompt/prompt-footer.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=e([s]);s=(a.then?(await a)():a)[0];const c=({show:e,exitMode:t,modelLabel:n,isMaxMode:o,tokenPercentLabel:i,changedFilesCount:a,showReviewHint:c,headlineLabel:d,headlineColor:u,exitHintText:p,rightStatusLabel:h,showSlashHint:g=!0})=>e?(0,r.jsx)(s.az,{flexDirection:"column",marginX:2,children:t?(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{dimColor:!0,children:null!=p?p:"Press Ctrl+C again to exit"})}):(0,r.jsxs)(s.az,{marginTop:d?0:1,flexDirection:"column",children:[d?(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:u||"foreground",children:d})}):null,(0,r.jsxs)(s.az,{gap:2,justifyContent:"space-between",children:[(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,children:[h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:h}),(0,r.jsx)(s.EY,{dimColor:!0,children:"·"})]}):null,(0,r.jsx)(s.EY,{dimColor:!0,children:n}),o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"·"}),(0,r.jsx)(s.EY,{color:"white",children:"MAX"})]}),i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"·"}),(0,r.jsx)(s.EY,{dimColor:!0,children:i})]}):null,a>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"·"}),(0,r.jsxs)(s.EY,{dimColor:!0,children:[a," file",1===a?"":"s"," edited"]})]})]}),(0,r.jsx)(s.az,{})]}),(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{dimColor:!0,children:[(()=>{const e=[];return g&&e.push("/ commands"),l.KD&&e.push("@ files"),e.push("! shell"),e.join(" · ")})(),l.hD&&c&&a>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:" · "}),(0,r.jsx)(s.EY,{dimColor:!0,children:"ctrl+r to review edits"})]})]})})]})}):null,d=i.memo(c);o()}catch(e){o(e)}}))},"./src/components/queued-message-banner.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{J:()=>g});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/hooks/use-screen-size.ts"),a=n("./src/utils/text-wrapping.ts"),c=e([s,l]);[s,l]=c.then?(await c)():c;const d="yellow",u="○ ",p="  ",h=2,g=({messages:e,showTip:t=!0,inputIsEmpty:n=!0,maxLinesPerMessage:o=2})=>{const{width:c}=(0,l.l)(),g=Math.max(20,c-4),m=Math.max(1,g-4),f=Math.max(1,m-h),{allLines:v,totalMoreLines:x}=(0,i.useMemo)((()=>{var t,n;if(0===e.length)return{allLines:[],totalMoreLines:0};const r=[];let s=0;for(const i of e){const e=i.trim().split("\n"),l=[];for(const t of e){const e=(0,a.G)(t,f);l.push(...e)}if(l.length>o){s+=l.length-o,l.length=o;const e=l.length-1,n=null!==(t=l[e])&&void 0!==t?t:"";n.length>=f?l[e]=`${n.slice(0,f-1)}…`:l[e]=`${n}…`}for(let e=0;e<l.length;e++){const t=null!==(n=l[e])&&void 0!==n?n:"",o=0===e?u:p;r.push(`${o}${t}`)}}return{allLines:r,totalMoreLines:s}}),[e,o,f]),b=(0,i.useMemo)((()=>t?n?"enter send now · ↑ edit · esc cancel":"↑ to edit":null),[t,n]);if(0===e.length)return null;const y=Math.max(0,g-14-1),w=`┌─ follow-ups ${"─".repeat(y)}┐`,j=Math.max(0,g-2),k=`└${"─".repeat(j)}┘`,C=e=>{const t=Math.max(0,m-e.length);return e+" ".repeat(t)},S=(x>0?`+${x} more line${x>1?"s":""} · `:"")+(null!=b?b:"");return(0,r.jsxs)(s.az,{flexDirection:"column",marginBottom:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:d,children:w})}),v.map(((e,t)=>(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{color:d,children:"│ "}),(0,r.jsx)(s.EY,{dimColor:!0,children:C(e)}),(0,r.jsx)(s.EY,{color:d,children:" │"})]},`queued-line-${t}`))),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{color:d,children:"│ "}),(0,r.jsx)(s.EY,{dimColor:!0,children:C(S)}),(0,r.jsx)(s.EY,{color:d,children:" │"})]}),(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:d,children:k})})]})};o()}catch(e){o(e)}}))},"./src/components/read-lints-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n;const o=(null==e?void 0:e.paths)||[],c=0===o.length?"project":1===o.length?(0,l.Kr)(o[0]):`${(0,l.Kr)(o[0])} (+${o.length-1} more)`;let d="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:d="pending";break;case"error":d="error";break;case"success":d="success";break;default:d="pending"}const u=`${(0,i.F_)("readLintsToolCall","success"===d)||("success"===d?"Read":"Reading")} Lints`;return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:u,primary:c,status:d}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.errorMessage]})}):null})(),(()=>{const e=null==t?void 0:t.result;if("success"===(null==e?void 0:e.case)){const t=e.value.totalDiagnostics||0,n=e.value.totalFiles||0;return(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Found ",t," issue",1===t?"":"s",n>0?` in ${n} file${1===n?"":"s"}`:""]})})}return null})()]})};o()}catch(e){o(e)}}))},"./src/components/read-todos-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{w:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/utils/abort-label.ts"),l=n("./src/components/todos-ui.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:e,aborted:t,abortedReason:n})=>{const o=()=>{var t,n,o,r;const s=[];if((null===(n=null===(t=e.args)||void 0===t?void 0:t.statusFilter)||void 0===n?void 0:n.length)&&e.args.statusFilter.length>0){const t=e.args.statusFilter.map((e=>{switch(e){case 1:return"pending";case 2:return"in_progress";case 3:return"completed";case 4:return"cancelled";default:return"unknown"}}));s.push(`status: ${t.join(", ")}`)}return(null===(r=null===(o=e.args)||void 0===o?void 0:o.idFilter)||void 0===r?void 0:r.length)&&e.args.idFilter.length>0&&s.push(`ids: ${e.args.idFilter.join(", ")}`),s.length>0?` (${s.join("; ")})`:""};if(t)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsxs)(s.EY,{color:"foreground",children:[(0,r.jsx)(s.EY,{bold:!0,children:"Read to-dos"})," ",(0,r.jsx)(s.EY,{color:"gray",children:(0,i.P)(n)})]})})});if(!e.result)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(l.S,{todos:[],mode:"read",loading:!0,filters:o()})});const a=e.result.result;switch("success"===(null==a?void 0:a.case)&&a.value.totalCount,null==a?void 0:a.case){case"success":return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(l.S,{todos:a.value.todos,totalCount:a.value.totalCount,mode:"read",filters:o(),showHeader:!0})});case"error":return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.EY,{color:"gray",children:a.value.error})});default:return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(l.S,{todos:[],mode:"read"})})}};o()}catch(e){o(e)}}))},"./src/components/read-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{B:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n;if(!e)return null;const o=(0,l.Kr)(e.path),c=(0,l.me)(e.offset,e.limit);let d="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:d="pending";break;case"error":d="error";break;case"success":d="success";break;default:d="pending"}const u=(0,i.F_)("readToolCall","success"===d)||("success"===d?"Read":"Reading");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:u,primary:o,status:d,note:c}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.errorMessage]})}):null})()]})};o()}catch(e){o(e)}}))},"./src/components/running-agents-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{e:()=>u,q:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../agent-ui-state/dist/index.js"),i=n("../ink/build/index.js"),l=n("./src/utils/abort-label.ts"),a=e([i]);function c(e,t){if(!e)return"";const n=e.split("/"),o=n[n.length-1]||e;return o.length<=t?o:`${o.slice(0,t-1)}…`}function d(e,t){return e.length<=t?e:`${e.slice(0,t-1)}…`}function u(e,t,n,o){const r=null==o?void 0:o.completed,s=null==o?void 0:o.aborted,i=null==o?void 0:o.abortReason,a=t.args,u=(null==a?void 0:a.description)&&a.description.trim().length>0?d(a.description.trim(),40):"Subagent task",p=null==n?void 0:n.subagentState;let h;return s?h=(0,l.P)(i):r?h="Done":(h=function(e){if(!(null==e?void 0:e.pendingTurn))return null;if("agent"!==e.pendingTurn.type)return null;const t=e.pendingTurn.pendingState;if("tool-call-segment"===(null==t?void 0:t.type)){const e=t.groups[t.groups.length-1];if(e&&e.calls.length>0){const t=e.calls[e.calls.length-1];if(t)return function(e){const t=e.tool.case,n=e.tool.value;switch(t){case"readToolCall":{const e=null==n?void 0:n.args,t=c(null==e?void 0:e.path,30);return t?`Reading ${t}`:"Reading file"}case"editToolCall":{const e=null==n?void 0:n.args,t=c(null==e?void 0:e.path,30);return t?`Editing ${t}`:"Editing file"}case"deleteToolCall":{const e=null==n?void 0:n.args,t=c(null==e?void 0:e.path,30);return t?`Deleting ${t}`:"Deleting file"}case"lsToolCall":{const e=null==n?void 0:n.args,t=c(null==e?void 0:e.path,30);return t?`Listing ${t}`:"Listing directory"}case"grepToolCall":{const e=null==n?void 0:n.args,t=(null==e?void 0:e.pattern)?d(e.pattern,20):"";return t?`Searching "${t}"`:"Searching"}case"globToolCall":{const e=null==n?void 0:n.args,t=(null==e?void 0:e.globPattern)?d(e.globPattern,25):"";return t?`Finding ${t}`:"Finding files"}case"shellToolCall":{const e=null==n?void 0:n.args,t=(null==e?void 0:e.command)?d(e.command,30):"";return t?`Running: ${t}`:"Running command"}case"taskToolCall":return"Running subagent";default:return"Working…"}}(t.call)}}const n=e.pendingTurn.thinkingContent;return n&&n.length>0?"Thinking…":"text"===(null==t?void 0:t.type)&&t.content?"Responding…":null}(p),h||(h=(null==p?void 0:p.pendingTurn)?"Working…":"Starting…")),{id:e,description:u,currentStep:h,completed:null!=r&&r,aborted:null!=s&&s,abortReason:i}}i=(a.then?(await a)():a)[0];const p=({agents:e})=>{const t=e.filter((e=>!e.completed&&!e.aborted)).length,n=e.filter((e=>e.completed&&!e.aborted)).length,o=e.filter((e=>e.aborted)).length,l=e.filter((e=>e.aborted&&(0,s.t6)(e.abortReason))).length,a=e.filter((e=>e.aborted&&(0,s._z)(e.abortReason))).length,c=o-l-a,d=0===t&&e.length>0,u=()=>{const e=[];return l>0&&e.push(`${l} cancelled`),a>0&&e.push(`${a} follow-up interrupted`),c>0&&e.push(`${c} interrupted`),e.join(", ")};let p;if(d)p=0===o?`${n} ${1===n?"agent":"agents"} completed`:0===n?u():`${n} completed, ${u()}`;else{let e=`Running ${t} ${1===t?"agent":"agents"}…`;const r=[];n>0&&r.push(`${n} done`),o>0&&r.push(u()),r.length>0&&(e+=` (${r.join(", ")})`),p=e}return(0,r.jsxs)(i.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsxs)(i.az,{gap:1,alignItems:"flex-start",children:[(0,r.jsx)(i.az,{width:1,flexShrink:0,children:(0,r.jsx)(i.EY,{color:"gray",children:"⬢"})}),(0,r.jsx)(i.EY,{bold:!0,color:"white",dimColor:d,children:p})]}),e.map((e=>{const t=e.aborted?"red":e.completed?"green":"gray",n=e.aborted?"✗ ":e.completed?"✓ ":"";return(0,r.jsxs)(i.az,{flexDirection:"column",children:[(0,r.jsxs)(i.az,{gap:1,children:[(0,r.jsx)(i.az,{width:1,flexShrink:0}),(0,r.jsx)(i.EY,{color:e.completed||e.aborted?"gray":void 0,children:e.description})]}),e.currentStep?(0,r.jsxs)(i.az,{gap:1,children:[(0,r.jsx)(i.az,{width:1,flexShrink:0}),(0,r.jsxs)(i.EY,{color:t,children:[n,e.currentStep]})]}):null]},e.id)}))]})};o()}catch(h){o(h)}}))},"./src/components/sandbox-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{J:()=>m});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../shell-exec/dist/index.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/utils/input-keys.ts"),c=n("./src/utils/sandbox-messages.ts"),d=e([s]);s=(d.then?(await d)():d)[0];var u=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const h=[{id:"sandbox-user-config-only",baseLabel:"Auto-Run in Sandbox",networkLabel:"sandbox.json allowlist only",config:{sandboxMode:"enabled",networkAccess:"user_config_only",approvalMode:"allowlist"}},{id:"sandbox-user-config-with-defaults",baseLabel:"Auto-Run in Sandbox",networkLabel:"sandbox.json + default allowlist",config:{sandboxMode:"enabled",networkAccess:"user_config_with_defaults",approvalMode:"allowlist"}},{id:"sandbox-all-network",baseLabel:"Auto-Run in Sandbox",networkLabel:"allow all network",config:{sandboxMode:"enabled",networkAccess:"allow_all",approvalMode:"allowlist"}},{id:"no-sandbox",baseLabel:"No Sandbox, use regular permissions",config:{sandboxMode:"disabled",networkAccess:"user_config_with_defaults",approvalMode:"allowlist"}}],g=[{id:"sandbox-admin-network",baseLabel:"Auto-Run in Sandbox",config:{sandboxMode:"enabled",networkAccess:"user_config_with_defaults",approvalMode:"allowlist"}},{id:"no-sandbox",baseLabel:"No Sandbox, use regular permissions",config:{sandboxMode:"disabled",networkAccess:"user_config_with_defaults",approvalMode:"allowlist"}}];function p(e,t,n=!1){return n?e.sandboxMode===t.sandboxMode&&e.approvalMode===t.approvalMode:e.sandboxMode===t.sandboxMode&&e.networkAccess===t.networkAccess&&e.approvalMode===t.approvalMode}const m=({configProvider:e,teamSettingsService:t,adminNetworkControlsEnabled:n,onClose:o,sandboxDefaultEnabled:d})=>{const m=(0,l.useMemo)((()=>{var t,n,o,r,s;const i=e.get(),l=d?"enabled":"disabled";return{sandboxMode:null!==(n=null===(t=i.sandbox)||void 0===t?void 0:t.mode)&&void 0!==n?n:l,networkAccess:null!==(r=null===(o=i.sandbox)||void 0===o?void 0:o.networkAccess)&&void 0!==r?r:"user_config_with_defaults",approvalMode:null!==(s=i.approvalMode)&&void 0!==s?s:"allowlist"}}),[e,d]),f=(0,l.useMemo)((()=>{const e=h.findIndex((e=>p(e.config,m)));return e>=0?e:0}),[m]),[v,x]=(0,l.useState)(m),[b,y]=(0,l.useState)(f),[w,j]=(0,l.useState)(!1),[k,C]=(0,l.useState)(""),[S,E]=(0,l.useState)("none"),M=(0,l.useMemo)((()=>(0,i.K3)()),[]);(0,l.useEffect)((()=>{let e=!1;return function(){u(this,void 0,void 0,(function*(){try{const o=yield t.getSandboxingControls();if(e)return;if(o.networkingDisabled)return void E("disabled");if(n){const n=yield t.getNetworkAccessControls();if(e)return;if(n.available&&(n.allowlist.length>0||n.denylist.length>0))return void E("controlled")}}catch(e){}}))}(),()=>{e=!0}}),[t,n]);const $="none"!==S,T=$?g:h,I=(0,l.useRef)(b),P=(0,l.useRef)(v),A=(0,l.useRef)(w),D=(0,l.useRef)(T),_=(0,l.useRef)(null);I.current=b,P.current=v,A.current=w,D.current=T,(0,l.useEffect)((()=>{const e=T.findIndex((e=>p(e.config,v,$)));y(e>=0?e:0)}),[T,v,$]),(0,l.useEffect)((()=>()=>{_.current&&clearTimeout(_.current)}),[]);const R=(0,l.useCallback)(((e,t=2e3)=>{_.current&&clearTimeout(_.current),C(e),_.current=setTimeout((()=>{C(""),_.current=null}),t)}),[]),L=(0,l.useCallback)((()=>u(void 0,void 0,void 0,(function*(){if(A.current)return;const t=D.current,n=t[I.current];if(!n)return;const o=t===g;if(p(n.config,P.current,o))R("Already using this configuration");else if("enabled"!==n.config.sandboxMode||M){j(!0);try{yield e.transform((e=>{var t,r,s;return Object.assign(Object.assign({},e),{approvalMode:n.config.approvalMode,sandbox:{mode:n.config.sandboxMode,networkAccess:o?null!==(r=null===(t=e.sandbox)||void 0===t?void 0:t.networkAccess)&&void 0!==r?r:"user_config_with_defaults":n.config.networkAccess,networkAllowlist:null===(s=e.sandbox)||void 0===s?void 0:s.networkAllowlist}})})),x(n.config),R("✓ Configuration updated")}catch(e){R(`Error: ${e instanceof Error?e.message:String(e)}`,3e3)}finally{j(!1)}}else R((0,c.l)(),3e3)}))),[e,M,R]);return(0,s.Ge)((0,l.useCallback)(((e,t)=>{(function(e){return e.includes("[M")||e.includes("[<")||e.includes("[?")||/\x1b\[<\d+;\d+;\d+[Mm]/.test(e)||/\x1b\[M[\x20-\xff]{3}/.test(e)})(e)||(t.ctrl&&"c"===e||(0,a.xv)(e,t)||"q"===e||"Q"===e?o():(0,a.Po)(e,t)||"k"===e||"K"===e?y((e=>{const t=D.current.length;return e>0?e-1:t-1})):(0,a.u$)(e,t)||"j"===e||"J"===e?y((e=>e<D.current.length-1?e+1:0)):t.return&&!A.current&&L())}),[o,L])),(0,r.jsxs)(s.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(s.az,{marginBottom:1,children:[(0,r.jsx)(s.EY,{bold:!0,color:"cyan",children:"Command Execution Settings"}),k&&(0,r.jsxs)(s.EY,{color:k.startsWith("✓")?"green":"yellow",children:[" ",k]})]}),!M&&(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsxs)(s.EY,{color:"yellow",children:["⚠ ",(0,c.l)(),". Sandbox options are unavailable."]})}),"disabled"===S&&(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:"yellow",children:"⚠ Network access is disabled by your admin."})}),"controlled"===S&&(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:"yellow",children:"⚠ Network access is controlled by your admin."})}),(0,r.jsx)(s.az,{flexDirection:"column",children:T.map(((e,t)=>{const n=t===b,o=p(e.config,v,$),i="enabled"===e.config.sandboxMode&&!M,l=i?"gray":n?"cyan":"white",a=n&&!i;return(0,r.jsx)(s.az,{flexDirection:"column",paddingLeft:1,children:(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{color:l,bold:a,children:n?"→ ":"  "}),o?(0,r.jsxs)(s.az,{children:[(0,r.jsxs)(s.EY,{color:"green",bold:!0,children:["● ",e.baseLabel]}),e.networkLabel&&(0,r.jsxs)(s.EY,{color:"green",bold:!$,dimColor:$,children:[", ",e.networkLabel]})]}):(0,r.jsxs)(s.az,{children:[(0,r.jsxs)(s.EY,{color:l,bold:a,children:["○ ",e.baseLabel]}),e.networkLabel&&(0,r.jsxs)(s.EY,{color:$||i?"gray":n?"cyan":"white",dimColor:$,bold:a&&!$,children:[", ",e.networkLabel]})]}),o&&(0,r.jsxs)(s.EY,{color:"green",dimColor:!0,children:[" ","(current)"]})]})},e.id)}))}),(0,r.jsxs)(s.az,{marginTop:1,flexDirection:"column",children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"When Sandbox is enabled, tools will auto-run in a sandbox if possible."}),(0,r.jsx)(s.EY,{dimColor:!0,children:"If not, they will respect the allowlist or ask for approval."})]}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{dimColor:!0,italic:!0,children:"↑/↓ to navigate • Enter to select • Esc to close"})})]})};o()}catch(f){o(f)}}))},"./src/components/search-results-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{X:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/path-display.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const c=({result:e,index:t})=>{var n,o,l,a;const c=e.codeBlock;if(!c)return null;const d=c.relativeWorkspacePath;return(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,children:[(0,r.jsxs)(s.EY,{color:"cyan",bold:!0,children:[(t+1).toString().padStart(3," "),"."]}),(0,r.jsx)(i.g,{path:d}),(0,r.jsxs)(s.EY,{color:"gray",children:["(L",null===(o=null===(n=c.range)||void 0===n?void 0:n.startPosition)||void 0===o?void 0:o.line," - L",null===(a=null===(l=c.range)||void 0===l?void 0:l.endPosition)||void 0===a?void 0:a.line,")"]})]})})},d=({query:e,results:t})=>0===t.length?(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.EY,{color:"yellow",children:['No results found for "',e,'"']})}):(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{color:"green",bold:!0,children:["Found ",t.length," result",1!==t.length?"s":"",' for "',e,'"']}),t.map(((e,t)=>{var n,o,s;return(0,r.jsx)(c,{result:e,index:t},`${null!==(o=null===(n=e.codeBlock)||void 0===n?void 0:n.relativeWorkspacePath)&&void 0!==o?o:""}-${null!==(s=e.score)&&void 0!==s?s:0}-${t}`)}))]});function a(e,t){(0,s.XX)((0,r.jsx)(d,{query:e,results:t}))}o()}catch(u){o(u)}}))},"./src/components/sem-search-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n;if(!e||!e.query)return null;const o=e.query.length>40?`...${e.query.slice(-37)}`:e.query;let c="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:c="pending";break;case"error":c="error";break;case"success":c="success";break;default:c="pending"}const d=(()=>{var t;const n=null!==(t=e.targetDirectories)&&void 0!==t?t:[];if(!n||0===n.length)return;const o=[];let r=0;for(let e=0;e<Math.min(n.length,3);e++){const t=(0,l.Kr)(n[e]||".");if(!(0===o.length||r+2+t.length<=100))break;o.push(t),r+=t.length+(o.length>1?2:0)}const s=n.length-o.length;return`in ${s>0?`${o.join(", ")} (+${s} more)`:o.join(", ")}`})(),u=(0,i.F_)("semSearchToolCall","success"===c)||("success"===c?"Searched":"Searching");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:u,primary:`"${o}"`,status:c,note:d}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.errorMessage]})}):null})(),(()=>{const e=null==t?void 0:t.result;if("success"===(null==e?void 0:e.case)){const t=(e.value.results||"").match(/<search_result\b/g),n=t?t.length:0;return(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Found ",n," results"]})})}return null})()]})};o()}catch(e){o(e)}}))},"./src/components/shell-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{f:()=>f});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../local-exec/dist/index.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/constants.ts"),c=n("./src/context/agent-state-context.tsx"),d=n("./src/utils/abort-label.ts"),u=n("./src/utils/characters.ts"),p=n("./src/utils/durations.ts"),h=n("./src/utils/path-utils.ts"),g=n("./src/components/highlighted-code.tsx"),m=e([s,g]);[s,g]=m.then?(await m)():m;const f=({tool:e,expand:t,aborted:n,abortedReason:o,shellManager:m})=>{var f,v;const{pendingDecisions:x}=(0,c.C9)(),b=(0,c.tO)(),y=e.args,w=e.result,j=(0,l.useMemo)((()=>((null==y?void 0:y.command)||"").trim()),[null==y?void 0:y.command]),k=null!=t?t:!b,C=(0,l.useMemo)((()=>m&&(null==y?void 0:y.toolCallId)?m.getOrCreateShellEmitter(y.toolCallId):null),[m,null==y?void 0:y.toolCallId]),S=(0,l.useMemo)((()=>{const e=(null==y?void 0:y.workingDirectory)||void 0,t=null==w?void 0:w.result;let n=e;if(!n&&t)switch(t.case){case"success":case"failure":case"rejected":n=t.value.workingDirectory||void 0;break;default:n=void 0}if(!n)return;const o=(0,h.fw)(n),r="."===o?"current dir":o;return(0,h.tk)(r,a.DN)}),[null==y?void 0:y.workingDirectory,w]),E=(0,l.useMemo)((()=>x.some((e=>e.operation.type===i.S5.Shell&&(e.operation.details.command||"").trim()===j))),[x,j]),M=(0,l.useMemo)((()=>!(null==w?void 0:w.result)),[w]),$=(0,l.useMemo)((()=>{if(!(null==w?void 0:w.isBackground))return!1;const e=w.result;return"success"===(null==e?void 0:e.case)&&void 0!==e.value.shellId&&0!==e.value.shellId}),[w]),[T,I]=(0,l.useState)(void 0),P=null==C?void 0:C.startedAt,A=null==C?void 0:C.endedAt,[D,_]=(0,l.useState)(0),[R,L]=(0,l.useState)(0),[O,Y]=(0,l.useState)(void 0);(0,l.useEffect)((()=>{if(!C)return void I(void 0);I(C.getCurrentState());const e=e=>{I(e)};return C.addListener(e),()=>{C.removeListener(e)}}),[C]),(0,l.useEffect)((()=>{var e,t;if($&&"success"===(null===(e=null==w?void 0:w.result)||void 0===e?void 0:e.case)&&void 0===O){const e=null!==(t=w.result.value.executionTime)&&void 0!==t?t:0;Y(performance.now()-e)}else $||void 0===O||Y(void 0)}),[$,w,O]);const F=(0,l.useMemo)((()=>{var e,t;if(n)return(0,d.P)(o);const r=null==w?void 0:w.result;if(!r&&null!==(null==T?void 0:T.exitCode)&&void 0!==(null==T?void 0:T.exitCode))return`exit ${T.exitCode}`;if(r)switch(r.case){case"success":return null!==(e=(0,p.u)(r.value.executionTime))&&void 0!==e?e:void 0;case"failure":{const e=null!==(t=r.value.exitCode)&&void 0!==t?t:1,n=r.value.signal||"",o=(0,p.u)(r.value.executionTime),s=[];return s.push(`exit ${e}${n?` (${n})`:""}`),o&&s.push(o),s.join(" • ")}case"rejected":return"Rejected";default:return}}),[n,o,w,T]);(0,l.useEffect)((()=>{if(!(void 0!==P&&M||$&&void 0!==O)||E||n)return;const e=setInterval((()=>{_((e=>e+1))}),100);return()=>clearInterval(e)}),[P,M,$,O,E,n]);const z=$&&void 0!==O?Math.round(performance.now()-O):void 0!==P?Math.round((null!=A?A:performance.now())-P):R;(0,l.useEffect)((()=>{void 0!==P&&z>0&&L(z)}),[P,z]);const N=(0,l.useMemo)((()=>{if(n)return null;const e=e=>(0,u.aJ)(e),t=e=>e.replace(/(\S{80})(?=\S)/g,"$1​"),o=null==w?void 0:w.result;if(!o&&(null==T?void 0:T.output)){const n=t(e(T.output));if(!n)return null;const o=Buffer.byteLength(n,"utf8"),r=o>a.qg;return{text:r?Buffer.from(n,"utf8").subarray(0,a.qg).toString("utf8"):n,color:void 0,isTruncated:r,originalSize:o}}if(!o)return null;switch(o.case){case"success":case"failure":{const n=o.value.stdout||"",r=o.value.stderr||"",s=[];n&&s.push(t(e(n))),r&&s.push(t(e(r)));const i=s.join("\n");if(!i)return null;const l=Buffer.byteLength(i,"utf8"),c=l>a.qg;return{text:c?Buffer.from(i,"utf8").subarray(0,a.qg).toString("utf8"):i,color:void 0,isTruncated:c,originalSize:l}}case"rejected":{const e="string"==typeof o.value.reason?o.value.reason.trim():"";return e?{text:e,color:"yellow"}:null}default:return null}}),[w,n,T]);return y?(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:"$ "})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsxs)(s.EY,{wrap:"wrap",children:[(0,r.jsx)(s.EY,{color:"foreground",children:j}),F&&!$?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:F}),n&&z>0?(0,r.jsxs)(s.EY,{color:"gray",children:[" • ",(0,p.u)(z)]}):null]}):null,!M&&!$||n?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.EY,{color:"gray",children:[E?"Waiting for approval...":null!==(f=(0,p.u)(z))&&void 0!==f?f:void 0,$?" (background)":""]})]}),S?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.EY,{color:"gray",children:["in ",S]})]}):null]})})]}),null!==N?"yellow"===N.color?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"yellow",wrap:"wrap",children:N.text})}):N.text?(0,r.jsxs)(s.az,{paddingLeft:2,flexDirection:"column",children:[(0,r.jsx)(g.d,{content:N.text,language:"plaintext",showLineNumbers:!1,maxLines:k?a.U5:a.Ok,truncationHint:k?void 0:"ctrl+o to expand",dimmed:!0}),N.isTruncated&&k?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsxs)(s.EY,{color:"yellow",dimColor:!0,children:["Output truncated at 1MiB limit (",Math.round((null!==(v=N.originalSize)&&void 0!==v?v:0)/1024)," KB total)"]})}):null,k?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"ctrl+o to collapse"})}):null]}):null:null]}):null};o()}catch(e){o(e)}}))},"./src/components/shell-turn-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{o:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/context/agent-state-context.tsx"),a=n("./src/components/highlighted-code.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({command:e,output:t,exitCode:n})=>{e=e.trim();const o=void 0!==n,c=!(0,l.tO)(),d=Buffer.byteLength(t,"utf8"),u=d>i.qg,p=u?Buffer.from(t,"utf8").subarray(0,i.qg).toString("utf8"):t;return(0,r.jsxs)(s.az,{flexDirection:"column",marginTop:1,marginBottom:1,children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:"$ "})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsxs)(s.EY,{wrap:"wrap",children:[(0,r.jsx)(s.EY,{color:"foreground",children:e}),o?null!=n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.EY,{color:"gray",children:["exit ",n]})]}):null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:"Running…"})]})]})})]}),t?(0,r.jsxs)(s.az,{paddingLeft:1,flexDirection:"column",children:[(0,r.jsx)(a.d,{content:p,language:"plaintext",showLineNumbers:!1,maxLines:c?i.U5:i.a6,truncationHint:c?void 0:"ctrl+o to expand",dimmed:!0}),u&&c?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsxs)(s.EY,{color:"yellow",dimColor:!0,children:["Output truncated at 1MiB limit (",Math.round(d/1024)," ","KB total)"]})}):null,c?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"ctrl+o to collapse"})}):null]}):null]})};o()}catch(e){o(e)}}))},"./src/components/step-container.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{C:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({children:e,shouldPadTop:t=!1,shouldMarginBottom:n=!1,overrideBorderColor:o="gray",paddingLeft:i=2,paddingRight:l=2})=>(0,r.jsx)(s.az,{paddingLeft:i,paddingRight:l,paddingTop:t?1:0,marginBottom:n?1:0,children:e});o()}catch(e){o(e)}}))},"./src/components/sudo-password-banner.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{t:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/hooks/use-sudo-password-requests.ts"),a=n("./src/components/sudo-password-prompt.tsx"),c=e([s,a]);function d({store:e}){const{currentRequest:t,submitPassword:n,cancelRequest:o}=(0,l.k)(e),c=(0,i.useCallback)((e=>{t&&n(t.id,e)}),[t,n]),d=(0,i.useCallback)((()=>{t&&o(t.id)}),[t,o]);return t?(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(a.H,{prompt:t.prompt,onSubmit:c,onCancel:d})}):null}[s,a]=c.then?(await c)():c,o()}catch(u){o(u)}}))},"./src/components/sudo-password-prompt.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{H:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/utils/input-keys.ts"),a=e([s]);function c({prompt:e,onSubmit:t,onCancel:n}){const[o,a]=(0,i.useState)(""),[c,d]=(0,i.useState)(!1),u=(0,i.useCallback)((()=>{c||(d(!0),t(o))}),[t,o,c]);(0,s.Ge)(((e,t)=>{if(c)return;if((0,l.xv)(e,t))return void n();if(t.return)return void u();if(t.backspace||t.delete)return void a((e=>e.slice(0,-1)));if(t.ctrl&&"c"===e)return void n();if(t.ctrl&&"u"===e)return void a("");if(t.ctrl||t.meta||t.upArrow||t.downArrow||t.leftArrow||t.rightArrow||t.tab)return;const o=e.replace(/[\x00-\x1F\x7F]/g,"");o.length>0&&a((e=>e+o))}),{isActive:!c});const p="*".repeat(o.length),h=o.length>0?p:"Enter password...",g=o.length>0?void 0:"gray";return(0,r.jsxs)(s.az,{flexDirection:"column",borderStyle:"round",borderColor:"yellow",paddingX:2,paddingY:1,marginY:1,children:[(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsxs)(s.EY,{children:[(0,r.jsxs)(s.EY,{color:"yellow",bold:!0,children:["🔐"," "]}),(0,r.jsx)(s.EY,{color:"foreground",bold:!0,children:"Sudo Authentication Required"})]})}),(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:"gray",children:e})}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{color:"cyan",children:"Password: "}),(0,r.jsx)(s.EY,{color:g,dimColor:0===o.length,children:h}),!c&&(0,r.jsx)(s.EY,{inverse:!0,children:" "})]}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:c?"Authenticating...":"Press Enter to submit, Escape to cancel"})}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,italic:!0,children:"ℹ Your password is secure and will not be visible to the AI model."})})]})}s=(a.then?(await a)():a)[0],o()}catch(d){o(d)}}))},"./src/components/summary.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{B:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/hooks/use-screen-size.ts"),l=n("./src/components/markdown.tsx"),a=e([s,i,l]);function c({summary:e}){const t=(0,i.l)();return(0,r.jsxs)(s.az,{borderStyle:"single",borderColor:"cyan",borderDimColor:!0,paddingLeft:1,paddingRight:4,marginTop:1,marginBottom:1,marginX:1,width:t.width-2,flexDirection:"column",gap:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:"cyan",bold:!0,children:"Summary"})}),(0,r.jsx)(l.Ay,{content:e})]})}[s,i,l]=a.then?(await a)():a,o()}catch(d){o(d)}}))},"./src/components/switch-mode-approval.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{V:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/utils/interaction-utils.ts"),l=n("./src/components/prompt/decision-dropdown.tsx"),a=n("./src/components/tool-row-box.tsx"),c=e([s,l,a]);[s,l,a]=c.then?(await c)():c;const d=({prompt:e})=>{const t=(0,i.dy)(e.targetModeId);return(0,r.jsx)(a.Y,{flexDirection:"column",borderColor:"cyan",borderDimColor:!1,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,gap:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{bold:!0,color:"cyan",children:["Switch to ",t," mode?"]})}),e.explanation?(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:"gray",children:e.explanation})}):null,(0,r.jsx)(l.A,{title:"",highlightColor:"cyan",options:[{label:"Approve mode switch",hint:"(y)"},{label:"Reject",hint:"(n or esc)"}],selectedIndex:e.decisionIndex})]})})};o()}catch(e){o(e)}}))},"./src/components/switch-mode-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{U:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/interaction-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=e=>{var t,n,o,r,s,i,a;switch(null===(t=e.result)||void 0===t?void 0:t.result.case){case"success":{const t=null!==(o=null===(n=e.result)||void 0===n?void 0:n.result.value.fromModeId)&&void 0!==o?o:"",i=null!==(s=null===(r=e.result)||void 0===r?void 0:r.result.value.toModeId)&&void 0!==s?s:"",a=(0,l.dy)(t),c=(0,l.dy)(i);return{status:"success",note:t.length>0&&i.length>0?`Switched from ${a} to ${c}`:"Mode switch approved"}}case"rejected":return{status:"rejected",note:(null===(i=e.result)||void 0===i?void 0:i.result.value.reason)||"Mode switch rejected"};case"error":return{status:"error",errorMessage:(null===(a=e.result)||void 0===a?void 0:a.result.value.error)||"Unknown error"};default:return{status:"pending"}}},u=({tool:e})=>{var t,n,o;const c=null!==(n=null===(t=e.args)||void 0===t?void 0:t.targetModeId)&&void 0!==n?n:"unknown",u=(0,l.dy)(c),{status:p,note:h,errorMessage:g}=d(e);return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:"SwitchMode",primary:`→ ${u}`,status:p,note:h}),(null===(o=e.args)||void 0===o?void 0:o.explanation)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:e.args.explanation})}):null,g?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",g]})}):null]})};o()}catch(e){o(e)}}))},"./src/components/task-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{K:()=>y});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/abort-label.ts"),a=n("./src/utils/durations.ts"),c=n("./src/utils/task-tool.ts"),d=n("./src/components/markdown.tsx"),u=n("./src/components/overflow-markdown.tsx"),p=n("./src/components/tool-call-header.tsx"),h=e([s,d,u,p]);[s,d,u,p]=h.then?(await h)():h;const m=8,f=600,v="Subagent task",x=4,b=4;function g(e,t){return e.length<=t?e:`${e.slice(0,t-1)}…`}const y=({tool:e,aborted:t,abortedReason:n,additionalData:o})=>{var h;const y=e.args,w=(null==y?void 0:y.description)&&y.description.trim().length>0?y.description.trim():v,j=(0,c.N)(null==y?void 0:y.subagentType),k=null==o?void 0:o.subagentState,C=null===(h=e.result)||void 0===h?void 0:h.result;let S,E,M,$=t?"error":"pending",T=!1;if(t)S=`Subagent execution ${(0,l.E)(n).toLowerCase()}`;else{const e=null==C?void 0:C.case;switch(e){case void 0:$="pending";break;case"success":{$="success";const e="success"===(null==C?void 0:C.case)?C.value:void 0;E=(0,c.U)(null==e?void 0:e.conversationSteps),M=(0,a.u)(null==e?void 0:e.durationMs),T=!0===(null==e?void 0:e.isBackground);break}case"error":$="error",S="error"===(null==C?void 0:C.case)&&C.value.error||"Unknown error";break;default:throw new Error(`Unhandled task result case: ${e}`)}}const I=[];j&&I.push(j),T&&I.push("background"),M&&I.push(M);const P=I.length>0?I.join(" • "):void 0,A=[];let D=0;const _=(e,t)=>{A.push({id:`${e}-${D++}`,content:t})};if("pending"===$&&!t){const e=function(e){if(!(null==e?void 0:e.pendingTurn))return null;if("agent"!==e.pendingTurn.type)return null;const t=e.pendingTurn.pendingState;if("tool-call-segment"!==(null==t?void 0:t.type))return null;const n=t.groups[t.groups.length-1];if(!n||0===n.calls.length)return null;const o=n.calls[n.calls.length-1];if(!o||o.completed)return null;const r=o.call.tool.case,s=(0,i.F_)(r,!1);if(!s)return null;const l=function(e){const t=e.tool.case,n=e.tool.value;if(!n)return"";switch(t){case"readToolCall":case"editToolCall":case"deleteToolCall":case"lsToolCall":{const e=n.args;return function(e){if(!e)return"";const t=e.split("/");return t[t.length-1]||e}(null==e?void 0:e.path)}case"grepToolCall":{const e=n.args;return(null==e?void 0:e.pattern)?`"${g(e.pattern,20)}"`:""}case"globToolCall":{const e=n.args;return(null==e?void 0:e.globPattern)?`"${g(e.globPattern,30)}"`:""}case"shellToolCall":{const e=n.args;return(null==e?void 0:e.command)?g(e.command,40):""}case"taskToolCall":{const e=n.args;return(null==e?void 0:e.description)?g(e.description,30):"subagent"}default:return""}}(o.call);return{verb:s,details:l}}(k),t=function(e){if(!(null==e?void 0:e.pendingTurn))return null;if("agent"!==e.pendingTurn.type)return null;const t=e.pendingTurn.pendingState;return"text"===(null==t?void 0:t.type)&&t.content?t.content:null}(k),n=function(e){return(null==e?void 0:e.pendingTurn)?"agent"!==e.pendingTurn.type?null:e.pendingTurn.thinkingContent||null:null}(k);if(e)_("current-tool",(0,r.jsxs)(s.EY,{color:"gray",children:[e.verb,e.details?` ${e.details}`:""]})),n&&_("thinking-content",(0,r.jsx)(u.m,{content:n,maxLines:x,showHiddenIndicator:!0,dimmed:!0,preserveParagraphBreaks:!0,compact:!0}));else if(n)_("thinking",(0,r.jsx)(u.m,{content:n,maxLines:x,showHiddenIndicator:!0,dimmed:!0,preserveParagraphBreaks:!0,compact:!0}));else if(t){const e=function(e,t){const n=e.split("\n");return n.length<=t?e:`${n.slice(0,t).join("\n")}…`}(t,b);_("streaming-text",(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsx)(d.Ay,{content:e})}))}else(null==k?void 0:k.pendingTurn)?_("active",(0,r.jsx)(s.EY,{color:"gray",children:"Working…"})):_("pending",(0,r.jsx)(s.EY,{color:"gray",children:"Waiting for subagent to finish…"}))}if("success"===$&&E){const{text:e,wasTruncated:t}=function(e){const t=e.split("\n");let n=e,o=!1;return t.length>m&&(n=t.slice(0,m).join("\n"),o=!0),n.length>f&&(n=n.slice(0,f),o=!0),{text:n.trimEnd(),wasTruncated:o}}(E);_("output",(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsx)(s.EY,{color:"gray",children:"Last output"}),(0,r.jsx)(s.EY,{wrap:"wrap",children:e}),t?(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"…(output truncated)"}):null]}))}return"error"===$&&S&&_("error",(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",S]})),(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(p.C,{name:"Task",primary:w,status:$,note:P}),A.length>0?(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,flexDirection:"column",children:A.map(((e,t)=>(0,r.jsx)(s.az,{marginBottom:t<A.length-1?1:0,children:e.content},e.id)))}):null]})};o()}catch(w){o(w)}}))},"./src/components/thinking-block-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/context/agent-state-context.tsx"),a=n("./src/utils/durations.ts"),c=n("./src/components/overflow-markdown.tsx"),d=n("./src/components/tool-row-box.tsx"),u=e([s,c,d]);[s,c,d]=u.then?(await u)():u;const p=({content:e,thoughtIndex:t,durationMs:n})=>{var o;const u=!(0,l.tO)(),p=null!=n&&n>0?`Thought for ${null!==(o=(0,a.u)(n))&&void 0!==o?o:"0ms"}`:"Thought";return(0,r.jsxs)(d.Y,{flexDirection:"column",gap:0,children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",paddingX:1,children:[(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"gray",children:"…"})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsx)(s.EY,{color:"gray",wrap:"wrap",children:p})})]}),e?(0,r.jsxs)(s.az,{paddingX:1,flexDirection:"column",children:[(0,r.jsx)(c.m,{content:e,maxLines:u?i.U5:i.WT,showHiddenIndicator:!0,truncationHint:u?void 0:"ctrl+o to expand",dimmed:!0,preserveParagraphBreaks:!0,compact:!0}),u?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"ctrl+o to collapse"})}):null]}):null]})};o()}catch(e){o(e)}}))},"./src/components/todos-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../proto/dist/generated/agent/v1/todo_tool_pb.js"),l=n("./src/constants.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({todos:e,totalCount:t,loading:n,error:o,mode:c,filters:d,showHeader:u=!0,isCreating:p=!1})=>{const h="read"===c?"Reading":p?"Creating":"Updating";if(n)return(0,r.jsx)(a.C,{name:"To-do",primary:`${h} to-dos${d?` ${d}`:""}...`,status:"pending"});if(o)return(0,r.jsx)(s.az,{paddingLeft:1,paddingRight:2,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error"," ","read"===c?"reading":p?"creating":"updating"," ","to-dos: ",o]})});if(0===e.length)return(0,r.jsx)(s.az,{paddingLeft:1,paddingRight:2,children:(0,r.jsxs)(s.EY,{color:"gray",children:["No to-dos found",d?` ${d}`:""]})});const g=e.filter((e=>e.status===i.Vj.COMPLETED)),m=e.filter((e=>e.status===i.Vj.IN_PROGRESS)),f=e.filter((e=>e.status===i.Vj.PENDING)),v=m.length+f.length,x=g.length,b=[];for(const e of g)b.push({icon:"☒",text:e.content});for(const e of m)b.push({icon:"☐",text:e.content});for(const e of f)b.push({icon:"☐",text:e.content});return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[u&&(0,r.jsx)(a.C,{name:"To-do",primary:v>0?`Working on ${v} ${1===v?"to-do":"to-dos"}${v>0&&x>0?` • ${x} done`:""}`:"All done",status:"success"}),(0,r.jsx)(s.az,{flexDirection:"column",marginLeft:l.SK,children:b.map(((e,t)=>(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsxs)(s.EY,{children:[e.icon," "]}),(0,r.jsx)(s.EY,{wrap:"wrap",children:e.text})]},`${e.icon}-${e.text}-${t}`)))})]})};o()}catch(e){o(e)}}))},"./src/components/tool-call-header.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{C:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({name:e,primary:t,status:n,note:o})=>{const i=function(e){switch(e){case"success":return"white";case"error":default:return"gray";case"rejected":case"pending":return"yellow"}}(n);return(0,r.jsxs)(s.az,{gap:1,alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:1,flexShrink:0,children:(0,r.jsx)(s.EY,{color:i,dimColor:"success"===n,children:"success"===n?"⬢":"⬡"})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsxs)(s.EY,{wrap:"wrap",children:[(0,r.jsx)(s.EY,{bold:!0,children:e}),t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:t})]}):null,o?"string"==typeof o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",wrap:"wrap",children:o})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),o]}):null]})})]})};o()}catch(e){o(e)}}))},"./src/components/tool-row-box.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Y:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/hooks/use-screen-size.ts"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=e=>{var{fullWidth:t,width:n,children:o}=e,l=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(e,["fullWidth","width","children"]);const a=(0,i.l)(),c=t?"100%":null!=n?n:Math.max(0,a.width-2);return(0,r.jsx)(s.az,Object.assign({borderStyle:"single",borderColor:"gray",borderDimColor:!0,gap:1,width:c},l,{children:o}))};o()}catch(e){o(e)}}))},"./src/components/unified-list-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{W:()=>j});var r=n("node:fs"),s=n("node:path"),i=n("../agent-kv/dist/index.js"),l=n("../ink/build/index.js"),a=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),c=n("../../node_modules/.pnpm/chalk@5.4.1/node_modules/chalk/source/index.js"),d=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),u=n("./src/constants.ts"),p=n("./src/hooks/use-screen-size.ts"),h=n("./src/state/index.ts"),g=n("./src/state/sqlite-blob-store.ts"),m=n("./src/utils/characters.ts"),f=n("./src/utils/git.ts"),v=n("./src/utils/input-keys.ts"),x=e([l,p]);[l,p]=x.then?(await x)():x;var b=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const y=e=>{var t,n,o,r,s,i,l,a,c;if(!e)return;let d=0,u=0;const p=null!==(n=null===(t=e.diff)||void 0===t?void 0:t.diffs)&&void 0!==n?n:[];for(const e of p)d+=Math.max(0,null!==(o=e.added)&&void 0!==o?o:0),u+=Math.max(0,null!==(r=e.removed)&&void 0!==r?r:0);const h=null!==(s=e.submoduleDiffs)&&void 0!==s?s:[];for(const e of h){if(e.errored)continue;const t=null!==(l=null===(i=e.diff)||void 0===i?void 0:i.diffs)&&void 0!==l?l:[];for(const e of t)d+=Math.max(0,null!==(a=e.added)&&void 0!==a?a:0),u+=Math.max(0,null!==(c=e.removed)&&void 0!==c?c:0)}return d>0||u>0?{totalAdded:d,totalRemoved:u}:void 0},w=e=>{const t="number"==typeof e?e:0;return t<=0||!Number.isFinite(t)?0:t<1e11?Math.floor(1e3*t):t>=1e14&&t<1e17?Math.floor(t/1e3):t>=1e17?Math.floor(t/1e6):Math.floor(t)},j=({client:e,onClose:t,onSelectChat:n,onSelectBackground:o})=>{var x,j,k,C;const S=(0,d.useCallback)((t=>b(void 0,void 0,void 0,(function*(){if(!e)return;let n;const o=new Promise((e=>{n=setTimeout((()=>e(void 0)),1e4)})),r=b(void 0,void 0,void 0,(function*(){try{return yield e.getOptimizedDiffDetails({bcId:t})}catch(e){return}})),s=yield Promise.race([r,o]);return n&&clearTimeout(n),s?y(s):void 0}))),[e]),[E,M]=(0,d.useState)([]),[$,T]=(0,d.useState)(0),[I,P]=(0,d.useState)(0),[A,D]=(0,d.useState)(!0),[_,R]=(0,d.useState)(""),[L,O]=(0,d.useState)(!1),[Y,F]=(0,d.useState)(0),[z,N]=(0,d.useState)(""),[U,B]=(0,d.useState)(void 0),[q,H]=(0,d.useState)("Continue"),[W,G]=(0,d.useState)("Cancel"),[X,K]=(0,d.useState)(null),{stdout:Q}=(0,l.t$)(),J=(0,p.l)();(0,d.useEffect)((()=>{if(Q){try{Q.write("[?1049h[?7l[?1h=")}catch(e){}return()=>{try{Q.write("[?1l>[?7h[?1049l")}catch(e){}}}}),[Q]),(0,d.useEffect)((()=>{let t=!1;return b(void 0,void 0,void 0,(function*(){var n;try{let o=[];if(e&&u.xZ)try{const t=(0,f.X4)(),r=(null!==(n=(yield e.listBackgroundComposers({n:32,includeStatus:!0,preferredRepoUrl:t.preferredRepoUrl,additionalRepoUrls:t.additionalRepoUrls})).composers)&&void 0!==n?n:[]).map((e=>{var t,n,o,r,s,i,l;return{kind:"background",id:null!==(t=e.bcId)&&void 0!==t?t:"",name:e.name||"Cloud Agent",repoUrl:null!==(n=e.repoUrl)&&void 0!==n?n:"",branch:null!==(o=e.branchName)&&void 0!==o?o:"",status:null!==(r=e.status)&&void 0!==r?r:a.R6p.UNSPECIFIED,updatedAtMs:w(null!==(i=null!==(s=e.createdAtMs)&&void 0!==s?s:e.updatedAtMs)&&void 0!==i?i:0),isArchived:null!==(l=e.isArchived)&&void 0!==l&&l}})).filter((e=>e.id.length>0&&!e.isArchived));o=r}catch(e){o=[]}let l=[];try{const e=(0,h.r)(),t=(0,r.readdirSync)(e,{withFileTypes:!0}),n=yield Promise.all(t.filter((e=>e.isDirectory())).map((t=>b(void 0,void 0,void 0,(function*(){var n,o;try{const l=(0,s.join)(e,t.name),a=(0,s.join)(l,"store.db");let c=Number.MAX_SAFE_INTEGER;try{const e=(0,r.statSync)(a),t=Math.floor(e.birthtimeMs||e.mtimeMs);t>0&&(c=Math.min(c,t))}catch(e){}try{const e=(0,r.statSync)(l),t=Math.floor(e.birthtimeMs||e.mtimeMs);t>0&&(c=Math.min(c,t))}catch(e){}c===Number.MAX_SAFE_INTEGER&&(c=0);const d=yield g.M.initAndLoad(a),u=null!==(n=d.get("name"))&&void 0!==n?n:(0,i.sh)().name,p=d.get("latestRootBlobId");if(!p||0===p.length)return null;let h=w(null!==(o=d.get("createdAt"))&&void 0!==o?o:0);return h||(h=w(c)),{kind:"chat",id:t.name,name:u,updatedAtMs:h}}catch(e){return null}})))));l=n.filter((e=>null!==e))}catch(e){l=[]}const c=[...o,...l].sort(((e,t)=>(t.updatedAtMs||0)-(e.updatedAtMs||0)));t||M(c),e&&u.xZ&&b(void 0,void 0,void 0,(function*(){try{const e=c.filter((e=>"background"===e.kind));if(0===e.length)return;const n=yield Promise.allSettled(e.map((e=>b(void 0,void 0,void 0,(function*(){const t=yield S(e.id);return{id:e.id,stats:t}})))));if(t)return;const o=new Map;for(const e of n)"fulfilled"===e.status&&o.set(e.value.id,e.value.stats);M((e=>e.map((e=>{if("background"!==e.kind)return e;const t=o.get(e.id);return t?Object.assign(Object.assign({},e),{totalAdded:t.totalAdded,totalRemoved:t.totalRemoved}):e}))))}catch(e){}}))}finally{t||D(!1)}})),()=>{t=!0}}),[e,S]);const V=null!==(j=null!==(x=null==J?void 0:J.width)&&void 0!==x?x:null==Q?void 0:Q.columns)&&void 0!==j?j:80,Z=null!==(C=null!==(k=null==J?void 0:J.height)&&void 0!==k?k:null==Q?void 0:Q.rows)&&void 0!==C?C:24,ee=Math.max(1,Z-6);return(0,d.useEffect)((()=>{if(0===E.length)return T(0),void P(0);T((e=>Math.max(0,Math.min(e,E.length-1)))),P((e=>{const t=Math.max(0,E.length-ee);return Math.max(0,Math.min(e,t))}))}),[E.length,ee]),(0,d.useEffect)((()=>{$<I?P($):$>=I+ee&&P(Math.max(0,$-ee+1))}),[$,ee,I]),(0,l.Ge)(((i,l)=>{if(L){if((0,v.u$)(i,l)||"j"===i||"J"===i)return void F((e=>Math.min(1,e+1)));if((0,v.Po)(i,l)||"k"===i||"K"===i)return void F((e=>Math.max(0,e-1)));if(l.ctrl&&"d"===i)return void t();if((0,v.xv)(i,l)||l.ctrl&&"c"===i||"n"===i||"N"===i||"q"===i||"Q"===i)return O(!1),K(null),void F(0);if(l.return||"y"===i||"Y"===i){const t=0===Y||"y"===i||"Y"===i,n=X;if(O(!1),K(null),F(0),t&&n){const{index:t,item:o}=n;if("chat"===o.kind){try{const e=(0,s.join)((0,h.r)(),o.id);(0,r.rmSync)(e,{recursive:!0,force:!0})}catch(e){}M((e=>e.filter(((e,n)=>n!==t))))}else M((e=>e.filter(((e,n)=>n!==t)))),b(void 0,void 0,void 0,(function*(){var t;try{yield null===(t=null==e?void 0:e.archiveBackgroundComposer)||void 0===t?void 0:t.call(e,{bcId:o.id})}catch(e){}}))}return}return}if(l.ctrl&&"d"===i||l.ctrl&&"c"===i||(0,v.xv)(i,l)||"q"===i)return R(""),void t();if(/^[0-9]$/.test(i))return void R((e=>(e+i).replace(/^0+/,"")));if(l.backspace||l.delete){if(_.length>0)return void R((e=>e.slice(0,-1)));if(!(E.length>0)||A)return;const e=E[$];if(!e)return;return F(0),"chat"===e.kind?(N("Delete session?"),B(`This will permanently remove the local session “${e.name}”.`),H("Delete"),G("Cancel")):(N("Delete cloud agent?"),B(`This will remove “${e.name}” from the list.`),H("Delete"),G("Cancel")),K({index:$,item:e}),void O(!0)}const a=()=>{const e=parseInt(_||"1",10);return Number.isFinite(e)&&e>0?e:1},c=()=>R(""),d=E.length>0&&!A;if((0,v.Po)(i,l)||"k"===i){if(!d)return;const e=a();return c(),void T((t=>Math.max(0,t-e)))}if((0,v.u$)(i,l)||"j"===i){if(!d)return;const e=a();return c(),void T((t=>Math.min(E.length-1,t+e)))}if(l.ctrl&&"f"===i){if(!d)return;const e=a();c();const t=e*Math.max(1,ee-1);return T((e=>Math.min(E.length-1,e+t))),void P((e=>Math.min(Math.max(0,E.length-ee),e+t)))}if(l.ctrl&&"b"===i){if(!d)return;const e=a();c();const t=e*Math.max(1,ee-1);return T((e=>Math.max(0,e-t))),void P((e=>Math.max(0,e-t)))}if("g"===i){if(!d)return;return c(),T(0),void P(0)}if("G"===i){if(!d)return;const e=_.length>0,t=a();if(c(),e){const e=Math.max(0,Math.min(E.length-1,t-1));T(e),P((t=>{const n=Math.max(0,E.length-ee);return Math.max(0,Math.min(n,e-Math.floor(ee/2)))}))}else{const e=Math.max(0,E.length-1);T(e),P(Math.max(0,E.length-ee))}return}const u=l;if(u.pageDown){if(!d)return;const e=a();c();const t=e*Math.max(1,ee-1);return T((e=>Math.min(E.length-1,e+t))),void P((e=>Math.min(Math.max(0,E.length-ee),e+t)))}if(u.pageUp){if(!d)return;const e=a();c();const t=e*Math.max(1,ee-1);return T((e=>Math.max(0,e-t))),void P((e=>Math.max(0,e-t)))}if(l.return){c();const e=E[$];if(!e)return;"chat"===e.kind?null==n||n(e.id):null==o||o(e.id)}})),(0,d.useEffect)((()=>{var e,t,n,o,r,s;if(!Q)return;const i=e=>(0,m.aJ)(e).length,l=(e,t)=>{const n=e.trim();return t<=0?"":n.length<=t?n:t<=3?n.slice(0,t):`${n.slice(0,Math.max(0,t-3))}...`},d=e=>{const t="string"==typeof e?e:"",n=t.indexOf("\n");return-1===n?t.replace(/\r/g,""):t.slice(0,n).replace(/\r/g,"")};if(L){const e=z,t=U,n=[{label:q,hint:"y"},{label:W,hint:"esc/n"}],o=Math.max(28,Math.min(60,V-12)),r=Math.max(8,o-4),s=e=>{const t=(null!=e?e:"").trim();return i(t)<=r?t:`${(0,m.aJ)(t).slice(0,Math.max(0,r-3))}...`},l=s(e),a=t?s(t):void 0,d=n.map(((e,t)=>{const n=t===Y,o=n?c.Ay.white("→"):c.Ay.gray(" "),s=Math.max(0,r-2),i=`${e.label}${e.hint?` ${e.hint}`:""}`,l=(0,m.aJ)(i),a=l.length>s?`${l.slice(0,Math.max(0,s-3))}...`:l,d=e.label.length,u=a.slice(0,Math.min(d,a.length)),p=a.slice(u.length);return`${o} ${n?c.Ay.white.bold(u):c.Ay.gray(u)}${p.length>0?n?c.Ay.white.dim(p):c.Ay.gray(p):""}`})),u=[c.Ay.white.bold(l),...a?[c.Ay.gray(a)]:[],...d],p=c.Ay.gray.dim,h=2+u.length,g=4+Math.max(0,Math.floor((ee-h)/2)),f=Math.max(1,Math.floor((V-o)/2)+1),v=`${p("┌")}${p("─".repeat(o-2))}${p("┐")}`;Q.write(`[${g};${f}H${v}`);for(let e=0;e<u.length;e++){const t=g+1+e,n=u[e];Q.write(`[${t};${f}H${p("│")}`),Q.write(" ");const s=i((0,m.aJ)(n)),l=Math.max(0,r-s);Q.write(`${n}${" ".repeat(l)}`),Q.write(" ");const a=f+o-1;Q.write(`[${t};${a}H${p("│")}`)}const x=`${p("└")}${p("─".repeat(o-2))}${p("┘")}`;return void Q.write(`[${g+h-1};${f}H${x}`)}const u=Math.max(0,Math.floor((V-25)/2)),p="─".repeat(V);if(Q.write(`[1;1H[2K${c.Ay.gray(p)}`),Q.write(`[2;1H[2K${" ".repeat(u)}${c.Ay.bold("Sessions and Cloud Agents")}`),Q.write(`[3;1H[2K${c.Ay.gray(p)}`),A){const e=Math.floor(Z/2),t="Loading sessions and cloud agents...",n="Press Ctrl-D, q or ESC to cancel";Q.write(`[${e};1H[2K${" ".repeat(Math.max(0,Math.floor((V-t.length)/2)))}${c.Ay.gray(t)}`),Q.write(`[${e+2};1H[2K${" ".repeat(Math.max(0,Math.floor((V-n.length)/2)))}${c.Ay.gray(n)}`);for(let t=4;t<=Z-2;t++)t!==e&&t!==e+2&&Q.write(`[${t};1H[2K`)}else if(0===E.length){const e=Math.floor(Z/2),t="No sessions or cloud agents found.",n="Press Ctrl-D, q or ESC to go back";Q.write(`[${e};1H[2K${" ".repeat(Math.max(0,Math.floor((V-t.length)/2)))}${c.Ay.gray(t)}`),Q.write(`[${e+2};1H[2K${" ".repeat(Math.max(0,Math.floor((V-n.length)/2)))}${c.Ay.gray(n)}`);for(let t=4;t<=Z-2;t++)t!==e&&t!==e+2&&Q.write(`[${t};1H[2K`)}else{const u=I,p=Math.min(E.length,u+ee),h=E.slice(u,p);let g=null,m=null;if(L){Math.max(30,Math.min(72,V-8));const e=2+(U?1:0)+2;g=4+Math.max(0,Math.floor((ee-e)/2)),m=g+e-1}for(let p=0;p<ee;p++){const f=p+4;if(L&&null!==g&&null!==m&&f>=g&&f<=m)continue;const v=h[p];if(!v){Q.write(`[${f};1H[2K`);continue}const x=u+p===$,b=new Date(Math.max(0,v.updatedAtMs||0)),y=new Date,w=Math.floor((Date.UTC(y.getFullYear(),y.getMonth(),y.getDate())-Date.UTC(b.getFullYear(),b.getMonth(),b.getDate()))/864e5),j=b.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let k;k=w<=0?`Today ${j}`:1===w?`Yesterday ${j}`:w<7?`${w} days ago`:`${b.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})} ${j}`;const C=x?"  ▶ ":"    ",S="background"===v.kind?"⬢ ":"  ",E=i(S),M=e=>{switch(e){case a.R6p.ERROR:return c.Ay.red("⬢ ");case a.R6p.FINISHED:return c.Ay.green("⬢ ");case a.R6p.RUNNING:case a.R6p.CREATING:return c.Ay.yellow("⬢ ");default:return c.Ay.gray("⬢ ")}},T="background"===v.kind?M(v.status):S,I=x?c.Ay.white(k):c.Ay.gray(k),P=(e,t)=>(t||"").trim(),A="background"===v.kind?P(v.repoUrl,v.branch):"",D=C.length,_=C.length+E,R=_+1+k.length+D,O=Math.max(1,V-R),Y=d(v.name).trim();if("background"===v.kind){const a=A?" ":"",d=i(a),u=A?x?c.Ay.white(a):c.Ay.gray(a):"",p=v,h="number"==typeof p.totalAdded&&"number"==typeof p.totalRemoved&&((null!==(e=p.totalAdded)&&void 0!==e?e:0)>0||(null!==(t=p.totalRemoved)&&void 0!==t?t:0)>0),g=h?`  +${Math.max(0,null!==(n=p.totalAdded)&&void 0!==n?n:0)} -${Math.max(0,null!==(o=p.totalRemoved)&&void 0!==o?o:0)}`:"",m=i(g),b=Math.min(24,Math.max(10,Math.floor(.35*O))),y=Math.min(22,Math.max(8,Math.floor(.25*O))),w=Math.max(1,O-m);let j=Math.floor(.6*w),S=w-j-d;if(S<y){const e=y-S;j=Math.max(b,j-e),S=w-j-d}if(j<b){const e=b-j;S=Math.max(y,S-e),j=w-S-d}j=Math.max(1,j),S=Math.max(0,S);const E=l(Y,j),M=l(A,S),$=x?c.Ay.bold(c.Ay.white(E)):c.Ay.white(E),P=x?c.Ay.white(M):c.Ay.gray(M),R=M?`${$}${u}${P}`:`${$}`,L=`+${Math.max(0,null!==(r=p.totalAdded)&&void 0!==r?r:0)}`,F=`-${Math.max(0,null!==(s=p.totalRemoved)&&void 0!==s?s:0)}`,z=`  ${c.Ay.green(L)} ${c.Ay.red(F)}`,N=h?x?z:c.Ay.dim(z):"",U=Math.max(0,V-D-_-i(R+g)-1-k.length),B=`${C}${T}${R}${N}${" ".repeat(U)} ${I}${" ".repeat(D)}`;Q.write(`[${f};1H[2K${B}`)}else{const e=l(Y,O),t=x?c.Ay.bold(c.Ay.white(e)):c.Ay.white(e),n=Math.max(0,V-D-_-i(t)-1-k.length),o=`${C}${T}${t}${" ".repeat(n)} ${I}${" ".repeat(D)}`;Q.write(`[${f};1H[2K${o}`)}}}const h=Z-1,g=Z,f="─".repeat(V);if(Q.write(`[${h};1H[2K${c.Ay.gray(f)}`),E.length>0){const e=`${Math.min($+1,E.length)}/${E.length}`,t="↑↓/jk: navigate • Enter: select • Backspace: delete • Ctrl-D/q/ESC: back",n=`${c.Ay.bold(e)} ${c.Ay.gray("•")} ${c.Ay.gray(t)}`,o=Math.max(0,Math.floor((V-(e.length+3+t.length))/2));Q.write(`[${g};1H[2K${" ".repeat(o)}${n}`)}else{const e="Ctrl-D/q/ESC: back",t=Math.max(0,Math.floor((V-e.length)/2));Q.write(`[${g};1H[2K${" ".repeat(t)}${c.Ay.gray(e)}`)}if(L){const e=z,t=U,n=[{label:q,hint:"y"},{label:W,hint:"esc/n"}],o=Math.max(30,Math.min(72,V-8)),r=Math.max(10,o-2),s=e=>{const t=(null!=e?e:"").trim();return i(t)<=r-2?t:`${(0,m.aJ)(t).slice(0,Math.max(0,r-5))}...`},l=s(e),a=t?s(t):void 0,d=n.map(((e,t)=>{const n=t===Y,o=n?"→ ":"  ",s=e.hint?` ${c.Ay.gray(e.hint)}`:"",l=e.label,a=`${o}${l}${(0,m.aJ)(s)?` ${e.hint}`:""}`,d=(0,m.aJ)(a).length>r-2?`${(0,m.aJ)(a).slice(0,Math.max(0,r-5))}...`:a,u=n?`${c.Ay.white("→ ")}${c.Ay.black.bgYellow(l)}`+(e.hint?` ${c.Ay.gray(e.hint)}`:""):`  ${c.Ay.white(l)}`+(e.hint?` ${c.Ay.gray(e.hint)}`:"");return i(u)>r-2?(0,m.aJ)(d):u})),u=[c.Ay.white(l),...a?[c.Ay.gray(a)]:[],...d],p=c.Ay.yellow,h=2+u.length,g=4+Math.max(0,Math.floor((ee-h)/2)),f=Math.max(1,Math.floor((V-o)/2)+1),v=`${p("┌")}${p("─".repeat(o-2))}${p("┐")}`;Q.write(`[${g};${f}H${v}`);for(let e=0;e<u.length;e++){const t=g+1+e,n=u[e];Q.write(`[${t};${f}H${p("│")}`),Q.write(` ${n}`);const r=f+o-1;Q.write(`[${t};${r}H${p("│")}`)}const x=`${p("└")}${p("─".repeat(o-2))}${p("┘")}`;Q.write(`[${g+h-1};${f}H${x}`)}}),[Q,E,$,I,ee,V,Z,A,L,Y,z,U,q,W]),null};o()}catch(e){o(e)}}))},"./src/components/update-todos-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{v:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/utils/abort-label.ts"),l=n("./src/components/todos-ui.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:e,aborted:t,abortedReason:n})=>{if(t)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsxs)(s.EY,{color:"foreground",children:[(0,r.jsx)(s.EY,{bold:!0,children:"Update to-dos"})," ",(0,r.jsx)(s.EY,{color:"gray",children:(0,i.P)(n)})]})})});if(!e.result)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(l.S,{todos:[],mode:"update",loading:!0})});const o=e.result.result;switch(null==o?void 0:o.case){case"success":return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(l.S,{todos:o.value.todos,totalCount:o.value.totalCount,mode:"update",showHeader:!0})});case"error":return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.EY,{color:"gray",children:o.value.error})});default:return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(l.S,{todos:[],mode:"update"})})}};o()}catch(e){o(e)}}))},"./src/components/usage-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{z:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/utils/input-keys.ts"),a=e([s]);s=(a.then?(await a)():a)[0];const c=({dailyMetrics:e,onClose:t})=>{var n,o,a;(0,i.useEffect)((()=>{var e;const t=process.stdin,n=t.isRaw;try{null===(e=t.setRawMode)||void 0===e||e.call(t,!0)}catch(e){}return()=>{var e;try{n||null===(e=t.setRawMode)||void 0===e||e.call(t,!1)}catch(e){}}}),[]),(0,s.Ge)(((e,n)=>{((0,l.xv)(e,n)||"q"===e||n.ctrl&&"c"===e)&&t()}));const c=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,d=new Map,u=[];let p=0;for(const t of e){const e=c(new Date(t.date));if(e){const o=t.agentLines+t.tabLines,r=null!==(n=d.get(e))&&void 0!==n?n:0;d.set(e,r+o),p+=o,o>0&&!u.includes(e)&&u.push(e)}}const h=(e,t)=>(e=>{const[t,n,o]=e.split("-").map(Number),r=new Date(t,n-1,o);return r.setDate(r.getDate()+1),c(r)})(e)===t,g=(e=>{if(0===e.length)return{longest:0,current:0};const t=[...new Set(e)].sort();let n=1,o=1;for(let e=1;e<t.length;e++){const r=t[e-1],s=t[e];h(r,s)?(o++,o>n&&(n=o)):o=1}const r=new Date;r.setHours(0,0,0,0);const s=new Date(r);s.setDate(s.getDate()-1);const i=c(r),l=c(s);let a=0;if(t.length>0){const e=t[t.length-1];if(e===i||e===l){a=1;for(let e=t.length-2;e>=0;e--){const n=t[e],o=t[e+1];if(!h(n,o))break;a++}}}return{longest:n,current:a}})(u),m=new Date;m.setHours(0,0,0,0);const f=new Date(m);f.setDate(1),f.setMonth(f.getMonth()-11);const v=new Date(f);v.setDate(v.getDate()-v.getDay());const x=new Date(m);6!==x.getDay()&&x.setDate(x.getDate()+(6-x.getDay()));const b=[],y=new Date(v);let w=[null,null,null,null,null,null,null];for(;y<=x;){const e=c(y),t=y>m?0:null!==(o=d.get(e))&&void 0!==o?o:0,n=y.getDay();w[n]={date:new Date(y),value:t},6===n&&(b.push(w),w=[null,null,null,null,null,null,null]),y.setDate(y.getDate()+1)}w.some((e=>null!==e))&&b.push(w);let j=1;for(const e of b)for(const t of e)t&&t.value>j&&(j=t.value);const k=["J","F","M","A","M","J","J","A","S","O","N","D"],C=new Array(b.length).fill("");for(let e=0;e<b.length;e++){const t=b[e];if(t)for(const n of t)if(n&&1===n.date.getDate()){C[e]=null!==(a=k[n.date.getMonth()])&&void 0!==a?a:"";break}}return(0,r.jsxs)(s.az,{flexDirection:"column",padding:1,children:[(0,r.jsxs)(s.az,{marginBottom:1,children:[(0,r.jsx)(s.EY,{bold:!0,color:"cyan",children:"Agent Edits"}),(0,r.jsx)(s.EY,{color:"gray",children:"   (Esc to close)"})]}),(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:"gray",children:"─".repeat(60)})}),(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Accepted lines (last 12 months)"}),(0,r.jsx)(s.EY,{bold:!0,color:"cyan",children:(S=p,S.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"  "}),C.map(((e,t)=>(0,r.jsx)(s.EY,{dimColor:!0,children:e?e.padEnd(2):"  "},`month-${t}`)))]}),["","M","","W","","F",""].map(((e,t)=>(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:`${e||" "} `}),b.map(((e,n)=>{const o=e[t],i=o?o.date.toISOString():`empty-${n}`;if(o){const e=(e=>{if(0===e)return{char:"·",color:"gray"};const t=e/j;return t>.75?{char:"█",color:"green"}:t>.5?{char:"▓",color:"green"}:t>.25?{char:"▒",color:"green"}:{char:"░",color:"green"}})(o.value);return(0,r.jsx)(s.EY,{color:e.color,dimColor:0===o.value,children:`${e.char} `},i)}return(0,r.jsx)(s.EY,{dimColor:!0,children:"  "},i)}))]},`day-${t}`))),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Current streak: "}),(0,r.jsxs)(s.EY,{color:g.current>0?"green":"gray",children:[g.current," day",1!==g.current?"s":""]}),(0,r.jsx)(s.EY,{dimColor:!0,children:"   "}),(0,r.jsx)(s.EY,{dimColor:!0,children:"Longest streak: "}),(0,r.jsxs)(s.EY,{color:"cyan",children:[g.longest," day",1!==g.longest?"s":""]})]}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Less "}),(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"·"}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"green",children:"░"}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"green",children:"▒"}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"green",children:"▓"}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"green",children:"█"}),(0,r.jsx)(s.EY,{dimColor:!0,children:" More"})]})]}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"View more at "}),(0,r.jsx)(s.EY,{color:"blue",children:"https://cursor.com/dashboard?tab=analytics"})]})]});var S};o()}catch(e){o(e)}}))},"./src/components/user-message-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{H:()=>h});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/context/theme-context.tsx"),c=n("./src/hooks/use-screen-size.ts"),d=n("./src/utils/color-mixing.ts"),u=n("./src/utils/text-wrapping.ts"),p=e([s,a,c]);[s,a,c]=p.then?(await p)():p;const h=({content:e,isFollowup:t=!1})=>{const n=(0,c.l)(),o=(0,a.pW)(),p=(0,a.xl)(),h=(0,i.useMemo)((()=>{const e=t?o?l.qK:l.ew:o?l.jF:l.DO;return(0,d.Po)(p,e)}),[o,t,p]),g=Math.max(1,n.width-10),m=(0,u.F)(e,l.p9,g);return(0,r.jsx)(s.az,{backgroundColor:h,paddingLeft:1,paddingRight:5,paddingY:1,marginX:1,width:n.width-2,children:(0,r.jsx)(s.EY,{color:"foreground",wrap:"wrap",children:m})})};o()}catch(e){o(e)}}))},"./src/components/web-fetch-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{n:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;const a=null!==(n=e.url)&&void 0!==n?n:"";let c,d,u="pending";switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:u="pending";break;case"error":u="error",c=(null==t?void 0:t.result.value.error)||"Unknown error";break;case"success":u="success";break;case"rejected":u="rejected",d=(null==t?void 0:t.result.value.reason)||"Web fetch rejected";break;default:u="pending"}return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"WebFetch",primary:a,status:u,note:d}),c&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",c]})})]})};o()}catch(e){o(e)}}))},"./src/components/web-search-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{F:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o,a,c;if(!e)return null;const d=null!==(n=e.searchTerm)&&void 0!==n?n:"";let u,p,h,g="pending";switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:g="pending";break;case"error":g="error",p=(null==t?void 0:t.result.value.error)||"Unknown error";break;case"success":g="success",h=null!==(c=null===(a=null==t?void 0:t.result.value.references)||void 0===a?void 0:a.length)&&void 0!==c?c:0;break;case"rejected":g="rejected",u=(null==t?void 0:t.result.value.reason)||"Web search rejected";break;default:g="pending"}return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"WebSearch",primary:d,status:g,note:u}),p&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",p]})}),"success"===g&&void 0!==h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{dimColor:!0,children:["Found ",h," reference",1!==h?"s":""]})})]})};o()}catch(e){o(e)}}))},"./src/components/write-shell-stdin-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=String.fromCharCode(4),d=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;const a=`shell ${e.shellId}`,d=function(e,t=50){const n=e.split(c).join("<EOF>").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t");return n.length>t?`${n.slice(0,t-3)}...`:n}(e.chars);let u,p="pending";const h=null==t?void 0:t.result,g=null==h?void 0:h.case;switch(g){case void 0:p="pending";break;case"success":p="success";break;case"error":p="error",u=String(null!==(o=null===(n=null==h?void 0:h.value)||void 0===n?void 0:n.error)&&void 0!==o?o:"")||"Write failed";break;default:p="pending"}const m=(0,i.F_)("writeShellStdinToolCall","success"===p)||("success"===p?"Wrote to stdin":"Writing to stdin");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:m,primary:a,status:p}),(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:d?`"${d}"`:"(empty)"})}),"error"===g&&u&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"red",children:u})})]})};o()}catch(e){o(e)}}))},"./src/context/agent-state-context.tsx":(e,t,n)=>{n.d(t,{C9:()=>a,oG:()=>l,tO:()=>c});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),s=n("./src/analytics.ts");const i=(0,r.createContext)(null),l=({children:e,fileChangeTracker:t,pendingDecisionStore:n,configProvider:l,initialViewMode:a="chat",initialInputValue:c="",initialIsCompact:d=!0,initialAgentStore:u,modelManager:p})=>{const[h,g]=(0,r.useState)((()=>t.getChanges())),[m,f]=(0,r.useState)(a),[v,x]=(0,r.useState)(p.getCurrentModel()),[b,y]=(0,r.useState)(c),[w,j]=(0,r.useState)(n.getPendingDecisions()),[k,C]=(0,r.useState)([]),[S,E]=(0,r.useState)(0),[M,$]=(0,r.useState)(u),[T,I]=(0,r.useState)(!1),[P,A]=(0,r.useState)(!1),[D,_]=(0,r.useState)(d),[R,L]=(0,r.useState)((()=>M.getMetadata("mode"))),[O,Y]=(0,r.useState)(null),[F,z]=(0,r.useState)(null),[N,U]=(0,r.useState)(null),B=(0,r.useCallback)((e=>{return t=void 0,n=void 0,r=function*(){l?yield p.setCurrentModel(e,l):p.setCurrentModelWithoutPersistence(e),(0,s.sx)("cli.model.select",{model:e.modelId})},new((o=void 0)||(o=Promise))((function(e,s){function i(e){try{a(r.next(e))}catch(e){s(e)}}function l(e){try{a(r.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,l)}a((r=r.apply(t,n||[])).next())}));var t,n,o,r}),[l,p]);(0,r.useEffect)((()=>{const e=t.subscribe((()=>{g(t.getChanges())}));return g(t.getChanges()),e}),[t]),(0,r.useEffect)((()=>{const e=n.subscribe((e=>{j(e)}));return j(n.getPendingDecisions()),e}),[n]),(0,r.useEffect)((()=>{const e=M.subscribeToMetadata("mode",(e=>{L(e)}));return L(M.getMetadata("mode")),e}),[M]),(0,r.useEffect)((()=>{const e=()=>{const e=M.getConversationStateStructure(),t=null==e?void 0:e.tokenDetails,n="number"==typeof(null==t?void 0:t.usedTokens)&&Number.isFinite(t.usedTokens)?t.usedTokens:null,o="number"==typeof(null==t?void 0:t.maxTokens)&&Number.isFinite(t.maxTokens)?t.maxTokens:null;if(Y(n),z(o),null!=n&&null!=o&&o>0){const e=Math.max(0,Math.min(100,Math.round(n/o*100*10)/10));U(e)}else U(null)},t=[];return t.push(M.subscribeToMetadata("latestRootBlobId",(()=>{e()}))),e(),()=>{for(const e of t)try{e()}catch(e){}}}),[M]),(0,r.useEffect)((()=>p.subscribe((e=>{x(e)}))),[p]);const q=(0,r.useCallback)((e=>{n.approveDecision(e)}),[n]),H=(0,r.useCallback)(((e,t)=>{n.rejectDecision(e,t)}),[n]),W=(0,r.useCallback)((e=>n.requestApproval(e)),[n]);return(0,o.jsx)(i.Provider,{value:{changedFiles:h,viewMode:m,setViewMode:f,mode:R,currentModel:v,setCurrentModel:B,inputValue:b,setInputValue:y,pendingDecisions:w,approvePendingDecision:q,rejectPendingDecision:H,requestApproval:W,queuedMessages:k,setQueuedMessages:C,reviewSelectedIndex:S,setReviewSelectedIndex:E,agentStore:M,setAgentStore:$,modelManager:p,isGenerating:T,setIsGenerating:I,isSummarizing:P,setIsSummarizing:A,isCompact:D,setIsCompact:_,conversationTokensUsed:O,conversationMaxTokens:F,conversationTokenPercent:N},children:e})},a=()=>{const e=(0,r.useContext)(i);if(!e)throw new Error("useAgentState must be used within an AgentStateProvider");return e},c=()=>a().isCompact},"./src/context/config-context.tsx":(e,t,n)=>{n.d(t,{$i:()=>a,HS:()=>c,t1:()=>i});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const s=(0,r.createContext)(void 0),i=({children:e,configProvider:t})=>{const n=t.get();return(0,o.jsx)(s.Provider,{value:{config:n,configProvider:t},children:e})},l=()=>{const e=(0,r.useContext)(s);if(void 0===e)throw new Error("useConfig must be used within a ConfigContextProvider");return e},a=()=>{var e,t;const{config:n}=l();return null!==(t=null===(e=n.display)||void 0===e?void 0:e.showLineNumbers)&&void 0!==t&&t},c=()=>{var e,t;const{config:n}=l();return null!==(t=null===(e=n.display)||void 0===e?void 0:e.showThinkingBlocks)&&void 0!==t&&t}},"./src/context/slash-command-context.tsx":(e,t,n)=>{n.d(t,{E:()=>i,x:()=>l});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const s=(0,r.createContext)(null),i=({children:e})=>{const[t,n]=(0,r.useState)([]),i=(0,r.useCallback)((e=>{n((t=>[...t.filter((t=>t.id!==e.id)),e]))}),[]),l=(0,r.useCallback)((e=>{n((t=>t.filter((t=>t.id!==e))))}),[]);return(0,o.jsx)(s.Provider,{value:{dynamicCommands:t,registerCommand:i,unregisterCommand:l},children:e})},l=()=>{const e=(0,r.useContext)(s);if(!e)throw new Error("useSlashCommandRegistry must be used within SlashCommandProvider");return e}},"./src/context/sudo-password-context.tsx":(e,t,n)=>{n.d(t,{S:()=>i,h:()=>l});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const s=(0,r.createContext)(null);function i({store:e,children:t}){return(0,o.jsx)(s.Provider,{value:e,children:t})}function l(){return(0,r.useContext)(s)}},"./src/context/terminal-state-context.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{PH:()=>u,rs:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=(0,i.createContext)(null),c=({children:e})=>{const[t,n]=(0,i.useState)(0),[o,l]=(0,i.useState)(0),[c,d]=(0,i.useState)(0),[u,p]=(0,i.useState)(null),h=(0,s.t$)().stdout,g=(0,i.useRef)(null),m=(0,i.useRef)(null),f=(0,i.useCallback)((e=>{n((e=>e+1)),e&&p(e)}),[]),v=(0,i.useCallback)((e=>{l((e=>e+1))}),[]),x=(0,i.useCallback)((e=>{d((e=>e+1))}),[]);return(0,i.useEffect)((()=>{const e=h;if(!e)return;const t=()=>{const t=e.columns,n=e.rows;null===g.current&&(g.current=t),null===m.current&&(m.current=n);const o=t!==g.current,r=n!==m.current;o&&(g.current=t,v()),r&&(m.current=n,x()),(o||r)&&f()};return e.on("resize",t),t(),()=>{e.off("resize",t)}}),[h,v,x,f]),(0,r.jsx)(a.Provider,{value:{terminalEpoch:t,widthEpoch:o,heightEpoch:c,lastReason:u,bumpTerminalEpoch:f,bumpWidthEpoch:v,bumpHeightEpoch:x},children:e})},d=()=>{const e=(0,i.useContext)(a);if(!e)throw new Error("useTerminalState must be used within a TerminalStateProvider");return e},u=()=>d().widthEpoch;o()}catch(e){o(e)}}))},"./src/conversation/dynamic-item.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{C:()=>b});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/components/create-plan-tool-ui.tsx"),a=n("./src/components/index.ts"),c=n("./src/components/markdown.tsx"),d=n("./src/components/merged-read-search-tool-ui.tsx"),u=n("./src/components/plan-execution-message.tsx"),p=n("./src/components/running-agents-ui.tsx"),h=n("./src/components/shell-turn-ui.tsx"),g=n("./src/conversation/tool-call.tsx"),m=e([s,l,a,c,d,u,p,h,g]);[s,l,a,c,d,u,p,h,g]=m.then?(await m)():m;const f=200,v=({content:e})=>{const[t,n]=(0,i.useState)(e),o=(0,i.useRef)(null),s=(0,i.useRef)(0),l=(0,i.useRef)(!0),a=(0,i.useMemo)((()=>t.split("\n\n").length),[t]),d=(0,i.useMemo)((()=>e.split("\n\n").length),[e]);return(0,i.useEffect)((()=>{if(o.current&&clearTimeout(o.current),l.current||a<d)return n(e),s.current=performance.now(),void(l.current=!1);const t=performance.now(),r=t-s.current;if(r>=f)return n(e),void(s.current=t);const i=f-r;return o.current=setTimeout((()=>{n(e),s.current=performance.now()}),i),()=>{o.current&&clearTimeout(o.current)}}),[e,a,d]),(0,r.jsx)(c.Ay,{content:t})},x=!1,b=({item:e,options:t})=>{var n;if(x)return(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(s.EY,{color:"red",children:JSON.stringify(e,null,2)})});if("agent-text"===e.type){const t=e.completed?e.text:e.text.includes("\n")?e.text.slice(0,e.text.lastIndexOf("\n")):e.text;return(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(v,{content:t})})}return"plan-execution"===e.type?(0,r.jsx)(u.p,{content:e.message}):"user-message"===e.type?t.hideUserMessages?null:(0,r.jsx)(a.Hw,{content:e.message}):"agent-tool-calls"===e.type?e.calls.every((e=>"taskToolCall"===e.call.tool.case))&&e.calls.length>0?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(p.q,{agents:e.calls.map((e=>{var t;const n="task"===(null===(t=e.additionalData)||void 0===t?void 0:t.type)?e.additionalData:void 0;return(0,p.e)(e.id,e.call.tool.value,n,{completed:e.completed,aborted:e.aborted,abortReason:e.abortReason})}))})}):e.calls.length>1?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(d.r,{tools:e.calls})}):(0,r.jsx)(s.az,{flexDirection:"column",children:e.calls.map((n=>(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(g.S,{call:n,options:t,isLastStepOfTurn:e.isLastStepOfTurn,isLastTurn:e.isLastTurn})},n.id)))}):"plan"===e.type?"createPlanToolCall"!==e.call.tool.case?null:(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(l.U,{tool:e.call.tool.value,isSuggestingPlan:!0,planDecisionIndex:null!==(n=t.planDecisionIndex)&&void 0!==n?n:e.decisionIndex,state:"pending",isRepository:t.isRepository})}):"shell-turn"===e.type?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(h.o,{command:e.command,output:e.stdout,exitCode:e.exitCode})}):null};o()}catch(e){o(e)}}))},"./src/conversation/static-item.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{j:()=>y});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/app-header.tsx"),l=n("./src/components/create-plan-tool-ui.tsx"),a=n("./src/components/markdown.tsx"),c=n("./src/components/merged-read-search-tool-ui.tsx"),d=n("./src/components/plan-execution-message.tsx"),u=n("./src/components/running-agents-ui.tsx"),p=n("./src/components/shell-turn-ui.tsx"),h=n("./src/components/summary.tsx"),g=n("./src/components/thinking-block-ui.tsx"),m=n("./src/components/user-message-ui.tsx"),f=n("./src/context/config-context.tsx"),v=n("./src/conversation/tool-call.tsx"),x=e([s,i,l,a,c,d,u,p,h,g,m,v]);[s,i,l,a,c,d,u,p,h,g,m,v]=x.then?(await x)():x;const b=!1,y=({item:e,options:t})=>{const n=(0,f.HS)();return b?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(s.EY,{children:JSON.stringify(e,null,2)})}):"summary"===e.type?(0,r.jsx)(h.B,{summary:e.summary}):"agent-text"===e.type?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(a.Ay,{content:e.text})}):"debug-info"===e.type?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsxs)(s.EY,{children:["Debug info: ",e.serverUrl]})}):"header"===e.type?(0,r.jsx)(i.j,{isRepository:e.isRepository,folderMode:e.folderMode}):"plan-execution"===e.type?(0,r.jsx)(d.p,{content:e.message}):"user-message"===e.type?t.hideUserMessages?null:(0,r.jsx)(m.H,{content:e.message}):"agent-tool-calls"===e.type?e.calls.every((e=>"taskToolCall"===e.call.tool.case))&&e.calls.length>0?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(u.q,{agents:e.calls.map((e=>{var t;const n="task"===(null===(t=e.additionalData)||void 0===t?void 0:t.type)?e.additionalData:void 0;return(0,u.e)(e.id,e.call.tool.value,n,{completed:e.completed,aborted:e.aborted,abortReason:e.abortReason})}))})}):e.calls.length>1?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(c.r,{tools:e.calls})}):(0,r.jsx)(s.az,{flexDirection:"column",children:e.calls.map((n=>(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(v.S,{call:n,options:t,isLastStepOfTurn:!1,isLastTurn:e.isLastTurn})},n.id)))}):"plan"===e.type?"createPlanToolCall"!==e.call.tool.case?null:(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(l.U,{tool:e.call.tool.value,isSuggestingPlan:!1,planDecisionIndex:e.decisionIndex,state:0===e.decisionIndex?"accepted":"rejected"})}):"shell-turn"===e.type?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(p.o,{command:e.command,output:e.stdout,exitCode:e.exitCode})}):"agent-thinking"===e.type&&n?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(g.S,{content:e.content,thoughtIndex:e.thoughtIndex,durationMs:e.durationMs})}):null};o()}catch(e){o(e)}}))},"./src/conversation/tool-call.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>$});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/ask-question-tool-ui.tsx"),l=n("./src/components/create-plan-tool-ui.tsx"),a=n("./src/components/delete-tool-ui.tsx"),c=n("./src/components/edit-tool-ui.tsx"),d=n("./src/components/fetch-mcp-resource-tool-ui.tsx"),u=n("./src/components/glob-tool-ui.tsx"),p=n("./src/components/grep-tool-ui.tsx"),h=n("./src/components/list-mcp-resources-tool-ui.tsx"),g=n("./src/components/ls-tool-ui.tsx"),m=n("./src/components/mcp-tool-ui.tsx"),f=n("./src/components/read-lints-tool-ui.tsx"),v=n("./src/components/read-todos-tool-ui.tsx"),x=n("./src/components/read-tool-ui.tsx"),b=n("./src/components/sem-search-tool-ui.tsx"),y=n("./src/components/shell-tool-ui.tsx"),w=n("./src/components/switch-mode-tool-ui.tsx"),j=n("./src/components/task-tool-ui.tsx"),k=n("./src/components/update-todos-tool-ui.tsx"),C=n("./src/components/web-fetch-tool-ui.tsx"),S=n("./src/components/web-search-tool-ui.tsx"),E=n("./src/components/write-shell-stdin-tool-ui.tsx"),M=e([s,i,l,a,c,d,u,p,h,g,m,f,v,x,b,y,w,j,k,C,S,E]);[s,i,l,a,c,d,u,p,h,g,m,f,v,x,b,y,w,j,k,C,S,E]=M.then?(await M)():M;const $=({call:{call:e,aborted:t,abortReason:n,additionalData:o},isLastStepOfTurn:M,isLastTurn:$,options:{isCompact:T,isSuggestingPlan:I,isGenerating:P,planDecisionIndex:A,shellManager:D,isRepository:_}})=>{switch(e.tool.case){case"shellToolCall":{const o=!T&&!!$;return(0,r.jsx)(y.f,{tool:e.tool.value,expand:o,aborted:t,abortedReason:n,shellManager:D})}case"deleteToolCall":return(0,r.jsx)(a.Y,{tool:e.tool.value});case"grepToolCall":return(0,r.jsx)(p.h,{tool:e.tool.value});case"semSearchToolCall":return(0,r.jsx)(b.S,{tool:e.tool.value});case"globToolCall":return(0,r.jsx)(u.P,{tool:e.tool.value});case"editToolCall":return(0,r.jsx)(c.N,{tool:e.tool.value,aborted:t,abortedReason:n});case"readToolCall":return(0,r.jsx)(x.B,{tool:e.tool.value});case"readLintsToolCall":return(0,r.jsx)(f.A,{tool:e.tool.value});case"updateTodosToolCall":return(0,r.jsx)(k.v,{tool:e.tool.value,aborted:t,abortedReason:n});case"readTodosToolCall":return(0,r.jsx)(v.w,{tool:e.tool.value,aborted:t,abortedReason:n});case"lsToolCall":return(0,r.jsx)(g.U,{tool:e.tool.value});case"mcpToolCall":return(0,r.jsx)(m.v,{tool:e.tool.value});case"listMcpResourcesToolCall":return(0,r.jsx)(h.A,{tool:e.tool.value});case"readMcpResourceToolCall":return(0,r.jsx)(d.J,{tool:e.tool.value});case"webSearchToolCall":return(0,r.jsx)(S.F,{tool:e.tool.value});case"webFetchToolCall":return(0,r.jsx)(C.n,{tool:e.tool.value});case"taskToolCall":{const s="task"===(null==o?void 0:o.type)?o:void 0;return(0,r.jsx)(j.K,{tool:e.tool.value,aborted:t,abortedReason:n,additionalData:s})}case"writeShellStdinToolCall":return(0,r.jsx)(E.S,{tool:e.tool.value});case"askQuestionToolCall":return(0,r.jsx)(i.S,{tool:e.tool.value});case"switchModeToolCall":return(0,r.jsx)(w.U,{tool:e.tool.value});case"createPlanToolCall":{const t=M&&$?I?"pending":P?"accepted":"rejected":M?"rejected":"accepted",n=I||!T&&!!$;return(0,r.jsx)(l.U,{tool:e.tool.value,isSuggestingPlan:I,planDecisionIndex:A,state:t,expand:n,isRepository:_})}default:return(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{color:"red",children:["Unknown tool type: ",JSON.stringify(e.tool.case)]})})}};o()}catch(e){o(e)}}))},"./src/cursor-blame/cli-conversation-classification.ts":(e,t,n)=>{n.d(t,{Z:()=>m});var o=n("node:fs/promises"),r=n("node:os"),s=n("node:path"),i=n("../agent-analytics/dist/index.js"),l=n("../proto/dist/generated/aiserver/v1/analytics_pb.js"),a=n("./src/client.ts"),c=n("./src/debug.ts"),d=n("./src/statsig.ts"),u=n("./src/transcript/cli-transcript-writer.ts"),p=n("./src/cursor-blame/sqlite-adapter.ts"),h=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const g=(0,s.join)((0,r.homedir)(),".cursor","ai-tracking","ai-code-tracking.db");class m{constructor(e){var t,n;this.options=e,this.inFlightClassifications=new Map,this.conversationMeta=null,this.pollInProgress=!1,this.storageInitPromise=null,this.analyticsClient=(0,a.Mr)(e.credentialManager,{endpoint:e.backendUrl,insecure:e.insecure,configProvider:e.configProvider}),this.transcriptsDir=(0,u.$J)(e.workspacePath);const o=(0,p.$)();this.storage=new i.Ou(o,null!==(t=e.dbPath)&&void 0!==t?t:g),(0,c.debugLog)("conversationClassification.init",{conversationId:e.conversationId,workspacePath:e.workspacePath,backendUrl:e.backendUrl,dbPath:null!==(n=e.dbPath)&&void 0!==n?n:g,transcriptsDir:this.transcriptsDir,insecure:!0===e.insecure})}startPolling(){this.scheduleNextPoll()}updateConversationMeta(e){var t,n;this.conversationMeta||(0,c.debugLog)("conversationClassification.meta.initial",{conversationId:this.options.conversationId,lastUpdatedAt:e.lastUpdatedAt,model:null!==(t=e.model)&&void 0!==t?t:"unknown",mode:null!==(n=e.mode)&&void 0!==n?n:"unknown"}),this.conversationMeta=e}dispose(){return h(this,void 0,void 0,(function*(){if(this.classificationPollingTimeoutId&&(clearTimeout(this.classificationPollingTimeoutId),this.classificationPollingTimeoutId=void 0),this.inFlightClassifications.size>0){for(const e of this.inFlightClassifications.values())e.abort();this.inFlightClassifications.clear()}(0,c.debugLog)("conversationClassification.dispose",{conversationId:this.options.conversationId}),yield this.storage.close()}))}scheduleNextPoll(){var e,t;this.classificationPollingTimeoutId&&clearTimeout(this.classificationPollingTimeoutId);const n=.1*(2*Math.random()-1),o=Math.floor(6e5*(1+n));this.classificationPollingTimeoutId=setTimeout((()=>{this.classificationPollingTimeoutId=void 0,this.pollAndScheduleNext()}),o),null===(t=(e=this.classificationPollingTimeoutId).unref)||void 0===t||t.call(e)}pollAndScheduleNext(){return h(this,void 0,void 0,(function*(){if(this.pollInProgress)this.scheduleNextPoll();else{this.pollInProgress=!0;try{yield this.classifyConversationIfNeeded()}catch(e){(0,c.debugLog)("conversationClassification.poll.error",{error:e})}finally{this.pollInProgress=!1,this.scheduleNextPoll()}}}))}classifyConversationIfNeeded(){return h(this,void 0,void 0,(function*(){if(!(yield this.isClassificationEnabled()))return;if(this.inFlightClassifications.size>0)return;const e=yield this.listRecentConversationsFromDisk();if(0===e.length)return;const t=e.map((e=>e.conversationId===this.options.conversationId&&this.conversationMeta?Object.assign(Object.assign({},e),this.conversationMeta):e));yield this.ensureStorageReady();const n=t.map((e=>e.conversationId)),o=yield this.storage.getConversationSummaryTimestamps(n);let r=t.filter((e=>this.shouldScoreConversation(e,o)));r=r.sort(((e,t)=>{const n=void 0===o[e.conversationId];return n!==(void 0===o[t.conversationId])?n?-1:1:t.lastUpdatedAt-e.lastUpdatedAt}));const s=r.slice(0,10);s.length>0&&(0,c.debugLog)("conversationClassification.classify.batch",{conversationId:this.options.conversationId,total:t.length,queued:s.length});for(const e of s)this.classifySingleConversation(e)}))}shouldScoreConversation(e,t){const n=t[e.conversationId];return void 0===n||e.lastUpdatedAt>n}listRecentConversationsFromDisk(){return h(this,void 0,void 0,(function*(){try{const e=(yield(0,o.readdir)(this.transcriptsDir,{withFileTypes:!0})).filter((e=>e.isFile()&&e.name.endsWith(".txt")));let t=(yield Promise.all(e.map((e=>h(this,void 0,void 0,(function*(){const t=(0,s.join)(this.transcriptsDir,e.name);try{const n=yield(0,o.stat)(t);return{conversationId:e.name.slice(0,-4),lastUpdatedAt:n.mtimeMs}}catch(e){return}})))))).filter((e=>Boolean(e)));return this.conversationMeta&&(t.some((e=>e.conversationId===this.options.conversationId))||(t=[...t,Object.assign({conversationId:this.options.conversationId},this.conversationMeta)])),t=t.sort(((e,t)=>t.lastUpdatedAt-e.lastUpdatedAt)).slice(0,100),t}catch(e){return(0,c.debugLog)("conversationClassification.scan.error",{error:e}),[]}}))}classifySingleConversation(e){var t;const n=this.inFlightClassifications.get(e.conversationId);n&&n.abort();const o=new AbortController;this.inFlightClassifications.set(e.conversationId,o);const r=setTimeout((()=>{o.abort()}),3e4);null===(t=r.unref)||void 0===t||t.call(r),this.doClassifyConversation(e,o.signal).catch((t=>{(0,c.debugLog)("conversationClassification.classify.error",{conversationId:e.conversationId,error:t})})).finally((()=>{clearTimeout(r),this.inFlightClassifications.get(e.conversationId)===o&&this.inFlightClassifications.delete(e.conversationId)}))}doClassifyConversation(e,t){return h(this,void 0,void 0,(function*(){var n,o;if(t.aborted)return!1;const r=yield this.readTranscriptFromDisk(e.conversationId).catch((()=>{}));r||(0,c.debugLog)("conversationClassification.transcript.missing",{conversationId:e.conversationId});const s=null!==(n=e.mode)&&void 0!==n?n:"unknown",i=null!==(o=e.model)&&void 0!==o?o:"unknown",a=yield this.analyticsClient.ingestConversation(new l.$g({conversationId:e.conversationId,transcript:(null==r?void 0:r.trim())||"",transcriptJson:"",mode:s,model:i,lastUpdatedAt:BigInt(e.lastUpdatedAt)}),{signal:t});return yield this.storeSummaryResponse(e.conversationId,a,e),!0===a.success}))}storeSummaryResponse(e,t,n){return h(this,void 0,void 0,(function*(){var o,r,s;if(t.success&&t.summary)try{yield this.ensureStorageReady(),yield this.storage.storeConversationSummary({conversationId:e,title:null!==(o=n.title)&&void 0!==o?o:null,tldr:null!==(r=t.summary)&&void 0!==r?r:null,overview:null!==(s=t.detailedSummary)&&void 0!==s?s:null,summaryBullets:[],model:n.model&&"unknown"!==n.model?n.model:null,mode:n.mode&&"unknown"!==n.mode?n.mode:null,updatedAt:n.lastUpdatedAt}),(0,c.debugLog)("conversationClassification.storeSummary.success",{conversationId:e,lastUpdatedAt:n.lastUpdatedAt})}catch(t){(0,c.debugLog)("conversationClassification.storeSummary.error",{conversationId:e,error:t})}}))}readTranscriptFromDisk(e){return h(this,void 0,void 0,(function*(){const t=(0,u.kw)(this.options.workspacePath,e);try{return yield(0,o.readFile)(t,"utf-8")}catch(e){return}}))}isClassificationEnabled(){return h(this,void 0,void 0,(function*(){var e,t;if(!(0,d.QF)("cursor_blame"))return!1;if(!(null===(e=this.options.configProvider.get().authInfo)||void 0===e?void 0:e.teamId))return!0;try{const e=yield this.options.teamSettingsService.getTeamAdminSettings(),n=null==e?void 0:e.cursorBlameSettings;return null!==(t=null==n?void 0:n.enabled)&&void 0!==t&&t}catch(e){return(0,c.debugLog)("conversationClassification.teamSettings.error",{error:e}),!1}}))}ensureStorageReady(){return h(this,void 0,void 0,(function*(){this.storageInitPromise||(this.storageInitPromise=this.storage.initialize()),yield this.storageInitPromise}))}}},"./src/execution-mode/approval.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{K:()=>l});var r=n("./src/components/approval-dialog.tsx"),s=e([r]);r=(s.then?(await s)():s)[0];var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function l(e){return i(this,void 0,void 0,(function*(){if(!0!==e.get().showSandboxIntro)return!1;const t=yield(0,r.b)({title:"Command Execution",description:["Cursor can execute commands safely in a sandbox. \nChoose how commands should be executed:"],options:[{key:"a",label:"Auto - Commands run in sandbox automatically with configurable network access",value:"auto"},{key:"m",label:"Manual - All commands require approval (allowlist mode)",value:"manual"},{key:"u",label:"Unrestricted - All commands run unsandboxed without approval",value:"unrestricted"},{key:"q",label:"Quit",value:"quit"}],onAction:()=>i(this,void 0,void 0,(function*(){})),variant:"info"});if(!t||"quit"===t)return!0;let n;if("auto"===t){const e=[{key:"y",label:"Yes - Enable network access in sandbox",value:"yes"},{key:"n",label:"No - Disable network access in sandbox (allowlist only)",value:"no"},{key:"q",label:"Quit",value:"quit"}];if(n=yield(0,r.b)({title:"Network Access Configuration",description:["Choose network access policy:"],options:e,onAction:()=>i(this,void 0,void 0,(function*(){})),variant:"info"}),!n||"quit"===n)return!0}const o={auto:"enabled",manual:"disabled",unrestricted:"disabled",quit:"disabled"}[t],s={auto:"allowlist",manual:"allowlist",unrestricted:"unrestricted",quit:"allowlist"}[t],l="yes"===n?"allow_all":"user_config_with_defaults";return yield e.transform((e=>Object.assign(Object.assign({},e),{showSandboxIntro:!1,approvalMode:s,sandbox:Object.assign(Object.assign({},e.sandbox),{mode:o,networkAccess:l})}))),!1}))}o()}catch(a){o(a)}}))},"./src/headless.ts":(e,t,n)=>{n.d(t,{t:()=>y});var o=n("../agent-client/dist/index.js"),r=n("../agent-core/dist/index.js"),s=n("../agent-exec/dist/index.js"),i=n("../proto/dist/generated/agent/v1/agent_pb.js"),l=n("../proto/dist/generated/agent/v1/selected_context_pb.js"),a=n("../proto/dist/generated/agent/v1/shell_exec_pb.js"),c=n("./src/console-io.ts"),d=n("./src/exit.ts"),u=n("./src/hang-detection.ts"),p=n("./src/startup-timing.ts"),h=(n("./src/state/session.ts"),n("./src/transcript/index.ts")),g=n("./src/utils/interaction-responses.ts"),m=n("./src/utils/turn-tracking.ts"),f=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const v="printenv",x=5e3;let b=!1;function y(e,t,n,y,w,j,k,C){return f(this,void 0,void 0,(function*(){var S,E,M,$;t.trim()||((0,c.p2)("Error: No prompt provided for print mode"),yield(0,d.GZ)({code:1}));const T=new AbortController,I=()=>{(0,c.p2)("\nAborting operation..."),T.abort()};process.on("SIGINT",I);const P=Date.now(),A=!0===C.streamPartialOutput,D="stream-json"===C.outputFormat,_="json"===C.outputFormat,R="text"===C.outputFormat,L=D||A,O=!0===C.captureEnv;let Y="";const F=(0,m.GK)(j.getConversationStateStructure().turns.length),z=crypto.randomUUID(),N=(0,m.Io)(F,z);(0,u.ln)({agentMode:j.getMetadata("mode"),conversationId:j.getId(),conversationCreatedAt:j.getMetadata("createdAt"),turnCount:j.getConversationStateStructure().turns.length,isHeadless:!0});let U,B="",q="";const H=()=>f(this,void 0,void 0,(function*(){if(U)try{yield U.waitForPendingWrites()}catch(e){}try{yield j.dispose()}catch(e){const t=e instanceof Error?e.message:String(e);(0,c.p2)(`Warning: Failed to flush local agent state (${t})`)}})),W=e=>{if(!L||0===q.length)return;const t={type:"assistant",message:{role:"assistant",content:[{type:"text",text:q}]},session_id:C.sessionId};e.modelCallId&&(t.model_call_id=e.modelCallId),e.includeTimestamp&&(t.timestamp_ms=Date.now()),process.stdout.write(`${JSON.stringify(t)}\n`),q=""},G=(e,t)=>{if(!L)return;W({includeTimestamp:!0});const n=Object.assign({type:"retry",subtype:e,session_id:C.sessionId,timestamp_ms:Date.now()},t);process.stdout.write(`${JSON.stringify(n)}\n`)},X=e=>{if(!L)return;const t={type:"connection",subtype:e,session_id:C.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(t)}\n`)},K={sendUpdate(t,n){return f(this,void 0,void 0,(function*(){switch(n.message.case){case"textDelta":if(Y+=n.message.value.text,B+=n.message.value.text,q+=n.message.value.text,A){const e={type:"assistant",message:{role:"assistant",content:[{type:"text",text:n.message.value.text}]},session_id:C.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(e)}\n`)}break;case"toolCallStarted":if(W({includeTimestamp:!0,modelCallId:n.message.value.modelCallId}),B="",D||A){const e={type:"tool_call",subtype:"started",call_id:n.message.value.callId,tool_call:n.message.value.toolCall,model_call_id:n.message.value.modelCallId,session_id:C.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(e)}\n`)}break;case"toolCallCompleted":{const t=n.message.value.toolCall,o=O&&(D||A)&&void 0!==t&&function(e){return"shellToolCall"===e.tool.case}(t),r=o?yield function(e,t){return f(this,void 0,void 0,(function*(){var n;try{const o=t.get(s.qk);if(!o)throw new Error("shell executor unavailable");const r=yield o.execute(e,new a.a({command:v,timeout:x,simpleCommands:[v],skipApproval:!0,parsingResult:new a.HO({parsingFailed:!1,executableCommands:[new a.Pv({name:v,args:[],fullText:v})],hasRedirects:!1,hasCommandSubstitution:!1})}));if("success"===r.result.case)return null!==(n=r.result.value.stdout)&&void 0!==n?n:"";if("failure"===r.result.case){const e=r.result.value.stdout;if(e&&e.length>0)return e}throw new Error(function(e){var t;const n=e.result.case;if(!n)return"unknown shell result";switch(n){case"failure":{const{exitCode:t,stderr:n}=e.result.value,o=null==n?void 0:n.split("\n").find(Boolean);return`exit code ${t}${o?` (${o.substring(0,200)})`:""}`}case"timeout":return`timeout after ${e.result.value.timeoutMs}ms`;case"rejected":return`rejected: ${null!==(t=e.result.value.reason)&&void 0!==t?t:"unknown reason"}`;case"spawnError":return`spawn error: ${e.result.value.error}`;case"permissionDenied":return`permission denied: ${e.result.value.error}`;default:return n}}(r))}catch(e){if(!b){const t=e instanceof Error?e.message:String(e);(0,c.p2)(`Warning: Failed to capture environment snapshot; falling back to process.env snapshot (${t})`),b=!0}return Object.entries(process.env).map((([e,t])=>`${e}=${null!=t?t:""}`)).join("\n")}}))}(e,w):void 0;if(D||A){const e=Object.assign({type:"tool_call",subtype:"completed",call_id:n.message.value.callId,tool_call:t,model_call_id:n.message.value.modelCallId,session_id:C.sessionId,timestamp_ms:Date.now()},void 0!==r?{env:r}:{});process.stdout.write(`${JSON.stringify(e)}\n`)}break}case"thinkingDelta":if(D||A){const e={type:"thinking",subtype:"delta",text:n.message.value.text,session_id:C.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(e)}\n`)}break;case"thinkingCompleted":if(D||A){const e={type:"thinking",subtype:"completed",session_id:C.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(e)}\n`)}}}))},query(e,t){return f(this,void 0,void 0,(function*(){(e=>{if(!L)return;W({includeTimestamp:!0});const t={type:"interaction_query",subtype:"request",query_type:e.query.case,query:e,session_id:C.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(t)}\n`)})(t);const e=(0,g.l)(t,{approveWebSearch:k,approveWebFetch:k,askQuestionRejectReason:"Questions skipped in headless mode",webSearchRejectReason:"User Rejected",webFetchRejectReason:"User Rejected"});return((e,t)=>{if(!L)return;const n={type:"interaction_query",subtype:"response",query_type:e,response:t,session_id:C.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(n)}\n`)})(t.query.case,e),e}))}};try{const o=yield n.awaitCurrentModel();if(D||A){const e={type:"system",subtype:"init",apiKeySource:null!==(S=C.apiKeySource)&&void 0!==S?S:"login",cwd:process.cwd(),session_id:C.sessionId,model:o.displayName,permissionMode:"default"};process.stdout.write(`${JSON.stringify(e)}\n`);const n={type:"user",message:{role:"user",content:[{type:"text",text:t}]},session_id:C.sessionId};process.stdout.write(`${JSON.stringify(n)}\n`)}const s=new l.xv,a=new i.UserMessageAction({userMessage:new i.UserMessage({text:t,selectedContext:s,messageId:crypto.randomUUID()})}),g=new r.hg,v=new h.Ko(C.workspacePath,j.getId(),j.getBlobStore());U=v;const x={handleCheckpoint:(e,t)=>f(this,void 0,void 0,(function*(){yield j.handleCheckpoint(e,t),v.writeFromState(e,t)})),getLatestCheckpoint:()=>j.getLatestCheckpoint()};performance.mark(p.Y.DID_SEND_PROMPT),(0,p._)(!0,p.Y.DID_SEND_PROMPT),yield y.run(e,j.getConversationStateStructure(),new i.ConversationAction({action:{case:"userMessageAction",value:a}}),o,K,w,j.getBlobStore(),g,x,[],{conversationId:j.getId(),generationUUID:z,headers:C.headers,customSystemPrompt:C.customSystemPrompt,enableAgentRetries:C.enableRetries||null!=C.endlessRetries||!1,endlessRetries:C.endlessRetries,onRetryStarting:(e,t)=>f(this,void 0,void 0,(function*(){L?G("starting",{attempt:e,is_resume:t.isResume}):(0,c.p2)(`Retry attempt ${e}...\n`),t.isResume||L||(Y="",B="",q="")})),onRetryResuming:e=>f(this,void 0,void 0,(function*(){L&&G("resuming",{checkpoint_turn_count:e.checkpointState.turns.length,attempt:e.nextAttempt})})),onConnectionStateChange:e=>{"reconnecting"===e.state?L?X("reconnecting"):(0,c.p2)("Connection lost, reconnecting...\n"):"connected"===e.state&&L&&X("reconnected")},onStall:(0,u.M4)(j.getId(),{actionType:"userMessageAction"})});const b=Date.now()-P;if(_){const e={type:"result",subtype:"success",is_error:!1,duration_ms:b,duration_api_ms:b,result:Y||"",session_id:C.sessionId,request_id:z};process.stdout.write(`${JSON.stringify(e)}\n`)}else if(D){W({includeTimestamp:!1});const e={type:"result",subtype:"success",duration_ms:b,duration_api_ms:b,is_error:!1,result:Y||"",session_id:C.sessionId,request_id:z};process.stdout.write(`${JSON.stringify(e)}\n`)}else if(A){const e={type:"result",subtype:"success",duration_ms:b,duration_api_ms:b,is_error:!1,result:Y||"",session_id:C.sessionId,request_id:z};process.stdout.write(`${JSON.stringify(e)}\n`)}else R&&process.stdout.write(`${B||""}\n`);(0,m.WF)(N,"success"),yield null===(E=C.onSessionEnd)||void 0===E?void 0:E.call(C,"completed"),yield H(),yield(0,d.GZ)({code:d.yU.SUCCESS})}catch(e){if(e instanceof o.cc)return(0,m.WF)(N,"cancelled"),yield null===(M=C.onSessionEnd)||void 0===M?void 0:M.call(C,"aborted"),yield H(),(0,c.p2)("Operation cancelled"),void(yield(0,d.GZ)({code:d.yU.SIGINT}));(0,m.WF)(N,"error",e),yield null===($=C.onSessionEnd)||void 0===$?void 0:$.call(C,"error"),yield H(),(0,c.p2)(String(e)),yield(0,d.GZ)({code:1})}finally{process.off("SIGINT",I)}}))}},"./src/hooks/prompt/use-at-palette.ts":(e,t,n)=>{n.d(t,{q:()=>I,g:()=>A});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),r=n("./src/constants.ts"),s=n("node:child_process"),i=n("node:fs"),l=n("node:os"),a=n.n(l),c=n("node:path"),d=n("node:util"),u=n("../proto/dist/generated/agent/v1/agent_service_pb.js"),p=n("../shell-exec/dist/index.js"),h=n("./src/debug.ts"),g=n("./src/utils/fuzzy.ts"),m=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const f=(0,d.promisify)(s.execFile),v=.3,x=1e5;function b(e,t,n){return m(this,arguments,void 0,(function*(e,t,n,o=2e3){try{const{stdout:r}=yield f(e,t,{cwd:n,timeout:o,encoding:"utf8",maxBuffer:10485760});return r}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`Command failed: ${t}`)}}))}const y={ready:!1,paths:[],building:!1,startedAt:null,baseDir:null,strategies:new Set,lastReason:null,lastDurationMs:null,sessionId:null};let w=0;const j=new Set;function k(){for(const e of Array.from(j))try{e()}catch(e){}}function C(){return m(this,arguments,void 0,(function*(e={}){var t,n,o,r;if(y.ready||y.building)return;y.building=!0,y.startedAt=Date.now();const l=null!=(a=e.cwd)?a:process.cwd();var a;y.baseDir=l;const d=null!==(t=e.maxFiles)&&void 0!==t?t:2e4,u=null!==(n=e.maxDepth)&&void 0!==n?n:16,g=null!==(o=e.includeHidden)&&void 0!==o&&o,v=Number(null!==(r=process.env.AT_FILE_INDEX_TIMEOUT_MS)&&void 0!==r?r:"8000");(0,h.debugLog)("atFileSuggestions.index.start",{cwd:l,maxFiles:d,maxDepth:u,includeHidden:g,timeoutMs:v});const x=++w;y.sessionId=x;const j=new Set,C=new Set,S=[],E=[],M=Date.now()+v;let $=!1,T=0;const I=e=>{S.push(e)},P=(e,t)=>{if(!$&&y.sessionId===x){for(const t of e)j.add(t);for(const e of t)C.add(e);(()=>{if($||y.sessionId!==x)return;const e=j.size+C.size;(e<=64||e-T>=256)&&(y.paths=Array.from(j).concat(Array.from(C)),T=e,k())})()}},A=()=>m(this,void 0,void 0,(function*(){try{return yield function(e,t,n){return m(this,arguments,void 0,(function*(e,t,n,o=2e3){try{return yield f(e,t,{cwd:n,timeout:o,encoding:"utf8",maxBuffer:10485760}),!0}catch(e){return!1}}))}("git",["rev-parse","--is-inside-work-tree"],l)}catch(e){return!1}}));let D=!1,_=!1,R=!1;const L=e=>{$||0===y.strategies.size&&(e=>{if($)return;$=!0;for(const e of E)clearTimeout(e);for(const e of S)try{e.kill()}catch(e){}const t=Array.from(j),n=new Set;for(const e of t){let t=(0,c.dirname)(e);for(;t&&"."!==t;)n.add(`${t}/`),t=(0,c.dirname)(t)}const o=new Set(y.paths);for(const e of t)o.add(e);for(const e of n)o.add(e);const r=Array.from(o);y.paths=r.sort(((e,t)=>{const n=e.endsWith("/"),o=t.endsWith("/");if(n!==o){const r=n?e.slice(0,-1):e,s=o?t.slice(0,-1):t;if(r===s||r.startsWith(`${s}/`)||s.startsWith(`${r}/`))return n?-1:1}return e.localeCompare(t,void 0,{sensitivity:"base"})})),y.ready=!0,y.building=!1;const s=y.startedAt?Date.now()-y.startedAt:void 0;y.lastReason=e,y.lastDurationMs=null!=s?s:null,y.strategies.clear(),(0,h.debugLog)("atFileSuggestions.index.done",{reason:e,durationMs:s,total:y.paths.length}),k()})(e)},O=()=>{if(D)return;D=!0,y.strategies.add("rg"),k();const e=["--files","--follow","--max-depth",String(u),"--no-messages"];g&&e.push("--hidden");const t=(0,p.Ko)(),n=(0,s.spawn)(t,e,{cwd:l});I(n);const o=[],r=new Set;let i="",a=!1;const f=e=>{if(!a){a=!0;try{n.kill()}catch(e){}P(o,r),y.strategies.delete("rg"),L(`rg:${e}`)}},b=setTimeout((()=>f("timeout")),v);E.push(b),n.stdout.setEncoding("utf8"),n.stdout.on("data",(e=>{if($||y.sessionId!==x)return;let t;for(i+=e;-1!==(t=i.indexOf("\n"));){const e=i.slice(0,t).trim();if(i=i.slice(t+1),!e)continue;const n=e.split(c.sep).join("/");o.push(n);let s=(0,c.dirname)(n);for(;s&&"."!==s;)r.add(`${s}/`),s=(0,c.dirname)(s);if((o.length<=64||o.length%256==0)&&P(o,r),o.length>=d||Date.now()>M)return clearTimeout(b),void f(o.length>=d?"limit":"timeout")}})),n.on("error",(e=>{(()=>{m(this,void 0,void 0,(function*(){clearTimeout(b),a||$||((0,h.debugLog)("atFileSuggestions.rg.error",String(e)),y.strategies.delete("rg"),(yield A())&&!_?yield Y(!0):R||F(!0),L("rg:error"))}))})()})),n.on("close",(e=>{(()=>{m(this,void 0,void 0,(function*(){clearTimeout(b),a||$||(0===e||o.length>0?f("complete"):(y.strategies.delete("rg"),(yield A())&&!_?yield Y(!0):R||F(!0),L("rg:empty")))}))})()}))},Y=(...e)=>m(this,[...e],void 0,(function*(e=!1){if(_)return;_=!0,y.strategies.add("git"),k();const t=(0,s.spawn)("git",["ls-files","-co","--exclude-standard","-z","--","."],{cwd:l});I(t);const n=[],o=new Set;let r="",i=!1;const a=r=>{if(!i){i=!0;try{t.kill()}catch(e){}P(n,o),y.strategies.delete("git"),L(`git:${r}${e?":fallback":""}`)}},u=setTimeout((()=>a("timeout")),v);E.push(u);let p="";try{const e=yield b("git",["rev-parse","--show-prefix"],l);p=e.trim().split(c.sep).join("/")}catch(e){}t.stdout.setEncoding("utf8"),t.stdout.on("data",(e=>{if($||y.sessionId!==x)return;let t;for(r+=e;-1!==(t=r.indexOf("\0"));){const e=r.slice(0,t);if(r=r.slice(t+1),!e)continue;let s=e.split(c.sep).join("/");if(p&&s.startsWith(p)&&(s=s.slice(p.length)),s.startsWith("../"))continue;n.push(s);let i=(0,c.dirname)(s);for(;i&&"."!==i;)o.add(`${i}/`),i=(0,c.dirname)(i);if((n.length<=64||n.length%256==0)&&P(n,o),n.length>=d||Date.now()>M)return clearTimeout(u),void a(n.length>=d?"limit":"timeout")}})),t.on("error",(t=>{clearTimeout(u),i||$||(i=!0,(0,h.debugLog)("atFileSuggestions.git.error",String(t)),y.strategies.delete("git"),R||F(e),L("git:error"))})),t.on("close",(t=>{clearTimeout(u),i||$||(0===t||n.length>0?a("complete"):(y.strategies.delete("git"),R||F(e),L("git:empty")))}))})),F=(e=!1)=>{if(R)return;R=!0,y.strategies.add("node"),k();const t=new Set([".git","node_modules","out","dist","build","target",".next",".cache","venv",".venv"]),n=[""];let o=!1;const r=()=>m(this,void 0,void 0,(function*(){for(;!$;){const e=n.shift();if(void 0===e)break;if((e?e.split("/").filter(Boolean).length:0)>u)continue;const r=e?(0,c.join)(l,e):l;let s;try{s=yield i.promises.readdir(r,{withFileTypes:!0})}catch(e){continue}const a=[],p=new Set;for(const r of s){if($){o=!0;break}const s=r.name;if(!g&&s.startsWith("."))continue;if(t.has(s))continue;const i=e?(0,c.join)(e,s):s;if(r.isDirectory())n.push(i+c.sep);else{a.push(i);let e=(0,c.dirname)(i);for(;e&&"."!==e;)p.add(`${e}/`),e=(0,c.dirname)(e);if(j.size+a.length>=d){o=!0;break}}}if(a.length>0&&P(a,p),Date.now()>M||j.size>=d){o=!0;break}}}));Promise.all(Array.from({length:8},(()=>r()))).then((()=>{y.strategies.delete("node"),L(`node:${o?"timeout":"complete"}${e?":fallback":""}`)})).catch((()=>{y.strategies.delete("node"),L("node:error"+(e?":fallback":""))}))};try{O(),(yield A())&&(yield Y(!0))}catch(e){(0,h.debugLog)("atFileSuggestions.index.start.error",String(e)),F()}}))}function S(e,t){const n=e.endsWith("/"),o=n?e.slice(0,-1):e;if(!t)return 1+(n?5:0);const r=(0,g.dt)(o,t);return r<=0?0:r+(n?5:0)}function E(){try{const e=a().homedir(),t=(0,c.join)(e,".cursor","ide_state.json"),n=(0,i.readFileSync)(t,"utf8");return u.m_.fromJsonString(n).recentlyViewedFiles.filter((e=>e.relativePath&&e.absolutePath&&e.absolutePath.startsWith(process.cwd()))).map((e=>e.relativePath))}catch(e){return[]}}function M(e){return`${e.replace(/[^A-Za-z0-9._-]/g,"").split("").map((e=>`*${e}`)).join("")}*`}var $=n("./src/hooks/prompt/use-windowed-nav.ts"),T=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const I=/(^|[^A-Za-z0-9._\-/])@([A-Za-z0-9._\-/]*)$/,P=200;function A(e,t){return r.KD?function(e,t){const[n,r]=(0,o.useState)([]),[l,a]=(0,o.useState)(!1),[d,u]=(0,o.useState)(!1),g=(0,o.useRef)(e),f=(0,o.useRef)(0),w=(0,$.m)(6);(0,o.useEffect)((()=>{const t=e!==g.current;g.current=e,I.test(e)&&!e.startsWith("/")||d&&u(!1);const o=e.match(I);if(!o)return a((e=>!e&&e)),0!==n.length&&r([]),void w.setLength(0);if(d)return a((e=>!e&&e)),0!==n.length&&r([]),void w.setLength(0);const j=o[2],k=()=>T(this,void 0,void 0,(function*(){const e=++f.current;if(yield C(),e!==f.current)return;const o=(yield function(e){return m(this,arguments,void 0,(function*(e,t=50){const n=e.trim().replace(/^[.[/\\]+/,"");if(!n)return function(e){const t=E(),n=[],o=new Set,r=Math.floor(e*v);for(const e of t.slice(0,r)){const t=e.toLowerCase();o.has(t)||(o.add(t),n.push({path:e,score:x+S(e,"")}))}if(y.ready&&y.paths.length>0){const r=[];for(const t of y.paths){if(t.endsWith("/")){const e=t.split("/").filter(Boolean),n=e.length>0?`${e[0]}/`:t,s=n.toLowerCase();o.has(s)||(o.add(s),r.push(n))}else{const e=t.indexOf("/");if(-1===e){const e=t.toLowerCase();o.has(e)||(o.add(e),r.push(t))}else{const n=`${t.slice(0,e)}/`,s=n.toLowerCase();o.has(s)||(o.add(s),r.push(n))}}if(r.length>=2*e)break}for(const e of r)n.push({path:e,score:S(e,"")});const s=n.sort(((e,t)=>t.score-e.score||e.path.localeCompare(t.path,void 0,{sensitivity:"base"}))).slice(0,e);return(0,h.debugLog)("atFileSuggestions.default.index",{count:s.length,recentCount:t.length}),s}try{const r=process.cwd(),l=(0,i.readdirSync)(r,{withFileTypes:!0}),a=!1,d=l.filter((e=>a||!e.name.startsWith("."))).map((e=>({name:e.name,path:e.isDirectory()?`${e.name}${c.sep}`:e.name,isDir:e.isDirectory()})));let u=d;try{if(0===(0,s.spawnSync)("git",["rev-parse","--is-inside-work-tree"],{cwd:r,stdio:"ignore"}).status&&d.length>0){const e=d.map((e=>e.path)).join("\0"),t=(0,s.spawnSync)("git",["check-ignore","-z","--stdin"],{cwd:r,encoding:"utf8",input:e}),n=new Set((t.stdout||"").split("\0").filter(Boolean));u=d.filter((e=>!n.has(e.path))),(0,h.debugLog)("atFileSuggestions.default.gitFilter",{total:d.length,ignored:d.length-u.length})}}catch(e){}for(const{path:e}of u){const t=e.toLowerCase();o.has(t)||(o.add(t),n.push({path:e,score:S(e,"")}))}const p=n.sort(((e,t)=>t.score-e.score||e.path.localeCompare(t.path,void 0,{sensitivity:"base"}))).slice(0,e);return(0,h.debugLog)("atFileSuggestions.default.readdir",{count:p.length,recentCount:t.length}),p}catch(e){return[]}}(t);yield C();const o=[],r=y.paths.length>0?y.paths:[],l=new Set;try{const e=[];for(const o of E())if(S(o,n)>0&&e.push(o),e.length>=t)break;for(const t of e){const e=t.toLowerCase();l.has(e)||(l.add(e),o.push({path:t,score:S(t,n)+x}))}}catch(e){}for(const e of r){const t=e.toLowerCase();if(l.has(t))continue;const r=S(e,n);r>0&&(l.add(t),o.push({path:e,score:r}))}if(o.length<t&&n.length>=3)try{const e=yield function(e,t){return m(this,void 0,void 0,(function*(){const n=y.baseDir||process.cwd(),o=new Set;try{let r="";try{const e=yield b("git",["rev-parse","--show-prefix"],n);r=e.trim().split(c.sep).join("/")}catch(e){}const s=`:(icase,glob)${r}**/${M(e)}`,i=(yield b("git",["ls-files","-co","--exclude-standard","-z","--",s],n)).split("\0").filter(Boolean).map((e=>e.split(c.sep).join("/"))).map((e=>r&&e.startsWith(r)?e.slice(r.length):e)).filter((e=>!e.startsWith("../")));for(const e of i)if(o.add(e),o.size>=t)break}catch(e){}if(o.size<Math.max(8,Math.floor(t/4)))try{const r=`**/${M(e)}`,s=(0,p.Ko)(),i=(yield b(s,["--files","--iglob",r],n)).split("\n").filter(Boolean).map((e=>e.split(c.sep).join("/")));for(const e of i)if(o.add(e),o.size>=t)break}catch(e){}return Array.from(o)}))}(n,4*t);for(const t of e){const e=t.toLowerCase();if(l.has(e))continue;const r=S(t,n);r>0&&(l.add(e),o.push({path:t,score:r}))}}catch(e){}return o.sort(((e,t)=>t.score-e.score||e.path.localeCompare(t.path,void 0,{sensitivity:"base"}))),o.slice(0,t)}))}(j)).map((e=>e.path));if(e!==f.current)return;(o.length!==n.length||o.some(((e,t)=>e!==n[t])))&&r(o),w.setLength(o.length);const l=o.length>0;a((e=>e!==l?l:e)),l&&t&&w.reset()}));if(!l)return void k().catch((()=>{}));const $=setTimeout((()=>{k().catch((()=>{}))}),P);return()=>clearTimeout($)}),[e,d,l,w.reset,w.setLength,n]);const j=(0,o.useCallback)((e=>{if(!l||0===n.length)return null;const t=n[w.index];if(!t)return null;const o=t.endsWith("/")?`@${t}`:`@${t} `;return e.replace(I,((e,t)=>`${t}${o}`))}),[l,n,w.index]),k=(0,o.useCallback)((()=>{a(!1)}),[]),A=(0,o.useCallback)((()=>{u(!0),a(!1)}),[]),D=!t&&l;return(0,o.useMemo)((()=>({active:D,suggestions:n,index:w.index,windowStart:w.windowStart,next:w.next,prev:w.prev,reset:w.reset,acceptExpansion:j,hide:k,suppress:A})),[D,n,w.index,w.windowStart,w.next,w.prev,w.reset,j,k,A])}(e,t):{active:!1,suggestions:[],index:0,windowStart:0,next:()=>{},prev:()=>{},reset:()=>{},acceptExpansion:()=>null,hide:()=>{},suppress:()=>{}}}},"./src/hooks/prompt/use-ephemeral.ts":(e,t,n)=>{n.d(t,{N:()=>i});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),r=n("./src/constants.ts"),s=n("./src/debug.ts");function i(){const[e,t]=(0,o.useState)([]),n=(0,o.useRef)(null),i=(0,o.useRef)(!1),l=(0,o.useRef)(!1),a=(0,o.useCallback)((e=>{if(Array.isArray(e)){const t=e[0];return t&&"object"==typeof t&&!Array.isArray(t)&&"text"in t?[e]:e}return[e]}),[]),c=(0,o.useCallback)((()=>{n.current&&(clearTimeout(n.current),n.current=null)}),[]),d=(0,o.useCallback)((()=>{c(),t([])}),[c]),u=(0,o.useCallback)(((e,o)=>{const i=a(e);c(),t(i),!0===(null==o?void 0:o.persistUntilInput)&&(l.current=!0);const d=null==o?void 0:o.minLingerMs;if(i.length>0){const e=null!=d?d:l.current?void 0:r.fj;void 0!==e&&(n.current=setTimeout((()=>{t([]),n.current=null,null===s.debugLog||void 0===s.debugLog||(0,s.debugLog)("ephemeral.timeout.clear")}),e))}}),[c,a]),p=(0,o.useCallback)((()=>{i.current=!0}),[]);(0,o.useEffect)((()=>()=>{c()}),[c]);const h=(0,o.useCallback)((()=>{l.current&&(l.current=!1,c(),t([]))}),[c]),g=(0,o.useCallback)((o=>{c(),0!==e.length&&(n.current=setTimeout((()=>{t([]),n.current=null,null===s.debugLog||void 0===s.debugLog||(0,s.debugLog)("ephemeral.linger.clear")}),Math.max(0,0|o)))}),[c,e.length]);return(0,o.useMemo)((()=>({lines:e,set:u,clear:d,preserveNextClear:p,normalize:a,onUserInput:h,linger:g})),[e,u,d,p,a,h,g])}},"./src/hooks/prompt/use-prompt-history.ts":(e,t,n)=>{n.d(t,{a:()=>g});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),r=n("./src/debug.ts"),s=n("node:fs"),i=n("node:os"),l=n("node:path"),a=n("./src/utils/characters.ts"),c=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const d=500;function u(){switch((0,i.platform)()){case"win32":{const e=process.env.APPDATA||(0,l.join)((0,i.homedir)(),"AppData","Roaming");return(0,l.join)(e,"Cursor","prompt_history.json")}case"darwin":return(0,l.join)((0,i.homedir)(),".cursor","prompt_history.json");default:{const e=process.env.XDG_CONFIG_HOME||(0,l.join)((0,i.homedir)(),".config");return(0,l.join)(e,"cursor","prompt_history.json")}}}function p(){return c(this,void 0,void 0,(function*(){const e=u();try{const t=yield s.promises.readFile(e,"utf8"),n=JSON.parse(t);if(Array.isArray(n)){const e=n.filter((e=>"string"==typeof e)),t=new Set,o=[];for(const n of e){const e=(0,a.p3)(n);0!==e.length&&(t.has(e)||(t.add(e),o.push(e)))}return o.slice(0,d)}return[]}catch(e){return[]}}))}var h=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function g(){const[e,t]=(0,o.useState)([]),[n,i]=(0,o.useState)(null),g=(0,o.useRef)("");(0,o.useEffect)((()=>{(()=>{h(this,void 0,void 0,(function*(){try{const e=yield p();t(e)}catch(e){null===r.debugLog||void 0===r.debugLog||(0,r.debugLog)("history.init.error",String(e))}}))})()}),[]);const m=(0,o.useCallback)((t=>{if(0===e.length)return null;if(null!=n)return null;g.current=t,i(0);const o=e[0];return null!=o?o:null}),[e,n]),f=(0,o.useCallback)((()=>{var t;if(0===e.length)return null;const o=Math.min(e.length-1,(null!=n?n:0)+1);return i(o),null!==(t=e[o])&&void 0!==t?t:null}),[e,n]),v=(0,o.useCallback)((t=>{var o;if(null==n)return null;const r=n-1;return r>=0?(i(r),{value:null!==(o=e[r])&&void 0!==o?o:t,exited:!1}):(i(null),{value:g.current,exited:!0})}),[n,e]),x=(0,o.useCallback)((e=>h(this,void 0,void 0,(function*(){try{const n=yield function(e){return c(this,void 0,void 0,(function*(){const t=(0,a.p3)(e);if(0===t.length)return yield p();let n=yield p();return n=n.filter((e=>e!==t)),n.unshift(t),n.length>d&&(n=n.slice(0,d)),yield function(e){return c(this,void 0,void 0,(function*(){const t=u();yield function(e){return c(this,void 0,void 0,(function*(){const t=(0,l.dirname)(e);try{yield s.promises.mkdir(t,{recursive:!0})}catch(e){}}))}(t);const n=new Set,o=[];for(const t of e){const e=(0,a.p3)(t);if(0!==e.length&&!n.has(e)&&(n.add(e),o.push(e),o.length>=d))break}const r=JSON.stringify(o,null,2);yield s.promises.writeFile(t,r,"utf8")}))}(n),n}))}(e);t(n),i(null),g.current=""}catch(e){null===r.debugLog||void 0===r.debugLog||(0,r.debugLog)("history.add.error",String(e))}}))),[]),b=(0,o.useCallback)((()=>{i(null),g.current=""}),[]),y=(0,o.useCallback)((()=>{i(null),g.current=""}),[]),w=(0,o.useCallback)((()=>{t([]),i(null),g.current=""}),[]);return(0,o.useMemo)((()=>({items:e,index:n,inHistory:null!=n,draftBeforeHistory:g.current,begin:m,up:f,down:v,record:x,reset:b,resetForSlash:y,clearAllLocal:w})),[e,n,m,f,v,x,b,y,w])}},"./src/hooks/prompt/use-slash-palette.ts":(e,t,n)=>{n.d(t,{e:()=>p});var o=n("../context/dist/index.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),s=n("./src/constants.ts"),i=n("./src/instrument.ts"),l=n("./src/utils/error-info.ts"),a=n("./src/utils/fuzzy.ts"),c=n("./src/hooks/prompt/use-windowed-nav.ts"),d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function u(e,t,n,o,r,s){var i,l;if(!e.isArgSuggestion||!e.parentCommandId)return null;const a=t.find((t=>t.id.toLowerCase()===e.parentCommandId.toLowerCase())),c=null!==(l=null===(i=null==a?void 0:a.args)||void 0===i?void 0:i.length)&&void 0!==l?l:0;if(c>0&&n.length>c){const e=n.slice(0,c);return r&&"trailing"===s.kind?`${s.promptPrefix} /${e.join(" ")} ${o} `:`/${e.join(" ")} ${o} `}return null}function p(e,t,n,p,h){const[g,m]=(0,r.useState)([]),[f,v]=(0,r.useState)(!1),[x,b]=(0,r.useState)(!1),y=(0,c.m)(s.kQ),w=(0,r.useRef)(null),j=(0,r.useRef)(null),k=(0,r.useRef)(e),[C,S]=(0,r.useState)({kind:"none"});(0,r.useEffect)((()=>{var r,s,i,l,c;const u=e!==k.current;k.current=e;const p=(0,o.q6)(),f=null!=h?h:e.length,j=function(e,t){var n,o,r;const s=/(?:^|\s)(\/\S*)/g,i=[];for(const t of e.matchAll(s)){const e=t[0],r=null!==(n=t[1])&&void 0!==n?n:"",s=(null!==(o=t.index)&&void 0!==o?o:0)+(e.length-r.length),l=s+r.length,a=r.slice(1);i.push({slashStart:s,slashEnd:l,fragment:a})}if(e.startsWith("/")){const t=/^\/(\S*)/.exec(e);if(t){const e=null!==(r=t[1])&&void 0!==r?r:"",n=1+e.length;i.some((e=>0===e.slashStart))||i.unshift({slashStart:0,slashEnd:n,fragment:e})}}for(const n of i)if(t>=n.slashStart&&t<=n.slashEnd)return{found:!0,prefix:e.slice(0,n.slashStart).trimEnd(),fragment:n.fragment,slashStart:n.slashStart,slashEnd:n.slashEnd};return null}(e,f),C=/^(.*?)(\s+)\/(\S*)$/.exec(e);if(null==j?void 0:j.found){const t=e.slice(j.slashEnd);0===j.slashStart&&0===t.length?S({kind:"none"}):S({kind:"cursor",promptPrefix:j.prefix,fragment:j.fragment,slashStart:j.slashStart,slashEnd:j.slashEnd,suffix:t})}else if(C){const e=null!==(r=C[1])&&void 0!==r?r:"",t=null!==(s=C[3])&&void 0!==s?s:"";S({kind:"trailing",promptPrefix:e,fragment:t})}else S({kind:"none"});const E=(null==j?void 0:j.found)||null!=C;if(!e.startsWith("/")&&!E)return 0!==g.length&&m([]),y.setLength(0),v((e=>!e&&e)),void(x&&b(!1));if(x){if(!u)return 0!==g.length&&m([]),y.setLength(0),void v((e=>!e&&e));b(!1)}let M;M=(null==j?void 0:j.found)?j.fragment:C?null!==(i=C[3])&&void 0!==i?i:"":e.slice(1);const $=M.split(/\s+/),T=0===M.length?[]:$.filter(((e,t)=>!(""===e&&t===$.length-1&&!M.endsWith(" ")))),I=null!==(l=T[0])&&void 0!==l?l:"",P=()=>d(this,void 0,void 0,(function*(){const e=I,o=e.toLowerCase(),r=e?t.find((e=>e.id.toLowerCase()===o)):void 0;if(null==r?void 0:r.getArgSuggestions){const e=yield r.getArgSuggestions(p,[],n);if(e&&e.length>0)return e.map((e=>({identifier:e.value,label:e.value,description:e.description||"",args:[],parentCommandId:r.id,isArgSuggestion:!0})))}const s=(null==j?void 0:j.found)&&j.slashStart>0,i=(E&&s||E&&null!=C?t.filter((e=>e.inline)):t).map(((t,n)=>{const o=e.toLowerCase(),r=t.id.toLowerCase(),s=t.title.toLowerCase();(t.description||"").toLowerCase();let i=3;e&&(t.boostedAlts&&t.boostedAlts.some((e=>o===e.toLowerCase()||o.startsWith(e.toLowerCase())||e.toLowerCase().startsWith(o)))&&(i=0),i>1&&r.startsWith(o)&&(i=1),i>2&&r.includes(o)&&(i=2),i>2&&s.includes(o)&&(i=2));const l=`${t.id} ${t.title} ${t.description||""}`;return{c:t,score:e?(0,a.dt)(l,e):1,priority:i,originalIndex:n}})).filter((t=>!e||t.score>0)).sort(((t,n)=>e?t.priority!==n.priority?t.priority-n.priority:t.score!==n.score?n.score-t.score:t.originalIndex-n.originalIndex:t.originalIndex-n.originalIndex));return i.map((({c:e})=>({identifier:e.id,label:e.title,description:e.description||"",ghostText:e.ghostText,args:(e.args||[]).map((e=>({identifier:e.id,required:e.required}))),inline:e.inline})))})),A=()=>d(this,void 0,void 0,(function*(){const e=t.find((e=>e.id.toLowerCase()===I.toLowerCase()));if(!e)return[];const o=T.slice(1);if(e.getArgSuggestions){const t=yield e.getArgSuggestions(p,o,n);if(t&&t.length>0)return t.map((t=>({identifier:t.value,label:t.value,description:t.description||"",args:[],parentCommandId:e.id,isArgSuggestion:!0})))}return(e.args||[]).slice(o.length).map((t=>({identifier:t.id,label:t.id,description:!1===t.required?"optional":"required",args:[],parentCommandId:e.id,isArgSuggestion:!0})))}));null===(c=w.current)||void 0===c||c.abort();const D=new AbortController;w.current=D,(()=>{d(this,void 0,void 0,(function*(){let e=[];if(e=T.length<=1||1===T.length&&!M.endsWith(" ")?yield P():yield A(),D.signal.aborted)return;(e.length!==g.length||e.some(((e,t)=>{var n,o;return e.identifier!==(null===(n=g[t])||void 0===n?void 0:n.identifier)||e.parentCommandId!==(null===(o=g[t])||void 0===o?void 0:o.parentCommandId)})))&&m(e),y.setLength(e.length);const t=e.length>0;if(v((e=>e!==t?t:e)),t&&u){const t=T.slice(1).filter((e=>e.length>0)),n=t.length>0?t[t.length-1]:"";if(n){const t=e.findIndex((e=>e.identifier===n));t>=0?y.setIndex(t):y.reset()}else y.reset()}}))})()}),[e,t,x,n,g,y.reset,y.setIndex,y.setLength,h]);const E=(0,r.useCallback)((e=>{var n,o,r,s,i;if(!f||0===g.length)return null;const l=g[y.index];if(!l)return null;const a=/^(.*?)(\s+)\/(\S*)$/.exec(e),c=null!==a,d=a?(null!==(n=a[1])&&void 0!==n?n:"").trimEnd():"",p=a&&null!==(o=a[3])&&void 0!==o?o:"";if("cursor"===C.kind){const{promptPrefix:t,suffix:n}=C,o=`/${l.identifier} `,r=`${t.length>0?`${t} `:""}${o}${n.startsWith(" ")?n.slice(1):n}`;return r!==e?r:null}const h="trailing"===C.kind||c,m=h?"trailing"===C.kind?C.fragment:p:e.startsWith("/")?e.slice(1):"";if(!h&&!e.startsWith("/"))return null;const v="trailing"===C.kind?C.promptPrefix:d,x=m.includes(" "),b=e.endsWith(" ");if(!x){if(l.isArgSuggestion&&l.parentCommandId)return h?`${v} /${l.parentCommandId} ${l.identifier} `:`/${l.parentCommandId} ${l.identifier} `;const t=`/${l.identifier} `,n=h?`${v} ${t}`:t;return n!==e?n:null}const w=m.split(/\s+/);if(w.length>=2){const n=m.split(/\s+/).filter(Boolean),o=null!==(r=n[n.length-1])&&void 0!==r?r:"",a=l.identifier,c=null!==(s=w[0])&&void 0!==s?s:"",d=t.find((e=>e.id.toLowerCase()===c.toLowerCase())),p=1===(null===(i=null==d?void 0:d.args)||void 0===i?void 0:i.length);if(b){const r=(null==d?void 0:d.args)?d.args.length:void 0,s=Math.max(0,n.length-1);if(!d||null==r||s>=r){if(p&&l.isArgSuggestion){const e=h?"":"/",t=l.parentCommandId||c;return h?`${v} /${t} ${a} `:`${e}${t} ${a} `}const o=u(l,t,n,a,h,{kind:"trailing",promptPrefix:v});if(null!==o)return o;if(h)return`${v} /${a} `;const r=e.trimEnd(),s=r.lastIndexOf(" ");return`${s>=0?r.slice(0,s+1):""}${a} `}return o===a?null:`${e}${a} `}if(p&&l.isArgSuggestion){const e=h?"":"/",t=l.parentCommandId||c;return h?`${v} /${t} ${a} `:`${e}${t} ${a} `}const g=u(l,t,n,a,h,{kind:"trailing",promptPrefix:v});if(null!==g)return g;const f=e.lastIndexOf(" ");return(f>=0?e.slice(f+1):e)===a?e.endsWith(" ")?null:`${e} `:`${f>=0?e.slice(0,f+1):""}${a} `}return null}),[f,g,y.index,t,C]),M=(0,r.useCallback)((()=>{b(!0),v(!1)}),[]),$=(0,r.useCallback)(((e,t,n,r,s)=>d(this,void 0,void 0,(function*(){var a,c,d,u,p;let h,g="";if(e.startsWith("/"))h=e.slice(1);else{const t=/^(.*?)(\s+)\/(\S.*)$/.exec(e);if(!t)return"not-a-command";g=(null!==(a=t[1])&&void 0!==a?a:"").trimEnd(),h=null!==(c=t[3])&&void 0!==c?c:""}const m=h.split(/\s+/).filter(Boolean),f=m[0]||"";if(!f)return"not-a-command";const v=m.slice(1),x=(g?t.filter((e=>e.inline)):t).find((e=>e.id.toLowerCase()===f.toLowerCase()));if(!x)return g?"not-a-command":(null==s||s(f),"unknown");if(!x.run)return"handled";const b=(x.args||[]).filter((e=>!1!==e.required));if(v.length<b.length)return"handled";"quit"===f.toLowerCase()&&(null==r||r(!0)),null===(d=j.current)||void 0===d||d.abort();const y=new AbortController;j.current=y;const[w,k]=(0,o.q6)().withCancel();y.signal.addEventListener("abort",k);try{yield x.run(w,v,{onModelChange:n.onModelChange,insertText:e=>{if(!y.signal.aborted)if(g){const t=e&&e.length>0?e:g;n.insertText(t)}else n.insertText(e)},clearInput:()=>{var e;y.signal.aborted||null===(e=n.clearInput)||void 0===e||e.call(n)},enterShellMode:()=>{var e;return null===(e=n.enterShellMode)||void 0===e?void 0:e.call(n)},print:(e,t)=>{var o;y.signal.aborted||null===(o=n.print)||void 0===o||o.call(n,e,t)},exit:e=>{var t;return null===(t=n.exit)||void 0===t?void 0:t.call(n,e)},onHistoryCleared:()=>{var e;return null===(e=n.onHistoryCleared)||void 0===e?void 0:e.call(n)},onResumeChat:n.onResumeChat,getChatId:n.getChatId,logout:n.logout,onNewChat:n.onNewChat,onSummarize:n.onSummarize,onTransferToCloud:n.onTransferToCloud,submitMessage:(e,t)=>{var o;y.signal.aborted||null===(o=n.submitMessage)||void 0===o||o.call(n,e,t)},onOpenMcpPager:n.onOpenMcpPager,onOpenSandboxPager:n.onOpenSandboxPager,getPromptPrefix:()=>g||void 0,onOpenSkillsPager:n.onOpenSkillsPager,onShowExistingPlan:n.onShowExistingPlan,onExecutePlan:n.onExecutePlan,hidePalette:M})}catch(e){if(!y.signal.aborted){(0,i.Fb)(e,"error");const{message:t}=(0,l.q)(e);null===(u=n.print)||void 0===u||u.call(n,[[{text:`Error: ${t}`,color:"red"}]]),null===(p=n.clearInput)||void 0===p||p.call(n)}}finally{j.current===y&&(j.current=null)}return"executed"}))),[M]);(0,r.useEffect)((()=>()=>{var e,t;null===(e=w.current)||void 0===e||e.abort(),null===(t=j.current)||void 0===t||t.abort()}),[]);const T=!p&&f;return(0,r.useMemo)((()=>({active:T,items:g,index:y.index,windowStart:y.windowStart,next:y.next,prev:y.prev,reset:y.reset,acceptExpansion:E,runIfExecutable:$,hide:M})),[T,g,y.index,y.windowStart,y.next,y.prev,y.reset,E,$,M])}},"./src/hooks/prompt/use-windowed-nav.ts":(e,t,n)=>{n.d(t,{m:()=>l});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const r=2;function s(e){return e-r}function i(e,t,n){const o=s(n),r=Math.max(0,t-o);return e>r?r:e<0?0:e}function l(e=6){const[t,n]=(0,o.useState)(0),[r,l]=(0,o.useState)(0),[a,c]=(0,o.useState)(0),d=(0,o.useCallback)((t=>{c((o=>t===o?o:(n((e=>0===t?0:Math.min(e,t-1))),l((n=>i(n,t,e))),t)))}),[e]),u=(0,o.useCallback)((()=>{0!==a&&n((t=>{const n=(t+1)%a;return l((o=>{if(a<=e)return 0;if(n<t)return 0;const r=s(e);return n>=o+r?i(n-r+1,a,e):o})),n}))}),[a,e]),p=(0,o.useCallback)((()=>{0!==a&&n((t=>{const n=(t-1+a)%a;return l((o=>{if(a<=e)return 0;if(n>t){const t=s(e);return i(Math.max(0,a-t),a,e)}return n<o?i(n,a,e):o})),n}))}),[a,e]),h=(0,o.useCallback)((()=>{n(0),l(0)}),[]),g=(0,o.useCallback)((t=>{if(0===a)return;const o=Math.max(0,Math.min(t,a-1));n(o),l((t=>{if(a<=e)return 0;const n=s(e);return o<t?i(o,a,e):o>=t+n?i(o-n+1,a,e):t}))}),[a,e]),m=(0,o.useCallback)(((n=e)=>({visibleStart:r,highlight:t-r})),[t,r,e]);return(0,o.useMemo)((()=>({index:t,windowStart:r,setLength:d,setIndex:g,next:u,prev:p,reset:h,page:m})),[t,r,d,g,u,p,h,m])}},"./src/hooks/use-attach-background-composer.ts":(e,t,n)=>{n.d(t,{n:()=>h});var o=n("node:crypto"),r=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),s=n("../proto/dist/generated/aiserver/v1/tools_pb.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/debug.ts"),c=n("./src/hang-detection.ts"),d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))},u=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise((function(o,r){!function(e,t,n,o){Promise.resolve(o).then((function(t){e({value:t,done:n})}),t)}(o,r,(t=e[n](t)).done,t.value)}))}}};const p=6e4;function h(e,t){const[n,h]=(0,i.useState)({bubbles:[]}),[m,f]=(0,i.useState)(r.R6p.UNSPECIFIED),[v,x]=(0,i.useState)(!1),[b,y]=(0,i.useState)(!1),[w,j]=(0,i.useState)(void 0),[k,C]=(0,i.useState)(void 0),[S,E]=(0,i.useState)(void 0),[M,$]=(0,i.useState)(void 0),T=(0,i.useRef)(void 0),[I,P]=(0,i.useState)(void 0),[A,D]=(0,i.useState)(!1),_=(0,i.useRef)(!1),R=(0,i.useRef)(!1),L=(0,i.useRef)(null),O=(0,i.useRef)(!1),Y=(0,i.useRef)(r.R6p.UNSPECIFIED),F=(0,i.useRef)(!1),z=(0,i.useRef)(!1),N=(0,i.useCallback)((()=>d(this,void 0,void 0,(function*(){if(t)try{_.current||D(!0);const n=function(e){var t,n,o,r,s,i;if("object"!=typeof(i=e)||null===i)return[];const l=null!==(o=null===(n=null===(t=e.diff)||void 0===t?void 0:t.diffs)||void 0===n?void 0:n.map((e=>{var t,n,o,r;return{path:null!==(n=null!==(t=e.to)&&void 0!==t?t:e.from)&&void 0!==n?n:"",before:null!==(o=e.beforeFileContents)&&void 0!==o?o:void 0,after:null!==(r=e.afterFileContents)&&void 0!==r?r:void 0}})))&&void 0!==o?o:[],a=null!==(s=null===(r=e.submoduleDiffs)||void 0===r?void 0:r.flatMap((e=>{var t;return(null===(t=e.diff)||void 0===t?void 0:t.diffs)&&"string"==typeof e.relativePath&&0!==e.relativePath.length?e.diff.diffs.map((t=>{var n,o,r,s;const i=null!==(o=null!==(n=t.to)&&void 0!==n?n:t.from)&&void 0!==o?o:"",l=e.relativePath.replace(/\/+$/,"");return{path:i.startsWith("/")?`${l}${i}`:`${l}/${i}`,before:null!==(r=t.beforeFileContents)&&void 0!==r?r:void 0,after:null!==(s=t.afterFileContents)&&void 0!==s?s:void 0}})):[]})))&&void 0!==s?s:[];return[...l,...a]}(yield e.getOptimizedDiffDetails({bcId:t}));P(n),_.current=!0}catch(e){(0,a.debugLog)("Error fetching diffs",e)}finally{D(!1)}}))),[e,t]),U=(0,i.useCallback)((()=>d(this,void 0,void 0,(function*(){if(t)if(R.current)try{const n=yield e.getBackgroundComposerChangesHash({bcId:t});n.hash!==T.current&&(T.current=n.hash,yield N())}finally{D(!1)}else D(!1)}))),[e,t,N]);(0,i.useEffect)((()=>{if(!t)return;const e=setInterval((()=>{z.current||(z.current=!0,U().finally((()=>{z.current=!1})))}),l.Ep);return()=>clearInterval(e)}),[U,t]);const B=(0,i.useCallback)((t=>d(this,void 0,void 0,(function*(){var n,o,i,l,d,m,v,b,w,k,S,M,T;if(O.current)return;O.current=!0,j(void 0);const I=new AbortController;L.current=I;try{let j=0;try{y(!0);const[n,o]=yield Promise.allSettled([e.fetchBackgroundComposer({bcId:t}),e.listDetailedBackgroundComposers({bcId:t,n:1})]),r="fulfilled"===n.status?n.value:void 0,i="fulfilled"===o.status?o.value:void 0;if("rejected"===o.status)(0,a.debugLog)("Failed to fetch detailed background composers",t);else{(0,a.debugLogJSON)("detailed",i);const e=null===(d=null==i?void 0:i.composers)||void 0===d?void 0:d[0];e&&(C(e.modelDetails),E(null===(m=e.composer)||void 0===m?void 0:m.branchName),$(null===(v=e.composer)||void 0===v?void 0:v.repoUrl))}if(h({bubbles:[]}),(null===(w=null===(b=null==i?void 0:i.composers)||void 0===b?void 0:b[0])||void 0===w?void 0:w.prompt)&&r&&!(null===(S=null===(k=r.responses)||void 0===k?void 0:k[0])||void 0===S?void 0:S.humanMessage)&&h({bubbles:[{type:"user",isDone:!0,text:i.composers[0].prompt.text,richText:i.composers[0].prompt.richText,isOptimistic:!1}]}),(null==r?void 0:r.responses)&&r.responses.length>0){for(const e of r.responses){const t=null===(M=e.toolCall)||void 0===M?void 0:M.tool;t!==s.XaY.EDIT_FILE&&t!==s.XaY.EDIT_FILE_V2||(R.current=!0,U()),g(e,h)}j=r.responses.length}}catch(e){(0,a.debugLog)("Failed to fetch background composer",t)}finally{y(!1)}x(!0),(0,c.ln)({backgroundComposerAttached:!0,backgroundComposerId:t});const _=new r.R3$({bcId:t,startingIndex:j}),L=e.attachBackgroundComposer(_,{signal:I.signal});let O=Date.now(),Y=r.R6p.UNSPECIFIED,F=!1;const z=setInterval((()=>{const e=Date.now()-O,n=Y===r.R6p.FINISHED||Y===r.R6p.ERROR||Y===r.R6p.EXPIRED;!F&&!n&&e>=p&&(F=!0,(0,c.Dy)({category:"background_composer",waitingFor:"background_composer_message",lastActivityAgoMs:e,extra:{bcId:t,lastStatus:r.R6p[Y]}},"warning"))}),1e4);try{try{for(var P,A=!0,D=u(L);!(n=(P=yield D.next()).done);A=!0){l=P.value,A=!1;const e=l;if(O=Date.now(),F=!1,void 0!==e.statusUpdate&&e.statusUpdate!==r.R6p.UNSPECIFIED&&(Y=e.statusUpdate,f(e.statusUpdate)),e.headlessAgenticComposerResponse){const t=null===(T=e.headlessAgenticComposerResponse.toolCall)||void 0===T?void 0:T.tool;t!==s.XaY.EDIT_FILE&&t!==s.XaY.EDIT_FILE_V2||(R.current=!0,U()),g(e.headlessAgenticComposerResponse,h)}}}catch(e){o={error:e}}finally{try{A||n||!(i=D.return)||(yield i.call(D))}finally{if(o)throw o.error}}}finally{clearInterval(z)}}catch(e){const n=e instanceof Error?e.message:"string"==typeof e?e:JSON.stringify(e);(0,a.debugLog)("Error attaching background composer",t,n),j(n)}finally{x(!1),O.current=!1,(0,c.ln)({backgroundComposerAttached:!1,backgroundComposerId:void 0})}}))),[e,U]);(0,i.useEffect)((()=>{if(h({bubbles:[]}),f(r.R6p.UNSPECIFIED),x(!1),j(void 0),P(void 0),_.current=!1,T.current=void 0,D(!1),R.current=!1,t)return B(t),()=>{var e;null===(e=L.current)||void 0===e||e.abort(),O.current=!1}}),[B,t]);const q=(0,i.useCallback)((()=>{var e;t&&(null===(e=L.current)||void 0===e||e.abort(),O.current=!1,B(t))}),[B,t]);(0,i.useEffect)((()=>{Y.current=m}),[m]),(0,i.useEffect)((()=>{if(!t)return;let n=!1;const o=()=>d(this,void 0,void 0,(function*(){if(!F.current&&!n&&Y.current!==r.R6p.FINISHED&&Y.current!==r.R6p.ERROR&&Y.current!==r.R6p.EXPIRED){F.current=!0;try{const o=yield e.getBackgroundComposerStatus({bcId:t});!n&&o&&void 0!==o.status&&f(o.status)}catch(e){}finally{F.current=!1}}}));o();const s=setInterval((()=>{o()}),l.kh);return()=>{n=!0,clearInterval(s)}}),[e,t]);const H=(0,i.useCallback)(((e,t)=>{const n=(0,o.randomUUID)();return h((o=>({bubbles:[...o.bubbles,{type:"user",text:e,richText:null!=t?t:e,isDone:!1,isOptimistic:!0,bubbleId:n}]}))),n}),[]),W=(0,i.useCallback)((e=>{h((t=>{const n=t.bubbles;if(e){const o=n.findIndex((t=>"user"===t.type&&t.isOptimistic&&t.bubbleId===e));return-1!==o?{bubbles:[...n.slice(0,o),...n.slice(o+1)]}:t}for(let e=n.length-1;e>=0;e--){const t=n[e];if("user"===t.type&&t.isOptimistic)return{bubbles:[...n.slice(0,e),...n.slice(e+1)]}}return t}))}),[]);return(0,i.useMemo)((()=>({responses:n,status:m,isAttached:v,isLoadingConversation:b,isLoadingDiffs:A,error:w,reconnect:q,addOptimisticFollowup:H,removeOptimisticFollowup:W,modelDetails:k,branchName:S,repoUrl:M,diffs:I})),[n,m,v,b,A,w,q,H,W,k,S,M,I])}function g(e,t){var n,o;const s=e=>function(e){let t=e.length;for(let n=e.length-1;n>=0;n--){const o=e[n];if("user"!==o.type||!o.isOptimistic)break;t=n}return t}(e);if(e.thinking&&t((t=>{var n,o,r,i;const l=s(t.bubbles),a=l>0?t.bubbles[l-1]:void 0;if(a&&"thinking"===a.type&&!a.isDone){const r=Object.assign(Object.assign({},a),{text:a.text+(null!==(o=null===(n=e.thinking)||void 0===n?void 0:n.text)&&void 0!==o?o:"")});return{bubbles:[...t.bubbles.slice(0,l-1),r,...t.bubbles.slice(l)]}}const c={type:"thinking",text:null!==(i=null===(r=e.thinking)||void 0===r?void 0:r.text)&&void 0!==i?i:"",isDone:!1,thinkingDurationMs:0};return l===t.bubbles.length?{bubbles:[...t.bubbles,c]}:{bubbles:[...t.bubbles.slice(0,l),c,...t.bubbles.slice(l)]}})),void 0!==e.thinkingDurationMs&&t((t=>{var n;let o=-1;for(let e=s(t.bubbles)-1;e>=0;e--)if("thinking"===(null===(n=t.bubbles[e])||void 0===n?void 0:n.type)){o=e;break}if(-1===o)return t;const r=Object.assign(Object.assign({},t.bubbles[o]),{thinkingDurationMs:Number(e.thinkingDurationMs),isDone:!0});return{bubbles:[...t.bubbles.slice(0,o),r,...t.bubbles.slice(o+1)]}})),e.thinking||void 0!==e.thinkingDurationMs||t((e=>{const t=s(e.bubbles);if(0===t)return e;const n=e.bubbles[t-1];if(!n||"thinking"!==n.type||n.isDone)return e;const o=Object.assign(Object.assign({},n),{isDone:!0});return{bubbles:[...e.bubbles.slice(0,t-1),o,...e.bubbles.slice(t)]}})),e.status&&t((t=>{const n=s(t.bubbles),o=n>0?t.bubbles[n-1]:void 0,i=e.status;if(!i)return t;if(!i.isComplete&&"status"!==(null==o?void 0:o.type)){const e={type:"status",statusType:i.type,message:i.message,isDone:i.isComplete,isVisible:!0};return n===t.bubbles.length?{bubbles:[...t.bubbles,e]}:{bubbles:[...t.bubbles.slice(0,n),e,...t.bubbles.slice(n)]}}if("status"===(null==o?void 0:o.type)){const e=Object.assign(Object.assign({},o),{isDone:i.isComplete}),s=[...t.bubbles.slice(0,n-1),e,...t.bubbles.slice(n)];if(i.type===r.ywg.INDEX_SYNC){const o=Object.assign(Object.assign({},e),{isVisible:!1});return{bubbles:[...t.bubbles.slice(0,n-1),o,...t.bubbles.slice(n)]}}return i.isComplete&&i.type===r.ywg.GENERIC?{bubbles:[...s,{type:"status",statusType:i.type,message:i.message,isDone:!0,isVisible:!0}]}:{bubbles:s}}return t})),e.status||t((e=>{const t=s(e.bubbles);if(0===t)return e;const n=e.bubbles[t-1];if(!n||"status"!==n.type)return e;if(n.statusType!==r.ywg.INDEX_SYNC)return e;const o=Object.assign(Object.assign({},n),{isDone:!0,isVisible:!1});return{bubbles:[...e.bubbles.slice(0,t-1),o,...e.bubbles.slice(t)]}})),e.text&&t((t=>{const n=s(t.bubbles),o=n>0?t.bubbles[n-1]:void 0;if(o&&"text"===o.type&&!o.isDone){const r=Object.assign(Object.assign({},o),{text:o.text+e.text});return{bubbles:[...t.bubbles.slice(0,n-1),r,...t.bubbles.slice(n)]}}const r={type:"text",text:e.text,isDone:!!e.isMessageDone};return n===t.bubbles.length?{bubbles:[...t.bubbles,r]}:{bubbles:[...t.bubbles.slice(0,n),r,...t.bubbles.slice(n)]}})),e.toolCall){const n=e.toolCall;t((e=>{const t=e.bubbles.findIndex((e=>"tool"===e.type&&e.toolCall.toolCallId===n.toolCallId));if(-1===t)return{bubbles:[...e.bubbles,{type:"tool",toolCall:n,toolResult:void 0}]};const o=e.bubbles[t],r=Object.assign(Object.assign({},o),{toolCall:n});return{bubbles:[...e.bubbles.slice(0,t),r,...e.bubbles.slice(t+1)]}}))}if(e.finalToolResult&&t((t=>{const n=e.finalToolResult;if(!n)return t;const o=t.bubbles.findIndex((e=>"tool"===e.type&&e.toolCall.toolCallId===n.toolCallId));if(-1===o)return t;const r=t.bubbles[o],s=Object.assign(Object.assign({},r),{toolResult:n.result});return{bubbles:[...t.bubbles.slice(0,o),s,...t.bubbles.slice(o+1)]}})),e.humanMessage){const n=e.humanMessage,o=n.bubbleId;t((t=>{var r,s;const i=o?t.bubbles.findIndex((e=>"user"===e.type&&e.bubbleId===o)):-1;if(-1!==i){const e=t.bubbles[i],o=Object.assign(Object.assign({},e),{text:n.text,richText:null!==(r=n.richText)&&void 0!==r?r:"",isOptimistic:!1});return{bubbles:[...t.bubbles.slice(0,i),o,...t.bubbles.slice(i+1)]}}{const r={type:"user",text:n.text,richText:null!==(s=n.richText)&&void 0!==s?s:"",isDone:!!e.isMessageDone,isOptimistic:!1,bubbleId:o};return{bubbles:[...t.bubbles,r]}}})),t((e=>{const t=e.bubbles;for(let e=t.length-1;e>=0;e--){const n=t[e];if("user"===n.type&&n.isOptimistic)return{bubbles:[...t.slice(0,e),...t.slice(e+1)]}}return e}))}var i;e.isMessageDone&&t((e=>{const t=s(e.bubbles);if(0===t)return e;const n=e.bubbles[t-1];if(!n||"text"!==n.type&&"user"!==n.type&&"thinking"!==n.type)return e;const o=Object.assign(Object.assign({},n),{isDone:!0});return{bubbles:[...e.bubbles.slice(0,t-1),o,...e.bubbles.slice(t)]}})),e.error&&(i={type:"error",message:(null===(n=e.error)||void 0===n?void 0:n.message)||"An unknown error occurred",errorDetails:null===(o=e.error)||void 0===o?void 0:o.errorDetails},t((e=>{const t=s(e.bubbles);return t===e.bubbles.length?{bubbles:[...e.bubbles,i]}:{bubbles:[...e.bubbles.slice(0,t),i,...e.bubbles.slice(t)]}})))}},"./src/hooks/use-background-actions.ts":(e,t,n)=>{n.d(t,{V:()=>v});var o=n("node:child_process"),r=n("node:fs"),s=n("node:os"),i=n.n(s),l=n("node:path"),a=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),c=n("./src/utils/git.ts"),d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function u(e,t){try{null==e||e(t)}catch(e){}}function p(e,t){return(0,o.execFileSync)("git",e,{cwd:t,encoding:"utf8",stdio:["ignore","pipe","pipe"],maxBuffer:2097152}).trim()}function h(e,t){try{return p(e,t)}catch(e){return}}function g(e){return h(["rev-parse","--abbrev-ref","HEAD"],e)}function m(e,t){(0,r.mkdirSync)((0,l.dirname)(e),{recursive:!0}),(0,r.writeFileSync)(e,t,"utf8")}function f(e,t,n){const s=(0,l.join)(i().tmpdir(),`bg-merge-${Date.now()}-${Math.random().toString(36).slice(2)}`);(0,r.mkdirSync)(s,{recursive:!0});const a=(0,l.join)(s,"base.txt"),c=(0,l.join)(s,"ours.txt"),d=(0,l.join)(s,"theirs.txt"),u=e=>e.replace(/\r\n/g,"\n").replace(/\r/g,"\n");(0,r.writeFileSync)(a,u(e),"utf8"),(0,r.writeFileSync)(c,u(n),"utf8"),(0,r.writeFileSync)(d,u(t),"utf8");const p=["merge-file","-p","-L","Current (Your changes)","-L","Base (Original)","-L","Incoming (Cloud Agent changes)",c,a,d];let h="",g=!1;try{try{h=(0,o.execFileSync)("git",p,{encoding:"utf8",maxBuffer:10485760})}catch(e){const t=e;if(!t||1!==t.status||"string"!=typeof t.stdout)throw e;h=t.stdout,g=!0}}finally{try{(0,r.rmSync)(s,{recursive:!0,force:!0})}catch(e){}}var m;return"\r\n"==(((m=n).match(/\r\n/g)||[]).length>(m.match(/(?<!\r)\n/g)||[]).length?"\r\n":"\n")&&(h=h.replace(/\n/g,"\r\n")),{merged:h,hasConflicts:g}}function v(e){const t=(0,a.useCallback)(((t,n)=>d(this,void 0,void 0,(function*(){var o,r,s;const i=null==n?void 0:n.print,l=null==n?void 0:n.confirm,a=(0,c.ky)(process.cwd());u(i,[{text:"» ",dim:!0},{text:"Checking out background branch locally",bold:!0}]);const d=yield e.getBackgroundComposerInfo({bcId:t}),m=null===(r=null===(o=null==d?void 0:d.composer)||void 0===o?void 0:o.composer)||void 0===r?void 0:r.branchName;if(!m)return void u(i,[{text:"error:",color:"red",bold:!0},{text:" No branch available to checkout for this cloud agent"}]);var f;h((f=m)?["fetch","--prune","--tags","origin",f]:["fetch","--all","--prune","--tags"],a);const v=g(a),x=(null!==(s=h(["status","--porcelain"],a))&&void 0!==s?s:"").length>0;if((v&&v!==m||x)&&l&&!(yield l({title:x?"You have local changes that may conflict.":"You are not on the target branch.",detail:x?`Current branch: ${null!=v?v:"unknown"}. Continuing will attempt to check out '${m}'.`:`Current branch: ${null!=v?v:"unknown"}. Will switch to '${m}'.`,continueLabel:"Continue",cancelLabel:"Cancel"})))return;!function(e,t){void 0!==h(["show-ref","--verify",`refs/heads/${t}`],e)?p(["checkout",t],e):p(void 0!==h(["ls-remote","--exit-code","--heads","origin",t],e)?["checkout","-b",t,"--track",`origin/${t}`]:["checkout","-b",t],e),h(["pull","--ff-only"],e)}(a,m);const b=g(a);u(i,[[{text:"✔ ",color:"green",bold:!0},{text:"Now on branch "},{text:null!=b?b:m,bold:!0}]])}))),[e]),n=(0,a.useCallback)(((t,n)=>d(this,void 0,void 0,(function*(){var o,s,i,a,d,p;const v=null==n?void 0:n.print,x=null==n?void 0:n.confirm,b=(0,c.ky)(process.cwd()),y=g(b);u(v,[{text:"» ",dim:!0},{text:"Applying cloud agent changes locally",bold:!0}]);const w=yield e.getOptimizedDiffDetails({bcId:t}),j=[],k=e=>{var t,n;const o=e.to&&"/dev/null"!==e.to?e.to:e.from;if(!o)return;let r=function(e){const t=["/workspace/","file:///workspace/"];for(const n of t)if(e.startsWith(n)){const t=e.slice(n.length);return t.startsWith("/")?t.slice(1):t}return e}(o);r.startsWith("/")&&(r=r.slice(1)),j.push({relativePath:r,isDeleted:"/dev/null"===e.to&&"/dev/null"!==e.from,isNew:"/dev/null"===e.from&&"/dev/null"!==e.to,originalContent:null!==(t=e.beforeFileContents)&&void 0!==t?t:"",finalContent:null!==(n=e.afterFileContents)&&void 0!==n?n:""})};for(const e of null!==(s=null===(o=w.diff)||void 0===o?void 0:o.diffs)&&void 0!==s?s:[])k(e);for(const e of null!==(i=w.submoduleDiffs)&&void 0!==i?i:[])if(!e.errored&&(null===(a=e.diff)||void 0===a?void 0:a.diffs))for(const t of e.diff.diffs){const n=t.to&&"/dev/null"!==t.to?t.to:t.from;if(!n)continue;const o=`${e.relativePath}/${n}`;k(Object.assign(Object.assign({},t),{to:"/dev/null"===t.to?"/dev/null":o,from:"/dev/null"===t.from?"/dev/null":`${e.relativePath}/${t.from}`}))}if(0===j.length)return void u(v,[{text:"No changes to apply.",dim:!0}]);if((null!==(d=h(["status","--porcelain"],b))&&void 0!==d?d:"").length>0&&x&&!(yield x({title:"You have local changes",detail:`Applying ${j.length} changes${y?` from ${y}`:""}. We'll merge into your working tree and show conflict markers where needed.`,continueLabel:"Apply",cancelLabel:"Cancel"})))return;const C=[];let S=0,E=0,M=0,$=0,T=0;for(const e of j){const t=(0,l.resolve)(b,e.relativePath),n=(0,r.existsSync)(t),o=n?(0,r.readFileSync)(t,"utf8"):"",s=e.isDeleted?"":e.finalContent,{merged:i,hasConflicts:a}=f(null!==(p=e.originalContent)&&void 0!==p?p:"",null!=s?s:"",null!=o?o:"");if(e.isDeleted)if(0!==i.length||a)m(t,i),C.push([{text:"• ",color:a?"red":"green"},{text:e.relativePath,bold:!0},{text:a?" (conflicts)":" (updated)",dim:!0}]),a?T+=1:M+=1,S+=1;else if((0,r.existsSync)(t)){try{(0,r.rmSync)(t,{force:!0})}catch(e){}C.push([{text:"- ",color:"yellow"},{text:e.relativePath,bold:!0},{text:" (deleted)",dim:!0}]),$+=1,S+=1}else C.push([{text:"• ",color:"gray"},{text:e.relativePath,bold:!0},{text:" (unchanged)",dim:!0}]);else i===o?C.push([{text:"• ",color:"gray"},{text:e.relativePath,bold:!0},{text:" (unchanged)",dim:!0}]):(m(t,i),n?a?T+=1:M+=1:E+=1,C.push([{text:"• ",color:a?"red":"green"},{text:e.relativePath,bold:!0},{text:a?" (conflicts)":e.isNew?" (created)":" (updated)",dim:!0}]),S+=1),C.length%10==0&&u(v,C.slice(-10))}const I=[];E>0&&I.push(`${E} created`),M>0&&I.push(`${M} updated`),$>0&&I.push(`${$} deleted`),T>0&&I.push(`${T} with conflicts`);const P=I.length>0?` (${I.join(", ")})`:"",A=[{text:"✔ ",color:"green",bold:!0},{text:`Applied ${S}/${j.length} file changes${P}`},y?{text:` on ${y}`,dim:!0}:{text:"",dim:!0}];u(v,[...C.slice(-10),A])}))),[e]);return(0,a.useMemo)((()=>({checkoutLocally:t,applyChangesLocally:n})),[t,n])}},"./src/hooks/use-confirm-overlay.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{_:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/utils/input-keys.ts"),a=e([s]);function c(){const[e,t]=(0,i.useState)(!1),[n,o]=(0,i.useState)(null),[a,c]=(0,i.useState)(0),d=(0,i.useRef)(null),u=(0,i.useRef)(a);(0,i.useEffect)((()=>{u.current=a}),[a]);const p=(0,i.useCallback)((e=>new Promise((n=>{o(e),c(0),u.current=0,d.current=n,t(!0)}))),[]),h=(0,i.useCallback)((e=>{const n=d.current;d.current=null,t(!1),n&&n(e)}),[]);return(0,s.Ge)(((t,n)=>{e&&((0,l.Po)(t,n)||"k"===t||"K"===t?c((e=>Math.max(0,e-1))):(0,l.u$)(t,n)||"j"===t||"J"===t?c((e=>Math.min(1,e+1))):n.return?h(0===u.current):"y"!==t&&"Y"!==t?("n"===t||"N"===t||(0,l.xv)(t,n)||n.ctrl&&"c"===t)&&h(!1):h(!0))}),{isActive:e}),{askConfirm:p,element:(0,i.useMemo)((()=>{var t,o;if(!e||!n)return null;const i=[{key:"y",label:null!==(t=n.continueLabel)&&void 0!==t?t:"Continue",value:!0},{key:"n",label:null!==(o=n.cancelLabel)&&void 0!==o?o:"Cancel",value:!1}];return(0,r.jsx)(s.az,{flexDirection:"column",marginTop:1,marginX:2,children:(0,r.jsxs)(s.az,{flexDirection:"column",borderStyle:"round",borderColor:"yellow",paddingX:2,paddingY:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"yellow",bold:!0,children:"⚠ "}),(0,r.jsx)(s.EY,{color:"foreground",bold:!0,children:n.title})]})}),n.detail&&(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"foreground",children:n.detail})}),(0,r.jsx)(s.az,{marginTop:2,flexDirection:"column",children:i.map(((e,t)=>(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:a===t?"green":"gray",children:a===t?"▶ ":"  "}),(0,r.jsxs)(s.EY,{color:a===t?"foreground":"gray",bold:a===t,children:["[",e.key,"] ",e.label]})]},e.key)))}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"Use arrow keys to navigate, Enter to select, or press the key shown"})})]})})}),[e,n,a]),isActive:e}}s=(a.then?(await a)():a)[0],o()}catch(d){o(d)}}))},"./src/hooks/use-current-branch.ts":(e,t,n)=>{n.d(t,{h:()=>d});var o=n("node:fs"),r=n.n(o),s=n("node:path"),i=n.n(s),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/debug.ts"),c=n("./src/utils/path-utils.ts");function d(e){return(0,l.useMemo)((()=>{try{const t=(0,c.rR)(e.root);if(!t)return(0,a.debugLog)(`No .git directory found starting from: ${e.root}`),null;const n=i().join(t,"HEAD");if(!r().existsSync(n))return null;const o=r().readFileSync(n,"utf8").trim(),s=o.match(/^ref: refs\/heads\/(.+)$/);return s?s[1]:/^[0-9a-f]{40}$/.test(o)?o.slice(0,7):null}catch(e){return null}}),[e.root])}},"./src/hooks/use-debounced-callback.ts":(e,t,n)=>{n.d(t,{Y:()=>s});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const r=e=>{e.current&&(clearTimeout(e.current),e.current=null)};function s(e,t,n,s){const i="number"==typeof t?t:0,l=null!=n?n:{},a=!!l.leading,c=!("trailing"in l)||!!l.trailing,d="number"==typeof l.maxWait&&l.maxWait>=0?l.maxWait:void 0,u=(0,o.useRef)(e),p=(0,o.useRef)(null),h=(0,o.useRef)(null),g=(0,o.useRef)(null),m=(0,o.useRef)(null),f=(0,o.useRef)(0),v=(0,o.useRef)(void 0);(0,o.useEffect)((()=>{u.current=e}),[e]);const x=(0,o.useCallback)((()=>{s&&s({})}),[s]),b=(0,o.useCallback)((e=>{const t=g.current,n=m.current;return g.current=null,m.current=null,f.current=e,t?(v.current=u.current.apply(n,t),v.current):v.current}),[]),y=(0,o.useMemo)((()=>{const e=()=>{r(p),c&&g.current&&(b(Date.now()),x()),r(h)},t=()=>{r(h),g.current&&(r(p),b(Date.now()),x())},n=function(...n){const o=Date.now();if(g.current=n,m.current=this,a&&!p.current&&(v.current=u.current.apply(this,n),f.current=o),c&&(r(p),p.current=setTimeout(e,i)),void 0!==d&&!h.current){const e=o-f.current,n=Math.max(0,d-e);h.current=setTimeout(t,n)}return v.current};return n.cancel=()=>{r(p),r(h),g.current=null,m.current=null},n.flush=()=>(r(p),r(h),b(Date.now())),n.isPending=()=>!!p.current,n}),[a,c,i,d,b,x]);return(0,o.useEffect)((()=>()=>{r(p),r(h)}),[]),y}},"./src/hooks/use-git-root.ts":(e,t,n)=>{n.d(t,{_:()=>l});var o=n("node:path"),r=n.n(o),s=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),i=n("./src/utils/path-utils.ts");function l(e){return(0,s.useMemo)((()=>{const t=(0,i.rR)(e.root);return t?r().dirname(t):null}),[e.root])}},"./src/hooks/use-mounted-effect.ts":(e,t,n)=>{n.d(t,{H:()=>r});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");function r(e,t){const n=(0,o.useRef)(!1),r=(0,o.useCallback)(e,null!=t?t:[]);(0,o.useEffect)((()=>{n.current?r():n.current=!0}),[r])}},"./src/hooks/use-screen-size.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{l:()=>l});var r=n("../ink/build/index.js"),s=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),i=e([r]);function l(){const{stdout:e}=(0,r.t$)(),t=(0,s.useCallback)((()=>({height:e.rows,width:e.columns})),[e]),[n,o]=(0,s.useState)(t);return(0,s.useEffect)((()=>{function n(){o(t())}return e.on("resize",n),()=>{e.off("resize",n)}}),[e,t]),n}r=(i.then?(await i)():i)[0],o()}catch(a){o(a)}}))},"./src/hooks/use-send-to-background.ts":(e,t,n)=>{n.d(t,{$:()=>R});var o=n("node:child_process"),r=n("node:crypto"),s=n("../agent-client/dist/index.js"),i=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),l=n("../proto/dist/generated/aiserver/v1/chat_pb.js"),a=n("../../node_modules/.pnpm/@connectrpc+connect@1.6.1_patch_hash=a4b9a5e69295313832387f25b708426bcf53041a2f50bc7b95_a276813e7efa8e1efb8a7b0efc1d56a0/node_modules/@connectrpc/connect/dist/esm/connect-error.js"),c=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),d=n("./src/debug.ts"),u=n("../agent-kv/dist/index.js"),p=n("../proto/dist/generated/agent/v1/agent_pb.js"),h=n("./src/utils/terminal-title.ts"),g=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const m=new u.cm(p.ConversationTurnStructure),f=new u.cm(p.UserMessage);function v(e,t,n){return g(this,void 0,void 0,(function*(){var o,r;const s=new Set,i=e=>{e&&e.length>0&&s.add((0,u.nj)(e))};for(const s of t.turns){i(s);try{const t=yield n.getBlob(e,s);if(t){const s=m.deserialize(t);if("agentConversationTurn"===s.turn.case){const t=s.turn.value;i(t.userMessage);try{const s=yield n.getBlob(e,t.userMessage);if(s){const e=null!==(r=null===(o=f.deserialize(s).selectedContext)||void 0===o?void 0:o.selectedImages)&&void 0!==r?r:[];for(const t of e)"blobId"===t.dataOrBlobId.case&&t.dataOrBlobId.value.length>0?i(t.dataOrBlobId.value):"blobIdWithData"===t.dataOrBlobId.case&&t.dataOrBlobId.value.blobId.length>0&&i(t.dataOrBlobId.value.blobId)}}catch(e){}for(const e of t.steps)i(e)}else if("shellConversationTurn"===s.turn.case){const e=s.turn.value;i(e.shellCommand),i(e.shellOutput)}}}catch(e){}}for(const e of t.todos)i(e);t.summary&&t.summary.length>0&&i(t.summary),t.plan&&t.plan.length>0&&i(t.plan);for(const e of t.summaryArchives)i(e);for(const e of t.rootPromptMessagesJson)i(e);for(const[o,r]of Object.entries(t.subagentStates))if(r.conversationState){const t=yield v(e,r.conversationState,n);for(const e of t)s.add(e)}return s}))}function x(e,t){return g(this,void 0,void 0,(function*(){const n=t.getConversationStateStructure(),o=t.getBlobStore(),r=n.clone();r.fileStatesV2={},r.readPaths=[],r.pendingToolCalls=[],r.previousWorkspaceUris=[];const s=yield v(e,r,o),l=[];let a=0;for(const t of s){const n=(0,u.aD)(t),r=yield o.getBlob(e,n);if(r){const e=new Uint8Array(n),t=new Uint8Array(r);l.push(new i.onr({id:e,value:t})),a+=r.length}}const c=t.getMetadata("name"),d=(0,h.iq)(c)?c:"";return{conversationState:r,preFetchedBlobs:l,agentId:t.getMetadata("agentId"),agentName:d,totalBlobBytes:a}}))}function b(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`}var y=n("./src/utils/git.ts"),w=n("node:fs"),j=n("node:fs/promises"),k=n("node:os"),C=n("node:path"),S=n("node:util"),E=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const M=(0,S.promisify)(o.execFile),$="Cursor: Apply local changes for cloud agent";function T(e,t){try{return(0,o.execFileSync)("git",e,{cwd:t,stdio:["ignore","pipe","pipe"],encoding:"utf8",maxBuffer:2097152}).trimEnd()}catch(e){return}}function I(e,t){return E(this,void 0,void 0,(function*(){try{const{stdout:n}=yield M("git",e,{cwd:t,maxBuffer:2097152});return n.trimEnd()}catch(e){return}}))}function P(e,t){return E(this,void 0,void 0,(function*(){const{stdout:n}=yield function(e,t){return E(this,void 0,void 0,(function*(){var n,o;try{const{stdout:n,stderr:o}=yield M("git",e,{cwd:t,maxBuffer:2097152});return{stdout:n.trim(),stderr:o.trim()}}catch(t){const r=t,s=null!==(o=null!==(n=r.stderr)&&void 0!==n?n:r.message)&&void 0!==o?o:String(t);throw new Error(`git ${e.join(" ")} failed: ${s}`)}}))}(e,t);return n}))}var A=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function D(e,t){try{return(0,o.execFileSync)("git",e,{cwd:t,stdio:["ignore","pipe","ignore"],encoding:"utf8",maxBuffer:1048576}).trim()}catch(e){return}}function _(e){let t=e;e.startsWith("git@github.com:")&&(t=`https://github.com/${e.slice(15).replace(/\.git$/i,"")}`),e.startsWith("ssh://git@github.com/")&&(t=`https://github.com/${e.slice(21).replace(/\.git$/i,"")}`),e.startsWith("git://github.com/")&&(t=`https://github.com/${e.slice(17).replace(/\.git$/i,"")}`),t=t.replace(/\.git$/i,"");const n=t.replace(/^https?:\/\//i,"");return{httpsUrl:t,hostPath:n}}function R(e){const[t,o]=(0,c.useState)(!1),[u,p]=(0,c.useState)(!1),[h,g]=(0,c.useState)(!1),[m,f]=(0,c.useState)(""),v=(0,c.useRef)(!1),S=(0,c.useCallback)((()=>{h&&(v.current=!0)}),[h]),M=(0,c.useCallback)((t=>A(this,void 0,void 0,(function*(){var n,r,s;const a=t.trim();if(0===a.length)return{type:"error",message:"Prompt is empty",timestampMs:Date.now()};o(!0);try{const t=process.cwd(),o=(0,y.ky)(t),c=null!==(n=D(["config","--get","remote.origin.url"],o))&&void 0!==n?n:(()=>{var e;const t=D(["remote","-v"],o);if(!t)return;const n=null!==(e=t.split(/\r?\n/).find((e=>e.includes("(fetch)"))))&&void 0!==e?e:t.split(/\r?\n/)[0],r=null==n?void 0:n.split(/\s+/);return null==r?void 0:r[1]})(),d=null!==(r=D(["rev-parse","--abbrev-ref","HEAD"],o))&&void 0!==r?r:"main";if(!c)return{type:"error",message:"Cloud Agent requires a Git remote. Add a GitHub remote and try again.",timestampMs:Date.now()};const{httpsUrl:u,hostPath:p}=_(c);let h;try{h=(yield e.getBackgroundComposerUserSettings({})).modelName}catch(e){}const g=null===(s=(yield e.startBackgroundComposerFromSnapshot({snapshotNameOrId:p,snapshotWorkspaceRootPath:o,devcontainerStartingPoint:{url:u,ref:d,cursorServerCommit:"",userExtensions:[],environmentJsonOverride:"",dontAllowReadingEnvironmentJsonFromDatabase:!1,skipBuildCaches:!1},repoUrl:p,autoBranch:!0,returnImmediately:!0,source:i._bo.EDITOR,modelDetails:h?{modelName:h,maxMode:!0}:{},additionalModelDetails:[],repositoryInfo:{repositoryInfo:void 0,pathEncryptionKey:"",shouldSyncIndex:!1,repositoryInfoShouldQueryStaging:!1,repositoryInfoShouldQueryProd:!1,repoQueryAuthToken:"",queryOnlyRepoAccess:void 0},conversationHistory:[{text:a,richText:a,capabilityContexts:[],type:l.Jc.HUMAN,images:[]}]})).composer)||void 0===s?void 0:s.bcId;let m;if(g)try{const t=yield e.getBackgroundComposerStatus({bcId:g});m=(()=>{switch(t.status){case i.R6p.CREATING:return"CREATING";case i.R6p.RUNNING:return"RUNNING";case i.R6p.FINISHED:return"FINISHED";case i.R6p.ERROR:return"ERROR";case i.R6p.EXPIRED:return"EXPIRED";default:return"UNKNOWN"}})()}catch(e){}return g?{type:"success",bcId:g,repoHostPath:p,branch:d,statusText:m,timestampMs:Date.now()}:{type:"error",message:"Failed to start Cloud Agent",timestampMs:Date.now()}}catch(e){return{type:"error",message:`Failed to start Cloud Agent: ${e instanceof Error?e.message:String(e)}`,timestampMs:Date.now()}}finally{o(!1)}}))),[e]),R=(0,c.useCallback)(((t,n,o)=>A(this,void 0,void 0,(function*(){var r,s;const a=n.trim();if(!t||!a)return{type:"error",message:t?"Follow-up message is empty":"Background composer ID is required",timestampMs:Date.now()};p(!0);try{const n=new l.hS({text:a,richText:a,capabilityContexts:[],type:l.Jc.HUMAN,images:[]});(null==o?void 0:o.bubbleId)&&(n.bubbleId=o.bubbleId);const c=new i.FFs({bcId:t,followupMessage:n,synchronous:null!==(r=null==o?void 0:o.synchronous)&&void 0!==r&&r,followupSource:null!==(s=null==o?void 0:o.source)&&void 0!==s?s:i._bo.CLI});return yield e.addAsyncFollowupBackgroundComposer(c),{type:"success",bcId:t,timestampMs:Date.now()}}catch(e){const t=e instanceof Error?e.message:String(e);return(0,d.debugLog)(`Failed to send follow-up: ${t}`),{type:"error",message:`Failed to send follow-up: ${t}`,timestampMs:Date.now()}}finally{p(!1)}}))),[e]),L=(0,c.useCallback)(((t,o,l,c,u)=>A(this,void 0,void 0,(function*(){var p,h,m;const{confirm:S,setStatus:M}=l;g(!0);const A=e=>{f(e),M&&M(e)};v.current=!1;const D=()=>v.current;try{A("Checking git status");const s={confirm:S,setStatus:A},l=yield function(e){return E(this,void 0,void 0,(function*(){var t,n,o,r,s;const{confirm:i,setStatus:l}=e,a=process.cwd(),c=(0,y.ky)(a),d=e=>({success:!1,error:e,repoRoot:c,branch:"",originalBranch:"",commit:"",remoteUrl:""});if(!(0,w.existsSync)((0,C.join)(c,".git")))return d("Not a git repository. Initialize with: git init && git remote add origin <url>");const u=T(["config","--get","remote.origin.url"],c);if(!u)return d("No remote 'origin' configured. Add with: git remote add origin <url>");const p=T(["rev-parse","--abbrev-ref","HEAD"],c);if(!p||"HEAD"===p)return d("Not on a branch (detached HEAD). Checkout a branch first: git checkout -b <branch>");const h=yield I(["ls-remote","--heads","origin",p],c);if(!h||0===h.length){if(!(yield i({title:"Branch Not Pushed",detail:`The branch "${p}" is not on the remote repository. Push to remote before kicking off agent?`,continueLabel:"Push",cancelLabel:"Cancel"})))return d("Cancelled by user");try{null==l||l("Pushing branch"),yield P(["push","-u","origin",p],c);const e=yield I(["ls-remote","--heads","origin",p],c);if(!e||0===e.length)return d("Push completed but branch not found on remote")}catch(e){return d(`Failed to push branch: ${e instanceof Error?e.message:String(e)}`)}}yield I(["fetch","origin",p],c);const g=T(["rev-list","--count",`origin/${p}..HEAD`],c),m=parseInt(null!=g?g:"0",10),f=null!==(t=yield I(["diff","--no-color"],c))&&void 0!==t?t:"",v=null!==(n=yield I(["diff","--cached","--no-color"],c))&&void 0!==n?n:"";let x,b;if(f.trim().length>0||v.trim().length>0||m>0)try{null==l||l("Preparing branch"),x=yield function(e,t){return E(this,void 0,void 0,(function*(){var n;const o=yield function(e){return E(this,void 0,void 0,(function*(){var t;const n=[],o=(null!==(t=yield I(["status","--porcelain","-z","-uall"],e))&&void 0!==t?t:"").split("\0");let r=0;for(;r<o.length;){const e=o[r];if(""===e){r++;continue}if(e.length<4){r++;continue}const t=e.substring(0,2).trim(),s=e.substring(3);t.startsWith("R")||t.startsWith("C")?r+=2:r++,s&&n.push({path:s,status:t})}return n}))}(e);if(0===o.length)return;const r=function(){const e=Date.now(),t=Math.random().toString(36).substring(2,7);return(0,C.join)((0,k.tmpdir)(),`cursor-worktree-${e}-${t}`)}(),s=`cursor/cloud-agent-${Date.now()}-${Math.random().toString(36).substring(2,7)}`;try{if(yield P(["worktree","add","-b",s,r,t],e),yield function(e,t,n){return E(this,void 0,void 0,(function*(){for(const o of n){const n=(0,C.join)(e,o.path),r=(0,C.join)(t,o.path);if("D"===o.status)try{yield(0,j.unlink)(r)}catch(e){if(e instanceof Error&&"ENOENT"!==e.code)throw e}else if(["M","A","R","C","U","??","AM","MM"].includes(o.status))try{yield(0,j.mkdir)((0,C.dirname)(r),{recursive:!0}),yield(0,j.copyFile)(n,r)}catch(e){console.warn(`Error copying file ${o.path}:`,e)}else console.warn(`Unexpected file status: ${o.status} for file: ${o.path}`)}}))}(e,r,o),yield P(["add","-A"],r),""!==(null!==(n=yield I(["status","--porcelain"],r))&&void 0!==n?n:"").trim())try{yield P(["commit","-m",$],r)}catch(e){return void console.warn("Failed to commit changes in worktree:",e)}else console.warn("No changes to commit in worktree after copying dirty files");try{yield P(["push","--set-upstream","origin",s],r)}catch(e){console.warn(`Failed to push branch ${s}, continuing anyway:`,e)}return s}finally{try{yield I(["worktree","remove",r,"--force"],e)}catch(t){try{yield(0,j.rm)(r,{recursive:!0,force:!0}),yield I(["worktree","prune"],e)}catch(e){}}}}))}(c,"HEAD")}catch(e){return d(`Failed to prepare worktree with changes: ${e instanceof Error?e.message:String(e)}`)}return b=x?null!==(r=null!==(o=T(["rev-parse",`origin/${x}`],c))&&void 0!==o?o:T(["rev-parse","HEAD"],c))&&void 0!==r?r:"":null!==(s=T(["rev-parse","HEAD"],c))&&void 0!==s?s:"",{success:!0,repoRoot:c,branch:null!=x?x:p,originalBranch:p,commit:b,remoteUrl:u,worktreeBranch:x}}))}(s);if(!l.success)return{type:"cancelled",reason:null!==(p=l.error)&&void 0!==p?p:"Git preparation failed",timestampMs:Date.now()};if(D())return{type:"cancelled",reason:"Transfer cancelled by user",timestampMs:Date.now()};A("Exporting conversation");const a=yield x(t,o);A("Validating transfer size");const g=function(e,t=104857600){if(e.totalBlobBytes>t)return`Conversation is too large to transfer (${b(e.totalBlobBytes)} > ${b(t)}). Try starting a new conversation with a summary of the current one.`}(a);if(g)return{type:"error",message:g,timestampMs:Date.now()};if(D())return{type:"cancelled",reason:"Transfer cancelled by user",timestampMs:Date.now()};let m;A("Fetching settings");try{m=(yield e.getBackgroundComposerUserSettings({})).modelName}catch(e){}if(D())return{type:"cancelled",reason:"Transfer cancelled by user",timestampMs:Date.now()};A("Creating cloud agent");const{httpsUrl:f,hostPath:v}=_(l.remoteUrl);(0,d.debugLog)("StartBackgroundComposerFromSnapshot request:",{snapshotNameOrId:v,snapshotWorkspaceRootPath:l.repoRoot,repoUrl:v,httpsUrl:f,branch:l.branch,conversationStateTurnCount:a.conversationState.turns.length,conversationStateTodoCount:a.conversationState.todos.length,preFetchedBlobCount:a.preFetchedBlobs.length,totalBlobBytes:a.totalBlobBytes,modelName:m,sampleBlobIds:a.preFetchedBlobs.slice(0,3).map((e=>`${Array.from(e.id.slice(0,8)).map((e=>e.toString(16).padStart(2,"0"))).join("")}... (${e.value.length} bytes)`))});try{const e=a.conversationState.toJsonString();(0,d.debugLog)(`ConversationState JSON length: ${e.length} chars`);const t=a.conversationState.toBinary();(0,d.debugLog)(`ConversationState binary length: ${t.length} bytes`);for(let e=0;e<a.preFetchedBlobs.length;e++){const t=a.preFetchedBlobs[e];try{t.toBinary()}catch(t){throw(0,d.debugLog)(`Failed to serialize preFetchedBlob ${e}:`,String(t)),t}}(0,d.debugLog)("All preFetchedBlobs validated successfully")}catch(e){return(0,d.debugLog)("Failed to serialize:",String(e)),{type:"error",message:`Invalid data for transfer: ${e instanceof Error?e.message:String(e)}`,timestampMs:Date.now()}}const M=(0,r.randomUUID)(),R=(0,r.randomUUID)();if((0,d.debugLog)("Request fields being sent:",{snapshotNameOrId:v,snapshotWorkspaceRootPath:l.repoRoot,devcontainerUrl:f,devcontainerRef:l.branch,repoUrl:v,modelName:m,agentSessionId:M,kickoffMessageId:R,conversationStateTurns:a.conversationState.turns.length,preFetchedBlobsCount:a.preFetchedBlobs.length}),a.preFetchedBlobs.length>0){const e=a.preFetchedBlobs[0];(0,d.debugLog)("First blob details:",{idLength:e.id.length,valueLength:e.value.length,idIsUint8Array:e.id instanceof Uint8Array,valueIsUint8Array:e.value instanceof Uint8Array})}let L;if((0,d.debugLog)("Sending request to startBackgroundComposerFromSnapshot..."),A("Sending to cloud"),u)L=u;else{const{ConversationAction:e,UserMessageAction:t,UserMessage:o}=yield Promise.resolve().then(n.bind(n,"../proto/dist/generated/agent/v1/agent_pb.js")),r=(null==c?void 0:c.trim())||"Continue working on the current task.";L=new e({action:{case:"userMessageAction",value:new t({userMessage:new o({text:r,messageId:R,richText:r}),sendToInteractionListener:!0})}})}const O=null===(h=(yield e.startBackgroundComposerFromSnapshot({snapshotNameOrId:v,snapshotWorkspaceRootPath:l.repoRoot,devcontainerStartingPoint:{url:f,ref:l.branch,cursorServerCommit:"",userExtensions:[],environmentJsonOverride:"",dontAllowReadingEnvironmentJsonFromDatabase:!1,skipBuildCaches:!1},repoUrl:v,autoBranch:!0,baseBranch:l.originalBranch,returnImmediately:!0,source:i._bo.CLI,modelDetails:m?{modelName:m,maxMode:!0}:{},additionalModelDetails:[],repositoryInfo:{repositoryInfo:void 0,pathEncryptionKey:"",shouldSyncIndex:!1,repositoryInfoShouldQueryStaging:!1,repositoryInfoShouldQueryProd:!1,repoQueryAuthToken:"",queryOnlyRepoAccess:void 0},conversationState:a.conversationState,preFetchedBlobs:a.preFetchedBlobs,name:a.agentName,conversationAction:L,agentSessionId:M,kickoffMessageId:R,addInitialMessageToResponses:!0})).composer)||void 0===h?void 0:h.bcId;let Y;if(O){A("Verifying cloud agent");try{const t=yield e.getBackgroundComposerStatus({bcId:O});Y=(()=>{switch(t.status){case i.R6p.CREATING:return"CREATING";case i.R6p.RUNNING:return"RUNNING";case i.R6p.FINISHED:return"FINISHED";case i.R6p.ERROR:return"ERROR";case i.R6p.EXPIRED:return"EXPIRED";default:return"UNKNOWN"}})()}catch(e){}}return O?{type:"success",bcId:O,repoHostPath:v,branch:l.branch,statusText:Y,transferredBlobCount:a.preFetchedBlobs.length,transferredBlobBytes:a.totalBlobBytes,worktreeBranch:l.worktreeBranch,timestampMs:Date.now()}:{type:"error",message:"Failed to create cloud agent",timestampMs:Date.now()}}catch(e){const t=e instanceof Error?e.message:String(e);if((0,d.debugLog)(`Transfer to cloud failed: ${t}`),e instanceof a.T){const t=(0,s.mb)(e),n=e.code,o={0:"OK",1:"CANCELED",2:"UNKNOWN",3:"INVALID_ARGUMENT",4:"DEADLINE_EXCEEDED",5:"NOT_FOUND",6:"ALREADY_EXISTS",7:"PERMISSION_DENIED",8:"RESOURCE_EXHAUSTED",9:"FAILED_PRECONDITION",10:"ABORTED",11:"OUT_OF_RANGE",12:"UNIMPLEMENTED",13:"INTERNAL",14:"UNAVAILABLE",15:"DATA_LOSS",16:"UNAUTHENTICATED"};if((0,d.debugLog)("ConnectError details:",{code:n,codeName:null!==(m=o[n])&&void 0!==m?m:`CODE_${n}`,message:e.message,rawMessage:e.rawMessage,details:t}),e.metadata){const t={};e.metadata.forEach(((e,n)=>{t[n]=e})),(0,d.debugLog)("ConnectError metadata:",t)}e.cause&&(0,d.debugLog)("ConnectError cause:",String(e.cause));const r={};for(const t of Object.keys(e))try{r[t]=e[t]}catch(e){r[t]="[unreadable]"}(0,d.debugLog)("ConnectError all properties:",r)}else e instanceof Error&&((0,d.debugLog)("Error stack:",e.stack),e.cause&&(0,d.debugLog)("Error cause:",String(e.cause)));return{type:"error",message:`Transfer failed: ${t}`,timestampMs:Date.now()}}finally{g(!1),f("")}}))),[e]);return(0,c.useMemo)((()=>({isSubmitting:t,isSubmittingFollowup:u,isTransferring:h,transferStatus:m,sendToBackground:M,sendFollowupToBackground:R,transferToCloud:L,cancelTransfer:S})),[t,u,h,m,M,R,L,S])}},"./src/hooks/use-shared-animation.ts":(e,t,n)=>{n.d(t,{e:()=>l,q:()=>r});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const r=210,s=new Map;function i(e){let t=s.get(e);return t||(t={tick:0,timer:null,listeners:new Set},t.timer=setInterval((()=>{t.tick=t.tick+1;for(const e of t.listeners)e(t.tick)}),e),s.set(e,t)),t}function l(e,t){const[n,r]=(0,o.useState)((()=>i(e).tick));return(0,o.useEffect)((()=>{if(t)return;const n=i(e),o=e=>r(e);return n.listeners.add(o),r(n.tick),()=>{n.listeners.delete(o),0===n.listeners.size&&n.timer&&(clearInterval(n.timer),n.timer=null,s.delete(e))}}),[e,t]),n}},"./src/hooks/use-slash-commands.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{d:()=>Y});var r=n("node:child_process"),s=n("node:crypto"),i=n("node:fs"),l=n("node:os"),a=n("node:path"),c=n("../mcp-agent-exec/dist/index.js"),d=n("../proto/dist/generated/aiserver/v1/dashboard_pb.js"),u=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),p=n("./src/commands/custom-commands.ts"),h=n("./src/commands/logout.tsx"),g=n("./src/commands/set-line-numbers.ts"),m=n("./src/commands/set-thinking-blocks.ts"),f=n("./src/constants.ts"),v=n("./src/context/agent-state-context.tsx"),x=n("./src/context/config-context.tsx"),b=n("./src/context/slash-command-context.tsx"),y=n("./src/context/vim-mode-context.tsx"),w=n("./src/debug.ts"),j=n("./src/mcp/project-paths.ts"),k=n("./src/mcp/server-suggestions.ts"),C=n("./src/models/filter-legacy-models.ts"),S=n("./src/models/model-utils.ts"),E=n("./src/state/index.ts"),M=n("./src/state/session.ts"),$=n("./src/statsig.ts"),T=n("./src/utils/api-endpoint.ts"),I=n("./src/utils/clipboard.ts"),P=n("./src/utils/fuzzy.ts"),A=n("./src/utils/git.ts"),D=n("./src/utils/oauth-callback.ts"),_=n("./src/utils/open-browser.ts"),R=n("./src/utils/terminal-environment.ts"),L=e([h]);h=(L.then?(await L)():L)[0];var O=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function Y({credentialManager:e,configProvider:t,modelManager:o,mcpLoader:L,disabledStore:Y,dashboardClient:F,autoRunAvailability:z,sandboxDefaultEnabled:N,workspacePath:U}){const{vimEnabled:B,toggleVimEnabled:q}=(0,y.v)(),{dynamicCommands:H}=((0,x.$i)(),(0,b.x)()),{agentStore:W,setIsSummarizing:G}=(0,v.C9)(),[X,K]=(0,u.useState)((()=>o.getAvailableModels())),[Q,J]=(0,u.useState)([]),[V,Z]=(0,u.useState)(null);(0,u.useEffect)((()=>o.subscribe((()=>{K(o.getAvailableModels())}))),[o]);const ee=(0,$.QF)("enable_skills");(0,u.useEffect)((()=>{(()=>{O(this,void 0,void 0,(function*(){try{const e=(0,A.ky)(process.cwd())||process.cwd(),t=new p.FD(F),n=yield t.loadCommands(e,{includeSkills:ee});J(n),Z(t)}catch(e){(0,w.debugLog)("Failed to load cursor commands:",e),J([]),Z(null)}}))})()}),[F,ee]);const te=(0,u.useMemo)((()=>{var u,p,v,x;const b=[];b.push({id:"model",title:"Model",description:"Set the current model",inline:!0,args:[{id:"model"}],getArgSuggestions:(e,t,n)=>{const o=t.join(" ").trim(),r=e=>({value:e.displayName||e.displayNameShort||e.displayModelId||"",description:""});return o?X.map(r).map(((e,t)=>({s:e,originalIndex:t,score:(0,P.dt)(e.value,o)}))).filter((e=>e.score>0)).sort(((e,t)=>t.score!==e.score?t.score-e.score:e.originalIndex-t.originalIndex)).map((e=>e.s)):(0,C.s)(X).map(r)},run:(e,n,r)=>{var s,i,l;const a=n.join(" ").trim();if(!a)return;let c=o.normalizeModelId(a);if(!c){if(!a.startsWith("GENERICBASE"))throw null===(s=r.clearInput)||void 0===s||s.call(r),new Error(`Unknown model: ${a}.`);c={modelId:a,displayModelId:a,displayName:a,displayNameShort:a}}if(!0!==t.get().maxMode||(0,S.B)(c))null===(l=r.onModelChange)||void 0===l||l.call(r,c);else{const e=(0,S.U)(c);e.maxMode=!0,null===(i=r.onModelChange)||void 0===i||i.call(r,e)}r.insertText("")}});const y="disabled"===(null==z?void 0:z.type),$="sandbox-only"===(null==z?void 0:z.type)?"Auto-run in sandbox":"Run Everything",A="auto-run"===W.getMetadata("mode");b.push({id:"auto-run",title:"Auto-Run",description:y?"Auto-run is disabled by admin settings":`Toggle ${$} (currently ${A?"enabled":"disabled"})`,run:(e,t,n)=>{var o,r,s;const i=W.getMetadata("mode");if(y&&"auto-run"!==i)return null===(o=n.print)||void 0===o||o.call(n,[[{text:"Auto-run is disabled by admin settings (no sandbox available)",color:"red"}]]),void(null===(r=n.clearInput)||void 0===r||r.call(n));const l="auto-run"===i?"default":"auto-run";W.setMetadata("mode",l);const a="auto-run"===l?`ON (${$})`:"OFF";null===(s=n.print)||void 0===s||s.call(n,[[{text:"Auto-run: ",dim:!0},{text:a,color:"auto-run"===l?"blue":"gray"}]]),n.insertText("")}}),b.push({id:"plan",title:"Plan Mode",description:"Create a plan or show existing plan with options",ghostText:"[<prompt>]",args:[{id:"prompt",required:!1}],run:(e,t,n)=>{var o,r;const s=(t||[]).join(" ").trim();s.length>0?(W.setMetadata("mode","plan"),null===(o=n.submitMessage)||void 0===o||o.call(n,s,{mode:"plan"}),n.insertText("")):(W.setMetadata("mode","plan"),(0,w.debugLog)("plan.slashCommand",{hasOnShowExistingPlan:!!n.onShowExistingPlan}),null===(r=n.onShowExistingPlan)||void 0===r||r.call(n),n.insertText(""))}}),b.push({id:"ask",title:"Ask Mode",description:"Toggle ask mode (Q&A, read-only; no edits or command execution)",run:(e,t,n)=>{var o,r;"search"===W.getMetadata("mode")?(W.setMetadata("mode","default"),null===(o=n.print)||void 0===o||o.call(n,[[{text:"Ask mode ",dim:!0},{text:"disabled",color:"gray"}]])):(W.setMetadata("mode","search"),null===(r=n.print)||void 0===r||r.call(n,[[{text:"Ask mode ",dim:!0},{text:"enabled",color:"green"}]])),n.insertText("")}});const K=o.getCurrentModel(),J=!0===(null==K?void 0:K.maxMode);b.push({id:"max-mode",title:"Max Mode",description:`Toggle max mode (currently ${J?"enabled":"disabled"})`,run:(e,t,n)=>{var r,s,i,l,a;const c=o.getCurrentModel();if(!c)return null===(r=n.print)||void 0===r||r.call(n,[[{text:"No model selected",color:"red"}]]),void(null===(s=n.clearInput)||void 0===s||s.call(n));const d=!(!0===c.maxMode);if(d&&(0,S.B)(c))return null===(i=n.print)||void 0===i||i.call(n,[[{text:"Max mode is not available for Auto",color:"yellow"}]]),void n.insertText("");const u=(0,S.U)(c);u.maxMode=d,null===(l=n.onModelChange)||void 0===l||l.call(n,u);const p=[[{text:"Max mode: ",dim:!0},{text:d?"ON":"OFF",color:d?"white":"gray"}]];null===(a=n.print)||void 0===a||a.call(n,p),n.insertText("")}});const V=e=>O(this,void 0,void 0,(function*(){var t,n,o,r,s,i,l;if(null===(t=e.print)||void 0===t||t.call(e,[[{text:"Aborting current operation...",color:"yellow"}]]),!e.onNewChat)return null===(n=e.print)||void 0===n||n.call(e,[[{text:"Restarting requires CLI reload; press Ctrl-C twice.",color:"yellow"}]]),void(null===(o=e.clearInput)||void 0===o||o.call(e));null===(r=e.clearInput)||void 0===r||r.call(e),null===(s=e.print)||void 0===s||s.call(e,[[{text:"Creating new chat...",color:"cyan"}]]);const a=(yield e.onNewChat())||(null===(i=e.getChatId)||void 0===i?void 0:i.call(e));a&&(null===(l=e.print)||void 0===l||l.call(e,[[{text:`New chat: ${a}`,color:"cyan"}]])),e.insertText("")}));b.push({id:"clear",title:"Clear",description:"Start a new chat session",boostedAlts:["new","new-chat","newchat"],run:(e,t,n)=>O(this,void 0,void 0,(function*(){yield V(n)}))}),b.push({id:"compress",title:"Compress Conversation",description:"Summarize the conversation to reduce context",run:(e,t,n)=>O(this,void 0,void 0,(function*(){var e,t,o;if(null===(e=n.clearInput)||void 0===e||e.call(n),0!==W.getConversationStateStructure().turns.length){try{G(!0)}catch(e){}yield null===(o=n.onSummarize)||void 0===o?void 0:o.call(n)}else null===(t=n.print)||void 0===t||t.call(n,[[{text:"No active session.",color:"red"}]])}))}),b.push({id:"vim",title:"Vim Mode",description:`Toggle Vim keys (currently ${B?"enabled":"disabled"})`,run:(e,t,n)=>{var o;const r=B;q(),null===(o=n.print)||void 0===o||o.call(n,["Vim mode "+(r?"disabled":"enabled")]),n.insertText("")}});const Z=null!==(p=null===(u=t.get().display)||void 0===u?void 0:u.showLineNumbers)&&void 0!==p&&p;b.push({id:"line-numbers",title:"Line Numbers",description:`Toggle line numbers in code blocks (currently ${Z?"enabled":"disabled"})`,boostedAlts:["lines","numbers"],run:(e,n,o)=>O(this,void 0,void 0,(function*(){var e,n;try{const n=yield(0,g.x)(t);null===(e=o.print)||void 0===e||e.call(o,["Line numbers "+(n?"enabled":"disabled")]),o.insertText("")}catch(e){null===(n=o.print)||void 0===n||n.call(o,[`Error toggling line numbers: ${String(e)}`]),o.insertText("")}}))});const ee=null!==(x=null===(v=t.get().display)||void 0===v?void 0:v.showThinkingBlocks)&&void 0!==x&&x;b.push({id:"show-thinking",title:"Show Thinking",description:`Toggle thinking block display (currently ${ee?"enabled":"disabled"})`,boostedAlts:["thoughts","thinking","thinking-blocks"],run:(e,n,o)=>O(this,void 0,void 0,(function*(){var e,n;try{const n=yield(0,m.f)(t);null===(e=o.print)||void 0===e||e.call(o,["Thinking blocks "+(n?"enabled":"disabled")]),o.insertText("")}catch(e){null===(n=o.print)||void 0===n||n.call(o,[`Error toggling thinking blocks: ${String(e)}`]),o.insertText("")}}))}),b.push({id:"shell",title:"Shell Mode",description:"Enter Shell Mode (hint: type ! on an empty line)",boostedAlts:["sh","run"],inline:!0,args:[{id:"command",required:!1}],run:(e,t,n)=>{var o;null===(o=n.enterShellMode)||void 0===o||o.call(n);const r=(t||[]).join(" ").trim();r.length>0?n.insertText(r):n.insertText("")}}),b.push({id:"about",title:"About",description:"Show CLI version, system, and account info (copies to clipboard)",run:(t,r,s)=>O(this,void 0,void 0,(function*(){var t,r,i,a,c,d,u,p;null===(t=s.clearInput)||void 0===t||t.call(s);const h=null!=="2026.02.13-41ac335"?"2026.02.13-41ac335":"unknown",g=null!==(c=null!==(i=null===(r=o.getCurrentModel())||void 0===r?void 0:r.displayName)&&void 0!==i?i:null===(a=o.getCurrentModel())||void 0===a?void 0:a.modelId)&&void 0!==c?c:"Auto",m=(0,l.platform)(),f=(yield Promise.resolve().then(n.t.bind(n,"node:os",23))).arch(),v=(0,R.detectTerminalProgram)(),x=(0,R.detectShell)(),b=M.d.getLastRequestId();let y=null;try{const t=yield e.getAccessToken(),o=yield e.getRefreshToken();if(t&&o){const{GetMeRequest:e}=yield Promise.resolve().then(n.bind(n,"../proto/dist/generated/aiserver/v1/dashboard_pb.js"));y=null!==(d=(yield F.getMe(new e({}))).email)&&void 0!==d?d:null}}catch(e){}const w=[`CLI Version: ${h}`,`Model: ${g}`,`OS: ${m} (${f})`,`Terminal: ${v}`,`Shell: ${x}`];b&&w.push(`Last Request ID: ${b}`),w.push(`User Email: ${null!=y?y:"Not logged in"}`);const j=w.join("\n"),k=yield(0,I.e)(j),C=[{label:"CLI Version",value:h},{label:"Model",value:g},{label:"OS",value:`${m} (${f})`},{label:"Terminal",value:v},{label:"Shell",value:x}];b&&C.push({label:"Last Request ID",value:b}),C.push({label:"User Email",value:null!=y?y:"Not logged in",valueColor:y?"cyan":"yellow"});const S=Math.max(...C.map((e=>e.value.length))),E=Math.max(20+S+6,50),$="─".repeat(E-2),T=[[{text:`╭${$}╮`,dim:!0}],[{text:`│${" ".repeat(E-2)}│`,dim:!0}],[{text:"│  ",dim:!0},{text:"About Cursor CLI",color:"cyan",bold:!0},{text:`${" ".repeat(E-20)}│`,dim:!0}],[{text:`│${" ".repeat(E-2)}│`,dim:!0}]];for(const e of C){const t=e.label.padEnd(20),n=e.value.padEnd(E-20-6);T.push([{text:"│  ",dim:!0},{text:t,dim:!0},{text:n,color:null!==(u=e.valueColor)&&void 0!==u?u:"cyan"},{text:"  │",dim:!0}])}T.push([{text:`│${" ".repeat(E-2)}│`,dim:!0}]),T.push([{text:`╰${$}╯`,dim:!0}]),T.push([]),T.push([{text:k?"✓ Copied to clipboard":"Could not copy to clipboard",color:k?"green":"yellow"}]),null===(p=s.print)||void 0===p||p.call(s,T,{minLingerMs:1e4}),s.insertText("")}))}),b.push({id:"setup-terminal",title:"Setup Terminal",description:"Configure your terminal for newlines",visible:()=>{const e=(0,R.detectTerminalProgram)();return!(0,R.terminalSupportsShiftEnter)(e)},run:(e,t,o)=>O(this,void 0,void 0,(function*(){var e,t,r,s;null===(e=o.clearInput)||void 0===e||e.call(o);const i=(0,R.detectTerminalProgram)(),{CONFIGURABLE_TERMINAL_SETUP:l,terminalSupportsShiftEnter:a,configureAppleTerminal:c}=yield Promise.resolve().then(n.bind(n,"./src/utils/terminal-environment.ts"));if(a(i))return null===(t=o.print)||void 0===t||t.call(o,[[{text:"✓ Your terminal already supports Shift+Enter!",color:"green"}],[{text:"Press Shift+Enter to insert a newline.",dim:!0}]],{minLingerMs:5e3}),void o.insertText("");if("apple-terminal"===i){const e=c(),t=[];if(e.success)t.push([{text:`✓  ${e.message}`,color:"green"}]),e.requiresRestart?(t.push([]),t.push([{text:"Please restart Terminal.app for changes to take effect.",color:"yellow",bold:!0}]),t.push([{text:"Then use Option+Enter to insert newlines.",dim:!0}])):t.push([{text:"Use Option+Enter to insert newlines.",dim:!0}]);else{t.push([{text:`Could not auto-configure: ${e.error}`,color:"red"}]),t.push([]),t.push([{text:"Manual setup:",color:"cyan",bold:!0}]);const n=l[i];if(n)for(const e of n.instructions)""===e?t.push([]):t.push([{text:`  ${e}`,dim:!0}])}return null===(r=o.print)||void 0===r||r.call(o,t,{minLingerMs:1e4}),void o.insertText("")}const d=l[i],u=[];if(u.push([{text:"Setup Terminal",color:"cyan",bold:!0}]),u.push([]),u.push([{text:"Universal options (work in all terminals):",color:"green",bold:!0}]),u.push([{text:"  • Type \\ then press Enter",dim:!0}]),u.push([{text:"  • Press Ctrl+J",dim:!0}]),u.push([]),d){u.push([{text:`Setup for ${d.name}:`,color:"cyan",bold:!0}]);for(const e of d.instructions)""===e?u.push([]):u.push([{text:`  ${e}`,dim:!0}])}else u.push([{text:`Detected terminal: ${i}`,color:"yellow"}]),u.push([{text:"No specific setup instructions available.",dim:!0}]),u.push([{text:"Use \\+Enter or Ctrl+J for newlines.",dim:!0}]);null===(s=o.print)||void 0===s||s.call(o,u,{minLingerMs:15e3}),o.insertText("")}))});const te={id:"help",title:"Help",description:"Show help (/help [cmd])",args:[{id:"command",required:!1}],getArgSuggestions:(e,t,n)=>{const o=((null==t?void 0:t[0])||"").trim(),r=o.toLowerCase(),s=b.filter((e=>"help"!==e.id)).map((e=>({value:e.id,description:e.title})));return r?s.map((e=>({s:e,prefix:e.value.toLowerCase().startsWith(r)?1:0,score:(0,P.dt)(`${e.value} ${e.description||""}`,o)}))).filter((e=>e.score>0||e.prefix>0)).sort(((e,t)=>t.prefix-e.prefix||t.score-e.score||e.s.value.localeCompare(t.s.value))).map((e=>e.s)):s},run:(e,t,n)=>{var o,r,s,i;const l=b.filter((e=>"help"!==e.id)),a=t[0];if(!a){const e=[[{text:"Commands:",color:"cyan",bold:!0}]];for(const t of l){const n=(t.args||[]).map((e=>!1!==e.required?`<${e.id}>`:`[${e.id}]`)).join(" "),o=`/${t.id}${n?` ${n}`:""}`;e.push([{text:o,color:"cyan"},...t.description?[{text:" - ",color:"gray"},{text:t.description,dim:!0}]:[]])}return e.push([]),e.push([{text:"Hint:",color:"cyan",bold:!0},{text:" /help <command> for details",dim:!0}]),null===(o=n.print)||void 0===o||o.call(n,e),void n.insertText("")}const c=l.find((e=>e.id.toLowerCase()===a.toLowerCase()));if(!c)return null===(r=n.print)||void 0===r||r.call(n,[`Unknown command: ${a}`,"Run /help to list all commands."]),void(null===(s=n.clearInput)||void 0===s||s.call(n));const d=(c.args||[]).map((e=>!1!==e.required?`<${e.id}>`:`[${e.id}]`)).join(" "),u=[[{text:"Usage:",color:"cyan",bold:!0},{text:` /${c.id}${d?` ${d}`:""}`,color:"cyan"}]];if(c.description&&u.push([{text:c.description,dim:!0}]),c.args&&c.args.length>0){u.push([{text:"Arguments:",color:"cyan",bold:!0}]);for(const e of c.args)u.push([{text:!1!==e.required?`<${e.id}>`:`[${e.id}]`,color:"cyan"}])}null===(i=n.print)||void 0===i||i.call(n,u),n.insertText("")}};b.push(te),b.push({id:"feedback",title:"Feedback",description:"Share feedback with the team",args:[{id:"message",required:!0}],run:(e,t,r)=>O(this,void 0,void 0,(function*(){var e,s,i,a,c,u,p,h,g;const m=t.join(" ").trim();null===(e=r.clearInput)||void 0===e||e.call(r),null===(s=r.print)||void 0===s||s.call(r,[[{text:"Sending feedback...",color:"cyan"}]]);const f=(0,l.platform)(),v=(yield Promise.resolve().then(n.t.bind(n,"node:os",23))).arch(),x=(0,R.detectTerminalProgram)(),b=(0,R.detectShell)(),y=null!==(u=null!==(a=null===(i=o.getCurrentModel())||void 0===i?void 0:i.displayName)&&void 0!==a?a:null===(c=o.getCurrentModel())||void 0===c?void 0:c.modelId)&&void 0!==u?u:"Auto";try{yield F.submitFeedback(new d.SubmitFeedbackRequest({message:m,version:null!=="2026.02.13-41ac335"?"2026.02.13-41ac335":"unknown",lastAgentReqId:null!==(p=M.d.getLastRequestId())&&void 0!==p?p:void 0,os:`${f} (${v})`,terminal:x,shell:b,model:y})),null===(h=r.print)||void 0===h||h.call(r,[[{text:"Feedback sent. Thank you!",color:"green"}]]),(0,w.debugLog)("/feedback: success")}catch(e){null===(g=r.print)||void 0===g||g.call(r,[[{text:"Failed to send feedback",color:"red"}]]),(0,w.debugLog)("/feedback: error",String(e))}finally{r.insertText(""),(0,w.debugLog)("/feedback: done")}}))});const ne=(e,t,n)=>{var o,s,i;let l;null===(o=n.clearInput)||void 0===o||o.call(n);try{l=(0,r.execFileSync)("git",["rev-parse","--show-toplevel"],{encoding:"utf8"}).trim()}catch(e){l=process.cwd()}null===(s=n.print)||void 0===s||s.call(n,[[{text:"Opening ",dim:!0},{text:l,color:"cyan"},{text:" in Cursor...",dim:!0}]]);try{const e=(0,r.spawn)("cursor",[l],{stdio:"ignore",detached:!0});"function"==typeof e.unref&&e.unref(),(0,w.debugLog)("/open: launched cursor",l)}catch(e){null===(i=n.print)||void 0===i||i.call(n,[[{text:"Failed to launch cursor CLI",color:"red"}]]),(0,w.debugLog)("/open: failed to launch cursor",String(e))}finally{n.insertText("")}};if(b.push({id:"open",title:"Open in Cursor",description:"Open the repository's git root in Cursor",boostedAlts:["cursor"],run:ne}),b.push({id:"cursor",title:"Open in Cursor",description:"Alias for /open",run:ne}),b.push({id:"resume-chat",title:"Resume Chat",description:"Resume a previous chat by folder name",args:[{id:"chat",required:!0}],getArgSuggestions:(e,t,n)=>{const o=(0,E.r)();try{const e=(0,i.readdirSync)(o,{withFileTypes:!0}).filter((e=>{var t;return e.isDirectory()&&e.name!==(null===(t=n.getChatId)||void 0===t?void 0:t.call(n))})).map((e=>{try{const t=(0,a.join)(o,e.name),n=(0,i.statSync)(t);return{name:e.name,lastModified:n.mtime}}catch(e){return null}})).filter((e=>null!==e)).sort(((e,t)=>t.lastModified.getTime()-e.lastModified.getTime())),t=new Date,r=e=>{const n=Math.floor((Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())-Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))/864e5),o=e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return n<=0?`Today ${o}`:1===n?`Yesterday ${o}`:n<7?`${n} days ago ${o}`:`${e.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})} ${o}`};return e.map((e=>({value:e.name,description:r(e.lastModified)})))}catch(e){return[]}},run:(e,t,n)=>O(this,void 0,void 0,(function*(){var e,o,r,s,l,c;const d=(t[0]||"").trim();if(!d)return;if(d===(null===(e=n.getChatId)||void 0===e?void 0:e.call(n)))return null===(o=n.print)||void 0===o||o.call(n,[[{text:"Cannot resume current chat",color:"red"}]]),void(null===(r=n.clearInput)||void 0===r||r.call(n));const u=(0,E.r)(),p=(0,a.join)(u,d);try{if(!(0,i.statSync)(p).isDirectory())throw new Error("Not a directory")}catch(e){return null===(s=n.print)||void 0===s||s.call(n,[[{text:`Chat not found: ${d}`,color:"red"}]]),void(null===(l=n.clearInput)||void 0===l||l.call(n))}n.onResumeChat?(yield n.onResumeChat(d),n.insertText("")):null===(c=n.print)||void 0===c||c.call(n,[[{text:"Resume not supported in this context",color:"red"}]])}))}),b.push({id:"copy-request-id",title:"Copy Request ID",description:"Copy last request ID",run:(e,t,n)=>O(this,void 0,void 0,(function*(){var e,t;const o=M.d.getLastRequestId();if(!o)return null===(e=n.print)||void 0===e||e.call(n,[[{text:"No request ID found.",color:"red"}],[{text:"Submit a prompt first, then retry /copy-request-id.",dim:!0}]]),void n.insertText("");const r=yield(0,I.e)(o),s=[{text:r?"Copied request id ":"Request id ",color:r?"green":"cyan"},{text:o,color:"cyan"}];null===(t=n.print)||void 0===t||t.call(n,[s],{minLingerMs:8e3}),n.insertText("")}))}),b.push({id:"copy-conversation-id",title:"Copy Conversation ID",description:"Copy current conversation ID",run:(e,t,n)=>O(this,void 0,void 0,(function*(){var e,t,o;const r=null===(e=n.getChatId)||void 0===e?void 0:e.call(n),s=0===W.getConversationStateStructure().turns.length;if(!r||s)return null===(t=n.print)||void 0===t||t.call(n,[[{text:"No conversation ID found.",color:"red"}],[{text:"Start a conversation first, then retry /copy-conversation-id.",dim:!0}]]),void n.insertText("");const i=yield(0,I.e)(r),l=[{text:i?"Copied conversation id ":"Conversation id ",color:i?"green":"cyan"},{text:r,color:"cyan"}];null===(o=n.print)||void 0===o||o.call(n,[l],{minLingerMs:8e3}),n.insertText("")}))}),b.push({id:"logout",title:"Logout",description:"Sign out from Cursor",run:(n,o,r)=>O(this,void 0,void 0,(function*(){yield(0,h.handleLogout)(e,t)}))}),b.push({id:"quit",title:"Quit",description:"Exit",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),setTimeout((()=>{var e;return null===(e=n.exit)||void 0===e?void 0:e.call(n,!1)}),0)}}),b.push({id:"exit",title:"Exit",description:"Exit",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),setTimeout((()=>{var e;return null===(e=n.exit)||void 0===e?void 0:e.call(n,!1)}),0)}}),b.push({id:"mcp",title:"MCP",description:"Manage MCP servers (list, login, enable, disable, list-tools)",ghostText:"[list|login|enable|disable|list-tools] [<identifier>]",args:[{id:"subcommand",required:!1},{id:"identifier",required:!1}],getArgSuggestions:(e,t)=>O(this,void 0,void 0,(function*(){const e=(t[0]||"").trim().toLowerCase();if(t.length<=1){const t=[{value:"list",description:"List MCP servers and their status"},{value:"login",description:"Authenticate with an MCP server"},{value:"enable",description:"Enable an MCP server (approve or re-enable)"},{value:"disable",description:"Disable an MCP server (won't be loaded or prompted)"},{value:"list-tools",description:"List tools for an MCP server"}];return e?t.filter((t=>t.value.startsWith(e))):t}if("login"===e||"enable"===e||"disable"===e||"list-tools"===e){const n=t.slice(1).join(" ").trim();try{return yield(0,k.d)(e,Y,n)}catch(e){return[]}}return[]})),run:(e,t,n)=>O(this,void 0,void 0,(function*(){var o,r,s,i,d,u,p,h,g,m,f,v,x,b,y,k,C,S,E,M,$,T,I,P,A,R,O,F,z,N,U,B,q,H,W,G,X,K;const Q=(t[0]||"").trim().toLowerCase();if(""===Q||"list"===Q)return null===(o=n.clearInput)||void 0===o||o.call(n),null===(r=n.onOpenMcpPager)||void 0===r||r.call(n),void n.insertText("");if("login"===Q){const o=t.slice(1).join(" ").trim();if(!o)return null===(s=n.print)||void 0===s||s.call(n,[[{text:"Usage: /mcp login <identifier>",color:"red"}]]),null===(i=n.clearInput)||void 0===i||i.call(n),void n.insertText("");null===(d=n.clearInput)||void 0===d||d.call(n);try{let t;null===(u=n.print)||void 0===u||u.call(n,[[{text:`Preparing MCP login for ${o}...`,color:"cyan"}]]),null===(p=n.print)||void 0===p||p.call(n,[[{text:`Loading MCP server '${o}' from .cursor/mcp.json or ~/.cursor/mcp.json...`,color:"cyan"}]]);try{t=yield L.loadClient(e,o)}catch(e){const t=e instanceof c.C9?`MCP server '${o}' is disabled. Re-enable it to use /mcp login.`:`Failed to load MCP '${o}': ${(0,D.u1)(e)}`;return null===(h=n.print)||void 0===h||h.call(n,[[{text:t,color:"red"}]],{minLingerMs:5e3}),(0,w.debugLog)("/mcp login: load error",(0,D.u1)(e)),void n.insertText("")}const r=yield t.getState(e);if("ready"===r.kind)null===(g=n.print)||void 0===g||g.call(n,[[{text:`✓ MCP '${o}' is ready.`,color:"green"}]],{minLingerMs:5e3}),(0,w.debugLog)("/mcp login: already ready",o);else if("requires_authentication"===r.kind){const e=r.url;null===(m=n.print)||void 0===m||m.call(n,[[{text:`MCP '${o}' requires authentication. Opening your browser...`,color:"cyan"}],[{text:"If it doesn't open, navigate to:",color:"cyan"}],[{text:e,color:"blue"}],[{text:`Listening on ${D.Yt} for the OAuth callback...`,color:"cyan"}]],{minLingerMs:5e3}),e&&((0,_.g1)(e)?(0,_.ph)(e):null===(f=n.print)||void 0===f||f.call(n,[[{text:"Navigate to the following URL in your browser:",color:"cyan"}],[{text:e}]],{minLingerMs:5e3}));try{const e=yield(0,D.T5)();yield r.callback(e),null===(v=n.print)||void 0===v||v.call(n,[[{text:`✓ Received authorization code '${e.substring(0,6)}...'.`,color:"green"}],[{text:"You can close the browser. Re-running the command should now complete authentication.",color:"green"}]],{minLingerMs:5e3}),(0,w.debugLog)("/mcp login: success",o,e.substring(0,6))}catch(e){null===(x=n.print)||void 0===x||x.call(n,[[{text:`Authentication callback failed: ${(0,D.u1)(e)}`,color:"red"}]],{minLingerMs:5e3}),(0,w.debugLog)("/mcp login: callback error",(0,D.u1)(e))}}else null===(b=n.print)||void 0===b||b.call(n,[[{text:`Unknown MCP client state for '${o}'.`,color:"red"}]],{minLingerMs:5e3}),(0,w.debugLog)("/mcp login: unknown state",o,r)}catch(e){const t=e instanceof Error?e.message:String(e);null===(y=n.print)||void 0===y||y.call(n,[[{text:"MCP login failed: ",color:"red"}],[{text:t,color:"red",dim:!0}]],{minLingerMs:5e3}),(0,w.debugLog)("/mcp login: error",t)}}else if("enable"===Q){const o=t.slice(1).join(" ").trim();if(!o)return null===(k=n.print)||void 0===k||k.call(n,[[{text:"Usage: /mcp enable <identifier>",color:"red"}]]),null===(C=n.clearInput)||void 0===C||C.call(n),void n.insertText("");null===(S=n.clearInput)||void 0===S||S.call(n);try{const t=process.cwd(),{projectRoot:r,approvalPath:s}=(0,j.C)(t),i=new c.mF(s,r),d=(0,a.join)((0,l.homedir)(),".cursor","mcp.json"),u=(0,a.join)(t,".cursor","mcp.json"),[p,h]=yield Promise.all([(0,c.h1)(d).catch((()=>({mcpServers:{}}))),(0,c.h1)(u).catch((()=>({mcpServers:{}})))]),g=Object.assign(Object.assign({},p.mcpServers),h.mcpServers)[o];if(!g)return null===(E=n.print)||void 0===E||E.call(n,[[{text:`MCP server '${o}' not found in configuration`,color:"red"}],[{text:"Check .cursor/mcp.json or ~/.cursor/mcp.json",dim:!0}]],{minLingerMs:5e3}),void n.insertText("");const m=(0,c.Ko)(o,g,r),f=(yield i.getApprovals()).includes(m),v=yield Y.isServerDisabled(o),x=!v;v&&(yield Y.removeDisabledServer(o),yield L.load(e,!1));const b=[];f||(yield i.addApproval(m)),x&&f?b.push([{text:`MCP server '${o}' is already enabled`,color:"yellow"}]):b.push([{text:`✓ Enabled MCP server: ${o}`,color:"green"}]),null===(M=n.print)||void 0===M||M.call(n,b,{minLingerMs:5e3}),(0,w.debugLog)("/mcp enable: success",{identifier:o,wasEnabled:x,wasDisabled:v,isApproved:f})}catch(e){const t=e instanceof Error?e.message:String(e);null===($=n.print)||void 0===$||$.call(n,[[{text:"MCP enable failed: ",color:"red"}],[{text:t,color:"red",dim:!0}]],{minLingerMs:15e3}),(0,w.debugLog)("/mcp enable: error",t)}}else if("disable"===Q){const o=t.slice(1).join(" ").trim();if(!o)return null===(T=n.print)||void 0===T||T.call(n,[[{text:"Usage: /mcp disable <identifier>",color:"red"}]]),null===(I=n.clearInput)||void 0===I||I.call(n),void n.insertText("");null===(P=n.clearInput)||void 0===P||P.call(n);try{null===(A=n.print)||void 0===A||A.call(n,[[{text:`Disabling MCP server '${o}'...`,color:"cyan"}]]);const t=yield Y.isServerDisabled(o);t||(yield Y.addDisabledServer(o),yield L.load(e,!1)),t?null===(R=n.print)||void 0===R||R.call(n,[[{text:`MCP server '${o}' is already disabled`,color:"yellow"}]]):null===(O=n.print)||void 0===O||O.call(n,[[{text:`✓ Disabled MCP server: ${o}`,color:"green"}],[{text:"The server will no longer be loaded or prompted for approval.",color:"gray"}]]),(0,w.debugLog)("/mcp disable: success",o)}catch(e){const t=e instanceof Error?e.message:String(e);null===(F=n.print)||void 0===F||F.call(n,[[{text:"Failed to disable MCP server: ",color:"red"}],[{text:t,color:"red",dim:!0}]],{minLingerMs:5e3}),(0,w.debugLog)("/mcp disable: error",t)}}else if("list-tools"===Q){const o=t.slice(1).join(" ").trim();if(!o)return null===(z=n.print)||void 0===z||z.call(n,[[{text:"Usage: /mcp list-tools <identifier>",color:"red"}]]),null===(N=n.clearInput)||void 0===N||N.call(n),void n.insertText("");null===(U=n.clearInput)||void 0===U||U.call(n),null===(B=n.print)||void 0===B||B.call(n,[[{text:`Loading tools for '${o}'...`,color:"cyan"}]]);try{let t;try{t=yield L.loadClient(e,o)}catch(e){const t=e instanceof c.C9?`MCP server '${o}' is disabled. Re-enable it before listing tools.`:`Failed to load MCP '${o}': ${(0,D.u1)(e)}`;return null===(q=n.print)||void 0===q||q.call(n,[[{text:t,color:"red"}]],{minLingerMs:5e3}),(0,w.debugLog)("/mcp list-tools: load error",(0,D.u1)(e)),void n.insertText("")}const r=yield t.getTools(e);if(0===r.length)null===(H=n.print)||void 0===H||H.call(n,[[{text:`No tools available for '${o}'`,color:"yellow"}]],{minLingerMs:5e3});else{const e=[[{text:`Tools for '${o}':`,color:"cyan",bold:!0}]];for(const t of r){const n=t.inputSchema&&"object"==typeof t.inputSchema?Object.keys(t.inputSchema.properties||{}).join(", "):"";e.push([{text:`  ${t.name}`,color:"cyan"},...n?[{text:"(",color:"gray"},{text:n,dim:!0},{text:")",color:"gray"}]:[]])}null===(W=n.print)||void 0===W||W.call(n,e,{minLingerMs:8e3})}(0,w.debugLog)("/mcp list-tools: success",o,r.length)}catch(e){const t=e instanceof Error?e.message:String(e);null===(G=n.print)||void 0===G||G.call(n,[[{text:"Failed to list tools: ",color:"red"}],[{text:t,color:"red",dim:!0}]],{minLingerMs:15e3}),(0,w.debugLog)("/mcp list-tools: error",t)}}else null===(X=n.print)||void 0===X||X.call(n,[[{text:"Usage: /mcp [list|login|enable|disable|list-tools] [<identifier>]",color:"red"}]],{minLingerMs:5e3}),null===(K=n.clearInput)||void 0===K||K.call(n);n.insertText("")}))}),b.push({id:"sandbox",title:"Sandbox",description:(()=>{var e,n,o,r;const s=t.get(),i=N?"enabled":"disabled",l=null!==(n=null===(e=s.sandbox)||void 0===e?void 0:e.mode)&&void 0!==n?n:i,a=null!==(r=null===(o=s.sandbox)||void 0===o?void 0:o.networkAccess)&&void 0!==r?r:"user_config_with_defaults";if("enabled"===l)switch(a){case"user_config_only":return"✓ Sandbox enabled, sandbox.json allowlist only";case"user_config_with_defaults":return"✓ Sandbox enabled, sandbox.json + default allowlist";case"allow_all":return"✓ Sandbox enabled, allow all network";default:return"✓ Sandbox enabled"}return"✓ Sandbox disabled"})(),run:(e,t,n)=>{var o,r;null===(o=n.clearInput)||void 0===o||o.call(n),null===(r=n.onOpenSandboxPager)||void 0===r||r.call(n),n.insertText("")}}),(0,w.isDebugEnabled)()&&(b.push({id:"debug-test",title:"Debug Test",description:"Emit debug log",visible:()=>(0,w.isDebugEnabled)(),run:(e,t,n)=>{var o;const r=(0,s.randomUUID)();null===(o=n.print)||void 0===o||o.call(n,[[{text:"Emitted debug-test ",dim:!0},{text:r,color:"cyan"}]]),n.insertText("")}}),b.push({id:"throw",title:"Throw Error",description:"Throw test error",args:[{id:"message",required:!1}],visible:()=>(0,w.isDebugEnabled)(),run:(e,t,n)=>{var o,r;const i=(null===(o=t.join(" "))||void 0===o?void 0:o.trim())||`debug throw ${(0,s.randomUUID)()}`;throw null===(r=n.clearInput)||void 0===r||r.call(n),new Error(i)}}),b.push({id:"pq",title:"Open in Prompt Quality",description:"Open last request dashboard",visible:()=>(0,w.isDebugEnabled)(),run:(e,t,n)=>O(this,void 0,void 0,(function*(){var e,t;const o=M.d.getLastRequestId();if(!o)return null===(e=n.print)||void 0===e||e.call(n,[[{text:"No request ID found.",color:"red"}],[{text:"Submit a prompt first, then retry /pq.",dim:!0}]]),void n.insertText("");const r=`http://go/prompts/?requestId=${o}`;null===(t=n.print)||void 0===t||t.call(n,[[{text:"Opening ",dim:!0},{text:r,color:"cyan"}]]),yield(0,_.ph)(r),n.insertText("")}))})),f.Cu){const o=(e,t)=>O(this,void 0,void 0,(function*(){var o,r,s;const{extractConversationStats:i,extractAiSourceBreakdown:l,calculateAiPercentage:a}=yield n.e(874).then(n.bind(n,"./src/commands/dev-cursor-blame.ts")),c=[],d=l(e.aiLineRanges),u=i(e.aiLineRanges),p=a(Object.assign(Object.assign({},d),{totalLinesAdded:e.score.linesAdded,totalLinesDeleted:e.score.linesDeleted})),h=e.date?new Date(e.date).toLocaleString():"unknown";if(c.push([{text:e.hash.substring(0,8),color:"cyan"},{text:" - ",dim:!0},{text:(null!==(o=e.message)&&void 0!==o?o:"").substring(0,50)+((null!==(s=null===(r=e.message)||void 0===r?void 0:r.length)&&void 0!==s?s:0)>50?"...":"")}]),c.push([{text:`  ${h}`,dim:!0}]),c.push([{text:"  Lines: ",dim:!0},{text:`+${e.score.linesAdded}`,color:"green"},{text:"/"},{text:`-${e.score.linesDeleted}`,color:"red"},{text:" | AI: ",dim:!0},{text:`${p}%`,color:"cyan"}]),(d.tabLinesAdded>0||d.tabLinesDeleted>0)&&c.push([{text:"  Tab: ",dim:!0},{text:`+${d.tabLinesAdded}`,color:"green"},{text:"/"},{text:`-${d.tabLinesDeleted}`,color:"red"}]),(d.composerLinesAdded>0||d.composerLinesDeleted>0)&&c.push([{text:"  Composer: ",dim:!0},{text:`+${d.composerLinesAdded}`,color:"green"},{text:"/"},{text:`-${d.composerLinesDeleted}`,color:"red"}]),(d.cliLinesAdded>0||d.cliLinesDeleted>0)&&c.push([{text:"  CLI: ",dim:!0},{text:`+${d.cliLinesAdded}`,color:"green"},{text:"/"},{text:`-${d.cliLinesDeleted}`,color:"red"}]),u.size>0){c.push([{text:`  Conversations: ${u.size} detected`,dim:!0}]);for(const[e,n]of u){const o=null==t?void 0:t.get(e),r=`+${n.linesAdded}/-${n.linesDeleted}`;if((null==o?void 0:o.success)&&o.summary){const t=o.summary.length>50?`${o.summary.substring(0,50)}...`:o.summary;c.push([{text:"    • ",dim:!0},{text:e.substring(0,8),color:"magenta"},{text:" ",dim:!0},{text:r,color:"cyan"},{text:" - ",dim:!0},{text:t,dim:!0}])}else o&&!o.success?c.push([{text:"    • ",dim:!0},{text:e.substring(0,8),color:"magenta"},{text:" ",dim:!0},{text:r,color:"cyan"},{text:" (classification failed)",dim:!0}]):c.push([{text:"    • ",dim:!0},{text:e.substring(0,8),color:"magenta"},{text:" ",dim:!0},{text:r,color:"cyan"}])}}return c}));b.push({id:"dev:score-recent-commits",title:"Score Recent Commits",description:"Score recent commits for AI attribution (dev only)",args:[{id:"count",required:!1}],visible:()=>f.Cu,run:(r,s,i)=>O(this,void 0,void 0,(function*(){var r,l,a,c,d,u;null===(r=i.clearInput)||void 0===r||r.call(i);const p=s[0]?parseInt(s[0],10):10,h=Number.isNaN(p)||p<=0?10:p;let g;null===(l=i.print)||void 0===l||l.call(i,[[{text:`Scoring ${h} recent commits...`,color:"cyan"}]]);try{const{CliCommitScoringService:r}=yield Promise.resolve().then(n.bind(n,"./src/cursor-blame/cli-commit-scoring.ts")),{extractConversationStats:s,classifyConversation:l}=yield n.e(874).then(n.bind(n,"./src/commands/dev-cursor-blame.ts"));g=new r({workspacePath:null!=U?U:process.cwd(),backendUrl:(0,T.G6)(),credentialManager:e,configProvider:t,teamSettingsService:void 0,insecure:!1});const u=[];if(yield g.scoreRecentCommits(h,(e=>{u.push(e)})),0===u.length)null===(a=i.print)||void 0===a||a.call(i,[[{text:"No commits found. Make sure you're in a git repository with commits by the current user.",color:"yellow"}]],{persistUntilInput:!0});else{const n=new Set;for(const e of u){const t=s(e.aiLineRanges);for(const e of t.keys())n.add(e)}const r=new Map;if(n.size>0){null===(c=i.print)||void 0===c||c.call(i,[[{text:`Classifying ${n.size} conversation(s)...`,color:"cyan"}]]);for(const o of n)try{const n=yield l({workspacePath:null!=U?U:process.cwd(),backendUrl:(0,T.G6)(),credentialManager:e,configProvider:t,teamSettingsService:void 0,insecure:!1},o);r.set(o,{success:n.success,summary:n.summary})}catch(e){r.set(o,{success:!1})}}const a=[];for(const e of u)a.length>0&&a.push([]),a.push(...yield o(e,r));a.push([]),a.push([{text:`✓ Scored ${u.length} commits`,color:"green"}]),a.push([{text:"(start typing to dismiss)",dim:!0}]),null===(d=i.print)||void 0===d||d.call(i,a,{persistUntilInput:!0})}}catch(e){null===(u=i.print)||void 0===u||u.call(i,[[{text:`Error: ${e instanceof Error?e.message:String(e)}`,color:"red"}]])}finally{yield null==g?void 0:g.dispose()}i.insertText("")}))}),b.push({id:"dev:score-commit",title:"Score Commit",description:"Score a commit for AI attribution (dev only, defaults to HEAD)",args:[{id:"hash",required:!1}],visible:()=>f.Cu,run:(r,s,i)=>O(this,void 0,void 0,(function*(){var r,l,a,c,d,u,p,h,g;let m;null===(r=i.clearInput)||void 0===r||r.call(i);try{const{CliCommitScoringService:r}=yield Promise.resolve().then(n.bind(n,"./src/cursor-blame/cli-commit-scoring.ts"));m=new r({workspacePath:null!=U?U:process.cwd(),backendUrl:(0,T.G6)(),credentialManager:e,configProvider:t,teamSettingsService:void 0,insecure:!1});let g=null===(l=s[0])||void 0===l?void 0:l.trim();if(!g){null===(a=i.print)||void 0===a||a.call(i,[[{text:"Getting most recent commit...",color:"cyan"}]]);const e=yield m.getMostRecentCommitHash();if(!e)return null===(c=i.print)||void 0===c||c.call(i,[[{text:"No commits found in this repository",color:"red"}]]),void i.insertText("");g=e}null===(d=i.print)||void 0===d||d.call(i,[[{text:`Scoring commit ${g.substring(0,8)}...`,color:"cyan"}]]);const f=yield m.scoreCommit(g);if(f){const{extractConversationStats:r,classifyConversation:s}=yield n.e(874).then(n.bind(n,"./src/commands/dev-cursor-blame.ts")),l=r(f.aiLineRanges),a=new Map;if(l.size>0){null===(p=i.print)||void 0===p||p.call(i,[[{text:`Classifying ${l.size} conversation(s)...`,color:"cyan"}]]);for(const n of l.keys())try{const o=yield s({workspacePath:null!=U?U:process.cwd(),backendUrl:(0,T.G6)(),credentialManager:e,configProvider:t,teamSettingsService:void 0,insecure:!1},n);a.set(n,{success:o.success,summary:o.summary})}catch(e){a.set(n,{success:!1})}}const c=yield o(f,a);c.push([]),c.push([{text:"✓ Done",color:"green"}]),c.push([{text:"(start typing to dismiss)",dim:!0}]),null===(h=i.print)||void 0===h||h.call(i,c,{persistUntilInput:!0})}else null===(u=i.print)||void 0===u||u.call(i,[[{text:`Commit ${g} not found`,color:"red"}]],{persistUntilInput:!0})}catch(e){null===(g=i.print)||void 0===g||g.call(i,[[{text:`Error: ${e instanceof Error?e.message:String(e)}`,color:"red"}]])}finally{yield null==m?void 0:m.dispose()}i.insertText("")}))}),b.push({id:"dev:classify-conversation",title:"Classify Conversation",description:"Classify a conversation by ID (dev only)",args:[{id:"id",required:!1}],visible:()=>f.Cu,run:(o,r,s)=>O(this,void 0,void 0,(function*(){var o,i,l,a,c,d,u,p;const h=(null===(o=r[0])||void 0===o?void 0:o.trim())||(null===(i=s.getChatId)||void 0===i?void 0:i.call(s));if(!h)return null===(l=s.print)||void 0===l||l.call(s,[[{text:"Usage: /dev:classify-conversation [id] (defaults to current)",color:"red"}]]),null===(a=s.clearInput)||void 0===a||a.call(s),void s.insertText("");null===(c=s.clearInput)||void 0===c||c.call(s),null===(d=s.print)||void 0===d||d.call(s,[[{text:`Classifying conversation ${h}...`,color:"cyan"}]]);try{const{classifyConversation:o}=yield n.e(874).then(n.bind(n,"./src/commands/dev-cursor-blame.ts")),r=yield o({workspacePath:null!=U?U:process.cwd(),backendUrl:(0,T.G6)(),credentialManager:e,configProvider:t,teamSettingsService:void 0,insecure:!1},h),i=[];r.transcriptGenerated&&(i.push([{text:"Generated transcript from conversation state",dim:!0}]),i.push([])),r.success?(i.push([{text:"✓ Classification successful",color:"green"}]),r.summary&&(i.push([{text:"Summary:",color:"cyan",bold:!0}]),i.push([{text:r.summary}])),r.detailedSummary&&(i.push([]),i.push([{text:"Detailed Summary:",color:"cyan",bold:!0}]),i.push([{text:r.detailedSummary}])),r.summary||r.detailedSummary||i.push([{text:"(No summary returned)",dim:!0}])):(i.push([{text:"✗ Classification failed",color:"yellow"}]),r.errorMessage&&i.push([{text:`Error: ${r.errorMessage}`,dim:!0}])),i.push([]),i.push([{text:"(start typing to dismiss)",dim:!0}]),null===(u=s.print)||void 0===u||u.call(s,i,{persistUntilInput:!0})}catch(e){null===(p=s.print)||void 0===p||p.call(s,[[{text:`Error: ${e instanceof Error?e.message:String(e)}`,color:"red"}]])}s.insertText("")}))})}return[...b,...H,...Q].filter((e=>!e.visible||e.visible()))}),[B,H,Q,e,t,X,o,L,Y,F,W.getConversationStateStructure,W.getMetadata,W.setMetadata,G,q,null==z?void 0:z.type,N,U]);return(0,u.useMemo)((()=>({commands:te,findSkillReferences:e=>ee&&V?V.findSkillReferences(e):{skills:[],cleanedMessage:e}})),[te,V,ee])}o()}catch(F){o(F)}}))},"./src/hooks/use-sudo-password-requests.ts":(e,t,n)=>{n.d(t,{k:()=>r});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");function r(e){const[t,n]=(0,o.useState)([]);(0,o.useEffect)((()=>{if(e)return e.subscribe(n);n([])}),[e]);const r=(0,o.useCallback)(((t,n)=>{null==e||e.submitPassword(t,n)}),[e]),s=(0,o.useCallback)((t=>{null==e||e.cancelRequest(t)}),[e]);return{requests:t,currentRequest:t.length>0?t[0]:null,submitPassword:r,cancelRequest:s}}},"./src/hooks/use-terminal-size.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{H:()=>l});var r=n("../ink/build/index.js"),s=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),i=e([r]);function l(e=0){const{stdout:t}=(0,r.t$)(),[n,o]=(0,s.useState)((()=>{var e,n;return{columns:null!==(e=null==t?void 0:t.columns)&&void 0!==e?e:0,rows:null!==(n=null==t?void 0:t.rows)&&void 0!==n?n:0}})),i=(0,s.useRef)(null),l=(0,s.useRef)(null);return(0,s.useEffect)((()=>{if(!t)return;const n=()=>{const e={columns:t.columns,rows:t.rows};l.current&&l.current.columns===e.columns&&l.current.rows===e.rows||(l.current=e,o(e))},r=()=>{e<=0?n():(i.current&&clearTimeout(i.current),i.current=setTimeout(n,e))};return t.on("resize",r),()=>{t.off("resize",r),i.current&&(clearTimeout(i.current),i.current=null)}}),[t,e]),n}r=(i.then?(await i)():i)[0],o()}catch(a){o(a)}}))},"./src/image-processing.ts":(e,t,n)=>{n.d(t,{w:()=>c});var o=n("node:fs"),r=n("../proto/dist/generated/agent/v1/selected_context_pb.js"),s=n("../../node_modules/.pnpm/jimp@1.6.0/node_modules/jimp/dist/esm/index.js"),i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function l(e){if(255===e[0]&&216===e[1]&&255===e[2])return"image/jpeg";if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return"image/png";if(71===e[0]&&73===e[1]&&70===e[2])return"image/gif";if(82===e[0]&&73===e[1]&&70===e[2]&&70===e[3])return"image/webp";throw new Error("Unsupported image type: supported formats are jpeg, png, gif, or webp.")}const a=["userMessageAction"],c=e=>i(void 0,void 0,void 0,(function*(){const t=e.action.case;if(!a.includes(t))return;const n=e.action.value.userMessage;if(!n)return;const o=n.selectedContext;if(!o||0===o.selectedImages.length)return;const r=o.selectedImages.map((e=>e.path)).filter((e=>!!e));if(0===r.length)return;const s=yield d(r);o.selectedImages=s})),d=e=>i(void 0,void 0,void 0,(function*(){return(yield Promise.allSettled(e.map((e=>i(void 0,void 0,void 0,(function*(){const t=yield o.promises.readFile(e),n=yield function(e,t){return i(this,void 0,void 0,(function*(){var n,o,r,i,l,a;const c=yield s.dK.read(Buffer.from(e));let d=null!==(n=c.width)&&void 0!==n?n:t,u=null!==(o=c.height)&&void 0!==o?o:t;(d>t||u>t)&&c.scaleToFit({w:t,h:t});let p=yield c.getBuffer("image/jpeg",{quality:80}),h=80,g=.9;for(;p.length>5242880&&(h>=10||g>.1);)h>=10?(p=yield c.getBuffer("image/jpeg",{quality:h}),h-=10):(d=Math.floor((null!==(r=c.width)&&void 0!==r?r:t)*g),u=Math.floor((null!==(i=c.height)&&void 0!==i?i:t)*g),c.scaleToFit({w:d,h:u}),p=yield c.getBuffer("image/jpeg",{quality:90}),g*=.8);return{bytes:new Uint8Array(p),width:null!==(l=c.width)&&void 0!==l?l:d,height:null!==(a=c.height)&&void 0!==a?a:u}}))}(new Uint8Array(t),2048);return new r.d({dimension:{width:n.width,height:n.height},mimeType:l(n.bytes),dataOrBlobId:{case:"data",value:new Uint8Array(n.bytes)}})})))))).filter((e=>"fulfilled"===e.status)).map((e=>e.value))}))},"./src/mcp/approval.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Cz:()=>v,Ny:()=>x,Vh:()=>f});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:os"),i=n("node:path"),l=n.n(i),a=n("../ink/build/index.js"),c=n("../mcp-agent-exec/dist/index.js"),d=n("./src/components/approval-dialog.tsx"),u=n("./src/debug.ts"),p=n("./src/mcp/disabled-store.ts"),h=n("./src/mcp/project-paths.ts"),g=e([a,d]);[a,d]=g.then?(await g)():g;var m=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function f(e){return m(this,void 0,void 0,(function*(){const{projectRoot:t,approvalPath:n,disabledPath:o}=e,r={mcpServers:{}},i=l().join((0,s.homedir)(),".cursor","mcp.json"),a=l().join(t,".cursor","mcp.json"),[d,h]=yield Promise.all([(0,c.h1)(i).catch((()=>({mcpServers:{}}))),(0,c.h1)(a).catch((()=>({mcpServers:{}})))]);let g=[];try{const e=new c.mF(n,t);g=yield e.getApprovals()}catch(e){const t=e instanceof Error?e.message:String(e);(0,u.debugLogJSON)("Failed to read MCP approvals:",t);for(const[e,t]of[...Object.entries(d.mcpServers),...Object.entries(h.mcpServers)])r.mcpServers[e]=t;return{servers:r,error:`Could not read MCP approvals: ${t}`}}let m=[];try{const e=new p.P(o);m=yield e.getDisabledServers()}catch(e){(0,u.debugLogJSON)("Failed to read disabled MCP servers:",e instanceof Error?e.message:String(e))}for(const[e,n]of[...Object.entries(d.mcpServers),...Object.entries(h.mcpServers)]){if(m.includes(e))continue;const o=(0,c.Ko)(e,n,t);g.includes(o)||(r.mcpServers[e]=n)}return{servers:r}}))}function v(e,t){return m(this,void 0,void 0,(function*(){const{projectRoot:n,approvalPath:o}=t,r=new c.mF(o,n),s=Object.entries(e.mcpServers).map((([e,t])=>(0,c.Ko)(e,t,n)));yield r.addApprovals(s)}))}function x(e){return m(this,void 0,void 0,(function*(){const t=null!=e?e:process.cwd(),n=(0,h.C)(t),{servers:o,error:s}=yield f(n);return 0===Object.keys(o.mcpServers).length||(yield(0,d.b)({title:"MCP Server Approval Required",description:["Some MCP servers can execute code and read your data. Learn more at cursor.com/docs/context/mcp","The following MCP servers need to be approved:"],content:(0,r.jsxs)(r.Fragment,{children:[Object.entries(o.mcpServers).map((([e,t])=>(0,r.jsxs)(a.EY,{color:"cyan",children:["• ",e,"command"in t&&(0,r.jsxs)(a.EY,{color:"gray",children:[" (command: ",t.command,")"]}),"url"in t&&(0,r.jsxs)(a.EY,{color:"gray",children:[" (url: ",t.url,")"]})]},e))),s&&(0,r.jsxs)(a.EY,{color:"yellow",children:["\n","⚠ Warning: ",s]})]}),options:[{key:"a",label:"Approve all servers",value:"approved"},{key:"c",label:"Continue without approval",value:"continued"},{key:"q",label:"Quit",value:"quit"}],onAction:e=>m(this,void 0,void 0,(function*(){if("approved"===e)try{yield v(o,n)}catch(e){(0,u.debugLogJSON)("Failed to save MCP server approvals:",e instanceof Error?e.message:String(e))}else if("continued"===e)try{const e=new p.P(n.disabledPath),t=Object.keys(o.mcpServers);yield e.addDisabledServers(t)}catch(e){(0,u.debugLogJSON)("Failed to save disabled MCP servers:",e instanceof Error?e.message:String(e))}}))}))}))}o()}catch(b){o(b)}}))},"./src/mcp/server-suggestions.ts":(e,t,n)=>{n.d(t,{d:()=>a});var o=n("node:os"),r=n("node:path"),s=n("../mcp-agent-exec/dist/index.js"),i=n("./src/mcp/project-paths.ts"),l=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function a(e,t){return l(this,arguments,void 0,(function*(e,t,n=""){const{projectRoot:l}=(0,i.C)(process.cwd()),a=(0,r.join)((0,o.homedir)(),".cursor","mcp.json"),c=(0,r.join)(l,".cursor","mcp.json"),[d,u,p]=yield Promise.all([(0,s.h1)(a).catch((()=>({mcpServers:{}}))),(0,s.h1)(c).catch((()=>({mcpServers:{}}))),t.getDisabledServers()]),h=(0,s.N_)(d,u),g=Object.keys(h.mcpServers);if(0===g.length&&("enable"===e||"disable"===e))return[{value:"",description:"No MCP servers configured"}];let m=g;if("disable"===e?m=m.filter((e=>!p.includes(e))):"enable"===e&&(m=m.filter((e=>p.includes(e)))),0===m.length){if("disable"===e)return[{value:"",description:"All MCP servers are currently disabled"}];if("enable"===e)return[{value:"",description:"All MCP servers are currently enabled"}]}const f=m.map((e=>({value:e,description:`MCP server: ${e}`})));if(!n)return f;const v=n.toLowerCase();return f.filter((e=>e.value.toLowerCase().includes(v)))}))}},"./src/models/filter-legacy-models.ts":(e,t,n)=>{n.d(t,{s:()=>r});const o=[{familyPattern:/^GPT-5\.\d(?!.*Codex)(?:\s|$)/i,versions:["GPT-5.1","GPT-5.2"]},{familyPattern:/^GPT-5\.\d Codex(?:\s|$)/i,versions:["GPT-5.1 Codex","GPT-5.2 Codex"]},{familyPattern:/^Opus 4/i,versions:["Opus 4","Opus 4.1","Opus 4.5"]},{familyPattern:/^Sonnet 4/i,versions:["Sonnet 4","Sonnet 4 1M","Sonnet 4.5"]},{familyPattern:/^Gemini \d/i,versions:["Gemini 2.5","Gemini 3"]}];function r(e){const t=new Set(e.map((e=>e.displayName||e.displayNameShort||e.displayModelId)));return e.filter((e=>!function(e,t){for(const{familyPattern:n,versions:r}of o){if(!n.test(e))continue;let o=-1;for(let t=r.length-1;t>=0;t--)if(e.startsWith(r[t])){o=t;break}if(-1!==o)for(let e=o+1;e<r.length;e++){const n=r[e];for(const e of t)if(e.startsWith(n))return!0}}return!1}(e.displayName||e.displayNameShort||e.displayModelId,t)))}},"./src/pending-decision-store.ts":(e,t,n)=>{n.d(t,{$U:()=>a,uS:()=>l,yB:()=>i});var o=n("./src/analytics.ts"),r=n("./src/utils/url-utils.ts"),s=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const i="web-search",l="web-fetch";class a{constructor(){this.decisions=[],this.listeners=new Set,this.idCounter=0}getPendingDecisions(){return[...this.decisions]}subscribe(e){return this.listeners.add(e),e(this.getPendingDecisions()),()=>{this.listeners.delete(e)}}notifyListeners(){const e=this.getPendingDecisions();this.listeners.forEach((t=>{t(e)}))}addDecision(e){this.decisions=[...this.decisions,e],this.notifyListeners()}removeDecision(e){this.decisions=this.decisions.filter((t=>t.id!==e)),this.notifyListeners()}findDecision(e){return this.decisions.find((t=>t.id===e))}approveDecision(e){const t=this.findDecision(e);t&&((0,o.sx)("cli.request.user_input.response",{tool:t.operation.type||"unknown",response:"approved"}),t.resolve({approved:!0}),this.removeDecision(e))}rejectDecision(e,t){const n=this.findDecision(e);n&&(n.resolve({approved:!1,reason:t}),this.removeDecision(e))}clearAll(){const e=this.getPendingDecisions();for(const t of e)try{t.resolve({approved:!1,reason:"cleared"})}catch(e){}this.decisions=[],this.notifyListeners()}requestApproval(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const r=`decision-${Date.now()}-${this.idCounter++}`;(0,o.sx)("cli.request.user_input.requested",{tool:e.type||"unknown",type:"approval"});const s={id:r,type:"approval",operation:e,timestamp:Date.now(),resolve:t,reject:n};this.addDecision(s)}))}))}requestWebSearchApproval(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{var r;const s=`decision-${Date.now()}-${this.idCounter++}`;(0,o.sx)("cli.request.user_input.requested",{tool:i,type:"approval"});const l={id:s,type:"approval",operation:{type:i,details:{searchTerm:null!==(r=e.searchTerm)&&void 0!==r?r:""}},timestamp:Date.now(),resolve:t,reject:n};this.addDecision(l)}))}))}requestWebFetchApproval(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{var s;const i=`decision-${Date.now()}-${this.idCounter++}`,a=null!==(s=e.url)&&void 0!==s?s:"",c=(0,r.BF)(a);(0,o.sx)("cli.request.user_input.requested",{tool:l,type:"approval"});const d={id:i,type:"approval",operation:{type:l,details:{url:a,domain:c}},timestamp:Date.now(),resolve:t,reject:n};this.addDecision(d)}))}))}}},"./src/plan-file-utils.ts":(e,t,n)=>{n.d(t,{X:()=>s});var o=n("node:fs"),r=n("node:url");function s(e){const t=function(e){if(!e.startsWith("file:"))return null;try{return(0,r.fileURLToPath)(e)}catch(e){return null}}(e);if(!t)return null;if(!(0,o.existsSync)(t))return null;try{return(0,o.readFileSync)(t,"utf-8")}catch(e){return null}}},"./src/run-agent.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{J:()=>H});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:path"),i=n("../agent-kv/dist/index.js"),l=n("../context/dist/index.js"),a=n("../context-rpc/dist/index.js"),c=n("../cursor-config/dist/index.js"),d=n("../hooks/dist/index.js"),u=n("../hooks-exec/dist/index.js"),p=n("../ink/build/index.js"),h=n("../local-exec/dist/index.js"),g=n("../mcp-agent-exec/dist/index.js"),m=n("../proto/dist/generated/aiserver/v1/aiserver_connect.js"),f=n("../shell-exec/dist/index.js"),v=n("./src/always-approve-decision-provider.ts"),x=n("./src/always-deny-decision-provider.ts"),b=n("./src/autorun-aware-decision-provider.ts"),y=n("./src/client.ts"),w=n("./src/commands/update-core.ts"),j=n("./src/console-io.ts"),k=n("./src/cursor-blame/cli-ai-code-tracker.ts"),C=n("./src/debug.ts"),S=n("./src/exit.ts"),E=n("./src/headless.ts"),M=n("./src/models/index.ts"),$=n("./src/pending-decision-store.ts"),T=n("./src/sandbox-gate.ts"),I=n("./src/shared/autorun-mode.ts"),P=n("./src/shared/resources.ts"),A=n("./src/startup-timing.ts"),D=n("./src/state/index.ts"),_=n("./src/state/session.ts"),R=n("./src/state/sqlite-blob-store.ts"),L=n("./src/sudo/index.ts"),O=n("./src/team-hooks-sync.ts"),Y=n("./src/ui.tsx"),F=n("./src/utils/api-endpoint.ts"),z=n("./src/utils/auth-errors.ts"),N=e([p,Y]);[p,Y]=N.then?(await N)():N;var U=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))},B=function(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var o,r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(void 0===o){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose],n&&(r=o)}if("function"!=typeof o)throw new TypeError("Object not disposable.");r&&(o=function(){try{r.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:o,async:n})}else n&&e.stack.push({async:!0});return t},q=function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var o,r=0;return function e(){for(;o=t.stack.pop();)try{if(!o.async&&1===r)return r=0,t.stack.push(o),Promise.resolve().then(e);if(o.dispose){var s=o.dispose.call(o.value);if(o.async)return r|=2,Promise.resolve(s).then(e,(function(t){return n(t),e()}))}else r|=1}catch(e){n(e)}if(1===r)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}}("function"==typeof SuppressedError?SuppressedError:function(e,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=e,o.suppressed=t,o});function H(e,t,n,o){return U(this,void 0,void 0,(function*(){var N,H,W,G,X,K,Q,J,V,Z,ee;const te={stack:[],error:void 0,hasError:!1};try{const q=B(te,(0,l.VI)(e.withName("runAgent")),!1),{backendUrl:ne,insecure:oe,print:re,debug:se=!1,withDiffs:ie=!1,resumeChatId:le,resumeBcId:ae,diagnosticsProvider:ce,codebaseReferenceProvider:de,model:ue,workspace:pe}=n;se&&(yield(0,C.initDebug)()),yield function(e){return U(this,void 0,void 0,(function*(){var t,n,o;const r=e.get(),s=null!==(t=r.webFetchDomainAllowlist)&&void 0!==t?t:[];if(0===s.length)return;const i=null!==(o=null===(n=r.permissions)||void 0===n?void 0:n.allow)&&void 0!==o?o:[],l=s.filter((e=>{const t=`WebFetch(${e})`;return!i.includes(t)}));if(0===l.length)return void(yield e.transform((e=>Object.assign(Object.assign({},e),{webFetchDomainAllowlist:[]}))));const a=l.map((e=>`WebFetch(${e})`));yield e.transform((e=>{var t,n,o,r;return Object.assign(Object.assign({},e),{webFetchDomainAllowlist:[],permissions:Object.assign(Object.assign({},e.permissions),{allow:[...null!==(n=null===(t=e.permissions)||void 0===t?void 0:t.allow)&&void 0!==n?n:[],...a],deny:null!==(r=null===(o=e.permissions)||void 0===o?void 0:o.deny)&&void 0!==r?r:[]})})}))}))}(n.configProvider);try{new URL(ne)}catch(e){(0,j.uQ)(1,`Error: Invalid backend URL "${ne}"`)}const he=(0,D.r)(),ge=le,me=ge||crypto.randomUUID(),fe=(0,s.join)(he,me),ve=(0,s.join)(fe,"store.db");let xe;xe=ge?yield R.M.initAndLoad(ve):new R.M(ve);const be=new i.pH(xe,xe),ye={current:be},we=Date.now(),je=pe?(0,s.resolve)(pe):process.cwd(),ke=(0,y.ms)(o,ne,oe,n.configProvider),Ce=new h.J1(ke),Se=(0,P.A1)(n.configProvider,n.endpoint);let Ee,Me=!1;performance.mark(A.Y.WILL_FETCH_SERVER_CONFIG);try{const e=yield Ce.fetchServerConfig();e.agentUrlConfig&&(Ee={agentUrl:e.agentUrlConfig.agentUrl,agentnUrl:e.agentUrlConfig.agentnUrl}),Me=null!==(N=e.cliSandboxDefaultEnabled)&&void 0!==N&&N}catch(e){yield(0,z.lv)(e,o)}performance.mark(A.Y.DID_FETCH_SERVER_CONFIG);const $e=null===(H=n.configProvider.get().authInfo)||void 0===H?void 0:H.teamId,Te=null!=$e?(0,c.Vi)({credentialManager:o,endpoint:(0,F.G6)(n.endpoint),configProvider:n.configProvider}):void 0;performance.mark(A.Y.WILL_LOAD_HOOKS_CONFIG);const{hooksConfig:Ie,projectDir:Pe,teamHooksResultPromise:Ae}=yield(0,P.Pb)({workingDirectory:je,teamId:null!=$e?$e:void 0,dashboardClient:Te});let De;performance.mark(A.Y.DID_LOAD_HOOKS_CONFIG);const _e=(0,u.jv)(Ie),Re=null!=Ae;if(_e||Re){const e=(0,y.OC)(o,{backendUrl:ne,insecure:oe,configProvider:n.configProvider}),t=(0,a.Zj)(m.E,e);De=(0,y.Np)(t)}let Le,Oe,Ye=()=>{};Ae&&(Le=new Promise((e=>{Ye=e})));let Fe,ze=Ie;if(_e||Re){const e={cursor_version:null!=="2026.02.13-41ac335"?"2026.02.13-41ac335":"1.0.0",user_email:null!==(G=null===(W=n.configProvider.get().authInfo)||void 0===W?void 0:W.email)&&void 0!==G?G:null},t=(0,f.Fn)();if(Oe=new u.WL(Ie,Pe,e,t,De,Le),Ae&&Oe){const e=Oe;Ae.then((t=>{null!=t&&(ze=(0,O.O)(ze,t.teamHooks,t.teamDir),e.updateConfig(ze))})).finally((()=>Ye()))}}const Ne=new Promise((e=>{Fe=e})),Ue=e=>U(this,void 0,void 0,(function*(){var t,o,r;if(Oe&&(Re||Oe.hasHooksForStep(d._E.sessionEnd)))try{const s={conversation_id:me,generation_id:me,model:null!==(r=null!==(o=null===(t=null==ut?void 0:ut.getCurrentModel())||void 0===t?void 0:t.modelId)&&void 0!==o?o:ue)&&void 0!==r?r:"unknown",session_id:me,reason:e,duration_ms:Date.now()-we,is_background_agent:"background"===n.mode,final_status:e};yield Oe.executeHookForStep(d._E.sessionEnd,s)}catch(e){(0,C.debugLogJSON)("[hooks] sessionEnd hook failed:",e)}finally{null==Oe||Oe.clearSessionEnvironment()}})),Be=n.force||"unrestricted"===n.configProvider.get().approvalMode;let qe=!0;Be&&(qe=yield(0,I.Fo)(Se),!qe&&n.force&&(0,j.uQ)(1,"Error: Your team administrator has disabled the 'Run Everything' option.\nPlease run without '--force' to approve commands individually, or contact your administrator to enable this feature."));const He=re&&Be&&qe,We=new $.$U,Ge=new L.Ek;let Xe,Ke=null;if(!re){const e=(0,L.Gx)();if(e){Ke=new L._A;try{const{socketPath:t,secret:n}=yield Ke.start();Xe={socketPath:t,helperPath:e,secret:n},Ke.onPasswordRequest((e=>U(this,void 0,void 0,(function*(){return Ge.addRequest(e)})))),(0,C.debugLog)("askpass.server.started",{socketPath:t,helperPath:e})}catch(e){(0,C.debugLog)("askpass.server.startFailed",{error:e instanceof Error?e.message:String(e)}),Ke=null}}else(0,C.debugLog)("askpass.helper.notFound",{})}const Qe=()=>U(this,void 0,void 0,(function*(){Ke&&(Ge.cancelAll(),yield Ke.stop(),Ke=null)})),Je=()=>"auto-run"===ye.current.getMetadata("mode"),Ve=re?He?new v.I:new x.N:new b.w({getIsAutoRun:Je,autoRunControlsProvider:Se,configProvider:n.configProvider,sandboxOverride:n.sandboxOverride,sandboxDefaultEnabled:Me,sandboxFeatureGateEnabled:(0,T.Y)()},We);performance.mark(A.Y.WILL_BUILD_RESOURCES);const{createLocalResourceProvider:Ze,permissionsService:et,fileChangeTracker:tt,dashboardClient:nt,mcpLoader:ot,disabledStore:rt,isRepository:st,autoRunAvailability:it}=yield(0,P._Y)(q.ctx,{configProvider:n.configProvider,decisionProvider:Ve,workingDirectory:je,withDiffs:ie,getIsAutoRun:Je,getIsAskMode:()=>"search"===ye.current.getMetadata("mode"),isBrowserUserEnabled:n.isBrowserUseEnabled,ignoreApproveMcps:null!==(X=n.approveMcps)&&void 0!==X&&X,sandboxOverride:n.sandboxOverride,sandboxDefaultEnabled:Me,hookExecutor:Oe,hooksConfig:Ie,teamHooksResultPromise:Ae,hooksAdditionalContextPromise:Ne,promptHookClient:De,endpoint:n.endpoint,teamSettingsService:Se,askpassConfig:Xe});performance.mark(A.Y.DID_BUILD_RESOURCES);const lt=(0,y.t9)(o,{backendUrl:ne,insecure:oe,configProvider:n.configProvider}),at=(0,y.c3)(o,ne,n.configProvider),ct=M.P3.init(lt,{configProvider:n.configProvider,initialModel:ue}),dt=ot.load(e),[ut,pt]=yield Promise.all([ct,dt]),ht=new g.uz(pt);if(ge)try{yield be.resetFromDb(e);const t=be.getMetadata("lastUsedModel");yield ut.setModelFromStoredId(t,n.configProvider);const o=yield be.getLastRequestIdFromConversation(e);o&&_.d.recordLastRequest(o)}catch(e){(0,j.uQ)(1,`Failed to resume chat "${ge}": ${e instanceof Error?e.message:String(e)}`)}!ge&&Oe&&(Re||Oe.hasHooksForStep(d._E.sessionStart))?(()=>{U(this,void 0,void 0,(function*(){var e,t;try{const o=yield ut.awaitCurrentModel(),r={conversation_id:me,generation_id:me,model:null!==(t=null!==(e=o.modelId)&&void 0!==e?e:ue)&&void 0!==t?t:"unknown",session_id:me,is_background_agent:"background"===n.mode,composer_mode:n.mode},s=yield Oe.executeHookForStep(d._E.sessionStart,r);s&&(s.env&&Oe.setSessionEnvironment(s.env),s.additional_context&&(0,C.debugLog)("[hooks] sessionStart additional_context received",{length:s.additional_context.length})),Fe(null==s?void 0:s.additional_context)}catch(e){(0,C.debugLogJSON)("[hooks] sessionStart hook failed:",e),Fe(void 0)}}))})():Fe(void 0),n.force&&be.setMetadata("mode","auto-run");const gt=n.mode;if(ae)be.setMetadata("mode","background"),be.setMetadata("resumeBcId",ae);else if(gt&&["plan","ask","background"].includes(gt)){const e="ask"===gt?"search":gt;be.setMetadata("mode",e)}const mt=(e,t)=>(_.d.recordLastRequest(e.requestId,{path:e.inner.url}),t(e)),ft=(0,y.hO)(o,{backendUrl:ne,insecure:oe,requestMiddleware:mt,configProvider:n.configProvider,agentEndpoint:n.agentEndpoint,serverAgentUrlConfig:Ee});let vt=n.configProvider.get();const xt=vt.authInfo;(null===(K=null==xt?void 0:xt.email)||void 0===K?void 0:K.endsWith("@anysphere.co"))&&"static"!==vt.channel&&"prod-stable-internal"!==vt.channel&&(yield n.configProvider.transform((e=>Object.assign(Object.assign({},e),{channel:"lab"}))),vt=n.configProvider.get()),null!==(Q=n.disableAutoUpdate)&&void 0!==Q&&Q||"static"===vt.channel||setTimeout((()=>{(0,w.N)({dashboardClient:nt,showProgress:!1,channel:vt.channel,isAutoUpdate:!0}).catch((e=>{(0,C.debugLogJSON)("backgroundUpdateCheckFailed",e)}))}),2e3).unref();let bt=!1;try{if(re){if(se){const e=(0,C.getDebugSession)();e&&(0,j.p2)(`Debug server: ${e.serverUrl} (log: ${e.logFile})`)}const o=yield ut.awaitCurrentModel(),r=(0,k.L)(o,ue),s=Ze({diagnosticsProvider:ce,mcpLease:ht,codebaseReferenceProvider:de,agentClient:ft,conversationId:me,generationId:me,model:r});yield(0,E.t)(e,t,ut,ft,s,be,null!==(J=n.force)&&void 0!==J&&J,{outputFormat:null!==(V=n.outputFormat)&&void 0!==V?V:"text",streamPartialOutput:n.streamPartialOutput,sessionId:me,apiKeySource:null!==(Z=n.apiKeySource)&&void 0!==Z?Z:"login",headers:n.headers,captureEnv:null!==(ee=n.printEnv)&&void 0!==ee&&ee,customSystemPrompt:n.customSystemPrompt,enableRetries:n.enableRetries,endlessRetries:n.endlessRetries,onSessionEnd:Ue,workspacePath:je})}else{const s=se?(0,C.getDebugSession)():null,i=new h.Aj,l=yield ut.awaitCurrentModel(),a=(0,k.L)(l,ue),c=Ze({diagnosticsProvider:ce,mcpLease:ht,codebaseReferenceProvider:de,agentClient:ft,shellManager:i,conversationId:me,generationId:me,model:a});if(process.stdin.isTTY)try{process.stdin.resume(),process.stdout.write("[>1u");const e=()=>{try{process.stdout.write("[<u")}catch(e){}};process.on("SIGINT",(()=>U(this,void 0,void 0,(function*(){e(),yield Qe(),yield Ue("aborted"),yield(0,S.GZ)({code:S.yU.SIGINT})})))),process.on("SIGTERM",(()=>U(this,void 0,void 0,(function*(){e(),yield Qe(),yield Ue("aborted"),yield(0,S.GZ)({code:S.yU.SIGTERM})})))),process.on("exit",e)}catch(e){(0,C.debugLog)("Failed to resume stdin",{error:e})}performance.mark(A.Y.WILL_RENDER);const{waitUntilExit:d}=(0,p.XX)((0,r.jsx)(Y.X,{ctx:e,prompt:t,agentClient:ft,aiServerClient:lt,resources:c,agentStore:be,pendingDecisionStore:We,fileChangeTracker:tt,configProvider:n.configProvider,credentialManager:o,dashboardClient:nt,teamSettingsService:Se,backendUrl:ne,insecure:oe,mcpLease:ht,mcpLoader:ot,disabledStore:rt,addToAllowList:(t,n)=>et.addToAllowList(e,t,n),addToDenyList:(t,n)=>et.addToDenyList(e,t,n),modelManager:ut,endpoint:n.endpoint,headers:n.headers,customSystemPrompt:n.customSystemPrompt,onAgentStoreChanged:e=>{ye.current=e},debugInfo:s?{serverUrl:s.serverUrl,logFile:s.logFile}:void 0,isRepository:st,backgroundComposerClient:at,shellManager:i,hookExecutor:Oe,hooksConfig:Ie,onBeforeExit:()=>U(this,void 0,void 0,(function*(){bt=!0,yield Ue("completed")})),autoRunAvailability:it,sudoPasswordStore:Ge,sandboxDefaultEnabled:Me,enableRetries:n.enableRetries}),{exitOnCtrlC:!1,patchConsole:!1});performance.mark(A.Y.DID_RENDER),(0,A._)(!1),yield d()}}catch(e){throw bt=!0,yield Ue("error"),e}finally{if(process.stdin.isTTY)try{process.stdout.write("[<u")}catch(e){}bt||(yield Ue("completed")),yield Qe(),yield be.dispose()}return me}catch(e){te.error=e,te.hasError=!0}finally{q(te)}}))}o()}catch(W){o(W)}}))},"./src/sandbox-gate.ts":(e,t,n)=>{n.d(t,{Y:()=>a});var o=n("./src/statsig.ts");const r="composer_sandbox_settings_visible",s="sandbox_force_disable_linux",i="sandbox_force_disable_win32";function l(e,t){return(0,o.mD)()?(0,o.QF)(e):t}function a(e="linux"){return!(!l(r,!0)||"linux"===e&&l(s,!1)||"win32"===e&&l(i,!0))}},"./src/shared/autorun-mode.ts":(e,t,n)=>{n.d(t,{Fo:()=>l,Hs:()=>a,eM:()=>c});var o=n("../shell-exec/dist/index.js"),r=n("./src/debug.ts"),s=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const i=new WeakMap;function l(e){return s(this,void 0,void 0,(function*(){let t=i.get(e);if(t)return t;try{const n=yield e.getAutoRunControls(),o=!0===(null==n?void 0:n.enabled)&&!0!==n.enableRunEverything;return t=Promise.resolve(!o),i.set(e,t),t}catch(e){return(0,r.debugLogJSON)("Warning: Could not fetch team admin settings for auto-run check:",e),!0}}))}function a(e){return s(this,void 0,void 0,(function*(){const t=function(e){var t,n;const{configProvider:r,sandboxOverride:s,sandboxDefaultEnabled:i=!1,sandboxFeatureGateEnabled:l=!0}=e;if(!l)return!1;if(!(0,o.K3)())return!1;const a=r.get(),c=i?"enabled":"disabled";return"enabled"===(null!==(n=null!=s?s:null===(t=a.sandbox)||void 0===t?void 0:t.mode)&&void 0!==n?n:c)}(e);return e.getIsAutoRun()?{approvalMode:(yield l(e.autoRunControlsProvider))?"unrestricted":"allowlist",sandboxAvailable:t}:{approvalMode:"allowlist",sandboxAvailable:t}}))}function c(e){return s(this,void 0,void 0,(function*(){const{approvalMode:t}=yield a(e);return"unrestricted"===t}))}},"./src/shared/resources.ts":(e,t,n)=>{n.d(t,{A1:()=>T,Pb:()=>M,_Y:()=>I});var o=n("node:os"),r=n("node:path"),s=n.n(r),i=n("../agent-exec/dist/index.js"),l=n("../cli-credentials/dist/index.js"),a=n("../context/dist/index.js"),c=n("../cursor-config/dist/index.js"),d=n("../hooks-exec/dist/index.js"),u=n("../local-exec/dist/index.js"),p=n("../shell-exec/dist/index.js"),h=n("./src/cursor-blame/cli-ai-code-tracker.ts"),g=n("./src/mcp/disabled-store.ts"),m=n("./src/mcp/project-paths.ts"),f=n("./src/sandbox-gate.ts"),v=n("./src/statsig.ts"),x=n("./src/team-hooks-sync.ts"),b=n("./src/utils/api-endpoint.ts"),y=n("./src/utils/git.ts"),w=n("./src/utils/git-diffs.ts"),j=n("./src/shared/autorun-mode.ts"),k=n("./src/shared/cli-background-work-registry.ts"),C=n("./src/shared/cli-subagent-host-adapter.ts"),S=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const E=(0,a.h)("shared-resources");function M(){return S(this,arguments,void 0,(function*(e={}){const{workingDirectory:t,teamId:n,dashboardClient:o}=e,r=null!=t?t:process.cwd(),s=(0,y.ky)(r);let i;null!=n&&o&&(i=(0,x.a)({dashboardClient:o,teamId:n}));const l=(0,d.Ve)(s),a=new d.IF,c=new d.gY(a,l),u=yield c.load();return i?{hooksConfig:u,projectDir:s,teamHooksResultPromise:i}:{hooksConfig:u,projectDir:s}}))}const $={getDefaultNetworkAllowlist:()=>Promise.resolve((0,v.z)("sandbox_default_network_allowlist","allowlist",[]))};function T(e,t){const n=(0,l.jo)(null!=="cursor"?"cursor":"cursor-dev"),o=(0,c.Vi)({credentialManager:n,endpoint:(0,b.G6)(t),configProvider:e});return new u.w(new u.zM(o),$)}function I(e,t){return S(this,void 0,void 0,(function*(){var n,r,a,y,M,T,I,P,A,D,_,R;const L=null!==(n=t.workingDirectory)&&void 0!==n?n:process.cwd(),O=(0,l.jo)(null!=="cursor"?"cursor":"cursor-dev"),Y=(0,c.Vi)({credentialManager:O,endpoint:(0,b.G6)(t.endpoint),configProvider:t.configProvider}),F=null!==(r=t.teamSettingsService)&&void 0!==r?r:new u.w(new u.zM(Y),$),z=F.getAutoRunControls().catch((()=>{})),N=new u.$1(L);if(t.withDiffs){const e=(0,w.buildFileChanges)((0,w.collectGitStatuses)());for(const t of e)yield N.trackChange(t.path,t.before,t.after)}try{yield(0,u.Rh)(e)}catch(t){E.warn(e,"Failed to sync built-in skills",{error:t})}const U=()=>!0,B=new u.xK,q=new u.KO(e,B,L,!1,U,void 0),H=new u.EV(e,[L],(0,o.homedir)(),void 0,U),W=new u.Px([q,H]),G=new u.NB([H]),X=new u.o_([new u.Vz(L,U),new u.di(W)]),K=new u.E1(B,F),Q=(0,f.Y)(),J=[],V=new class{constructor(e,t,n=()=>!1,o,r=!1,s,i=!0){this.configProvider=e,this.getIsAutoRun=t,this.getIsAskMode=n,this.teamSettingsService=o,this.sandboxDefaultEnabled=r,this.sandboxOverride=s,this.sandboxFeatureGateEnabled=i,this.baseProvider=new c.QX(e)}getPermissions(){return S(this,void 0,void 0,(function*(){var e,t;const n=yield this.baseProvider.getPermissions(),o=null!==(t=null===(e=this.configProvider.get().sandbox)||void 0===e?void 0:e.networkAccess)&&void 0!==t?t:"user_config_with_defaults",r="allow_all"===o?(0,p.T6)():(0,p.Po)(),s="user_config_only"===o,{approvalMode:i,sandboxAvailable:l}=yield(0,j.Hs)({getIsAutoRun:this.getIsAutoRun,autoRunControlsProvider:this.teamSettingsService,configProvider:this.configProvider,sandboxOverride:this.sandboxOverride,sandboxDefaultEnabled:this.sandboxDefaultEnabled,sandboxFeatureGateEnabled:this.sandboxFeatureGateEnabled});let a;return a="unrestricted"===i?{type:"insecure_none"}:l?this.getIsAskMode()?{type:"workspace_readonly",networkPolicy:r,skipStatsigDefaults:s}:{type:"workspace_readwrite",networkPolicy:r,skipStatsigDefaults:s}:{type:"insecure_none"},Object.assign(Object.assign({},n),{approvalMode:i,userConfiguredPolicy:a})}))}updatePermissions(e){return S(this,void 0,void 0,(function*(){return this.baseProvider.updatePermissions(e)}))}}(t.configProvider,t.getIsAutoRun,null!==(a=t.getIsAskMode)&&void 0!==a?a:()=>!1,F,null!==(y=t.sandboxDefaultEnabled)&&void 0!==y&&y,t.sandboxOverride,Q);J.push(V);const Z=yield(0,u.ky)(e,B,L),ee=!!Z,te=null!=Z?Z:L,ne=yield c.N2.loadFromPath(s().join(te,".claude","settings.json"));ne&&J.push(ne);const oe=yield c.N2.loadFromPath(s().join((0,o.homedir)(),".claude","settings.json"));oe&&J.push(oe);const re=new c.Ol(J),{projectRoot:se,projectDir:ie,disabledPath:le}=(0,m.C)(L,null!=Z?Z:L),ae=new g.P(le),ce=c.aK.init(F,se,ie,null!==(M=t.ignoreApproveMcps)&&void 0!==M&&M,ae),de=t.configProvider.get(),ue=!0===t.sandboxDefaultEnabled?"enabled":"disabled",pe=null!==(P=null!==(T=t.sandboxOverride)&&void 0!==T?T:null===(I=de.sandbox)||void 0===I?void 0:I.mode)&&void 0!==P?P:ue,he=Q?pe:"disabled",ge=null!==(D=null===(A=de.sandbox)||void 0===A?void 0:A.networkAccess)&&void 0!==D?D:"user_config_with_defaults",me=new u.kh(K,t.decisionProvider,re,F,void 0,(0,v.QF)("admin_network_controls")),fe={executeIndexedGrep:void 0};let ve,xe=t.teamHooksResultPromise;if(t.hooksConfig)ve=t.hooksConfig;else{const e=null===(_=t.configProvider.get().authInfo)||void 0===_?void 0:_.teamId;null!=e&&Y&&!xe&&(xe=(0,x.a)({dashboardClient:Y,teamId:e}));const n=(0,d.Ve)(te),o=new d.IF,r=new d.gY(o,n);ve=yield r.load()}const be=new d.HW(ve);let ye,we=()=>{};xe&&(ye=new Promise((e=>{we=e})));const je=null!==(R=t.hookExecutor)&&void 0!==R?R:(()=>{var e,n;const o={cursor_version:null!=="2026.02.13-41ac335"?"2026.02.13-41ac335":"1.0.0",user_email:null!==(n=null===(e=t.configProvider.get().authInfo)||void 0===e?void 0:e.email)&&void 0!==n?n:null},r=(0,p.Fn)();return new d.WL(ve,te,o,r,t.promptHookClient,ye)})();xe&&ye&&xe.then((t=>{if(null!=t){const n=(0,x.O)(ve,t.teamHooks,t.teamDir);be.setConfig(n),je.updateConfig(n),E.info(e,"Team hooks config merged after fetch")}})).finally((()=>we()));const ke=Q&&(0,p.K3)()&&"enabled"===he;let Ce={type:"run-everything"};try{const e=yield z;!0===(null==e?void 0:e.enabled)&&!0!==e.enableRunEverything&&(Ce=ke?{type:"sandbox-only"}:{type:"disabled"})}catch(e){}const Se=s().join((0,o.homedir)(),".cursor","sandbox.json"),Ee=yield(0,p.tv)(Se,(0,o.homedir)()),Me=Ee?{perUser:Ee}:void 0;return{permissionsService:me,grepProvider:fe,fileChangeTracker:N,dashboardClient:Y,teamSettingsService:F,mcpLoader:ce,disabledStore:ae,isRepository:ee,hooksConfigLease:be,hookExecutor:je,hooksConfig:ve,autoRunAvailability:Ce,createLocalResourceProvider:({diagnosticsProvider:e,mcpLease:n,codebaseReferenceProvider:r,agentClient:s,shellManager:l,pendingDecisionProviderOverride:a,conversationId:c="",generationId:g="",model:m="unknown"})=>{const f=new h.e({workspacePath:L,conversationId:c,model:m}),v=new k.t,x=new u.Dv({pendingDecisionStore:null!=a?a:t.decisionProvider,fileChangeTracker:N,gitExecutor:B,ignoreService:K,grepProvider:fe,permissionsService:me,workspacePaths:[L],diagnosticsProvider:e,mcpLease:n,cursorRulesService:W,subagentsService:X,repositoryProvider:r,projectDir:ie,shellManager:l,_sandboxPolicyResolver:void 0,_defaultSandboxPolicy:"enabled"===he?{type:"workspace_readwrite",networkPolicy:"allow_all"===ge?(0,p.T6)():(0,p.Po)(),skipStatsigDefaults:"user_config_only"===ge}:{type:"insecure_none"},_defaultSandboxPolicySources:Me,getSandboxEnabled:()=>!!Q&&((0,p.K3)()&&"enabled"===he),getSandboxSupported:()=>Q&&(0,p.K3)(),getNetworkAllowlistInfo:()=>(0,u.mA)(F,(0,o.homedir)(),L),attributionConfigProvider:t.configProvider,getAgentSkills:e=>G.getAllAgentSkills(e),askpassConfig:t.askpassConfig,onWriteForAiTracking:e=>f.trackWrite(e),onDeleteForAiTracking:e=>f.trackDelete(e),backgroundWorkRegistry:v});return x.register(i.Zn,(0,i.hv)(new C.f(s,x,v))),new d.ae(x,je,(()=>({conversation_id:c,generation_id:g,model:m})),n,t.hooksAdditionalContextPromise,ye,be)}}}))}},"./src/shared/unified-approval-policy.ts":(e,t,n)=>{n.d(t,{y:()=>a});var o=n("./src/shared/autorun-mode.ts"),r=n("./src/utils/url-utils.ts");function s(e){return"type"in e&&"prompt"===e.type}var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const l="User Rejected";class a{constructor(e){this.params=e}requestOperationApproval(e,t){return i(this,void 0,void 0,(function*(){return(yield(0,o.eM)(this.params))?{approved:!0}:t.requestApproval(e)}))}requestWebSearchApproval(){return i(this,arguments,void 0,(function*(e={}){const t=function(e){return e.forceApprove||e.isRunEverything?{approved:!0}:e.allowPrompt?{type:"prompt"}:{approved:!1,reason:"User Rejected"}}({isRunEverything:yield(0,o.eM)(this.params),forceApprove:e.forceApprove,allowPrompt:!0===e.allowPrompt});return s(t)?e.onPrompt?e.onPrompt():{approved:!1,reason:l}:t}))}requestWebFetchApproval(e){return i(this,void 0,void 0,(function*(){var t;const n=yield(0,o.eM)(this.params),i=function(e){var t,n;if(e.skipApproval||e.forceApprove||e.isRunEverything)return{approved:!0};const o=null!==(t=e.args.url)&&void 0!==t?t:"",s=(0,r.BF)(o),i=null!==(n=e.permissionsAllow)&&void 0!==n?n:[];return(0,r.hD)(s,i)?{approved:!0}:e.allowPrompt?{type:"prompt"}:{approved:!1,reason:"Domain not in allowlist"}}({args:e.args,skipApproval:e.skipApproval,isRunEverything:n,permissionsAllow:null!==(t=e.permissionsAllow)&&void 0!==t?t:[],forceApprove:e.forceApprove,allowPrompt:!0===e.allowPrompt});return s(i)?e.onPrompt?e.onPrompt():{approved:!1,reason:l}:i}))}}},"./src/sudo/index.ts":(e,t,n)=>{n.d(t,{_A:()=>p,Ek:()=>h,Gx:()=>l});var o=n("node:fs"),r=n("node:path"),s=n("node:url");const i=!1;function l(){const e=process.argv[1];if(e){const t=(0,r.dirname)(e);if(i){const e=(0,r.join)(t,"cursor-askpass.cmd");if((0,o.existsSync)(e))return e}else{const e=(0,r.join)(t,"cursor-askpass");if((0,o.existsSync)(e))return e}const n=(0,r.join)(t,"cursor-askpass.js");if((0,o.existsSync)(n))return n}const t=(0,r.dirname)((0,s.fileURLToPath)("file:///__w/everysphere/everysphere/packages/agent-cli/src/sudo/askpass-helper-path.ts")),n=(0,r.join)(t,"cursor-askpass.js");if((0,o.existsSync)(n))return n;const l=(0,r.join)(t,"cursor-askpass.ts");if((0,o.existsSync)(l))return l;const a=(0,r.join)(t,"..","..","dist-package",i?"cursor-askpass.cmd":"cursor-askpass");return(0,o.existsSync)(a)?a:null}var a=n("node:crypto"),c=n("node:fs/promises"),d=n("node:net"),u=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};class p{constructor(e={}){var t,n;this.server=null,this.socketPath=null,this.secret=null,this.handler=null,this.activeConnections=new Set,this.poisoned=!1;const o=(0,a.randomUUID)().slice(0,10);this.config={socketPath:null!==(t=e.socketPath)&&void 0!==t?t:`/tmp/cursor-askpass-${o}.sock`,requestTimeoutMs:null!==(n=e.requestTimeoutMs)&&void 0!==n?n:12e4}}onPasswordRequest(e){this.handler=e}start(){return u(this,void 0,void 0,(function*(){if(this.server)throw new Error("AskpassServer is already running");this.secret=(0,a.randomBytes)(32).toString("hex");try{yield(0,c.unlink)(this.config.socketPath)}catch(e){}return new Promise(((e,t)=>{this.server=(0,d.createServer)((e=>{this.handleConnection(e)})),this.server.on("error",(e=>{t(e)})),this.server.listen(this.config.socketPath,(()=>u(this,void 0,void 0,(function*(){this.socketPath=this.config.socketPath;try{yield(0,c.chmod)(this.config.socketPath,384)}catch(e){}e({socketPath:this.socketPath,secret:this.secret})}))))}))}))}stop(){return u(this,void 0,void 0,(function*(){for(const e of this.activeConnections)e.destroy();if(this.activeConnections.clear(),this.server&&(yield new Promise((e=>{this.server.close((()=>e()))})),this.server=null),this.socketPath){try{yield(0,c.unlink)(this.socketPath)}catch(e){}this.socketPath=null}}))}getSocketPath(){return this.socketPath}getSecret(){return this.secret}isRunning(){return null!==this.server}isPoisoned(){return this.poisoned}verifySignature(e){if(!this.secret)return!1;const{signature:t}=e,n=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(e,["signature"]);if(!t)return!1;const o=(0,a.createHmac)("sha256",this.secret).update(JSON.stringify(n)).digest("hex");try{const e=Buffer.from(t,"hex"),n=Buffer.from(o,"hex");return e.length===n.length&&(0,a.timingSafeEqual)(e,n)}catch(e){return!1}}handleConnection(e){if(this.poisoned)return void e.destroy();this.activeConnections.add(e);let t="",n=!1;const o=setTimeout((()=>{n||(this.sendResponse(e,{type:"password_denied",id:"timeout",reason:"request timed out"}),e.destroy())}),this.config.requestTimeoutMs);e.on("data",(r=>u(this,void 0,void 0,(function*(){if(this.poisoned)return clearTimeout(o),void e.destroy();t+=r.toString("utf8");const s=t.indexOf("\n");if(-1===s)return;const i=t.slice(0,s);if(t=t.slice(s+1),!n){n=!0,clearTimeout(o);try{const t=JSON.parse(i);if(!this.verifySignature(t))return this.poisoned=!0,void e.destroy();if("password_request"!==t.type)return this.poisoned=!0,void e.destroy();if(!this.handler)return this.sendResponse(e,{type:"password_denied",id:t.id,reason:"no handler registered"}),void e.destroy();try{const n=yield this.handler(t);null!==n?this.sendResponse(e,{type:"password_response",id:t.id,password:n}):this.sendResponse(e,{type:"password_denied",id:t.id,reason:"user cancelled"})}catch(n){this.sendResponse(e,{type:"password_denied",id:t.id,reason:n instanceof Error?n.message:"handler error"})}}catch(t){return this.poisoned=!0,void e.destroy()}e.destroy()}})))),e.on("close",(()=>{clearTimeout(o),this.activeConnections.delete(e)})),e.on("error",(()=>{clearTimeout(o),this.activeConnections.delete(e)}))}sendResponse(e,t){try{e.write(`${JSON.stringify(t)}\n`)}catch(e){}}}class h{constructor(){this.requests=[],this.listeners=new Set}getPendingRequests(){return[...this.requests]}subscribe(e){return this.listeners.add(e),e(this.getPendingRequests()),()=>{this.listeners.delete(e)}}addRequest(e){return new Promise((t=>{const n={id:e.id,prompt:e.prompt,timestamp:Date.now(),resolve:n=>{this.removeRequest(e.id),t(n)}};this.requests=[...this.requests,n],this.notifyListeners()}))}submitPassword(e,t){const n=this.requests.find((t=>t.id===e));n&&n.resolve(t)}cancelRequest(e){const t=this.requests.find((t=>t.id===e));t&&t.resolve(null)}cancelAll(){for(const e of this.requests)try{e.resolve(null)}catch(e){}this.requests=[],this.notifyListeners()}removeRequest(e){this.requests=this.requests.filter((t=>t.id!==e)),this.notifyListeners()}notifyListeners(){const e=this.getPendingRequests();for(const t of this.listeners)t(e)}}},"./src/ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{X:()=>Be});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:crypto"),i=n("node:fs"),l=n("node:path"),a=n.n(l),c=n("../agent-client/dist/index.js"),d=n("../agent-core/dist/index.js"),u=n("../agent-kv/dist/index.js"),p=n("../agent-ui-state/dist/index.js"),h=n("../context/dist/index.js"),g=n("../hooks-exec/dist/index.js"),m=n("../ink/build/index.js"),f=n("../proto/dist/generated/agent/v1/agent_pb.js"),v=n("../proto/dist/generated/agent/v1/agent_service_pb.js"),x=n("../proto/dist/generated/agent/v1/ask_question_tool_pb.js"),b=n("../proto/dist/generated/agent/v1/create_plan_tool_pb.js"),y=n("../proto/dist/generated/agent/v1/cursor_rules_pb.js"),w=n("../proto/dist/generated/agent/v1/selected_context_pb.js"),j=n("../proto/dist/generated/agent/v1/setup_vm_environment_tool_pb.js"),k=n("../proto/dist/generated/agent/v1/switch_mode_tool_pb.js"),C=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),S=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),E=n("./src/analytics.ts"),M=n("./src/background.tsx"),$=n("./src/commands/custom-commands.ts"),T=n("./src/commands/logout.tsx"),I=n("./src/components/alt-screen.tsx"),P=n("./src/components/animated-dots.tsx"),A=n("./src/components/ask-question-form.tsx"),D=n("./src/components/cube-overlay.tsx"),_=n("./src/components/file-change-review.tsx"),R=n("./src/components/hexagon-loader.tsx"),L=n("./src/components/index.ts"),O=n("./src/components/items-pager.tsx"),Y=n("./src/components/mcp-servers-pager.tsx"),F=n("./src/components/plan-file-block.tsx"),z=n("./src/components/prompt-bar.tsx"),N=n("./src/components/queued-message-banner.tsx"),U=n("./src/components/sandbox-pager.tsx"),B=n("./src/components/sudo-password-banner.tsx"),q=n("./src/components/switch-mode-approval.tsx"),H=n("./src/components/unified-list-pager.tsx"),W=n("./src/components/usage-pager.tsx"),G=n("./src/components/user-message-ui.tsx"),X=n("./src/console-io.ts"),K=n("./src/constants.ts"),Q=n("./src/context/agent-state-context.tsx"),J=n("./src/context/config-context.tsx"),V=n("./src/context/slash-command-context.tsx"),Z=n("./src/context/sudo-password-context.tsx"),ee=n("./src/context/terminal-state-context.tsx"),te=n("./src/context/theme-context.tsx"),ne=n("./src/context/vim-mode-context.tsx"),oe=n("./src/conversation/dynamic-item.tsx"),re=n("./src/conversation/static-item.tsx"),se=n("./src/cursor-blame/cli-commit-scoring.ts"),ie=n("./src/cursor-blame/cli-conversation-classification.ts"),le=n("./src/debug.ts"),ae=n("./src/ephemeral-bridge.ts"),ce=n("./src/exit.ts"),de=n("./src/hang-detection.ts"),ue=n("./src/hooks/use-attach-background-composer.ts"),pe=n("./src/hooks/use-confirm-overlay.tsx"),he=n("./src/hooks/use-mounted-effect.ts"),ge=n("./src/hooks/use-send-to-background.ts"),me=n("./src/hooks/use-slash-commands.ts"),fe=n("./src/image-processing.ts"),ve=n("./src/plan-file-utils.ts"),xe=n("./src/shared/unified-approval-policy.ts"),be=n("./src/state/index.ts"),ye=n("./src/state/session.ts"),we=n("./src/state/sqlite-blob-store.ts"),je=n("./src/statsig.ts"),ke=n("./src/transcript/index.ts"),Ce=n("./src/utils/git.ts"),Se=n("./src/utils/interaction-utils.ts"),Ee=n("./src/utils/plan-utils.ts"),Me=n("./src/utils/retry-helpers.ts"),$e=n("./src/utils/sandbox-messages.ts"),Te=n("./src/utils/terminal-title.ts"),Ie=n("./src/utils/tokens.ts"),Pe=n("./src/utils/turn-file-tracker.ts"),Ae=n("./src/utils/turn-tracking.ts"),De=e([m,M,T,I,P,A,D,_,R,L,O,Y,F,z,N,U,B,q,H,W,G,ee,te,oe,re,pe,me]);[m,M,T,I,P,A,D,_,R,L,O,Y,F,z,N,U,B,q,H,W,G,ee,te,oe,re,pe,me]=De.then?(await De)():De;var _e=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))},Re=function(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var o,r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(void 0===o){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose],n&&(r=o)}if("function"!=typeof o)throw new TypeError("Object not disposable.");r&&(o=function(){try{r.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:o,async:n})}else n&&e.stack.push({async:!0});return t},Le=function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var o,r=0;return function e(){for(;o=t.stack.pop();)try{if(!o.async&&1===r)return r=0,t.stack.push(o),Promise.resolve().then(e);if(o.dispose){var s=o.dispose.call(o.value);if(o.async)return r|=2,Promise.resolve(s).then(e,(function(t){return n(t),e()}))}else r|=1}catch(e){n(e)}if(1===r)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}}("function"==typeof SuppressedError?SuppressedError:function(e,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=e,o.suppressed=t,o});function Oe(e){const{turnFileChanges:t,steps:n,endReason:o,liveTokens:r,requestStartTime:s,logCliTurnOutcome:i,error:l}=e;let a=0;s&&(a=Date.now()-s);const c=t.reduce(((e,t)=>{var n,o;return e+((null===(n=t.after)||void 0===n?void 0:n.split("\n").length)||0)-((null===(o=t.before)||void 0===o?void 0:o.split("\n").length)||0)}),0),d=t.length;try{const{todosCompleted:e,toolsUsed:t}=function(e){return{todosCompleted:e.filter((e=>{var t;return"tool-call-group"===e.type&&(null===(t=e.calls)||void 0===t?void 0:t.some((e=>"updateTodosToolCall"===e.call.tool.case)))})).length,toolsUsed:e.filter((e=>"tool-call-group"===e.type)).length}}(n);(0,E.sx)("cli.request.completed",{end_reason:o,lines_changed:c,files_changed:d,todos_completed:e,tools_used:t,time_elapsed_ms:a,estimated_tokens:r})}catch(e){}let u;switch(o){case"success":u="success";break;case"error":u="error";break;case"user_aborted":u="cancelled";break;default:throw new Error(`Unexpected endReason: ${o}`)}i(u,"error"===o?l:void 0)}function Ye(e){const t=e.split("\n");if(0===t.length||"---"!==t[0].trim())return e;for(let e=1;e<t.length;e++)if("---"===t[e].trim())return t.slice(e+1).join("\n").trimStart();return e}function Fe(e,t){var n,o,r;const s=(0,p.qX)(t),i=null!==(r="createPlanToolCall"===(null===(n=null==s?void 0:s.tool)||void 0===n?void 0:n.case)?null===(o=s.tool.value.result)||void 0===o?void 0:o.planUri:void 0)&&void 0!==r?r:e.getMetadata("currentPlanUri");return i?(e.setMetadata("currentPlanUri",i),(0,p.Wm)(t,i)):t}const ze=()=>{var e;const{stdout:t}=(0,m.t$)(),n=Math.max(20,null!==(e=null==t?void 0:t.columns)&&void 0!==e?e:80),o=Math.max(2,Math.floor((n-12-2)/2)),s="─".repeat(o),i="─".repeat(o);return(0,r.jsxs)(m.az,{marginY:1,children:[(0,r.jsx)(m.EY,{dimColor:!0,children:s}),(0,r.jsx)(m.EY,{children:" "}),(0,r.jsx)(m.EY,{color:"magenta",bold:!0,children:"STATIC ABOVE"}),(0,r.jsx)(m.EY,{children:" "}),(0,r.jsx)(m.EY,{dimColor:!0,children:i})]})},Ne=({agentStore:e,uiConversationState:t,optimisticUserMessage:o,onRequestReviewMode:s,onOpenBackgroundPicker:i,onOpenRulesPager:l,onOpenCommandsPager:a,onOpenUsagePager:c,onOpenSkillsPager:d,onOpenMcpPager:u,onOpenSandboxPager:h,isOverlayActive:g,isProcessing:f,sendMessage:v,onAbort:x,debugInfo:b,isGenerating:y,unshownTokenEstimate:w,onResumeChat:j,onNewChat:k,getChatId:C,addToAllowList:M,onImagesUpdated:$,configProvider:I,credentialManager:D,isRepository:_,isResumingChat:O,isSendingToBackground:Y,isTransferring:U,transferStatus:B,onSummarize:H,onTransferToCloud:W,checkCloudAgentAccess:X,externalCursorToEndSignal:Z,sendShellCommand:ee,executePlan:te,isSuggestingPlan:ne,planDecisionIndex:se,setPlanDecisionIndex:ie,onRejectPlan:ae,onDiscardPlan:ce,onCancelPlanRevision:de,onShowExistingPlan:ue,onClearPlanFileBlock:pe,askQuestionPrompt:he,switchModePrompt:ge,onAskQuestionSelectionChange:me,onAskQuestionSubmit:fe,onAskQuestionSkip:ve,onSwitchModeDecisionIndexChange:xe,onSwitchModeApprove:be,onSwitchModeReject:ye,shellManager:we,dashboardClient:ke,onSendQueuedNow:Ce,onCancelFirstQueued:Se,onPopLastForEdit:Ee,onClearPoppedForEdit:Te,slashCommands:Pe,inputDisabled:Ae,onBeforeExit:De,autoRunAvailability:Re,connectionState:Le})=>{var Oe;const{pendingDecisions:Ye,rejectPendingDecision:Fe,inputValue:Ne,setInputValue:Ue,changedFiles:Be,queuedMessages:qe,isSummarizing:He,mode:We}=(0,Q.C9)(),Ge=(0,Q.tO)(),Xe=(0,J.HS)(),{registerCommand:Ke,unregisterCommand:Qe}=(0,V.x)(),[Je,Ve]=(0,S.useState)(null),[Ze,et]=(0,S.useState)(!1),tt=he?"ask-question":ge?"switch-mode":t.rejectedPlan?"plan-revision":Je?"rejection-reason":Ye.length>0?"decision":"message";(0,S.useEffect)((()=>{var e;const t=(null!==(e=null==Be?void 0:Be.length)&&void 0!==e?e:0)>0;if(!K.hD||!t)return void Qe("review");const n={id:"review",title:"Review edits",description:"Enter review mode to inspect edits",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),s()}};return Ke(n),()=>Qe("review")}),[Ke,Qe,s,Be]),(0,S.useEffect)((()=>{const e={id:"resume",title:"Resume Session",description:"Open the picker for chats and cloud agents",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),i()}};return Ke(e),()=>{Qe("resume")}}),[Ke,Qe,i]),(0,S.useEffect)((()=>{const e={id:"rule",title:"Rules",description:"Manage Cursor rules",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),l()}};return Ke(e),()=>Qe("rule")}),[Ke,Qe,l]),(0,S.useEffect)((()=>{const e={id:"command",title:"Commands",description:"Manage custom commands",boostedAlts:["commands"],run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),a()}};return Ke(e),()=>Qe("command")}),[Ke,Qe,a]),(0,S.useEffect)((()=>{const e={id:"usage",title:"Usage",description:"Show AI usage stats",run:(e,t,o)=>_e(void 0,void 0,void 0,(function*(){var e,t,r,s,i;null===(e=o.clearInput)||void 0===e||e.call(o),null===(t=o.print)||void 0===t||t.call(o,[[{text:"Loading usage data...",color:"cyan"}]]);try{const{GetMeRequest:e,GetUserAnalyticsRequest:t}=yield Promise.resolve().then(n.bind(n,"../proto/dist/generated/aiserver/v1/dashboard_pb.js")),i=yield ke.getMe(new e({}));if(!i.userId)return void(null===(r=o.print)||void 0===r||r.call(o,[[{text:"Not logged in. Run /login first.",color:"red"}]]));const l=new Date,a=l.getTime(),d=new Date(l);d.setDate(d.getDate()-364);const u=((yield ke.getUserAnalytics(new t({teamId:null!==(s=i.teamId)&&void 0!==s?s:0,userId:i.userId,startDate:BigInt(d.getTime()),endDate:BigInt(a),version:"v2"}))).dailyMetrics||[]).map((e=>{var t,n;const o=(null!==(t=e.acceptedLinesAdded)&&void 0!==t?t:0)+(null!==(n=e.acceptedLinesDeleted)&&void 0!==n?n:0);return{date:Number(e.date),agentLines:o,tabLines:0,totalLines:o+0}}));c(u)}catch(e){const t=e instanceof Error?e.message:String(e);null===(i=o.print)||void 0===i||i.call(o,[[{text:"Failed to load usage data: ",color:"red"}],[{text:t,color:"red",dim:!0}],[],[{text:"View your usage at ",dim:!0},{text:"https://cursor.com/dashboard?tab=analytics",color:"blue"}]])}}))};return Ke(e),()=>Qe("usage")}),[Ke,Qe,c,ke]);const nt=(0,je.QF)("enable_skills");(0,S.useEffect)((()=>{if(!nt)return;const e={id:"skills",title:"Skills",description:"Open skills menu",inline:!0,run:(e,t,n)=>{var o,r,s,i,l;const a=[null!==(r=null===(o=n.getPromptPrefix)||void 0===o?void 0:o.call(n))&&void 0!==r?r:"",null!==(s=null==t?void 0:t.join(" "))&&void 0!==s?s:""].filter(Boolean).join(" ");null===(i=n.clearInput)||void 0===i||i.call(n),a&&n.insertText(a),null===(l=n.onOpenSkillsPager)||void 0===l||l.call(n)}};return Ke(e),()=>{Qe("skills")}}),[Ke,Qe,nt]),(0,S.useEffect)((()=>{if(!(0,le.isDebugEnabled)())return;const e={id:"static-indicator",title:"Static Indicator",description:"Toggle static divider and highlighting (/static-indicator [on|off|toggle|status])",args:[{id:"state",required:!1}],run:(e,t,n)=>{var o,r,s,i;const l=(t[0]||"").trim().toLowerCase(),a=Ze;if("status"===l)return null===(o=n.print)||void 0===o||o.call(n,[[{text:"Static indicator is ",dim:!0},{text:a?"ON":"OFF",color:a?"green":"gray"}]]),void n.insertText("");let c=null;if(""===l||"toggle"===l?c=!a:"on"===l?c=!0:"off"===l&&(c=!1),null===c)return null===(r=n.print)||void 0===r||r.call(n,[[{text:"Usage: /static-indicator [on|off|toggle|status]",color:"red"}]]),void(null===(s=n.clearInput)||void 0===s||s.call(n));et(c),null===(i=n.print)||void 0===i||i.call(n,[[{text:"Static indicator ",dim:!0},{text:c?"enabled":"disabled",color:c?"green":"gray"}]]),n.insertText("")}};return Ke(e),()=>Qe("static-indicator")}),[Ke,Qe,Ze]);const ot=(0,S.useMemo)((()=>{var e;return"agent"===(null===(e=t.pendingTurn)||void 0===e?void 0:e.type)&&void 0!==t.pendingTurn.thinkingContent&&t.pendingTurn.thinkingContent.length>0}),[t]),rt=(0,S.useMemo)((()=>{var e;return"agent"!==(null===(e=t.pendingTurn)||void 0===e?void 0:e.type)?null:t.pendingTurn.thinkingContent}),[t]),st=(0,S.useMemo)((()=>{var e;if("agent"!==(null===(e=t.pendingTurn)||void 0===e?void 0:e.type))return null;const n=t.pendingTurn.pendingState;if("tool-call-segment"!==(null==n?void 0:n.type))return null;const o=n.groups[n.groups.length-1];if("tool-call-group"!==(null==o?void 0:o.type))return null;const r=o.calls[o.calls.length-1];return(0,K.F_)(r.call.tool.case,!1)}),[t]),[it,lt]=(0,S.useState)(null);(0,S.useEffect)((()=>{if(!st)return void lt(null);const e=setTimeout((()=>{lt(st)}),K.V2);return()=>clearTimeout(e)}),[st]);const[at,ct]=(0,S.useState)(0),dt=(0,S.useRef)(0);(0,S.useEffect)((()=>{const e=Date.now(),t=K.Zx,n=e-dt.current;if(n>=t)return dt.current=e,void ct(w);const o=setTimeout((()=>{dt.current=Date.now(),ct(w)}),t-n);return()=>clearTimeout(o)}),[w]);const ut=(0,S.useCallback)((()=>_e(void 0,void 0,void 0,(function*(){yield(0,T.handleLogout)(D,I)}))),[D,I]),{staticItems:pt,dynamicItems:ht}=(0,S.useMemo)((()=>(0,p.HE)(t,b,{isRepository:_,folderMode:"background"===We?"git":"cwd"})),[t,b,_,We]),gt=(0,S.useDeferredValue)(ht),mt=(0,S.useMemo)((()=>{const e=t.pendingTurn;if(!e)return!1;switch(e.type){case"agent":return 0===e.completedSteps.length&&void 0===e.pendingState;case"shell":return 0===e.stdout.length&&0===e.stderr.length&&void 0===e.exitCode;default:return!1}}),[t.pendingTurn])?ht:gt,ft=(0,S.useMemo)((()=>{if(!t.pendingTurn)return null;const e=`turn-${t.completedTurns.length}`;return(0,p.M)(t.pendingTurn,e)}),[t.pendingTurn,t.completedTurns.length]),vt=(0,S.useMemo)((()=>ft?mt.filter((e=>e.pendingStateKey===ft)):[]),[mt,ft]),xt={hideUserMessages:!1,isCompact:Ge||null!==he,isSuggestingPlan:ne,isGenerating:y,planDecisionIndex:se,shellManager:we,isRepository:_};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.jC,{items:pt,children:(e,t)=>"agent-thinking"!==e.type||Xe?(0,r.jsx)(m.az,{marginTop:1,flexDirection:"column",children:(0,r.jsx)(re.j,{item:e,options:xt})},`static-item-${e.key}`):null}),Ze&&(0,r.jsx)(ze,{}),(0,r.jsx)(m.az,{flexDirection:"column",children:vt.map((e=>(0,r.jsx)(m.az,{marginTop:1,flexDirection:"column",children:(0,r.jsx)(oe.C,{item:e,options:xt})},e.key)))}),o?(0,r.jsx)(m.az,{marginTop:1,flexDirection:"column",children:(0,r.jsx)(G.H,{content:o})}):null,t.planFileBlock&&(0,r.jsx)(m.az,{marginTop:1,flexDirection:"column",children:(0,r.jsx)(F.l,{planUri:t.planFileBlock.planUri,planDecisionIndex:se,isRepository:_,onLoadFailed:pe})}),O&&(0,r.jsx)(m.az,{flexDirection:"column",children:(0,r.jsxs)(m.az,{flexDirection:"row",gap:1,paddingTop:2,paddingLeft:2,children:[(0,r.jsx)(m.az,{width:1,children:(0,r.jsx)(R.A,{customInterval:210,activeColor:"cyan"},"resume-hex")}),(0,r.jsx)(m.az,{flexDirection:"row",children:(0,r.jsx)(m.EY,{bold:!0,children:"Loading conversation"})})]})}),(0,r.jsxs)(m.az,{flexDirection:"column",children:["1"===process.env.AGENT_CLI_SESSION_WARNING_SANDBOX_UNSUPPORTED&&(0,r.jsx)(m.az,{marginX:1,marginTop:1,borderStyle:"round",borderColor:"yellow",paddingX:1,children:(0,r.jsxs)(m.EY,{color:"yellow",children:[(0,$e.l)(),". Falling back to allowlist mode for this session."]})}),rt&&(0,r.jsx)(m.az,{paddingX:2,paddingTop:1,paddingBottom:1,marginTop:1,children:(0,r.jsx)(L.mb,{content:rt,maxLines:5,showHiddenIndicator:!0,dimmed:!0,preserveParagraphBreaks:!0,compact:!0})}),ge?(0,r.jsx)(m.az,{paddingX:1,marginTop:1,children:(0,r.jsx)(q.V,{prompt:ge})}):null,he?(0,r.jsx)(m.az,{paddingX:1,marginTop:1,children:(0,r.jsx)(A.o,{args:he.args,selection:he.selection,isAsync:he.isAsync})}):null,(0,r.jsx)(z.q,{isEmptyChat:0===t.completedTurns.length&&void 0===t.pendingTurn,value:Ne,onChange:e=>{Ue(e)},onSubmit:(e,t)=>_e(void 0,void 0,void 0,(function*(){var n;if("message"===tt&&e.trim())v(e,{display:null==t?void 0:t.display,cursorRules:null==t?void 0:t.cursorRules,mode:null==t?void 0:t.mode}),"background"!==We&&(Ue(""),$([]));else if("rejection-reason"===tt&&Je){const t=Ye.find((e=>e.id===Je)),o=(null===(n=null==t?void 0:t.operation)||void 0===n?void 0:n.type)||"unknown";(0,E.sx)("cli.request.user_input.response",{tool:o,response:"rejected",reason:e.trim()||void 0}),Fe(Je,e.trim()||void 0),Ve(null),Ue(""),$([])}else"plan-revision"===tt&&e.trim()&&(v(e.trim(),{display:e.trim()}),Ue(""),$([]))})),onSubmitShell:ee,topStatusMarginTop:(void 0!==t.pendingTurn||t.completedTurns.length>0)&&"plan-revision"===tt?0:1,topStatus:(()=>{const e=(0,Me.MO)({hasPromptDialog:!(!he&&!ge),isTransferring:U,connectionState:Le,isGenerating:y,isSummarizing:He,hasQueuedMessages:qe.length>0});return null===e?null:(0,r.jsxs)(m.az,{flexDirection:"column",children:[qe.length>0&&(0,r.jsx)(N.J,{messages:qe,showTip:!0,inputIsEmpty:0===Ne.length}),"transfer"===e&&(0,r.jsxs)(m.az,{flexDirection:"row",gap:1,children:[(0,r.jsx)(m.az,{width:1,children:(0,r.jsx)(R.A,{customInterval:210,activeColor:"cyan"},"transfer-hex")}),(0,r.jsxs)(m.az,{flexDirection:"row",children:[(0,r.jsx)(m.EY,{bold:!0,children:B||"Moving to cloud"}),(0,r.jsx)(m.EY,{bold:!0,children:(0,r.jsx)(P.U,{})})]})]}),"reconnecting"===e&&(0,r.jsxs)(m.az,{flexDirection:"row",gap:1,children:[(0,r.jsx)(m.az,{width:1,children:(0,r.jsx)(R.A,{customInterval:210,activeColor:"yellow"},"reconnect-hex")}),(0,r.jsxs)(m.az,{flexDirection:"row",children:[(0,r.jsx)(m.EY,{bold:!0,color:"yellow",children:"Reconnecting"}),(0,r.jsx)(m.EY,{bold:!0,color:"yellow",children:(0,r.jsx)(P.U,{})})]})]}),"generating"===e&&(0,r.jsxs)(m.az,{flexDirection:"row",gap:1,children:[(0,r.jsx)(m.az,{width:1,children:(0,r.jsx)(R.A,{customInterval:210,activeColor:"green"},"gen-hex")}),(0,r.jsxs)(m.az,{flexDirection:"row",children:[(0,r.jsx)(m.EY,{bold:!0,children:ot?"Thinking":He?"Summarizing":null!=it?it:"Generating"}),(0,r.jsx)(m.EY,{bold:!0,children:(0,r.jsx)(P.U,{})})]}),(()=>{const e=(0,Ie.a)(at);return e?(0,r.jsxs)(m.EY,{dimColor:!0,children:[" ",e]}):null})()]})]})})(),inputMode:tt,isDisabled:Y,isProcessing:f,isSendingToBackground:Y,isRepository:_,onCtrlC:x,onRequestReview:s,slashCommands:Pe,externalCursorToEndSignal:Z,onBeginRejection:e=>{Ve(e),Ue("")},onResumeChat:j,getChatId:C,onSkipRejectionReason:()=>{Je&&(Fe(Je,void 0),Ve(null),Ue(""))},onCancelRejectionReason:()=>{Je&&(Ve(null),Ue(""))},onAddToAllowList:M,onImagesUpdated:$,onLogout:ut,onNewChat:k,onSummarize:H,onTransferToCloud:W,checkCloudAgentAccess:X,isCloudHandoffEnabled:!0,isSuggestingPlan:ne,planDecisionIndex:se,onPlanDecisionIndexChange:ie,onExecutePlan:te,onDiscardPlan:ce,onCancelPlanRevision:de,onRejectPlan:ae,onShowExistingPlan:ue,isPlanFromFileBlock:!!t.planFileBlock,onClearPlanFileBlock:pe,hasPlanToReview:!ne&&!!(null!==(Oe=(0,p.n6)(t))&&void 0!==Oe?Oe:e.getMetadata("currentPlanUri")),askQuestionPrompt:he,onAskQuestionSelectionChange:me,onAskQuestionSubmit:fe,onAskQuestionSkip:ve,switchModePrompt:ge,onSwitchModeDecisionIndexChange:xe,onSwitchModeApprove:be,onSwitchModeReject:ye,onSendQueuedNow:Ce,onCancelFirstQueued:Se,onPopLastForEdit:Ee,onClearPoppedForEdit:Te,onOpenMcpPager:u,onOpenSandboxPager:h,onOpenSkillsPager:d,inputDisabled:Ae,isOverlayActive:g,onBeforeExit:De,autoRunAvailability:Re})]},"prompt")]})},Ue=e=>{var t,n,o;const{mode:l,viewMode:T,setViewMode:P,changedFiles:A,currentModel:R,pendingDecisions:L,agentStore:z,setAgentStore:N,setIsGenerating:B,setIsSummarizing:q,isSummarizing:G,inputValue:K,setInputValue:J,setQueuedMessages:Z}=(0,Q.C9)(),[ee,ne]=(0,S.useState)((()=>(0,p.Du)())),[oe,re]=(0,S.useState)(!1),[$e,Ie]=(0,S.useState)("connected"),De=(0,Q.tO)(),{registerCommand:ze,unregisterCommand:Ue}=(0,V.x)(),Be=(0,S.useMemo)((()=>{const e=process.cwd(),t=(0,Ce.ky)(e);return t!==e||(0,i.existsSync)(a().join(e,".git"))?t:e}),[]),{commands:qe,findSkillReferences:He}=(0,me.d)({credentialManager:e.credentialManager,configProvider:e.configProvider,modelManager:e.modelManager,mcpLoader:e.mcpLoader,disabledStore:e.disabledStore,dashboardClient:e.dashboardClient,sandboxDefaultEnabled:e.sandboxDefaultEnabled,workspacePath:Be}),[,We]=(0,S.useState)(null),[Ge,Xe]=(0,S.useState)(null),[Ke,Qe]=(0,S.useState)(0),[Je,Ve]=(0,S.useState)(0),Ze=(0,S.useCallback)((()=>{(0,le.debugLog)("plan.handleClearPlanFileBlock.called"),ne((e=>(0,p.W5)(e)))}),[]),et=(0,S.useMemo)((()=>new xe.y({getIsAutoRun:()=>"auto-run"===z.getMetadata("mode"),autoRunControlsProvider:e.teamSettingsService,configProvider:e.configProvider,sandboxDefaultEnabled:e.sandboxDefaultEnabled})),[z,e.teamSettingsService,e.configProvider,e.sandboxDefaultEnabled]),[tt,nt]=(0,S.useState)(null),ot=(0,S.useRef)(!1),rt=(0,S.useRef)(void 0),st=(0,S.useRef)(z),it=(0,S.useRef)(ee),lt=(0,S.useRef)(null),at=(0,S.useRef)(null);(0,S.useEffect)((()=>{(0,de.ln)({agentMode:z.getMetadata("mode"),conversationId:z.getId(),conversationCreatedAt:z.getMetadata("createdAt"),turnCount:z.getConversationStateStructure().turns.length,isHeadless:!1})}),[z]);const ct=(0,S.useRef)(void 0),dt=(0,S.useRef)(!1),ut=(0,S.useRef)(!1),pt=(0,S.useRef)([]),ht=(0,S.useRef)(null),gt=(0,S.useRef)(void 0),[mt]=(0,S.useState)((()=>new Pe.k(e.fileChangeTracker))),ft=(0,S.useRef)(null),vt=(0,S.useRef)(z.getMetadata("mode")),xt=(0,S.useRef)(null),bt=(0,S.useRef)(null),yt=(0,S.useCallback)((()=>(0,Ae.GK)(it.current.completedTurns.length)),[]),wt=(0,S.useCallback)((()=>{const e=crypto.randomUUID();bt.current=e;const t=(0,Ae.Io)(yt(),e);xt.current=t}),[yt]),jt=(0,S.useCallback)(((e,t)=>{const n=xt.current;n&&((0,Ae.WF)(n,e,t),xt.current=null)}),[]),kt=(0,S.useMemo)((()=>Ge?{targetModeId:Ge.args.targetModeId,explanation:Ge.args.explanation,decisionIndex:Ke}:null),[Ge,Ke]),Ct=(0,S.useMemo)((()=>tt?{args:tt.args,selection:tt.selection,isAsync:tt.isAsync}:null),[tt]),St=(0,S.useRef)(0),Et=(0,S.useRef)((0,s.randomUUID)()),Mt=(0,S.useRef)(!1),$t=(0,S.useRef)(void 0);(0,S.useEffect)((()=>{$t.current=new ke.Ko(Be,z.getId(),z.getBlobStore())}),[Be,z]);const Tt=(0,S.useRef)(null);(0,S.useEffect)((()=>{const t=new ie.Z({conversationId:z.getId(),workspacePath:Be,backendUrl:e.backendUrl,credentialManager:e.credentialManager,configProvider:e.configProvider,teamSettingsService:e.teamSettingsService,insecure:e.insecure});return Tt.current=t,t.updateConversationMeta({lastUpdatedAt:Date.now(),model:z.getMetadata("lastUsedModel"),mode:z.getMetadata("mode"),title:z.getMetadata("name")}),t.startPolling(),()=>{Tt.current=null,t.dispose()}}),[z,e.backendUrl,e.configProvider,e.credentialManager,e.insecure,e.teamSettingsService,Be]);const It=(0,S.useRef)(null);(0,S.useEffect)((()=>{const t=new se.CliCommitScoringService({workspacePath:Be,backendUrl:e.backendUrl,credentialManager:e.credentialManager,configProvider:e.configProvider,teamSettingsService:e.teamSettingsService,insecure:e.insecure});return It.current=t,t.startPolling(),()=>{It.current=null,t.dispose()}}),[e.backendUrl,e.configProvider,e.credentialManager,e.insecure,e.teamSettingsService,Be]);const Pt=(0,S.useMemo)((()=>{var e;return G?((0,le.debugLog)("processingType isSummarizing",G),"summary"):void 0!==ee.pendingTurn&&("agent"===ee.pendingTurn.type?"plan"!==(null===(e=ee.pendingTurn.pendingState)||void 0===e?void 0:e.type)&&"agent":"shell"===ee.pendingTurn.type&&"shell")}),[G,ee.pendingTurn]);(0,S.useEffect)((()=>{ot.current=Pt}),[Pt]),(0,S.useEffect)((()=>{st.current=z}),[z]),(0,S.useEffect)((()=>{it.current=ee}),[ee]),(0,S.useEffect)((()=>{"plan"!==l&&(vt.current=l)}),[l]),(0,S.useEffect)((()=>{lt.current=Ge}),[Ge]),(0,S.useEffect)((()=>{at.current=tt}),[tt]);const[At,Dt]=(0,S.useState)(!1),[_t,Rt]=(0,S.useState)(0),{stdout:Lt}=(0,m.t$)(),{exit:Ot}=(0,m.nm)(),Yt=(0,S.useCallback)((e=>_e(void 0,void 0,void 0,(function*(){const{promise:t,resolve:n}=Promise.withResolvers();return Dt(!0),setTimeout((()=>_e(void 0,void 0,void 0,(function*(){yield e(),(0,I.m)(Lt),setTimeout((()=>{Dt(!1),n()}),10)}))),10),t}))),[Lt]),Ft=(0,S.useCallback)((e=>{Yt((()=>{P(e)}))}),[Yt,P]),zt=(0,te.cb)();(0,S.useEffect)((()=>{const e={id:"sync-theme",title:"Sync Theme",description:"Re-detect terminal theme and refresh UI",run:(e,t,n)=>_e(void 0,void 0,void 0,(function*(){var e,t,o;null===(e=n.clearInput)||void 0===e||e.call(n);try{yield zt(),yield Yt((()=>{})),null===(t=n.print)||void 0===t||t.call(n,[[{text:"Theme synced.",color:"green"}]])}catch(e){null===(o=n.print)||void 0===o||o.call(n,[[{text:"Failed to sync theme.",color:"red"}]])}n.insertText("")}))};return ze(e),()=>Ue("sync-theme")}),[ze,Ue,zt,Yt]),(0,S.useEffect)((()=>{const e={id:"cube",title:"Spinning Cube",description:"Show full-screen spinning cube overlay",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),Yt((()=>re(!0)))}};return ze(e),()=>Ue("cube")}),[ze,Ue,Yt]),(0,S.useEffect)((()=>{const e=z.getMetadata("name");(0,Te.iq)(e)?(0,Te.Bp)(e):(0,Te.cu)()}),[z]);const Nt=(0,te.pW)(),Ut=(0,S.useRef)(null);(0,he.H)((()=>{Ut.current!==Nt&&(null!==Ut.current&&Yt((()=>{})),Ut.current=!!Nt)}),[Nt]),(0,he.H)((()=>{Dt(!0),(0,I.m)(Lt),setTimeout((()=>{Dt(!1)}),10)}),[De]);const[Bt,qt]=(0,S.useState)([]),[Ht,Wt]=(0,S.useState)(null),[Gt,Xt]=(0,S.useState)(!1),[Kt,Qt]=(0,S.useState)(0);(0,S.useEffect)((()=>{ee.pendingTurn&&Wt(null)}),[ee.pendingTurn]);const[Jt,Vt]=(0,S.useState)([]),Zt=Pt&&void 0!==ee.pendingTurn&&"agent"===ee.pendingTurn.type&&"plan"!==(null===(t=ee.pendingTurn.pendingState)||void 0===t?void 0:t.type)&&0===L.length;(0,S.useEffect)((()=>{B(Zt)}),[Zt,B]);const[en,tn]=(0,S.useState)(null);(0,S.useEffect)((()=>{const e=()=>{ct.current?ct.current.abort("user_sigint"):"review"!==T?(0,ce.GZ)({code:ce.yU.SUCCESS}):P("chat")};return process.on("SIGINT",e),()=>{process.off("SIGINT",e)}}),[T,P]);const[nn,on]=(0,S.useState)((()=>{const t=e.agentStore.getMetadata("resumeBcId");return"string"==typeof t&&t.length>0?(e.agentStore.setMetadata("mode","background"),e.agentStore.setMetadata("resumeBcId",""),t):null})),[rn,sn]=(0,S.useState)(!1),[ln,an]=(0,S.useState)(!1),[cn,dn]=(0,S.useState)("rules"),[un,pn]=(0,S.useState)("list"),[hn,gn]=(0,S.useState)(null),[mn,fn]=(0,S.useState)(void 0),vn=(0,S.useCallback)((()=>{dn("rules"),pn("list"),gn(null),fn(void 0),an(!0)}),[]),xn=(0,S.useCallback)((()=>{dn("commands"),pn("list"),gn(null),fn(void 0),an(!0)}),[]),bn=(0,S.useCallback)((()=>{dn("skills"),pn("list"),gn(null),fn(void 0),an(!0)}),[]),yn=(0,S.useCallback)((()=>{Yt((()=>{an(!1),pn("list"),gn(null),fn(void 0)}))}),[Yt]),[wn,jn]=(0,S.useState)(!1),kn=(0,S.useCallback)((()=>{jn(!0)}),[]),[Cn,Sn]=(0,S.useState)(!1),En=(0,S.useCallback)((()=>{Sn(!0)}),[]),[Mn,$n]=(0,S.useState)(!1),[Tn,In]=(0,S.useState)([]),Pn=(0,S.useCallback)((e=>{In(e),$n(!0)}),[]),{sendToBackground:An,sendFollowupToBackground:Dn,transferToCloud:_n,cancelTransfer:Rn,isSubmitting:Ln,isTransferring:On,transferStatus:Yn}=(0,ge.$)(e.backgroundComposerClient),Fn=(0,S.useCallback)((e=>_e(void 0,void 0,void 0,(function*(){if(Ln)return;if(nn)return void(yield Dn(nn,e,{source:C._bo.CLI}));const t=yield An(e);if("success"===t.type){const e=t.bcId;(0,I.m)(Lt),on(e),J(""),qt([])}}))),[nn,Ln,Dn,An,J,Lt]),zn=(0,pe._)(),Nn=(0,S.useCallback)((t=>_e(void 0,void 0,void 0,(function*(){if(On)return;(0,le.debugLog)("handleTransferToCloud: starting",{message:t});const n=e.ctx.withName("chat.transfer-to-cloud"),o={confirm:zn.askConfirm},r=yield _n(n,z,o,t);if("success"===r.type)return(0,le.debugLog)("handleTransferToCloud: success",r.bcId),Dt(!0),J(""),qt([]),void setTimeout((()=>{const e=`https://cursor.com/agents/${r.bcId}`;(0,X.p2)(`\n  [90mOpen Cloud Agent in:[0m [1m[36m${e}[0m`),r.worktreeBranch&&(0,X.p2)(`\n  [90mCloud agent will work on branch:[0m [36m${r.worktreeBranch}[0m`),(0,X.p2)("\n"),Ot(),(0,ce.GZ)({code:ce.yU.SUCCESS})}),100);"cancelled"===r.type?((0,le.debugLog)("handleTransferToCloud: cancelled",r.reason),(0,ae.ET)([{text:"Transfer cancelled: ",color:"yellow"},{text:r.reason,dim:!0}])):((0,le.debugLog)("handleTransferToCloud: error",r.message),(0,ae.ET)([{text:"✗ ",color:"red"},{text:r.message}]))}))),[On,e.ctx,zn.askConfirm,_n,z,Ot,J]),Un=(0,S.useCallback)((()=>_e(void 0,void 0,void 0,(function*(){try{return yield e.backgroundComposerClient.getBackgroundComposerUserSettings({}),{hasAccess:!0}}catch(e){return(0,le.debugLog)("checkCloudAgentAccess: error",e),{hasAccess:!1,setupUrl:"https://cursor.com/dashboard?tab=cloud-agents"}}}))),[e.backgroundComposerClient]),Bn=(0,S.useCallback)((()=>{const e=lt.current;if(!e)return;const t="plan"===vt.current?"default":vt.current,n=(0,Se.Kx)(e.args.targetModeId,t);z.setMetadata("mode",n),e.resolve(d.x1.switchModeApproved(e.queryId)),Xe(null),Qe(0)}),[z]),qn=(0,S.useCallback)((()=>{const e=lt.current;e&&(e.resolve(d.x1.switchModeRejected(e.queryId,"Mode switch rejected by user")),Xe(null),Qe(0))}),[]),Hn=(0,S.useCallback)((e=>{nt((t=>{if(!t)return t;const n=Object.assign(Object.assign({},t),{selection:e});return at.current=n,n}))}),[]),Wn=(0,S.useCallback)((t=>_e(void 0,void 0,void 0,(function*(){const n={stack:[],error:void 0,hasError:!1};try{const o=Re(n,(0,h.VI)(e.ctx.withName("chat.ask-question.async")),!1).ctx,r=ct.current;if(r)try{return void(yield r.submitConversationAction(t))}catch(e){}const s=gt.current;if(s)try{yield s(o,t)}catch(e){(0,ae.ET)([{text:"Failed to deliver your answer: ",color:"red"},{text:e instanceof Error?e.message:String(e),dim:!0}])}else(0,X.p2)("Could not deliver your answer (session may have ended).\n")}catch(e){n.error=e,n.hasError=!0}finally{Le(n)}}))),[e.ctx]),Gn=(0,S.useCallback)((()=>{const e=at.current;if(!e)return;const t=(0,Se.iX)(e.args,e.selection);if(e.isAsync){const n=new f.ConversationAction({action:{case:"asyncAskQuestionCompletionAction",value:new f.AsyncAskQuestionCompletionAction({originalToolCallId:e.toolCallId,originalArgs:e.args,result:t})}});Wn(n)}else e.resolve&&e.resolve(d.x1.askQuestion(e.queryId,t));nt(null)}),[Wn]),Xn=(0,S.useCallback)((()=>{const e=at.current;if(!e)return;const t=(0,Se.N$)("Questions skipped by user");if(e.isAsync){const n=new f.ConversationAction({action:{case:"asyncAskQuestionCompletionAction",value:new f.AsyncAskQuestionCompletionAction({originalToolCallId:e.toolCallId,originalArgs:e.args,result:t})}});Wn(n)}else e.resolve&&e.resolve(d.x1.askQuestion(e.queryId,t));nt(null)}),[Wn]),Kn=(0,S.useCallback)(((e,t=!1,n=null,o,r)=>{var s;const i=null!==(s=null==n?void 0:n.turns.length)&&void 0!==s?s:0;let l=null;!t&&n&&z.handleCheckpoint(e,n),ne((e=>{var n;let s=e;const a=ft.current;if(e.pendingTurn){const t=e.pendingTurn,{changes:n,alreadyFinalized:i}=a?mt.finalizeTurn(a):{changes:[],alreadyFinalized:!1};i||"agent"!==t.type||Oe({turnFileChanges:n,steps:t.completedSteps,endReason:o,liveTokens:e.liveTokens,requestStartTime:en,logCliTurnOutcome:jt,error:r});const l=(0,p.RN)(e,"user_aborted"===o?p.ZY.USER_CANCELLED:p.ZY.SYSTEM_INTERRUPTED);s=(0,p.Gv)(l)}else if(a){const{changes:t,alreadyFinalized:n}=mt.finalizeTurn(a);if(!n){const n=e.completedTurns.at(-1);"agent"===(null==n?void 0:n.type)&&Oe({turnFileChanges:t,steps:n.steps,endReason:o,liveTokens:e.liveTokens,requestStartTime:en,logCliTurnOutcome:jt,error:r})}}const c=e.pendingTurn?s:(0,p.RN)(s,"user_aborted"===o?p.ZY.USER_CANCELLED:p.ZY.SYSTEM_INTERRUPTED);if((0,le.debugLog)(`stopUiConversation: hasReceivedCheckpoint: ${t}, numTurns: ${i}, abortedState.completedTurns.length: ${c.completedTurns.length}, abortedState.pendingTurn: ${c.pendingTurn?"true":"false"}`),t)return c;if(i<c.completedTurns.length+(c.pendingTurn?1:0)){const e=null!==(n=c.pendingTurn)&&void 0!==n?n:c.completedTurns[c.completedTurns.length-1];return"agent"===(null==e?void 0:e.type)&&(l=e.userMessage),(0,le.debugLog)(`stopUiConversation: truncating, lastTurn: ${null==e?void 0:e.type}, restoredInput: ${l}`),(0,p.P4)(c,i)}return c})),setImmediate((()=>{if(l){const e=l;J((t=>t?`${e}\n${t}`:e)),Qt((e=>e+1))}})),q(!1),"true"===process.env.AGENT_CLI_EXIT_ON_COMPLETION&&(0,ce.JZ)({code:ce.yU.SUCCESS,delayMs:10})}),[z,jt,en,J,q,mt.finalizeTurn]),Qn=(0,S.useCallback)(((t,n)=>_e(void 0,void 0,void 0,(function*(){var o,r,u,m,v,y,w;if("background"===l&&"userMessageAction"===n.action.case){const e=null===(o=n.action.value.userMessage)||void 0===o?void 0:o.text;return void(e&&(yield Fn(e)))}const C=Date.now();tn(C),R&&z.setMetadata("lastUsedModel",R.modelId);const S=Et.current;let M=!1,$=!1,T=!1,I=!1;const P=z.getConversationStateStructure().clone(),[A,D]=t.withCancel(),_=new d.hg;_.addAbortCallback((()=>{var n,o,r,s,i;I=!0,D();const l=lt.current;l&&(l.resolve(d.x1.switchModeRejected(l.queryId,"Aborted by user")),Xe(null),Qe(0));const a=at.current;if(a&&(a.resolve&&a.resolve(d.x1.askQuestion(a.queryId,(0,Se.N$)("Aborted by user"))),nt(null)),dt.current){(0,le.debugLog)("[abort] Skipping cleanup (send-now)");const e=it.current.pendingTurn;"agent"===(null==e?void 0:e.type)&&jt("cancelled")}else{if((0,le.debugLog)("[abort] Running abort cleanup"),Z([]),pt.current=[],ht.current=null,"agent"===ot.current){const e=ut.current;ut.current=!1,Kn(t,$||e,P,"user_aborted")}else ut.current=!1;e.hookExecutor&&e.hooksConfig&&((null===(o=null===(n=e.hooksConfig.userHooks)||void 0===n?void 0:n.hooks.stop)||void 0===o?void 0:o.length)||(null===(s=null===(r=e.hooksConfig.projectHooks)||void 0===r?void 0:r.hooks.stop)||void 0===s?void 0:s.length))&&e.hookExecutor.executeHookForStep(g._E.stop,{conversation_id:z.getId(),generation_id:S,model:null!==(i=null==R?void 0:R.modelId)&&void 0!==i?i:"unknown",status:"aborted",loop_count:St.current}).catch((e=>{(0,le.debugLog)("[hooks] Stop hook error on abort:",e)}))}}));const L={handleCheckpoint:(e,t)=>_e(void 0,void 0,void 0,(function*(){var n,o;if(I)return;$=!0,null===(n=$t.current)||void 0===n||n.writeFromState(e,t);const r=yield z.handleCheckpoint(e,t);return null===(o=Tt.current)||void 0===o||o.updateConversationMeta({lastUpdatedAt:Date.now(),model:z.getMetadata("lastUsedModel"),mode:z.getMetadata("mode"),title:z.getMetadata("name")}),r})),getLatestCheckpoint:()=>z.getLatestCheckpoint()};try{const o={sendUpdate:(e,n)=>_e(void 0,void 0,void 0,(function*(){if(!I)if(ne((e=>{try{return(0,p.as)(e,n)}catch(t){if(t instanceof p.VX)return e;throw t}})),"summaryStarted"!==n.message.case){if("heartbeat"!==n.message.case)if("summaryCompleted"!==n.message.case){if("textDelta"!==n.message.case&&"tokenDelta"!==n.message.case)if("turnEnded"!==n.message.case){if("userMessageAppended"===n.message.case){const e=n.message.value.userMessage;return e&&_.markMessageAsProcessed(e),void Z([])}if("toolCallStarted"!==n.message.case&&"partialToolCall"!==n.message.case){if("thinkingDelta"!==n.message.case&&"thinkingCompleted"!==n.message.case)return"summary"===n.message.case?(Yt((()=>{})),void q(!1)):void 0;M||(M=!0,(0,h.HF)(t,"token_counts_visible"))}else if("toolCallStarted"===n.message.case){const e=n.message.value.toolCall;if(!e)return;(0,E.sx)("cli.request.tools.used",{tool:e.tool.case||"unknown",count:1})}}else ne((e=>{const t=(0,p.Gv)(e);return void 0===t.pendingTurn&&(T=!0),t}))}else q(!1)}else q(!0)})),query:(t,n)=>_e(void 0,void 0,void 0,(function*(){var t,o,r,s,l,c;switch(n.query.case){case"webSearchRequestQuery":{const o=n.query.value.args;if(!o)return d.x1.webSearchRejected(n.id,"Missing web search arguments");const r=yield et.requestWebSearchApproval({allowPrompt:!0,onPrompt:()=>e.pendingDecisionStore.requestWebSearchApproval(o)});return r.approved?d.x1.webSearchApproved(n.id):d.x1.webSearchRejected(n.id,null!==(t=r.reason)&&void 0!==t?t:"User Rejected")}case"webFetchRequestQuery":{const t=n.query.value.args;if(!t)return d.x1.webFetchRejected(n.id,"Missing web fetch arguments");const i=yield et.requestWebFetchApproval({args:t,skipApproval:!0===n.query.value.skipApproval,permissionsAllow:null!==(r=null===(o=e.configProvider.get().permissions)||void 0===o?void 0:o.allow)&&void 0!==r?r:[],allowPrompt:!0,onPrompt:()=>e.pendingDecisionStore.requestWebFetchApproval(t)});return i.approved?d.x1.webFetchApproved(n.id):d.x1.webFetchRejected(n.id,null!==(s=i.reason)&&void 0!==s?s:"User Rejected")}case"switchModeRequestQuery":{if(lt.current||at.current)return d.x1.switchModeRejected(n.id,"Another interaction is already pending");const e=null!==(l=n.query.value.args)&&void 0!==l?l:new k.Bx;return yield new Promise((t=>{var o;Qe(0),Xe({queryId:n.id,toolCallId:null!==(o=e.toolCallId)&&void 0!==o?o:"",args:e,resolve:t})}))}case"askQuestionInteractionQuery":{const e=n.query.value;if(!e)return d.x1.askQuestion(n.id,(0,Se.N$)("Missing ask-question query"));if(lt.current||at.current)return d.x1.askQuestion(n.id,(0,Se.N$)("Another interaction is already pending"));const t=e.args;if(!t)return d.x1.askQuestion(n.id,(0,Se.N$)("Missing ask-question arguments"));const o=null!==(c=t.runAsync)&&void 0!==c&&c,r=(0,Se.AX)(t);return o?(nt({queryId:n.id,toolCallId:e.toolCallId,args:t,isAsync:!0,selection:r}),d.x1.askQuestion(n.id,new x.tz({result:{case:"async",value:new x.yt}}))):yield new Promise((o=>{nt({queryId:n.id,toolCallId:e.toolCallId,args:t,resolve:o,isAsync:!1,selection:r})}))}case"createPlanRequestQuery":{const e=n.query.value.args;if(!e)return d.x1.createPlan(n.id,new b.bK({result:{case:"success",value:new b.Jo},planUri:""}));let t="";try{const n=process.cwd(),o=(0,Ce.ky)(n),r=o!==n||(0,i.existsSync)(a().join(n,".git"))?o:void 0,s=z.getId();t=(yield(0,Ee.IB)({args:e,workspaceRoot:r,conversationId:s})).planUri,z.setMetadata("currentPlanUri",t)}catch(e){console.error("[CLI] Failed to create plan file:",e instanceof Error?e.message:e)}const o=new b.bK({result:{case:"success",value:new b.Jo},planUri:t});return d.x1.createPlan(n.id,o)}case"setupVmEnvironmentArgs":{const e=new j.r$({result:{case:"success",value:new j.JH}});return d.x1.setupVmEnvironment(n.id,e)}case"prManagementRequestQuery":return d.x1.prManagement(n.id,(0,d.p_)());case"mcpAuthRequestQuery":return d.x1.mcpAuthRejected(n.id,"MCP authentication is not supported in CLI mode");case void 0:throw new Error("Missing interaction query type");default:throw new Error("Unhandled interaction query type")}}))};try{rt.current=D,ct.current=_;const s=()=>{var e;ne((e=>(0,Me.fu)(e)));const t=lt.current;t&&(t.resolve(d.x1.switchModeRejected(t.queryId,"Retrying")),lt.current=null,Xe(null),Qe(0));const n=at.current;n&&(null===(e=n.resolve)||void 0===e||e.call(n,d.x1.askQuestion(n.queryId,(0,Se.N$)("Retrying"))),at.current=null,nt(null))};yield Promise.all([(0,c.Oe)(t,n,e.resources),(0,fe.w)(n)]),yield e.agentClient.run(A,z.getConversationStateStructure(),n,yield e.modelManager.awaitCurrentModel(),o,e.resources,z.getBlobStore(),_,L,[],{conversationId:z.getId(),generationUUID:null!==(r=bt.current)&&void 0!==r?r:void 0,headers:e.headers,customSystemPrompt:e.customSystemPrompt,enableAgentRetries:(0,Me.w5)(e.enableRetries,n.action.case),onStall:(0,de.M4)(z.getId(),{actionType:n.action.case,execId:"shellCommandAction"===n.action.case?n.action.value.execId:void 0}),onRetryStarting:(e,t)=>_e(void 0,void 0,void 0,(function*(){s()})),onRetryResuming:e=>_e(void 0,void 0,void 0,(function*(){})),onConnectionStateChange:e=>{Ie(e.state)}})}finally{rt.current=void 0,dt.current||Ie("connected"),ct.current===_&&(ct.current=void 0)}ne((e=>{const t=T?e:(0,p.Gv)(e),n=t.completedTurns.at(-1);if("agent"===(null==n?void 0:n.type))try{const e=ft.current,{changes:o,alreadyFinalized:r}=e?mt.finalizeTurn(e):{changes:[],alreadyFinalized:!1};r||Oe({turnFileChanges:o,steps:n.steps,endReason:"success",liveTokens:t.liveTokens,requestStartTime:en,logCliTurnOutcome:jt})}catch(e){}return t})),(0,de.ln)({turnCount:z.getConversationStateStructure().turns.length});const l=()=>_e(void 0,void 0,void 0,(function*(){var t,n,o,r,i;if(e.hookExecutor&&e.hooksConfig&&((null===(n=null===(t=e.hooksConfig.userHooks)||void 0===t?void 0:t.hooks.stop)||void 0===n?void 0:n.length)||(null===(r=null===(o=e.hooksConfig.projectHooks)||void 0===o?void 0:o.hooks.stop)||void 0===r?void 0:r.length)))try{const t=yield e.hookExecutor.executeHookForStep(g._E.stop,{conversation_id:z.getId(),generation_id:S,model:null!==(i=null==R?void 0:R.modelId)&&void 0!==i?i:"unknown",status:"completed",loop_count:St.current});if(t&&"string"==typeof t.followup_message&&t.followup_message.trim().length>0){const e=t.followup_message;St.current+=1,(0,le.debugLog)(`[hooks] Stop hook returned followup_message, queueing (loop ${St.current})`);const n=new f.ConversationAction({action:{case:"userMessageAction",value:new f.UserMessageAction({userMessage:new f.UserMessage({text:e,messageId:(0,s.randomUUID)()})})}});pt.current.push({action:n,display:e.slice(0,100)+(e.length>100?"...":"")}),Z(pt.current.map((e=>e.display)))}}catch(e){(0,le.debugLog)("[hooks] Stop hook error:",e)}}));yield l()}catch(n){if(dt.current)throw n;throw Kn(t,$,P,"error",n),e.hookExecutor&&e.hooksConfig&&((null===(m=null===(u=e.hooksConfig.userHooks)||void 0===u?void 0:u.hooks.stop)||void 0===m?void 0:m.length)||(null===(y=null===(v=e.hooksConfig.projectHooks)||void 0===v?void 0:v.hooks.stop)||void 0===y?void 0:y.length))&&e.hookExecutor.executeHookForStep(g._E.stop,{conversation_id:z.getId(),generation_id:S,model:null!==(w=null==R?void 0:R.modelId)&&void 0!==w?w:"unknown",status:"error",loop_count:St.current}).catch((e=>{(0,le.debugLog)("[hooks] Stop hook error on error:",e)})),n}yield _e(void 0,["chat.queued"],void 0,(function*(t="chat.queued"){const n={stack:[],error:void 0,hasError:!1};try{if(ct.current)return;const o=pt.current[0];if(!o)return;const r=gt.current;if(!r)return void(0,de.Dy)({category:"queue_processing",waitingFor:"queue_item_processing",conversationId:z.getId(),extra:{queueLength:pt.current.length,queuedActionType:o.action.action.case,sendConversationActionRefUndefined:!0}},"error");const s=pt.current.shift();if(!s)return;Z(pt.current.map((e=>e.display)));const i=`turn-${Date.now()}`;ft.current=i,mt.startTurn(i),ne((e=>(0,p.HG)(e,s.display)));const l=Re(n,(0,h.VI)(e.ctx.withName(t)),!1);wt(),yield r(l.ctx,s.action)}catch(e){n.error=e,n.hasError=!0}finally{Le(n)}}))}))),[z,z.getId,R,l,e.resources,e.modelManager.awaitCurrentModel,e.agentClient.run,Fn,Yt,q,Z,wt,Kn,mt.startTurn,mt.finalizeTurn,jt,en,e.headers,e.customSystemPrompt,e.ctx.withName,e.pendingDecisionStore.requestWebSearchApproval,e.pendingDecisionStore.requestWebFetchApproval,et,e.hookExecutor,e.hooksConfig,e.configProvider.get,e.enableRetries]);(0,S.useEffect)((()=>(gt.current=Qn,()=>{gt.current=void 0})),[Qn]);const Jn=(0,S.useCallback)(((t,n)=>_e(void 0,void 0,void 0,(function*(){var o,r,i,a,c,d,u,m,x,b,j,k,C;const S={stack:[],error:void 0,hasError:!1};try{const M=Re(S,(0,h.VI)(e.ctx.withName("chat.request")),!1).ctx,$=null!==(o=null==n?void 0:n.display)&&void 0!==o?o:t,{skills:T}=He(t),I=[...T.map((e=>{const t=new y.DX({fullPath:e.path,content:Ye(e.content),type:new y.f5({type:{case:"manuallyAttached",value:new y._u}})});return new w.G4({rule:t})})),...null!==(r=null==n?void 0:n.cursorRules)&&void 0!==r?r:[]],P=ht.current;if(P){ht.current=null;const e="userMessageAction"===P.action.action.case?null===(a=null===(i=P.action.action.value)||void 0===i?void 0:i.userMessage)||void 0===a?void 0:a.selectedContext:void 0,o=new f.ConversationAction({action:{case:"userMessageAction",value:new f.UserMessageAction({userMessage:new f.UserMessage({text:t,selectedContext:e,messageId:crypto.randomUUID()})})}});if(ct.current)return pt.current.push({action:o,display:null!==(c=null==n?void 0:n.display)&&void 0!==c?c:t}),Z(pt.current.map((e=>e.display))),J(""),void qt([]);const r=`turn-${Date.now()}`;return ft.current=r,mt.startTurn(r),wt(),ne((e=>{var o;return(0,p.HG)(e,null!==(o=null==n?void 0:n.display)&&void 0!==o?o:t)})),void(yield Qn(M,o))}St.current=0;const A=(0,s.randomUUID)();if(Et.current=A,!t.trim())return;if("background"===l||ct.current||void 0!==it.current.pendingTurn?Wt(null):Wt($),e.hookExecutor&&e.hooksConfig&&((null===(u=null===(d=e.hooksConfig.userHooks)||void 0===d?void 0:d.hooks.beforeSubmitPrompt)||void 0===u?void 0:u.length)||(null===(x=null===(m=e.hooksConfig.projectHooks)||void 0===m?void 0:m.hooks.beforeSubmitPrompt)||void 0===x?void 0:x.length)))try{const n=yield e.hookExecutor.executeHookForStep(g._E.beforeSubmitPrompt,{conversation_id:z.getId(),generation_id:A,model:null!==(b=null==R?void 0:R.modelId)&&void 0!==b?b:"unknown",prompt:t,attachments:[]});if(n&&!1===n.continue){Wt(null);const e=null!==(j=n.user_message)&&void 0!==j?j:"A beforeSubmitPrompt hook blocked this submission.";return(0,le.debugLog)(`[hooks] beforeSubmitPrompt blocked: ${e}`),void(0,ae.ET)([[{text:e,color:"yellow"}]])}}catch(e){(0,le.debugLog)("[hooks] beforeSubmitPrompt error:",e)}if((0,E.sx)("cli.request.create",{length:t.length,model:(null==R?void 0:R.modelId)||"unknown"}),"background"===l)return Wt(null),void(yield Fn(t));if(ct.current){Wt(null);const e=$,o=new w.xv({selectedImages:Bt.map((e=>new w.d({path:e.path}))),cursorRules:I}),r=null!==(k=null==n?void 0:n.mode)&&void 0!==k?k:l,s=(0,Se.cT)(r),i=new f.ConversationAction({action:{case:"userMessageAction",value:new f.UserMessageAction({userMessage:new f.UserMessage({text:t,selectedContext:o,messageId:crypto.randomUUID(),mode:s})})}});return pt.current.push({action:i,display:e}),Z(pt.current.map((e=>e.display))),J(""),void qt([])}if(0===it.current.completedTurns.length){const n=z.getId();e.aiServerClient.nameAgent(new v.Il({userMessage:t})).then((e=>{z.setMetadata("name",e.name),(0,Te.iq)(e.name)&&st.current.getId()===n&&(0,Te.Bp)(e.name)})).catch((e=>{(0,le.debugLog)(e)}))}const D=`turn-${Date.now()}`;ft.current=D,mt.startTurn(D),wt(),Wt(null),ne((e=>(0,p.HG)(e,$)));const _=new w.xv({selectedImages:Bt.map((e=>new w.d({path:e.path}))),cursorRules:I}),L=null!==(C=null==n?void 0:n.mode)&&void 0!==C?C:l,O=(0,Se.cT)(L),Y=new f.ConversationAction({action:{case:"userMessageAction",value:new f.UserMessageAction({userMessage:new f.UserMessage({text:t,selectedContext:_,messageId:crypto.randomUUID(),mode:O})})}});yield Qn(M,Y)}catch(e){S.error=e,S.hasError=!0}finally{Le(S)}}))),[z.getId,z.setMetadata,null==R?void 0:R.modelId,He,l,e.aiServerClient.nameAgent,e.ctx.withName,Bt,Fn,Qn,wt,J,Z,mt.startTurn,e.hookExecutor,e.hooksConfig]),Vn=(0,S.useCallback)((e=>{const t=K.trim();yn();const n=`/${e.name}`,{fullMessage:o,displayText:r}=(0,$.jI)(n,t||void 0);t?J(o):Jn(o.trim(),{display:r})}),[K,yn,J,Jn]),Zn=()=>_e(void 0,void 0,void 0,(function*(){ct.current&&ct.current.abort("abort_and_clear_pending"),e.pendingDecisionStore.clearAll()})),eo=(t,n)=>_e(void 0,void 0,void 0,(function*(){var o,r,i;e.fileChangeTracker.clear(),mt.cleanup(),N(t),null===(o=e.onAgentStoreChanged)||void 0===o||o.call(e,t);const l=t.getMetadata("name");if((0,Te.iq)(l)?(0,Te.Bp)(l):(0,Te.cu)(),n.loadFromDb)try{const n=yield t.getFullConversation(e.ctx);if("false"!==process.env.AGENT_CLI_LOAD_HISTORY){const e=(0,p.N1)(n);We(null!==(i=null===(r=n.summary)||void 0===r?void 0:r.summary)&&void 0!==i?i:"");const o=Fe(t,e);ne(o)}else ne((0,p.Du)()),We(null)}catch(e){ne((0,p.Du)())}else ne((0,p.Du)());Z([]),J(""),pt.current=[],ht.current=null,Xe(null),Qe(0),Ve(0),nt(null),St.current=0,Et.current=(0,s.randomUUID)()})),to=t=>_e(void 0,void 0,void 0,(function*(){try{Xt(!0),ne((0,p.Du)()),yield Zn(),yield z.dispose(),ye.d.clearLastRequest();const n=a().join((0,be.r)(),t),o=a().join(n,"store.db"),r=yield we.M.initAndLoad(o),s=new u.pH(r,r);yield s.resetFromDb(e.ctx);const i=yield s.getLastRequestIdFromConversation(e.ctx);i&&ye.d.recordLastRequest(i),yield eo(s,{loadFromDb:!0}),s.setMetadata("mode","default");const l=s.getMetadata("lastUsedModel");l&&(yield e.modelManager.setModelFromStoredId(l,e.configProvider))}finally{Xt(!1),pt.current=[],ht.current=null,St.current=0,Et.current=(0,s.randomUUID)()}})),no=(0,S.useCallback)((()=>_e(void 0,void 0,void 0,(function*(){var t;const n={stack:[],error:void 0,hasError:!1};try{const o=pt.current;if(0===o.length)return;const r=o.shift();Z(o.map((e=>e.display))),J(""),dt.current=!0,ht.current=null;try{ne((e=>(0,p.RN)(e,p.ZY.INTERRUPTED_BY_FOLLOWUP))),ct.current&&ct.current.abort("new_message_submitted");const e=()=>_e(void 0,void 0,void 0,(function*(){const e=Date.now();for(;void 0!==ct.current&&!(Date.now()-e>5e3);)yield new Promise((e=>setTimeout(e,50)))}));yield e()}finally{dt.current=!1}Ie("connected");const s=`turn-${Date.now()}`;ft.current=s,mt.startTurn(s),ne((e=>(0,p.HG)(e,r.display)));const i=Re(n,(0,h.VI)(e.ctx.withName("chat.queued-now")),!1);wt(),yield null===(t=gt.current)||void 0===t?void 0:t.call(gt,i.ctx,r.action)}catch(e){n.error=e,n.hasError=!0}finally{Le(n)}}))),[e.ctx,wt,mt,Z,J]),oo=(0,S.useCallback)((()=>{const e=pt.current;0!==e.length&&(e.shift(),Z(e.map((e=>e.display))))}),[Z]),ro=(0,S.useCallback)((()=>{const e=pt.current;if(0===e.length)return null;const t=e.pop();return Z(e.map((e=>e.display))),ht.current=t,t.display}),[Z]),so=(0,S.useCallback)((()=>{ht.current=null}),[]);(0,S.useEffect)((()=>{_e(void 0,void 0,void 0,(function*(){(0,le.debugLog)("Loading existing conversation");try{z.getConversationStateStructure().turns.length>0&&0===it.current.completedTurns.length&&Xt(!0);const t=yield z.getFullConversation(e.ctx);if("false"!==process.env.AGENT_CLI_LOAD_HISTORY&&(t.summary&&We(t.summary.summary),t.turns.length>0)){const e=(0,p.N1)(t),n=Fe(z,e);ne((e=>e.completedTurns.length>0||e.pendingTurn?e:n))}}finally{Xt(!1)}}))}),[z,e.ctx]),(0,S.useEffect)((()=>{e.prompt&&!Mt.current&&(Mt.current=!0,Jn(e.prompt))}),[e.prompt,Jn]);const{responses:io,status:lo,isLoadingDiffs:ao,addOptimisticFollowup:co,removeOptimisticFollowup:uo,modelDetails:po,isAttached:ho,isLoadingConversation:go,repoUrl:mo,branchName:fo,diffs:vo}=(0,ue.n)(e.backgroundComposerClient,null!=nn?nn:null),xo=(0,S.useCallback)((()=>{sn(!0)}),[]),bo=(0,S.useCallback)((()=>{Ft("review"),(0,E.sx)("cli.review.enter")}),[Ft]);(0,S.useEffect)((()=>{nn&&vo?((0,le.debugLogJSON)("Setting background review changes",vo),Vt(vo)):Vt([])}),[nn,vo]);const yo=(0,S.useMemo)((()=>{if(!nn)return!1;const e=(()=>{const e=io.bubbles;for(let t=e.length-1;t>=0;t--){const n=e[t];if("thinking"===n.type)return!n.isDone}return!1})(),t=(()=>{const e=io.bubbles;for(let t=e.length-1;t>=0;t--){const n=e[t];if("text"===n.type)return n}})();return e||t&&!t.isDone||lo===C.R6p.RUNNING||lo===C.R6p.CREATING}),[nn,io.bubbles,lo]);return oe?(0,r.jsx)(I.I,{clearScreenTrigger:_t,clearOnMount:!0,children:(0,r.jsx)(D.a,{onClose:()=>{Yt((()=>re(!1)))}})}):(0,r.jsxs)(I.I,{clearScreenTrigger:_t,clearOnMount:!1,children:[!At&&!rn&&!ln&&!Mn&&!wn&&!Cn&&"review"===T&&(0,r.jsx)(_.Z,{fileChangeTracker:e.fileChangeTracker,changes:nn?Jt:A,onExit:()=>{Ft("chat")},onSubmitPrompt:e=>{Jn(e)},initialSelectedIndex:(0,p.b)(ee,A),isGenerating:nn?yo:void 0}),!At&&rn&&!ln&&!Mn&&!wn&&!Cn&&(0,r.jsx)(H.W,{client:e.backgroundComposerClient,onClose:()=>{Yt((()=>{sn(!1)}))},onSelectBackground:t=>{e.isRepository?Yt((()=>{sn(!1),on(t),e.agentStore.setMetadata("mode","background")})):Yt((()=>{sn(!1)}))},onSelectChat:e=>{P("chat"),sn(!1),on(null),Yt((()=>{})).then((()=>to(e)))}}),!At&&ln&&!("skills"===cn&&"list"===un)&&(0,r.jsx)(O.g,{mode:cn,viewState:un,onViewStateChange:pn,viewingItemPath:null!=hn?hn:void 0,onViewingItemPathChange:gn,editContent:mn,onEditContentChange:fn,onClose:yn,onSelect:"skills"===cn?Vn:void 0}),!At&&Mn&&!ln&&(0,r.jsx)(W.z,{dailyMetrics:Tn,onClose:()=>{Yt((()=>{$n(!1)}))}}),!At&&wn&&(0,r.jsx)(Y.g,{ctx:e.ctx,mcpLoader:e.mcpLoader,disabledStore:e.disabledStore,onClose:()=>{Yt((()=>{jn(!1)}))}}),!At&&Cn&&(0,r.jsx)(U.J,{configProvider:e.configProvider,teamSettingsService:e.teamSettingsService,adminNetworkControlsEnabled:(0,je.QF)("admin_network_controls"),sandboxDefaultEnabled:e.sandboxDefaultEnabled,onClose:()=>{Yt((()=>{Sn(!1)}))}}),!At&&!rn&&!ln&&!Mn&&!wn&&!Cn&&"chat"===T&&nn&&(0,r.jsx)(M.y,{bcId:nn,isAttached:ho,backgroundComposerClient:e.backgroundComposerClient,isRepository:e.isRepository,debugInfo:e.debugInfo,modelManager:e.modelManager,responses:io,status:lo,isLoadingConversation:go,addOptimisticFollowup:co,removeOptimisticFollowup:uo,modelDetails:po,repoUrl:mo,branchName:fo,onRequestReview:()=>{Ft("review"),(0,E.sx)("cli.review.enter")},changes:Jt,isLoadingDiffs:ao,onOpenComposerPicker:()=>sn(!0),onSwitchComposer:t=>{(0,I.m)(Lt),on(t),e.agentStore.setMetadata("mode","background")}}),!At&&!rn&&(!ln||"skills"===cn&&"list"===un)&&!Mn&&!wn&&!Cn&&!nn&&"chat"===T&&(0,r.jsx)(Ne,Object.assign({},e,{uiConversationState:ee,optimisticUserMessage:Ht,onRequestReviewMode:bo,onOpenBackgroundPicker:xo,onOpenRulesPager:vn,onOpenCommandsPager:xn,onOpenUsagePager:Pn,onOpenSkillsPager:bn,onOpenMcpPager:kn,onOpenSandboxPager:En,isOverlayActive:zn.isActive,isProcessing:!!Pt,isSendingToBackground:Ln,isTransferring:On,transferStatus:Yn,sendMessage:Jn,sendShellCommand:t=>_e(void 0,void 0,void 0,(function*(){const n={stack:[],error:void 0,hasError:!1};try{const o=Re(n,(0,h.VI)(e.ctx.withName("chat.shell")),!1).ctx,r=crypto.randomUUID(),s=new f.ShellCommandAction({shellCommand:new f.ShellCommand({command:t}),execId:r});ne((e=>(0,p.Yb)(e,t))),yield Qn(o,new f.ConversationAction({action:{case:"shellCommandAction",value:s}}))}catch(e){n.error=e,n.hasError=!0}finally{Le(n)}})),executePlan:t=>_e(void 0,void 0,void 0,(function*(){var n,o;const r={stack:[],error:void 0,hasError:!1};try{const s=null!==(n=null==t?void 0:t.cloud)&&void 0!==n&&n,i=Re(r,(0,h.VI)(e.ctx.withName(s?"chat.execute-plan-cloud":"chat.execute-plan")),!1).ctx,l=`turn-${Date.now()}`;ft.current=l,mt.startTurn(l),wt(),ne((e=>{const t=(0,p.ti)(e);return(0,p.HG)(t,"Building plan...",{isPlanExecution:!0})}));const a="plan"===vt.current?"default":vt.current;z.setMetadata("mode",a);const c=z.getMetadata("currentPlanUri"),d=c&&null!==(o=(0,ve.X)(c))&&void 0!==o?o:"";if(s){if(!d)return(0,ae.ET)([{text:"✗ ",color:"red"},{text:"Could not read plan file. Build in Cloud requires the plan content."}]),void ne((e=>(0,p.Gv)(e)));if(nn){const e=`Execute this plan. Follow the todos and implement each step.\n\n---\nPlan:\n\n${d}\n---`;return yield Fn(e),void ne((e=>(0,p.Gv)(e)))}{const e=new f.ConversationAction({action:{case:"executePlanAction",value:new f.ExecutePlanAction({planFileUri:null!=c?c:"cursor-plan://plan.md",planFileContent:d,executionMode:f.AgentMode.AGENT})}}),t={confirm:zn.askConfirm},n=yield _n(i,z,t,void 0,e);"success"===n.type?(Dt(!0),J(""),qt([]),setTimeout((()=>{const e=`https://cursor.com/agents/${n.bcId}`;(0,X.p2)(`\n  [90mOpen Cloud Agent in:[0m [1m[36m${e}[0m`),n.worktreeBranch&&(0,X.p2)(`\n  [90mCloud agent will work on branch:[0m [36m${n.worktreeBranch}[0m`),(0,X.p2)("\n"),Ot(),(0,ce.GZ)({code:ce.yU.SUCCESS})}),100)):"cancelled"===n.type?((0,ae.ET)([{text:"Transfer cancelled: ",color:"yellow"},{text:n.reason,dim:!0}]),ne((e=>(0,p.Gv)(e)))):((0,ae.ET)([{text:"✗ ",color:"red"},{text:n.message}]),ne((e=>(0,p.Gv)(e))))}}else{const e=new f.ConversationAction({action:{case:"executePlanAction",value:new f.ExecutePlanAction({planFileUri:null!=c?c:"",planFileContent:d,executionMode:f.AgentMode.AGENT})}});yield Qn(i,e)}}catch(e){r.error=e,r.hasError=!0}finally{Le(r)}})),isSuggestingPlan:(0,p.OE)(ee),planDecisionIndex:ee.planFileBlock?Je:"agent"===(null===(n=ee.pendingTurn)||void 0===n?void 0:n.type)&&"plan"===(null===(o=ee.pendingTurn.pendingState)||void 0===o?void 0:o.type)?(0,p.II)(ee):Je,setPlanDecisionIndex:e=>{var t,n;ee.planFileBlock?Ve(e):"agent"===(null===(t=ee.pendingTurn)||void 0===t?void 0:t.type)&&"plan"===(null===(n=ee.pendingTurn.pendingState)||void 0===n?void 0:n.type)?ne((t=>(0,p.k4)(t,e))):Ve(e)},onAbort:()=>{On&&Rn(),ct.current&&ct.current.abort("user_cancelled")},isGenerating:Zt,unshownTokenEstimate:ee.liveTokens,onResumeChat:to,onNewChat:()=>_e(void 0,void 0,void 0,(function*(){yield Zn(),yield z.dispose(),ye.d.clearLastRequest();const t=(0,be.r)(),n=(0,s.randomUUID)(),o=a().join(t,n),r=a().join(o,"store.db"),i=new we.M(r);i.set("agentId",n);const l=new u.pH(i,i);yield eo(l,{loadFromDb:!1});const c=l.getMetadata("lastUsedModel");return yield e.modelManager.setModelFromStoredId(c,e.configProvider),St.current=0,Et.current=(0,s.randomUUID)(),yield Yt((()=>{})),n})),getChatId:()=>z.getId(),onImagesUpdated:e=>qt(e),isResumingChat:Gt,onSummarize:()=>_e(void 0,void 0,void 0,(function*(){(0,le.debugLog)("onSummarize"),q(!0);const t=e.ctx.withName("chat.summarize");yield Qn(t,new f.ConversationAction({action:{case:"summarizeAction",value:new f.SummarizeAction}}))})),onTransferToCloud:Nn,checkCloudAgentAccess:Un,onRejectPlan:()=>{ut.current=!0;const e=ee.planFileBlock;if(e){const t=(0,F.W)(e.planUri);ne((e=>t?(0,p.BR)(e,t):(0,p.W5)(e)))}else ne((e=>(0,p.bE)(e)))},onDiscardPlan:()=>{ne((e=>(0,p.cp)(e)))},onCancelPlanRevision:()=>{ne((e=>(0,p.dl)(e)))},onClearPlanFileBlock:Ze,onShowExistingPlan:()=>{(0,le.debugLog)("plan.onShowExistingPlan.called"),ne((e=>{const t=(0,p.n6)(e),n=z.getMetadata("currentPlanUri"),o=null!=t?t:n;return(0,le.debugLog)("plan.onShowExistingPlan",{planUriFromState:t,planUriFromMeta:n,planUri:o,hasPlanFileBlock:!!e.planFileBlock}),o?((0,le.debugLog)("plan.onShowExistingPlan.mergeShowPlanFileBlock",{planUri:o}),(0,p.Wm)(e,o)):((0,le.debugLog)("plan.onShowExistingPlan.noPlanUri"),e)}))},externalCursorToEndSignal:Kt,askQuestionPrompt:Ct,switchModePrompt:kt,onAskQuestionSelectionChange:Hn,onAskQuestionSubmit:Gn,onAskQuestionSkip:Xn,onSwitchModeDecisionIndexChange:Qe,onSwitchModeApprove:Bn,onSwitchModeReject:qn,mcpLoader:e.mcpLoader,shellManager:e.shellManager,onSendQueuedNow:no,onCancelFirstQueued:oo,onPopLastForEdit:ro,onClearPoppedForEdit:so,slashCommands:qe,inputDisabled:ln&&"skills"===cn&&"list"===un,connectionState:$e})),!At&&ln&&"skills"===cn&&"list"===un&&(0,r.jsx)(O.g,{mode:cn,viewState:un,onViewStateChange:pn,viewingItemPath:null!=hn?hn:void 0,onViewingItemPathChange:gn,editContent:mn,onEditContentChange:fn,onClose:yn,onSelect:Vn}),zn.element]})},Be=e=>{var t,n;return(0,S.useEffect)((()=>()=>{process.stdout.write("[?25h")}),[]),(0,r.jsx)(J.t1,{configProvider:e.configProvider,children:(0,r.jsx)(ne.l,{configProvider:e.configProvider,children:(0,r.jsx)(ee.rs,{children:(0,r.jsx)(V.E,{children:(0,r.jsx)(te.NP,{children:(0,r.jsx)(Z.S,{store:null!==(t=e.sudoPasswordStore)&&void 0!==t?t:null,children:(0,r.jsxs)(Q.oG,{fileChangeTracker:e.fileChangeTracker,pendingDecisionStore:e.pendingDecisionStore,configProvider:e.configProvider,initialViewMode:"chat",initialAgentStore:e.agentStore,modelManager:e.modelManager,children:[(0,r.jsx)(B.t,{store:null!==(n=e.sudoPasswordStore)&&void 0!==n?n:null}),(0,r.jsx)(Ue,Object.assign({},e))]})})})})})})})};o()}catch(qe){o(qe)}}))},"./src/utils/abort-label.ts":(e,t,n)=>{n.d(t,{E:()=>s,P:()=>r});var o=n("../agent-ui-state/dist/index.js");function r(e){return(0,o.t6)(e)?"Cancelled":(0,o._z)(e)?"Interrupted by follow-up":"Interrupted"}function s(e){return(0,o.t6)(e)?"Cancelled by user":(0,o._z)(e)?"Interrupted by follow-up message":"Interrupted"}},"./src/utils/auth-errors.ts":(e,t,n)=>{n.d(t,{hY:()=>i,lv:()=>l});var o=n("../../node_modules/.pnpm/@connectrpc+connect@1.6.1_patch_hash=a4b9a5e69295313832387f25b708426bcf53041a2f50bc7b95_a276813e7efa8e1efb8a7b0efc1d56a0/node_modules/@connectrpc/connect/dist/esm/connect-error.js"),r=n("../../node_modules/.pnpm/@connectrpc+connect@1.6.1_patch_hash=a4b9a5e69295313832387f25b708426bcf53041a2f50bc7b95_a276813e7efa8e1efb8a7b0efc1d56a0/node_modules/@connectrpc/connect/dist/esm/code.js"),s=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};class i extends Error{constructor(e="Your stored authentication is invalid. Please log in again.",t){super(e),this.cause=t,this.name="InvalidTokenError",Error.captureStackTrace&&Error.captureStackTrace(this,i)}}function l(e,t){return s(this,void 0,void 0,(function*(){if(function(e){if(e instanceof o.T)return e.code===r.C.Unauthenticated;if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("401")||t.includes("unauthorized")||t.includes("unauthenticated")||t.includes("authentication failed")||t.includes("invalid token")||t.includes("token expired")}return!1}(e)){try{yield t.clearAuthentication()}catch(e){}throw new i("Your stored authentication is invalid. Please log in again.",e)}throw e}))}},"./src/utils/characters.ts":(e,t,n)=>{function o(e){return e.replace(/\x1B(?:[@-Z\\-_]|\[[0-?]*[ -/]*[@-~]|\][^\u0007]*(?:\u0007|\x1b\\))/g,"")}function r(e){let t=String(null!=e?e:"");return t=o(t),t=t.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/g,""),t=t.replace(/[\u200B-\u200F\u202A-\u202E\u2060-\u206F\uFEFF]/g,""),t=function(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}(t),t.length>1e4&&(t=t.slice(0,1e4)),t}n.d(t,{aJ:()=>o,p3:()=>r})},"./src/utils/color-mixing.ts":(e,t,n)=>{n.d(t,{E2:()=>s,LQ:()=>a,LR:()=>u,Lh:()=>l,Ob:()=>i,PT:()=>r,Po:()=>d});var o=n("node:process");function r(){var e,t;const n=null!==(t=null===(e=null===o.stdout||void 0===o.stdout?void 0:o.stdout.getColorDepth)||void 0===e?void 0:e.call(o.stdout))&&void 0!==t?t:1;return n>=24?"truecolor":n>=8?"ansi256":n>=4?"basic":"none"}function s(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function i(e){const t=e=>{const t=Math.round(Math.max(0,Math.min(255,e))).toString(16);return 1===t.length?`0${t}`:t};return`#${t(e.r)}${t(e.g)}${t(e.b)}`}function l(e,t,n=.8){const o=1-n;return{r:Math.round(e.r*n+t.r*o),g:Math.round(e.g*n+t.g*o),b:Math.round(e.b*n+t.b*o)}}function a(e,t,n){return e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5)}const c=.18;function d(e,t){const n=r();if(e){const r=s(t.tintHex);if(r){const s=l(e,r,function(e,t){const n=Math.abs(t-.5)/.5;return Math.max(.5,e-n*c)}(t.mixRatio,(o=e).r/255*.2126+o.g/255*.7152+o.b/255*.0722));return"ansi256"===n?`ansi256(${a(s.r,s.g,s.b)})`:i(s)}}var o;return"ansi256"===n?`ansi256(${t.fallbackAnsi256})`:t.fallbackHex}function u(e){var t,n,o,r;if(e>=0&&e<=15)return null!==(t=["#000000","#800000","#008000","#808000","#000080","#800080","#008080","#c0c0c0","#808080","#ff0000","#00ff00","#ffff00","#0000ff","#ff00ff","#00ffff","#ffffff"][e])&&void 0!==t?t:"#000000";if(e>=16&&e<=231){const t=e-16,s=Math.floor(t/36),i=Math.floor(t%36/6),l=t%6,a=[0,95,135,175,215,255],c=null!==(n=a[s])&&void 0!==n?n:0,d=null!==(o=a[i])&&void 0!==o?o:0,u=null!==(r=a[l])&&void 0!==r?r:0,p=e=>e.toString(16).padStart(2,"0");return`#${p(c)}${p(d)}${p(u)}`}if(e>=232&&e<=255){const t=8+10*(e-232),n=Math.max(0,Math.min(255,t)),o=e=>e.toString(16).padStart(2,"0");return`#${o(n)}${o(n)}${o(n)}`}return"#808080"}},"./src/utils/diff-colors.ts":(e,t,n)=>{n.d(t,{U:()=>i,a:()=>s});var o=n("./src/constants.ts"),r=n("./src/utils/color-mixing.ts");function s(e){if("truecolor"===(0,r.PT)())return e?o.iP:o.eh;const t=e?o.Xh:o.XM;return{addHex:(0,r.LR)(t.add),removeHex:(0,r.LR)(t.remove)}}function i(e){return e&&0!==e.length?"+"!==e[0]||e.startsWith("+++")?"-"!==e[0]||e.startsWith("---")?"other":"removed":"added":"other"}},"./src/utils/diff-sequences.ts":(e,t,n)=>{n.d(t,{A:()=>g});const o="@jest/diff-sequences",r=0,s=(e,t,n,o,r)=>{let s=0;for(;e<t&&n<o&&r(e,n);)e+=1,n+=1,s+=1;return s},i=(e,t,n,o,r)=>{let s=0;for(;e<=t&&n<=o&&r(t,o);)t-=1,o-=1,s+=1;return s},l=(e,t,n,o,r,i,l)=>{let a=0,c=-e,d=i[a],u=d;i[a]+=s(d+1,t,o+d-c+1,n,r);const p=Math.min(e,l);for(a+=1,c+=2;a<=p;a+=1,c+=2){if(a!==e&&u<i[a])d=i[a];else if(d=u+1,t<=d)return a-1;u=i[a],i[a]=d+s(d+1,t,o+d-c+1,n,r)}return l},a=(e,t,n,o,r,s,l)=>{let a=0,c=e,d=s[a],u=d;s[a]-=i(t,d-1,n,o+d-c-1,r);const p=Math.min(e,l);for(a+=1,c-=2;a<=p;a+=1,c-=2){if(a!==e&&s[a]<u)d=s[a];else if(d=u-1,d<t)return a-1;u=s[a],s[a]=d-i(t,d-1,n,o+d-c-1,r)}return l},c=(e,t,n,o,l,a,c,d,u,p,h)=>{const g=o-t,m=l-o-(n-t),f=-m-(e-1),v=e-1-m;let x=r;const b=Math.min(e,d);for(let r=0,d=-e;r<=b;r+=1,d+=2){const b=0===r||r!==e&&x<c[r],y=b?c[r]:x,w=b?y:y+1,j=g+w-d,k=s(w+1,n,j+1,l,a),C=w+k;if(x=c[r],c[r]=C,f<=d&&d<=v){const r=(e-1-(d+m))/2;if(r<=p&&u[r]-1<=C){const r=g+y-(b?d+1:d-1),s=i(t,y,o,r,a),c=y-s+1,u=r-s+1;h.nChangePreceding=e-1,e-1==c+u-t-o?(h.aEndPreceding=t,h.bEndPreceding=o):(h.aEndPreceding=c,h.bEndPreceding=u),h.nCommonPreceding=s,0!==s&&(h.aCommonPreceding=c,h.bCommonPreceding=u),h.nCommonFollowing=k,0!==k&&(h.aCommonFollowing=w+1,h.bCommonFollowing=j+1);const p=C+1,m=j+k+1;return h.nChangeFollowing=e-1,e-1==n+l-p-m?(h.aStartFollowing=n,h.bStartFollowing=l):(h.aStartFollowing=p,h.bStartFollowing=m),!0}}}return!1},d=(e,t,n,o,l,a,c,d,u,p,h)=>{const g=l-n,m=l-o-(n-t),f=m-e,v=m+e;let x=r;const b=Math.min(e,p);for(let r=0,p=e;r<=b;r+=1,p-=2){const b=0===r||r!==e&&u[r]<x,y=b?u[r]:x,w=b?y:y-1,j=g+w-p,k=i(t,w-1,o,j-1,a),C=w-k;if(x=u[r],u[r]=C,f<=p&&p<=v){const r=(e+(p-m))/2;if(r<=d&&C-1<=c[r]){const r=j-k;if(h.nChangePreceding=e,e===C+r-t-o?(h.aEndPreceding=t,h.bEndPreceding=o):(h.aEndPreceding=C,h.bEndPreceding=r),h.nCommonPreceding=k,0!==k&&(h.aCommonPreceding=C,h.bCommonPreceding=r),h.nChangeFollowing=e-1,1===e)h.nCommonFollowing=0,h.aStartFollowing=n,h.bStartFollowing=l;else{const t=g+y-(b?p-1:p+1),o=s(y,n,t,l,a);h.nCommonFollowing=o,0!==o&&(h.aCommonFollowing=y,h.bCommonFollowing=t);const r=y+o,i=t+o;e-1==n+l-r-i?(h.aStartFollowing=n,h.bStartFollowing=l):(h.aStartFollowing=r,h.bStartFollowing=i)}return!0}}}return!1},u=(e,t,n,r,s,i,p,h,g,m)=>{if(s-r<n-t){if((i=!i)&&1===p.length){const{foundSubsequence:e,isCommon:t}=p[0];p[1]={foundSubsequence:(t,n,o)=>{e(t,o,n)},isCommon:(e,n)=>t(n,e)}}const e=t,o=n;t=r,n=s,r=e,s=o}const{foundSubsequence:f,isCommon:v}=p[i?1:0];((e,t,n,r,s,i,u,p,h)=>{const g=r-t,m=s-n,f=n-t,v=s-r,x=v-f;let b=f,y=f;if(u[0]=t-1,p[0]=n,x%2==0){const o=(e||x)/2,c=(f+v)/2;for(let e=1;e<=c;e+=1)if(b=l(e,n,s,g,i,u,b),e<o)y=a(e,t,r,m,i,p,y);else if(d(e,t,n,r,s,i,u,b,p,y,h))return}else{const o=((e||x)+1)/2,d=(f+v+1)/2;let w=1;for(b=l(w,n,s,g,i,u,b),w+=1;w<=d;w+=1)if(y=a(w-1,t,r,m,i,p,y),w<o)b=l(w,n,s,g,i,u,b);else if(c(w,t,n,r,s,i,u,b,p,y,h))return}throw new Error(`${o}: no overlap aStart=${t} aEnd=${n} bStart=${r} bEnd=${s}`)})(e,t,n,r,s,v,h,g,m);const{nChangePreceding:x,aEndPreceding:b,bEndPreceding:y,nCommonPreceding:w,aCommonPreceding:j,bCommonPreceding:k,nCommonFollowing:C,aCommonFollowing:S,bCommonFollowing:E,nChangeFollowing:M,aStartFollowing:$,bStartFollowing:T}=m;t<b&&r<y&&u(x,t,b,r,y,i,p,h,g,m),0!==w&&f(w,j,k),0!==C&&f(C,S,E),$<n&&T<s&&u(M,$,n,T,s,i,p,h,g,m)},p=(e,t)=>{if("number"!=typeof t)throw new TypeError(`${o}: ${e} typeof ${typeof t} is not a number`);if(!Number.isSafeInteger(t))throw new RangeError(`${o}: ${e} value ${t} is not a safe integer`);if(t<0)throw new RangeError(`${o}: ${e} value ${t} is a negative integer`)},h=(e,t)=>{const n=typeof t;if("function"!==n)throw new TypeError(`${o}: ${e} typeof ${n} is not a function`)};function g(e,t,n,o){p("aLength",e),p("bLength",t),h("isCommon",n),h("foundSubsequence",o);const l=s(0,e,0,t,n);if(0!==l&&o(l,0,0),e!==l||t!==l){const s=l,a=l,c=i(s,e-1,a,t-1,n),d=e-c,p=t-c,h=l+c;e!==h&&t!==h&&u(0,s,d,a,p,!1,[{foundSubsequence:o,isCommon:n}],[r],[r],{aCommonFollowing:r,aCommonPreceding:r,aEndPreceding:r,aStartFollowing:r,bCommonFollowing:r,bCommonPreceding:r,bEndPreceding:r,bStartFollowing:r,nChangeFollowing:r,nChangePreceding:r,nCommonFollowing:r,nCommonPreceding:r}),0!==c&&o(c,d,p)}}},"./src/utils/durations.ts":(e,t,n)=>{function o(e,t={}){const{alwaysShowSeconds:n=!0}=t;if(void 0===e)return;const o=Number(e);if(!Number.isFinite(o)||o<0)return;if(o<1e3)return`${Math.round(o)}ms`;const r=Math.round(o/1e3);if(r<60)return o>=1e4?`${r}s`:`${(o/1e3).toFixed(1)}s`;if(r<3600){const e=Math.floor(r/60),t=r%60;return 0===t?`${e}m`:`${e}m ${t}s`}if(r<86400){const e=Math.floor(r/3600),t=Math.floor(r%3600/60),o=r%60;return n?0===t&&0===o?`${e}h`:0===o?`${e}h ${t}m`:0===t?`${e}h ${o}s`:`${e}h ${t}m ${o}s`:0===t?`${e}h`:`${e}h ${t}m`}const s=Math.floor(r/86400),i=Math.floor(r%86400/3600),l=Math.floor(r%3600/60);return n?0===i&&0===l?`${s}d`:0===l?`${s}d ${i}h`:0===i?`${s}d ${l}m`:`${s}d ${i}h ${l}m`:0===i?`${s}d`:`${s}d ${i}h`}n.d(t,{u:()=>o})},"./src/utils/fuzzy.ts":(e,t,n)=>{function o(e,t){var n,o;const r=e.toLowerCase(),s=t.toLowerCase();if(0===s.length)return 1;let i=0,l=0,a=0,c=-1;for(let t=0;t<s.length;t++){const d=s[t];let u=!1;for(let t=l;t<r.length;t++)if(r[t]===d){u=!0,l=t+1,c>=0&&t===c+1?(a++,i+=15*a):a=1,0===t&&(i+=30);const r=e[t-1];t>0&&("/"===r||"-"===r||"_"===r||"."===r||" "===r)&&(i+=25);const s=t>0&&/[a-z]/.test(null!==(n=e[t-1])&&void 0!==n?n:""),d=/[A-Z]/.test(null!==(o=e[t])&&void 0!==o?o:"");s&&d&&(i+=20),c>=0&&(i-=2*(t-c-1)),c=t;break}if(!u)return 0}return i+=Math.max(0,50-e.length),r===s&&(i+=100),i}n.d(t,{dt:()=>o})},"./src/utils/git-diffs.ts":(e,t,n)=>{n.r(t),n.d(t,{buildFileChanges:()=>f,buildUnifiedDiff:()=>d,collectGitStatuses:()=>m});var o=n("node:child_process"),r=n("node:fs"),s=n.n(r),i=n("node:os"),l=n.n(i),a=n("node:path"),c=n.n(a);const d=e=>{const t=s().mkdtempSync(c().join(l().tmpdir(),"delta-full-")),n=c().join(t,"before"),r=c().join(t,"after");s().mkdirSync(n,{recursive:!0}),s().mkdirSync(r,{recursive:!0});const i=(e,t,n)=>{const o=c().join(e,t);s().mkdirSync(c().dirname(o),{recursive:!0}),s().writeFileSync(o,n)};for(const t of e){const e=c().isAbsolute(t.path)?c().relative(process.cwd(),t.path):t.path;void 0!==t.before&&i(n,e,t.before),void 0!==t.after&&i(r,e,t.after)}const a=["diff","--no-index","--no-prefix","--diff-algorithm=patience","--unified=3","--","before","after"];let d="";try{d=(0,o.execFileSync)("git",a,{encoding:"utf8",cwd:t})}catch(e){const t=e;if(!(null==t?void 0:t.stdout))throw e;d=t.stdout}const u=(e=>{const t=c().join(n,""),o=c().join(r,"");let s=e.split(t).join("").split(o).join("");const i=c().join("before",""),l=c().join("after","");return s=s.split(i).join("").split(l).join(""),s})(d);return s().rmSync(t,{recursive:!0,force:!0}),u};function u(e){return(0,o.execFileSync)("git",e,{encoding:"utf8"}).trim()}function p(e){try{return(0,o.execFileSync)("git",["show",`HEAD:${e}`],{encoding:"utf8"})}catch(e){return}}let h=null;function g(e){const t=h||(h=u(["rev-parse","--show-toplevel"]),h),n=c().isAbsolute(e)?e:c().join(t,e);try{return(0,r.readFileSync)(n,"utf8")}catch(e){return""}}function m(){const e=u(["diff","--name-status","HEAD"]),t=(""===e?[]:e.split("\n")).filter(Boolean).map((e=>{var t,n,o,r,s;const i=e.split("\t"),l=(null!==(t=i[0])&&void 0!==t?t:"")[0];if("R"===l||"C"===l){const e=null!==(n=i[1])&&void 0!==n?n:"";return{code:l,path:null!==(o=i[2])&&void 0!==o?o:e,oldPath:e}}return{code:l,path:null!==(s=null!==(r=i[1])&&void 0!==r?r:i[0])&&void 0!==s?s:""}})),n=u(["ls-files","--others","--exclude-standard"]),o=""===n?[]:n.split("\n");for(const e of o)e&&t.push({code:"A",path:e});return t}function f(e){var t,n,o;const r=[];for(const s of e)if(s.path)switch(s.code){case"A":{const e=g(s.path);r.push({path:s.path,before:void 0,after:e});break}case"M":{const e=null!==(t=p(s.path))&&void 0!==t?t:"",n=g(s.path);r.push({path:s.path,before:e,after:n});break}case"D":{const e=null!==(n=p(s.path))&&void 0!==n?n:"";r.push({path:s.path,before:e,after:void 0});break}case"R":{const e=s.oldPath&&null!==(o=p(s.oldPath))&&void 0!==o?o:"",t=g(s.path);r.push({path:s.path,before:e,after:t});break}}return r}},"./src/utils/inline-diff.ts":(e,t,n)=>{n.d(t,{U:()=>l,f:()=>a});var o=n("./src/utils/diff-sequences.ts");function r(e){const t=[],n=/(\S+|\s+)/g;for(const o of e.matchAll(n))t.push({text:o[0],start:o.index,end:o.index+o[0].length});return t}function s(e,t){var n,o;if(0===e.length&&0===t.length)return 1;if(0===e.length||0===t.length)return 0;const r=Math.min(e.length,t.length)/Math.max(e.length,t.length);if(r<.3)return r;const s=new Map;for(const t of e)s.set(t,(null!==(n=s.get(t))&&void 0!==n?n:0)+1);let i=0;for(const e of t){const t=null!==(o=s.get(e))&&void 0!==o?o:0;t>0&&(i++,s.set(e,t-1))}return 2*i/(e.length+t.length)}function i(e,t=0){if(0===e.length)return[];const n=[];let o=Object.assign({},e[0]);for(let r=1;r<e.length;r++){const s=e[r];s.start<=o.end+t?o.end=Math.max(o.end,s.end):(n.push(o),o=Object.assign({},s))}return n.push(o),n}function l(e,t,n=.25){if(e===t)return{before:[],after:[]};if(0===e.length||0===t.length)return{before:[],after:[]};if(s(e,t)<n)return{before:[],after:[]};const l=r(e),a=r(t),c=new Array(l.length).fill(!0),d=new Array(a.length).fill(!0);(0,o.A)(l.length,a.length,((e,t)=>l[e].text===a[t].text),((e,t,n)=>{for(let o=0;o<e;o++)c[t+o]=!1,d[n+o]=!1}));const u=[],p=[];let h=0;for(let e=0;e<l.length;e++)if(c[e]){const t=l[e];u.push({start:t.start,end:t.end}),h+=t.end-t.start}let g=0;for(let e=0;e<a.length;e++)if(d[e]){const t=a[e];p.push({start:t.start,end:t.end}),g+=t.end-t.start}const m=e.length>0?h/e.length:0,f=t.length>0?g/t.length:0;return m>.5||f>.5?{before:[],after:[]}:{before:i(u,0),after:i(p,0)}}function a(e){const t=[];let n=0;for(;n<e.length;){if("common"===e[n].type||"gap"===e[n].type){n++;continue}const o=[];for(;n<e.length&&"removed"===e[n].type;)o.push(n),n++;const r=[];for(;n<e.length&&"added"===e[n].type;)r.push(n),n++;if(0!==o.length&&0!==r.length)if(o.length===r.length)for(let e=0;e<o.length;e++)t.push({removedIdx:o[e],addedIdx:r[e]});else{const n=new Set;for(const i of o){let o=-1,l=0;for(const t of r){if(n.has(t))continue;const r=s(e[i].content,e[t].content);r>l&&(l=r,o=t)}-1!==o&&l>.25&&(t.push({removedIdx:i,addedIdx:o}),n.add(o))}}}return t}},"./src/utils/mermaid-to-ascii.ts":(e,t,n)=>{n.d(t,{O:()=>r});var o=n("../../node_modules/.pnpm/beautiful-mermaid@0.1.3/node_modules/beautiful-mermaid/dist/index.js");function r(e,t){var n;try{const r=(0,o.XC)(e,{useAscii:null!==(n=null==t?void 0:t.ascii)&&void 0!==n&&n,paddingX:3,paddingY:1,boxBorderPadding:1});if(null==t?void 0:t.maxWidth){const e=r.split("\n");if(Math.max(...e.map((e=>e.length)))>t.maxWidth)return null}return r}catch(e){return null}}},"./src/utils/oauth-callback.ts":(e,t,n)=>{n.d(t,{T5:()=>c,Yt:()=>l,u1:()=>a});var o=n("node:http"),r=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const s=8787,i="/callback",l=`http://localhost:${s}${i}`;function a(e){if(e&&"object"==typeof e&&"message"in e){const t=e.message;if("string"==typeof t&&t.length>0)return t}if("string"==typeof e&&e.length>0)return e;try{return JSON.stringify(e)}catch(e){return"Unknown error"}}function c(){return r(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=(0,o.createServer)(((o,r)=>{if(!o.url)return r.statusCode=400,void r.end("Bad request");const l=new URL(o.url,`http://localhost:${s}`);if(l.pathname!==i)return r.statusCode=404,void r.end("Not found");const a=l.searchParams.get("code"),c=l.searchParams.get("error");a?(r.statusCode=200,r.setHeader("Content-Type","text/html"),r.end("<html><body><h1>Authorized</h1>You can close this window.</body></html>"),e(a),setTimeout((()=>n.close()),1e3)):(r.statusCode=400,r.end(`Auth failed: ${null!=c?c:"No code"}`),t(new Error(null!=c?c:"No authorization code provided")),setTimeout((()=>n.close()),1e3))}));n.listen(s,(()=>{}))}))}))}},"./src/utils/output-format.ts":(e,t,n)=>{n.d(t,{nt:()=>r});const o=["text","json","stream-json"];function r(e){if(null==e)return"text";if(function(e){return"string"==typeof e&&o.includes(e)}(e))return e;const t=o.join(", ");throw new Error(`Invalid --output-format. Allowed values: ${t}`)}},"./src/utils/path-utils.ts":(e,t,n)=>{n.d(t,{Kr:()=>u,RZ:()=>p,fw:()=>c,me:()=>h,rR:()=>g,tk:()=>d});var o=n("node:fs"),r=n.n(o),s=n("node:path"),i=n.n(s),l=n("../utils/dist/index.js"),a=n("./src/constants.ts");function c(e){const t=process.cwd(),n=(0,s.relative)(t,e);return n.startsWith("..")||(0,s.isAbsolute)(n)?e:""===n?".":n}function d(e,t){if(e.length<=t)return e;const n="...",o=t-3,r=e.split(/[\\/]/);if(r.length<=2)return e.length>t?e.substring(0,t-3)+n:e;const s=Math.floor(.4*o),l=o-s,a=[];let c=0;for(let e=0;e<r.length-1;e++){const t=r[e],n=t.length+(a.length>0?1:0);if(!(c+n<=s))break;a.push(t),c+=n}const d=[];let u=0;for(let e=r.length-1;e>=0;e--){const t=r[e],n=t.length+(d.length>0?1:0);if(!(u+n<=l))break;d.unshift(t),u+=n}if(0===a.length&&d.length>0)return n+i().sep+d.join(i().sep);const p=a.join(i().sep),h=d.join(i().sep);return p&&h?p+i().sep+n+i().sep+h:p?p+i().sep+n:h?n+i().sep+h:n}function u(e,t=a.rY){return(0,l.JD)(e)?"tool output":function(e,t=25){return t<=0?"":e.length<=t?e:t<=3?e.slice(-t):`...${e.slice(-(t-3))}`}(c(e||""),t)}function p(e,t,n={}){var o,r;const s=null!==(o=n.ellipsis)&&void 0!==o?o:"⋯";if(t<=0)return"";if(e.length<=t)return e;const l=e.split(i().sep);if(0===l.length)return e.slice(-t);const a=`${s}${i().sep}`,c=e=>{const t=l.slice(l.length-e).join(i().sep);return((e<l.length?a:"")+t).length};let d=1,u=Math.max(1,l.length),p=1;for(;d<=u;){const e=Math.floor((d+u)/2);c(e)<=t?(p=e,d=e+1):u=e-1}const h=p<l.length,g=l.slice(l.length-p),m=(h?a:"")+g.join(i().sep);if(m.length<=t)return m;const f=g.length-1,v=null!==(r=g[f])&&void 0!==r?r:"",x=(h?a:"")+g.slice(0,Math.max(0,f)).join(i().sep),b=x.length>0?x+(x.endsWith(i().sep)?"":i().sep):h?a:"",y=Math.max(0,t-b.length);return y<=0?(h?s:"").slice(0,t):b+(v.length<=y?v:v.slice(-y))}function h(e,t){if("number"==typeof e){const n=Math.max(1,e+1);return"number"==typeof t&&t>0?1===t?`line ${n}`:`lines ${n}-${n+t-1}`:`line ${n}`}}function g(e){let t=e;for(;t!==i().parse(t).root;){const e=i().join(t,".git");if(r().existsSync(e))return e;t=i().dirname(t)}const n=i().join(t,".git");return r().existsSync(n)?n:null}},"./src/utils/plan-utils.ts":(e,t,n)=>{n.d(t,{IB:()=>d});var o=n("node:fs"),r=n("node:fs/promises"),s=n("node:os"),i=n("node:path"),l=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}function c(e){const t=[];if(t.push(`  - id: "${a(e.id)}"`),t.push(`    content: "${a(e.content)}"`),t.push("    status: pending"),e.dependencies&&e.dependencies.length>0){t.push("    dependencies:");for(const n of e.dependencies)t.push(`      - "${a(n)}"`)}return t}function d(e){return l(this,void 0,void 0,(function*(){const{args:t,workspaceRoot:n,conversationId:d}=e,{plansDir:u}=yield function(e){return l(this,void 0,void 0,(function*(){const t=void 0===e,n=null!=e?e:(0,s.homedir)(),a=(0,i.join)(n,".cursor"),c=(0,i.join)(a,"plans");return(0,o.existsSync)(a)||(yield(0,r.mkdir)(a,{recursive:!0})),t||(yield function(e){return l(this,void 0,void 0,(function*(){const t=(0,i.join)(e,".gitignore");try{let e="";if((0,o.existsSync)(t)&&(e=yield(0,r.readFile)(t,"utf-8")),!e.includes("plans/")){const n=e.trim()+(e.trim()?"\n":"")+"plans/\n";yield(0,r.writeFile)(t,n,"utf-8")}}catch(e){}}))}(a)),(0,o.existsSync)(c)||(yield(0,r.mkdir)(c,{recursive:!0})),{plansDir:c,isUserDir:t}}))}(n),p=function(e,t){return`${e.replace(/[^a-zA-Z0-9-_ ]/g,"").trim().substring(0,50)||"Plan"}-${t.substring(0,8)}.plan.md`}(t.name||function(e){const t=e.match(/^#\s+(.+)$/m);if(t)return t[1].trim().substring(0,50);const n=e.split("\n");for(const e of n){const t=e.trim();if(t&&!t.startsWith("#"))return t.substring(0,50)}return"Plan"}(t.plan),d),h=(0,i.join)(u,p),g=(0,o.existsSync)(h),m=function(e,t){var n;const o=[];o.push(`\x3c!-- ${t} --\x3e`);const r=!!(e.todos&&e.todos.length>0),s=!0===e.isProject,i=!!(s&&e.phases&&e.phases.length>0);if(r||i||s){if(o.push("---"),r){o.push("todos:");for(const t of e.todos)o.push(...c(t))}if(o.push(`isProject: ${s}`),i&&e.phases){o.push("phases:");for(const t of e.phases)if(o.push(`  - name: "${a(null!==(n=t.name)&&void 0!==n?n:"")}"`),o.push("    todos:"),t.todos&&t.todos.length>0)for(const e of t.todos)for(const t of c(e))o.push(`    ${t}`)}o.push("---")}return o.push(e.plan),o.join("\n")}(t,d);return yield(0,r.writeFile)(h,m,"utf-8"),{planUri:`file://${h}`,created:!g}}))}},"./src/utils/prompt-utils.ts":(e,t,n)=>{n.d(t,{C:()=>r});var o=n("./src/utils/path-utils.ts");function r(e,t,n){const r=t.trim();return r?`For ${(0,o.fw)(e)}${n&&null!=n.startLine&&null!=n.endLine?` (lines ${n.startLine}-${n.endLine})`:""}:\n${r}`:""}},"./src/utils/retry-helpers.ts":(e,t,n)=>{function o(e){var t;return"agent"!==(null===(t=e.pendingTurn)||void 0===t?void 0:t.type)?e:Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{completedSteps:[...e.pendingTurn.completedSteps,{type:"text",content:"--- Connection lost. Retry attempted. ---",completed:!0}],pendingState:void 0,thinkingContent:void 0})})}function r(e){return e.hasPromptDialog?null:e.isTransferring?"transfer":"reconnecting"===e.connectionState?"reconnecting":e.isGenerating||e.isSummarizing?"generating":e.hasQueuedMessages?"queued":null}function s(e,t){return null!=e&&e&&"shellCommandAction"!==t}n.d(t,{MO:()=>r,fu:()=>o,w5:()=>s})},"./src/utils/sandbox-messages.ts":(e,t,n)=>{function o(){return"Sandbox requires kernel v6.2 or later and may require additional AppArmor policies to be set"}n.d(t,{l:()=>o})},"./src/utils/task-tool.ts":(e,t,n)=>{function o(e){var t;if(e&&0!==e.length)for(let n=e.length-1;n>=0;n-=1){const o=e[n];if("assistantMessage"===(null===(t=o.message)||void 0===t?void 0:t.case)){const e=o.message.value.text;if(e&&e.trim().length>0)return e}}}function r(e){var t;const n=null==e?void 0:e.type,o=null==n?void 0:n.case;switch(o){case void 0:return;case"custom":{const e=null!==(t=null==n?void 0:n.value)&&void 0!==t?t:void 0,o=null==e?void 0:e.name;return o&&o.trim().length>0?o.trim():"custom"}case"unspecified":return"general-purpose";case"computerUse":return"computer-use";case"explore":return"explore";case"shell":case"bash":return"shell";case"mediaReview":return"media-review";case"browserUse":return"browser-use";case"vmSetupHelper":return"vm-setup-helper";case"debug":return"debug";default:return o}}n.d(t,{N:()=>r,U:()=>o})},"./src/utils/terminal-title.ts":(e,t,n)=>{n.d(t,{Bp:()=>i,cu:()=>l,iq:()=>s});const o="Cursor Agent",r="New Agent";function s(e){return"string"==typeof e&&0!==e.trim().length&&e.trim()!==r}function i(e){if(!process.stdout.isTTY)return;const t="string"==typeof e&&e.trim().length>0?e.trim():o;try{process.stdout.write(`]0;${t}`)}catch(e){}}function l(){i(o)}},"./src/utils/text-wrapping.ts":(e,t,n)=>{function o(e,t){const n=[];if(t<=0)return[""];const o=e.split(/\s+/).filter((e=>e.length>0));let r="";const s=()=>{n.push(r),r=""},i=e=>{for(let o=0;o<e.length;o+=t){const i=e.slice(o,o+t);i.length===t?n.push(i):0===r.length?r=i:r.length+1+i.length<=t?r=`${r} ${i}`:(s(),r=i)}};for(const e of o)e.length>t?(r.length>0&&s(),i(e)):0===r.length?r=e:r.length+1+e.length<=t?r=`${r} ${e}`:(s(),r=e);return r.length>0&&n.push(r),0===n.length&&n.push(""),n}function r(e,t,n){var r,s,i;if(t<=0||n<=0)return"";const l=e.replaceAll("\r\n","\n").split("\n"),a=[];for(let e=0;e<l.length;e+=1){const i=null!==(r=l[e])&&void 0!==r?r:"",c=i.match(/^[ \t]+/),d=null!==(s=null==c?void 0:c[0])&&void 0!==s?s:"",u=i.slice(d.length),p=Math.max(0,n-d.length);if(p<=0){if(a.push(d.slice(0,n)),a.length>=t+1)break;continue}const h=o(u,p);for(const e of h){const n=`${d}${e}`;if(a.push(n),a.length>=t+1)break}if(a.length>=t+1)break}if(a.length<=t)return a.join("\n");const c=a.slice(0,t),d=t-1,u=null!==(i=c[d])&&void 0!==i?i:"";return u.length>=n?c[d]=`${u.slice(0,Math.max(0,n-1))}…`:c[d]=`${u}…`,c.join("\n")}n.d(t,{F:()=>r,G:()=>o})},"./src/utils/tokens.ts":(e,t,n)=>{function o(e,t){var n,o;if(null==e)return null;const r=Math.floor(e);if(!(r>0))return null;const s=null!==(n=null==t?void 0:t.shortThreshold)&&void 0!==n?n:1e3,i=null!==(o=null==t?void 0:t.decimals)&&void 0!==o?o:2,l=e=>e.replace(/\.0+$|(?<=\.[0-9]*?)0+$/g,"").replace(/\.$/,""),a=(e,t)=>{if(t<=0)return Math.floor(e);const n=Math.pow(10,t);return Math.floor(e*n)/n};let c;return c=r>=1e6&&r>=s?`${l(a(r/1e6,i).toFixed(i))}M`:r>=1e3&&r>=s?`${l(a(r/1e3,i).toFixed(i))}k`:String(r),`${c} ${1===r?"token":"tokens"}`}n.d(t,{a:()=>o})},"./src/utils/turn-file-tracker.ts":(e,t,n)=>{n.d(t,{k:()=>o});class o{constructor(e){this.fileChangeTracker=e,this.turnStartSnapshots=new Map}startTurn(e){this.turnStartSnapshots.set(e,[...this.fileChangeTracker.getChanges()])}getTurnChanges(e){const t=this.turnStartSnapshots.get(e);if(!t)return[];const n=this.fileChangeTracker.getChanges(),o=(new Set(t.map((e=>e.path))),[]);for(const e of n){const n=t.find((t=>t.path===e.path));n?n.after!==e.after&&o.push({path:e.path,before:n.after,after:e.after}):o.push(e)}return o}finalizeTurn(e){const t=!this.turnStartSnapshots.has(e),n=this.getTurnChanges(e);return this.turnStartSnapshots.delete(e),{changes:n,alreadyFinalized:t}}cleanup(){this.turnStartSnapshots.clear()}}},"./src/utils/turn-tracking.ts":(e,t,n)=>{n.d(t,{GK:()=>u,Io:()=>p,WF:()=>h});var o=n("../agent-client/dist/index.js"),r=n("../proto/dist/generated/aiserver/v1/utils_pb.js"),s=n("../utils/dist/index.js"),i=n("../../node_modules/.pnpm/@connectrpc+connect@1.6.1_patch_hash=a4b9a5e69295313832387f25b708426bcf53041a2f50bc7b95_a276813e7efa8e1efb8a7b0efc1d56a0/node_modules/@connectrpc/connect/dist/esm/code.js"),l=n("./src/structured-log.ts"),a=n("./src/utils/error-info.ts");const c=e=>{if(0===e)return"ok";const t=i.C[e];return"string"!=typeof t?`code_${e}`:t[0].toLowerCase()+t.substring(1).replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))},d=new Set(["cancelled","aborted"]),u=e=>e>0?"resume":"new",p=(e,t)=>{const n=(e=>new s.TI({logger:l.w9,logKey:"agent_cli",startEventName:"agent_cli.turn.start",outcomeEventName:"agent_cli.turn.outcome",simulatedThinkingTimeoutEventName:"agent_cli.turn.simulated_thinking_timeout",turnType:e}))(e);return n.start(t),n},h=(e,t,n)=>{if(n){const{info:s,extraOutcomeTags:i}=(e=>{var t;const n=(e=>e instanceof o.ao?"action_required":e instanceof o.DN?"retriable":e instanceof o.SK?"non_retriable":e instanceof o.cc?"cancelled":e instanceof o.Yv?"agent_error":e&&"object"==typeof e&&"ConnectError"===e.name?"connect_error":"unknown")(e),s=(e=>{const t={};let n=e,o=0;for(;n&&"object"==typeof n&&o<10;){const e=n;t.grpcCode||"ConnectError"!==e.name||"number"!=typeof e.code||(t.grpcCode=c(e.code)),t.networkCode||"string"!=typeof e.code||(t.networkCode=e.code),t.syscall||"string"!=typeof e.syscall||(t.syscall=e.syscall),t.address||"string"!=typeof e.address||(t.address=e.address),t.port||"string"!=typeof e.port&&"number"!=typeof e.port||(t.port=String(e.port)),n instanceof Error&&n.message&&"[unavailable]"!==n.message&&(t.deepestMessage=n.message),n="AggregateError"===e.name&&Array.isArray(e.errors)&&e.errors.length>0?e.errors[0]:e.cause,o++}return t})(e),i=((e,t)=>{if(e instanceof o.ao)return e.action;if(e instanceof o.DN){if(t.networkCode)return t.networkCode;if(t.grpcCode&&!d.has(t.grpcCode))return t.grpcCode}if(e instanceof o.Yv&&e.displayInfo){const{errorCode:t,connectCode:n}=e.displayInfo;if(void 0!==t){const e=r.yM[t];if(e)return e}const s=void 0!==n?c(n):void 0;if(s&&!(e instanceof o.DN&&d.has(s)))return s}if(t.networkCode)return t.networkCode;if(t.grpcCode)return t.grpcCode;const n=null==e?void 0:e.code;return"string"==typeof n?n:"number"==typeof n?c(n):"unknown"})(e,s),{message:l}=(0,a.q)(e),u={errorType:n,errorCode:i},p={};s.grpcCode&&s.grpcCode!==i&&(p.grpc_code=s.grpcCode),s.networkCode&&s.networkCode!==i&&(p.network_code=s.networkCode),s.syscall&&(p.syscall=s.syscall),s.address&&(p.error_address=s.address),s.port&&(p.error_port=s.port);const h=l&&"[unavailable]"!==l?l:null!==(t=s.deepestMessage)&&void 0!==t?t:l;h&&(u.errorText=(e=>e.includes("/")||e.includes("\\")?e.replace(/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w\-._]+(\\\\|\\|\/))+[\w\-._]*/g,"<REDACTED: user-file-path>"):e)(h));const g=null==e?void 0:e.requestId;return"string"==typeof g&&(p.request_id=g),{info:u,extraOutcomeTags:p}})(n);e.finalize(t,s,i)}else e.finalize(t)}},"./src/workspace/approval.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{I:()=>b,PX:()=>x,c1:()=>j});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:fs"),i=n("node:fs/promises"),l=n("node:os"),a=n("node:path"),c=n("../cursor-config/dist/index.js"),d=n("../ink/build/index.js"),u=n("../utils/dist/index.js"),p=n("./src/components/approval-dialog.tsx"),h=n("./src/debug.ts"),g=n("./src/mcp/approval.tsx"),m=n("./src/mcp/project-paths.ts"),f=e([d,p,g]);[d,p,g]=f.then?(await f)():f;var v=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const k=".workspace-trusted";function x(e){const t=null!=e?e:process.cwd(),n=(0,c.Xq)(t),o=(0,a.join)(n,k);return!!(0,s.existsSync)(o)||w(t)}function b(e){return v(this,void 0,void 0,(function*(){const t=null!=e?e:process.cwd(),n=(0,c.Xq)(t),o=(0,a.join)(n,k);try{yield(0,i.mkdir)(n,{recursive:!0}),yield(0,i.writeFile)(o,JSON.stringify({trustedAt:(new Date).toISOString(),workspacePath:t,trustMethod:"cli-flag"},null,2))}catch(e){throw(0,h.debugLogJSON)("Failed to create trust marker:",e instanceof Error?e.message:String(e)),e}}))}function y(e){const t=(0,a.resolve)(e),n=(0,l.homedir)(),o=t.split(a.sep).filter((e=>e.length>0));return!(t!==n&&!n.startsWith(t+a.sep))||o.length<3}function w(e){try{const t=(0,c.m4)();if(!(0,s.existsSync)(t))return!1;const n=new Set((0,s.readdirSync)(t));let o=(0,a.resolve)(e),r=(0,a.dirname)(o);for(;r!==o;){const e=(0,u.r_)(r);if(n.has(e)){const n=(0,a.join)(t,e),o=(0,a.join)(n,k);if((0,s.existsSync)(o)&&!y(r))return!0}o=r,r=(0,a.dirname)(o)}return!1}catch(e){return(0,h.debugLogJSON)("Failed to check parent approvals:",e instanceof Error?e.message:String(e)),!1}}function j(e,t){return v(this,void 0,void 0,(function*(){const n=null!=e?e:process.cwd(),o=(0,c.Xq)(n),l=(0,m.C)(n),u=(0,a.join)(o,k);if((0,s.existsSync)(u))return"already_approved";if(w(n))return"already_approved";const f=!0===(null==t?void 0:t.skipMcpApproval),{servers:x}=f?{servers:{mcpServers:{}}}:yield(0,g.Vh)(l),b=!f&&Object.keys(x.mcpServers).length>0,y=[],j=["Cursor Agent can execute code and access files in this directory.",b?"This will also enable the MCP servers configured for this workspace.":"","Do you trust the contents of this directory?"].filter(Boolean);y.push({key:"a",label:"Trust this workspace",value:b?"approved_with_mcp":"approved"}),b&&y.push({key:"w",label:"Trust this workspace, but don't enable all MCP servers",value:"approved"}),y.push({key:"q",label:"Quit",value:"quit"});const C=yield(0,p.b)({title:"Workspace Trust Required",description:j,content:(0,r.jsx)(d.EY,{color:"cyan",bold:!0,children:n}),options:y,onAction:e=>v(this,void 0,void 0,(function*(){if("approved"===e||"approved_with_mcp"===e){try{yield(0,i.mkdir)(o,{recursive:!0});const e=(0,a.join)(o,k);yield(0,i.writeFile)(e,JSON.stringify({trustedAt:(new Date).toISOString(),workspacePath:n},null,2))}catch(e){(0,h.debugLogJSON)("Failed to create project directory or trust marker:",e instanceof Error?e.message:String(e))}if("approved_with_mcp"===e&&b)try{yield(0,g.Cz)(x,l)}catch(e){(0,h.debugLogJSON)("Failed to approve MCP servers:",e instanceof Error?e.message:String(e))}}}))});return C}))}o()}catch(C){o(C)}}))}};