try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d4175f07-851c-4bb0-909a-146cd2fc1b5d",e._sentryDebugIdIdentifier="sentry-dbid-d4175f07-851c-4bb0-909a-146cd2fc1b5d")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.02.13-41ac335"}}catch(e){}}(),exports.id=493,exports.ids=[493,874],exports.modules={"./src/commands/dev-cursor-blame.ts":(e,t,i)=>{i.r(t),i.d(t,{calculateAiPercentage:()=>P,classifyConversation:()=>T,extractAiSourceBreakdown:()=>I,extractConversationStats:()=>D,handleDevClassifyConversation:()=>C,handleDevScoreCommit:()=>k,handleDevScoreRecentCommits:()=>R});var s=i("node:child_process"),n=i("node:fs"),o=i("node:fs/promises"),r=i("node:os"),d=i("node:path"),a=i("node:util"),l=i("../agent-analytics/dist/index.js"),c=i("../agent-analytics/dist/commit-scoring/index.js"),u=i("../agent-analytics/dist/node.js"),m=i("../agent-kv/dist/index.js"),h=i("../agent-transcript/dist/index.js"),f=i("../context/dist/index.js"),p=i("../proto/dist/generated/aiserver/v1/analytics_pb.js"),g=i("./src/client.ts"),y=i("./src/console-io.ts"),$=i("./src/constants.ts"),v=i("./src/cursor-blame/cli-commit-scoring.ts"),b=i("./src/cursor-blame/sqlite-adapter.ts"),S=i("./src/state/index.ts"),A=i("./src/state/sqlite-blob-store.ts"),L=i("./src/transcript/index.ts"),j=function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function d(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}a((s=s.apply(e,t||[])).next())}))};const w=(0,a.promisify)(s.execFile);function D(e){var t,i;const s=new Map;for(const[,n]of e)for(const[,e]of n){for(const i of e.additions)if(i.conversationId){const e=null!==(t=s.get(i.conversationId))&&void 0!==t?t:{linesAdded:0,linesDeleted:0};e.linesAdded++,s.set(i.conversationId,e)}for(const t of e.deletions)if(t.conversationId){const e=null!==(i=s.get(t.conversationId))&&void 0!==i?i:{linesAdded:0,linesDeleted:0};e.linesDeleted++,s.set(t.conversationId,e)}}return s}function I(e){let t=0,i=0,s=0,n=0,o=0,r=0;for(const[,d]of e){const e=d.get(c.IA.TAB);e&&(t+=e.additions.length,i+=e.deletions.length);const a=d.get(c.IA.COMPOSER);a&&(s+=a.additions.length,n+=a.deletions.length);const l=d.get(c.IA.CLI);l&&(o+=l.additions.length,r+=l.deletions.length)}return{tabLinesAdded:t,tabLinesDeleted:i,composerLinesAdded:s,composerLinesDeleted:n,cliLinesAdded:o,cliLinesDeleted:r}}function P(e){const t=e.totalLinesAdded+e.totalLinesDeleted,i=e.tabLinesAdded+e.tabLinesDeleted+e.composerLinesAdded+e.composerLinesDeleted+e.cliLinesAdded+e.cliLinesDeleted;return t>0?(i/t*100).toFixed(1):"0.0"}const E=(0,d.join)((0,r.homedir)(),".cursor","ai-tracking","ai-code-tracking.db");function R(e){return j(this,arguments,void 0,(function*(e,t=10,i){var s,n;const o=new u.Z,r=(0,b.$)(),d=new l.Ou(r,E);try{yield d.initialize();const r=yield(0,l.f_)(o,[e.workspacePath]);if(0===r.length)return void(0,y.p2)("No git repositories found in workspace\n");for(const a of r){let r,c;if(i)r=yield o.getCommitsByAuthor(a,i,t),c=i;else{const e=yield(0,l.IG)(o,a,{limit:t});if(!e)continue;r=e.commits,c=e.user}if(0===r.length)continue;const u=yield(0,l.pt)(o,a);(0,y.p2)(`\n${$.oH}Repository:${$.Sj} ${null!==(s=u.repoName)&&void 0!==s?s:a}\n`),(0,y.p2)(`${$.Ip}Branch:${$.Sj} ${null!==(n=u.branchName)&&void 0!==n?n:"unknown"}\n`),(0,y.p2)(`${$.Ip}User:${$.Sj} ${c}\n`),(0,y.p2)(`${$.Ip}─────────────────────────────────────────${$.Sj}\n`);for(const t of r)yield x(t,a,o,d,e)}}finally{yield d.close()}}))}function k(e,t){return j(this,void 0,void 0,(function*(){const i=new u.Z,s=(0,b.$)(),n=new l.Ou(s,E);try{yield n.initialize();const s=yield(0,l.f_)(i,[e.workspacePath]);if(0===s.length)return void(0,y.p2)("No git repositories found in workspace\n");let o,r=t;if(r){for(const e of s)if(yield i.commitExists(e,r)){o=e;break}}else{for(const e of s){const t=yield(0,l.IG)(i,e,{limit:1});if(t&&t.commits.length>0){r=t.commits[0],o=e,(0,y.p2)(`${$.Ip}Using most recent commit: ${r.substring(0,8)}${$.Sj}\n`);break}}if(!r)return void(0,y.p2)("No commits found by current user\n")}if(!o)return void(0,y.p2)(`Commit ${r} not found in any repository\n`);yield x(r,o,i,n,e)}finally{yield n.close()}}))}function x(e,t,i,s,n){return j(this,void 0,void 0,(function*(){var o;try{const{stdout:r}=yield w("git",["show","-s","--format=%H%n%s%n%aI",e],{cwd:t,maxBuffer:10485760}),[d,a,l]=r.trim().split("\n"),{stdout:u}=yield w("git",["show","--format=",e],{cwd:t,maxBuffer:10485760}),m=(0,v.parseGitDiff)(u);if(0===m.length)return void(0,y.p2)(`${$.oH}${null==d?void 0:d.substring(0,8)}${$.Sj} ${$.Ip}- No changes${$.Sj}\n`);const h=l?new Date(l).getTime()+1e3:void 0,f=function(e,t){return{getGitRoot:t=>e.getGitRoot(t),getRemotes:t=>e.getRemotes(t),getGitUser:t=>e.getGitUser(t),getCommitsByAuthor:(t,i,s)=>e.getCommitsByAuthor(t,i,s),getRecentCommits:(t,i,s)=>e.getRecentCommits(t,i,s),getCurrentBranch:t=>e.getCurrentBranch(t),getDefaultBranch:t=>e.getDefaultBranch(t),getUpstreamUrl:t=>e.getUpstreamUrl(t),getSubmodules:t=>e.getSubmodules(t),commitExists:(t,i)=>e.commitExists(t,i),hashObject:(t,i)=>e.hashObject(t,i),catBlob:(t,i)=>e.catBlob(t,i),getAiCodeHashes(e,i,s,n){return j(this,void 0,void 0,(function*(){const o=(0,c.H2)(e,i);return t.getHashes(o,{minCreatedAt:s,maxCreatedAt:n})}))},getTrackingStartTime(){return j(this,void 0,void 0,(function*(){return t.getTrackingStartTime()}))}}}(i,s),p=[...new Set(m.flatMap((e=>[e.from,e.to].filter((e=>!!e&&"/dev/null"!==e)).map((e=>e.replace(/\\/g,"/"))))))],g=p.length>0?yield s.getAiDeletedFiles(p,h):new Set,b=yield(0,c.fS)(m,{normalizeLines:!0,gitOperations:f,repoRoot:t,commitHash:e,commitTimestamp:h,isAiDeletedFile:e=>g.has(e)});if(!b)return void(0,y.p2)(`${$.Ip}  No AI hash data available for commit ${null==d?void 0:d.substring(0,8)} — skipping${$.Sj}\n`);const S=I(b.aiLineRanges),A=D(b.aiLineRanges),L=P({tabLinesAdded:Math.max(S.tabLinesAdded,b.tabLinesAdded),tabLinesDeleted:Math.max(S.tabLinesDeleted,b.tabLinesDeleted),composerLinesAdded:Math.max(S.composerLinesAdded,b.composerLinesAdded),composerLinesDeleted:Math.max(S.composerLinesDeleted,b.composerLinesDeleted),cliLinesAdded:S.cliLinesAdded,cliLinesDeleted:S.cliLinesDeleted,totalLinesAdded:b.linesAdded,totalLinesDeleted:b.linesDeleted}),E=l?new Date(l).toLocaleString():"unknown";if((0,y.p2)(`${$.oH}${null==d?void 0:d.substring(0,8)}${$.Sj} - ${null==a?void 0:a.substring(0,50)}${(null!==(o=null==a?void 0:a.length)&&void 0!==o?o:0)>50?"...":""}\n`),(0,y.p2)(`  ${$.Ip}${E}${$.Sj}\n`),(0,y.p2)(`  ${$.Ip}Lines:${$.Sj} ${$.ki}+${b.linesAdded}${$.Sj}/${$.s0}-${b.linesDeleted}${$.Sj} ${$.Ip}|${$.Sj} ${$.Ip}AI:${$.Sj} ${$.oH}${L}%${$.Sj}\n`),(S.tabLinesAdded>0||S.tabLinesDeleted>0)&&(0,y.p2)(`  ${$.Ip}Tab:${$.Sj} ${$.ki}+${S.tabLinesAdded}${$.Sj}/${$.s0}-${S.tabLinesDeleted}${$.Sj}\n`),(S.composerLinesAdded>0||S.composerLinesDeleted>0)&&(0,y.p2)(`  ${$.Ip}Composer:${$.Sj} ${$.ki}+${S.composerLinesAdded}${$.Sj}/${$.s0}-${S.composerLinesDeleted}${$.Sj}\n`),(S.cliLinesAdded>0||S.cliLinesDeleted>0)&&(0,y.p2)(`  ${$.Ip}CLI:${$.Sj} ${$.ki}+${S.cliLinesAdded}${$.Sj}/${$.s0}-${S.cliLinesDeleted}${$.Sj}\n`),A.size>0){(0,y.p2)(`  ${$.Ip}Conversations: ${A.size} detected${$.Sj}\n`);for(const[e,t]of A){const i=yield T(n,e),s=`+${t.linesAdded}/-${t.linesDeleted}`;if(i.success&&i.summary){const t=i.summary.length>50?`${i.summary.substring(0,50)}...`:i.summary;(0,y.p2)(`    ${$.Ip}•${$.Sj} ${$.A}${e.substring(0,8)}${$.Sj} ${$.oH}${s}${$.Sj} ${$.Ip}- ${t}${$.Sj}\n`)}else(0,y.p2)(`    ${$.Ip}•${$.Sj} ${$.A}${e.substring(0,8)}${$.Sj} ${$.oH}${s}${$.Sj}\n`)}}(0,y.p2)("\n")}catch(t){(0,y.p2)(`Error scoring ${e}: ${t instanceof Error?t.message:String(t)}\n`)}}))}function T(e,t){return j(this,void 0,void 0,(function*(){const i=(0,g.Mr)(e.credentialManager,{endpoint:e.backendUrl,insecure:e.insecure,configProvider:e.configProvider});try{let s=yield function(e,t){return j(this,void 0,void 0,(function*(){const i=(0,L.kw)(e,t);try{return yield(0,o.readFile)(i,"utf-8")}catch(e){return}}))}(e.workspacePath,t),r=!1;if(s||(s=yield function(e,t){return j(this,void 0,void 0,(function*(){const i=(0,S.r)(),s=(0,d.join)(i,t),r=(0,d.join)(s,"store.db");if(!(0,n.existsSync)(r))return;const a=(0,f.q6)().withName("generateTranscript");let l;try{l=yield A.M.initAndLoad(r);const i=new m.pH(l,l);yield i.resetFromDb(a);const s=i.getConversationStateStructure();if(0===s.turns.length)return;const n=yield(0,h.Jb)(a,i.getBlobStore(),s),d=(0,L.kw)(e,t),c=(0,L.$J)(e);return yield(0,o.mkdir)(c,{recursive:!0}),yield(0,o.writeFile)(d,n,"utf-8"),n}catch(e){return}finally{yield null==l?void 0:l.dispose()}}))}(e.workspacePath,t),s&&(r=!0)),!s)return{success:!1,errorMessage:`Conversation "${t}" not found. Make sure the conversation exists and has at least one turn.`};const a=yield i.ingestConversation(new p.$g({conversationId:t,transcript:s.trim(),transcriptJson:"",mode:"unknown",model:"unknown",lastUpdatedAt:BigInt(Date.now())}));return{success:a.success,summary:a.summary||void 0,detailedSummary:a.detailedSummary||void 0,errorMessage:a.errorMessage||void 0,transcriptGenerated:r}}catch(e){return{success:!1,errorMessage:e instanceof Error?e.message:String(e)}}}))}function C(e,t){return j(this,void 0,void 0,(function*(){(0,y.p2)(`${$.oH}Conversation:${$.Sj} ${t}\n`),(0,y.p2)(`${$.Ip}─────────────────────────────────────────${$.Sj}\n`);const i=yield T(e,t);i.success?((0,y.p2)(`${$.ki}✓ Classification successful${$.Sj}\n\n`),i.summary&&((0,y.p2)(`${$.oH}Summary:${$.Sj}\n`),(0,y.p2)(`${i.summary}\n\n`)),i.detailedSummary&&((0,y.p2)(`${$.oH}Detailed Summary:${$.Sj}\n`),(0,y.p2)(`${i.detailedSummary}\n`)),i.summary||i.detailedSummary||(0,y.p2)(`${$.Ip}(No summary returned)${$.Sj}\n`)):((0,y.p2)(`${$.Dk}✗ Classification failed${$.Sj}\n`),i.errorMessage&&(0,y.p2)(`${$.Ip}Error: ${i.errorMessage}${$.Sj}\n`))}))}},"./src/state/index.ts":(e,t,i)=>{i.d(t,{r:()=>r});var s=i("node:crypto"),n=i("node:path"),o=i("../cursor-config/dist/index.js");function r(){const e=(0,s.createHash)("md5").update(process.cwd()).digest("hex");return(0,n.join)((0,o.WI)(),"chats",e)}},"./src/state/sqlite-blob-store.ts":(e,t,i)=>{i.d(t,{M:()=>m});var s=i("node:fs"),n=i("node:path"),o=i("../agent-kv/dist/index.js"),r=i("../utils/dist/index.js"),d=i("../../node_modules/.pnpm/sqlite3@5.1.7_patch_hash=aee4b045019cd42c3fc35610736c4496fa74db4d4a28d55c814724e29047da6a/node_modules/sqlite3/lib/sqlite3.js"),a=i.n(d),l=function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function d(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,d)}a((s=s.apply(e,t||[])).next())}))};const c=new o.aY;class u extends a().Database{}class m extends r.jG{static initAndLoad(e){return l(this,void 0,void 0,(function*(){const t=new m(e);return yield t.getDb(),t}))}constructor(e){super(),this.dbPath=e,this.listeners={agentId:new Set,latestRootBlobId:new Set,name:new Set,createdAt:new Set,mode:new Set,lastUsedModel:new Set},this.isPersisting=!1,this.persistQueued=!1,this.isDisposing=!1,this.inFlightOps=0;const t=(0,n.basename)((0,n.dirname)(this.dbPath));this.metadata=(0,o.sh)(t)}getDb(){return l(this,void 0,void 0,(function*(){return this.dbPromise||(this.dbPromise=new Promise(((e,t)=>{const i=(0,n.dirname)(this.dbPath);(0,s.existsSync)(i)||(0,s.mkdirSync)(i,{recursive:!0});const r=new u(this.dbPath,(i=>{i?t(i):r.serialize((()=>{r.run("PRAGMA journal_mode = WAL"),r.run("PRAGMA synchronous = NORMAL"),r.run("PRAGMA user_version = 1"),r.run("CREATE TABLE IF NOT EXISTS blobs (id TEXT PRIMARY KEY, data BLOB)"),r.run("CREATE TABLE IF NOT EXISTS meta (key TEXT PRIMARY KEY, value TEXT)",(i=>{i?t(i):r.get("SELECT value FROM meta WHERE key = ?","0",((i,s)=>{if(i)t(i);else{if(null==s?void 0:s.value){const e=(0,o.aD)(s.value);this.metadata=c.deserialize(e)}else{const e=c.serialize(this.metadata),t=(0,o.nj)(e);r.run("INSERT OR REPLACE INTO meta (key, value) VALUES (?, ?)","0",t)}e(r)}}))}))}))}))}))),this.dbPromise}))}getBlob(e,t){return l(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),i=(0,o.nj)(t);return yield new Promise(((t,s)=>{e.get("SELECT data FROM blobs WHERE id = ?",i,((e,i)=>{e?s(e):i&&null!=i.data?t(new Uint8Array(i.data)):t(void 0)}))}))}finally{this.inFlightOps--}}}))}setBlob(e,t,i){return l(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),s=(0,o.nj)(t);return yield new Promise(((t,n)=>{e.run("INSERT OR REPLACE INTO blobs (id, data) VALUES (?, ?)",s,Buffer.from(i),(e=>{e?n(e):t()}))}))}finally{this.inFlightOps--}}}))}setBlobLocallyOnly(e,t,i){return l(this,void 0,void 0,(function*(){return Promise.resolve()}))}flush(e){return l(this,void 0,void 0,(function*(){return Promise.resolve()}))}get(e){return this.metadata[e]}valuesEqual(e,t,i){if("latestRootBlobId"===e){const e=t,s=i;if(e===s)return!0;if(!e||!s)return!1;if(e.length!==s.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==s[t])return!1;return!0}return t===i}schedulePersist(){this.dbPromise&&(this.isDisposing||(this.isPersisting?this.persistQueued=!0:(this.isPersisting=!0,this.persistMetadata().finally((()=>{this.isPersisting=!1,this.persistQueued&&(this.persistQueued=!1,this.schedulePersist())})))))}set(e,t){const i=this.metadata[e];if(this.valuesEqual(e,i,t))return;this.metadata=Object.assign(Object.assign({},this.metadata),{[e]:t}),this.dbPromise&&this.schedulePersist();const s=this.listeners[e];s&&s.size>0&&queueMicrotask((()=>{s.forEach((e=>{e()}))}))}persistMetadata(){return l(this,void 0,void 0,(function*(){if(!this.isDisposing){this.inFlightOps++;try{const e=yield this.getDb(),t=c.serialize(this.metadata),i=(0,o.nj)(t);return yield new Promise(((t,s)=>{e.run("INSERT OR REPLACE INTO meta (key, value) VALUES (?, ?)","0",i,(e=>{e?s(e):t()}))}))}finally{this.inFlightOps--}}}))}subscribe(e,t){const i=this.listeners[e];return i?(i.add(t),()=>i.delete(t)):()=>{}}dispose(){return l(this,void 0,void 0,(function*(){return this.disposePromise?this.disposePromise:this.dbPromise?(this.disposePromise=this.cleanup().then((()=>{this.dbPromise=void 0})),this.disposePromise):void 0}))}cleanup(){return l(this,void 0,void 0,(function*(){if(!this.dbPromise)return;for(this.isDisposing=!0,this.persistQueued=!1;this.isPersisting||this.inFlightOps>0;)yield new Promise((e=>setTimeout(e,10)));const e=yield this.dbPromise,t=yield new Promise(((t,i)=>{e.get("SELECT value FROM meta WHERE key = ?","0",((e,s)=>{e?i(e):t(s)}))}));let i=0;if(null==t?void 0:t.value){const e=(0,o.aD)(t.value);i=c.deserialize(e).latestRootBlobId.length}if(yield new Promise((t=>{e.close((()=>t()))})),0!==i);else{this.dbPromise=void 0;const e=(0,n.dirname)(this.dbPath);try{(0,s.rmSync)(e,{recursive:!0,force:!0})}catch(e){}}}))}}}};