try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5b97228f-1697-46be-a2ed-78e6fec54711",e._sentryDebugIdIdentifier="sentry-dbid-5b97228f-1697-46be-a2ed-78e6fec54711")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.02.13-41ac335"}}catch(e){}}(),exports.id=874,exports.ids=[874],exports.modules={"./src/commands/dev-cursor-blame.ts":(e,t,n)=>{n.r(t),n.d(t,{calculateAiPercentage:()=>k,classifyConversation:()=>H,extractAiSourceBreakdown:()=>I,extractConversationStats:()=>w,handleDevClassifyConversation:()=>R,handleDevScoreCommit:()=>M,handleDevScoreRecentCommits:()=>C});var i=n("node:child_process"),s=n("node:fs"),o=n("node:fs/promises"),r=n("node:os"),d=n("node:path"),a=n("node:util"),c=n("../agent-analytics/dist/index.js"),l=n("../agent-analytics/dist/commit-scoring/index.js"),u=n("../agent-analytics/dist/node.js"),m=n("../agent-kv/dist/index.js"),f=n("../agent-transcript/dist/index.js"),p=n("../context/dist/index.js"),$=n("../proto/dist/generated/aiserver/v1/analytics_pb.js"),g=n("./src/client.ts"),y=n("./src/console-io.ts"),h=n("./src/constants.ts"),v=n("./src/cursor-blame/cli-commit-scoring.ts"),S=n("./src/cursor-blame/sqlite-adapter.ts"),b=n("./src/state/index.ts"),j=n("./src/state/sqlite-blob-store.ts"),L=n("./src/transcript/index.ts"),A=function(e,t,n,i){return new(n||(n=Promise))((function(s,o){function r(e){try{a(i.next(e))}catch(e){o(e)}}function d(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}a((i=i.apply(e,t||[])).next())}))};const D=(0,a.promisify)(i.execFile);function w(e){var t,n;const i=new Map;for(const[,s]of e)for(const[,e]of s){for(const n of e.additions)if(n.conversationId){const e=null!==(t=i.get(n.conversationId))&&void 0!==t?t:{linesAdded:0,linesDeleted:0};e.linesAdded++,i.set(n.conversationId,e)}for(const t of e.deletions)if(t.conversationId){const e=null!==(n=i.get(t.conversationId))&&void 0!==n?n:{linesAdded:0,linesDeleted:0};e.linesDeleted++,i.set(t.conversationId,e)}}return i}function I(e){let t=0,n=0,i=0,s=0,o=0,r=0;for(const[,d]of e){const e=d.get(l.IA.TAB);e&&(t+=e.additions.length,n+=e.deletions.length);const a=d.get(l.IA.COMPOSER);a&&(i+=a.additions.length,s+=a.deletions.length);const c=d.get(l.IA.CLI);c&&(o+=c.additions.length,r+=c.deletions.length)}return{tabLinesAdded:t,tabLinesDeleted:n,composerLinesAdded:i,composerLinesDeleted:s,cliLinesAdded:o,cliLinesDeleted:r}}function k(e){const t=e.totalLinesAdded+e.totalLinesDeleted,n=e.tabLinesAdded+e.tabLinesDeleted+e.composerLinesAdded+e.composerLinesDeleted+e.cliLinesAdded+e.cliLinesDeleted;return t>0?(n/t*100).toFixed(1):"0.0"}const x=(0,d.join)((0,r.homedir)(),".cursor","ai-tracking","ai-code-tracking.db");function C(e){return A(this,arguments,void 0,(function*(e,t=10,n){var i,s;const o=new u.Z,r=(0,S.$)(),d=new c.Ou(r,x);try{yield d.initialize();const r=yield(0,c.f_)(o,[e.workspacePath]);if(0===r.length)return void(0,y.p2)("No git repositories found in workspace\n");for(const a of r){let r,l;if(n)r=yield o.getCommitsByAuthor(a,n,t),l=n;else{const e=yield(0,c.IG)(o,a,{limit:t});if(!e)continue;r=e.commits,l=e.user}if(0===r.length)continue;const u=yield(0,c.pt)(o,a);(0,y.p2)(`\n${h.oH}Repository:${h.Sj} ${null!==(i=u.repoName)&&void 0!==i?i:a}\n`),(0,y.p2)(`${h.Ip}Branch:${h.Sj} ${null!==(s=u.branchName)&&void 0!==s?s:"unknown"}\n`),(0,y.p2)(`${h.Ip}User:${h.Sj} ${l}\n`),(0,y.p2)(`${h.Ip}─────────────────────────────────────────${h.Sj}\n`);for(const t of r)yield B(t,a,o,d,e)}}finally{yield d.close()}}))}function M(e,t){return A(this,void 0,void 0,(function*(){const n=new u.Z,i=(0,S.$)(),s=new c.Ou(i,x);try{yield s.initialize();const i=yield(0,c.f_)(n,[e.workspacePath]);if(0===i.length)return void(0,y.p2)("No git repositories found in workspace\n");let o,r=t;if(r){for(const e of i)if(yield n.commitExists(e,r)){o=e;break}}else{for(const e of i){const t=yield(0,c.IG)(n,e,{limit:1});if(t&&t.commits.length>0){r=t.commits[0],o=e,(0,y.p2)(`${h.Ip}Using most recent commit: ${r.substring(0,8)}${h.Sj}\n`);break}}if(!r)return void(0,y.p2)("No commits found by current user\n")}if(!o)return void(0,y.p2)(`Commit ${r} not found in any repository\n`);yield B(r,o,n,s,e)}finally{yield s.close()}}))}function B(e,t,n,i,s){return A(this,void 0,void 0,(function*(){var o;try{const{stdout:r}=yield D("git",["show","-s","--format=%H%n%s%n%aI",e],{cwd:t,maxBuffer:10485760}),[d,a,c]=r.trim().split("\n"),{stdout:u}=yield D("git",["show","--format=",e],{cwd:t,maxBuffer:10485760}),m=(0,v.parseGitDiff)(u);if(0===m.length)return void(0,y.p2)(`${h.oH}${null==d?void 0:d.substring(0,8)}${h.Sj} ${h.Ip}- No changes${h.Sj}\n`);const f=c?new Date(c).getTime()+1e3:void 0,p=function(e,t){return{getGitRoot:t=>e.getGitRoot(t),getRemotes:t=>e.getRemotes(t),getGitUser:t=>e.getGitUser(t),getCommitsByAuthor:(t,n,i)=>e.getCommitsByAuthor(t,n,i),getRecentCommits:(t,n,i)=>e.getRecentCommits(t,n,i),getCurrentBranch:t=>e.getCurrentBranch(t),getDefaultBranch:t=>e.getDefaultBranch(t),getUpstreamUrl:t=>e.getUpstreamUrl(t),getSubmodules:t=>e.getSubmodules(t),commitExists:(t,n)=>e.commitExists(t,n),hashObject:(t,n)=>e.hashObject(t,n),catBlob:(t,n)=>e.catBlob(t,n),getAiCodeHashes(e,n,i,s){return A(this,void 0,void 0,(function*(){const o=(0,l.H2)(e,n);return t.getHashes(o,{minCreatedAt:i,maxCreatedAt:s})}))},getTrackingStartTime(){return A(this,void 0,void 0,(function*(){return t.getTrackingStartTime()}))}}}(n,i),$=[...new Set(m.flatMap((e=>[e.from,e.to].filter((e=>!!e&&"/dev/null"!==e)).map((e=>e.replace(/\\/g,"/"))))))],g=$.length>0?yield i.getAiDeletedFiles($,f):new Set,S=yield(0,l.fS)(m,{normalizeLines:!0,gitOperations:p,repoRoot:t,commitHash:e,commitTimestamp:f,isAiDeletedFile:e=>g.has(e)});if(!S)return void(0,y.p2)(`${h.Ip}  No AI hash data available for commit ${null==d?void 0:d.substring(0,8)} — skipping${h.Sj}\n`);const b=I(S.aiLineRanges),j=w(S.aiLineRanges),L=k({tabLinesAdded:Math.max(b.tabLinesAdded,S.tabLinesAdded),tabLinesDeleted:Math.max(b.tabLinesDeleted,S.tabLinesDeleted),composerLinesAdded:Math.max(b.composerLinesAdded,S.composerLinesAdded),composerLinesDeleted:Math.max(b.composerLinesDeleted,S.composerLinesDeleted),cliLinesAdded:b.cliLinesAdded,cliLinesDeleted:b.cliLinesDeleted,totalLinesAdded:S.linesAdded,totalLinesDeleted:S.linesDeleted}),x=c?new Date(c).toLocaleString():"unknown";if((0,y.p2)(`${h.oH}${null==d?void 0:d.substring(0,8)}${h.Sj} - ${null==a?void 0:a.substring(0,50)}${(null!==(o=null==a?void 0:a.length)&&void 0!==o?o:0)>50?"...":""}\n`),(0,y.p2)(`  ${h.Ip}${x}${h.Sj}\n`),(0,y.p2)(`  ${h.Ip}Lines:${h.Sj} ${h.ki}+${S.linesAdded}${h.Sj}/${h.s0}-${S.linesDeleted}${h.Sj} ${h.Ip}|${h.Sj} ${h.Ip}AI:${h.Sj} ${h.oH}${L}%${h.Sj}\n`),(b.tabLinesAdded>0||b.tabLinesDeleted>0)&&(0,y.p2)(`  ${h.Ip}Tab:${h.Sj} ${h.ki}+${b.tabLinesAdded}${h.Sj}/${h.s0}-${b.tabLinesDeleted}${h.Sj}\n`),(b.composerLinesAdded>0||b.composerLinesDeleted>0)&&(0,y.p2)(`  ${h.Ip}Composer:${h.Sj} ${h.ki}+${b.composerLinesAdded}${h.Sj}/${h.s0}-${b.composerLinesDeleted}${h.Sj}\n`),(b.cliLinesAdded>0||b.cliLinesDeleted>0)&&(0,y.p2)(`  ${h.Ip}CLI:${h.Sj} ${h.ki}+${b.cliLinesAdded}${h.Sj}/${h.s0}-${b.cliLinesDeleted}${h.Sj}\n`),j.size>0){(0,y.p2)(`  ${h.Ip}Conversations: ${j.size} detected${h.Sj}\n`);for(const[e,t]of j){const n=yield H(s,e),i=`+${t.linesAdded}/-${t.linesDeleted}`;if(n.success&&n.summary){const t=n.summary.length>50?`${n.summary.substring(0,50)}...`:n.summary;(0,y.p2)(`    ${h.Ip}•${h.Sj} ${h.A}${e.substring(0,8)}${h.Sj} ${h.oH}${i}${h.Sj} ${h.Ip}- ${t}${h.Sj}\n`)}else(0,y.p2)(`    ${h.Ip}•${h.Sj} ${h.A}${e.substring(0,8)}${h.Sj} ${h.oH}${i}${h.Sj}\n`)}}(0,y.p2)("\n")}catch(t){(0,y.p2)(`Error scoring ${e}: ${t instanceof Error?t.message:String(t)}\n`)}}))}function H(e,t){return A(this,void 0,void 0,(function*(){const n=(0,g.Mr)(e.credentialManager,{endpoint:e.backendUrl,insecure:e.insecure,configProvider:e.configProvider});try{let i=yield function(e,t){return A(this,void 0,void 0,(function*(){const n=(0,L.kw)(e,t);try{return yield(0,o.readFile)(n,"utf-8")}catch(e){return}}))}(e.workspacePath,t),r=!1;if(i||(i=yield function(e,t){return A(this,void 0,void 0,(function*(){const n=(0,b.r)(),i=(0,d.join)(n,t),r=(0,d.join)(i,"store.db");if(!(0,s.existsSync)(r))return;const a=(0,p.q6)().withName("generateTranscript");let c;try{c=yield j.M.initAndLoad(r);const n=new m.pH(c,c);yield n.resetFromDb(a);const i=n.getConversationStateStructure();if(0===i.turns.length)return;const s=yield(0,f.Jb)(a,n.getBlobStore(),i),d=(0,L.kw)(e,t),l=(0,L.$J)(e);return yield(0,o.mkdir)(l,{recursive:!0}),yield(0,o.writeFile)(d,s,"utf-8"),s}catch(e){return}finally{yield null==c?void 0:c.dispose()}}))}(e.workspacePath,t),i&&(r=!0)),!i)return{success:!1,errorMessage:`Conversation "${t}" not found. Make sure the conversation exists and has at least one turn.`};const a=yield n.ingestConversation(new $.$g({conversationId:t,transcript:i.trim(),transcriptJson:"",mode:"unknown",model:"unknown",lastUpdatedAt:BigInt(Date.now())}));return{success:a.success,summary:a.summary||void 0,detailedSummary:a.detailedSummary||void 0,errorMessage:a.errorMessage||void 0,transcriptGenerated:r}}catch(e){return{success:!1,errorMessage:e instanceof Error?e.message:String(e)}}}))}function R(e,t){return A(this,void 0,void 0,(function*(){(0,y.p2)(`${h.oH}Conversation:${h.Sj} ${t}\n`),(0,y.p2)(`${h.Ip}─────────────────────────────────────────${h.Sj}\n`);const n=yield H(e,t);n.success?((0,y.p2)(`${h.ki}✓ Classification successful${h.Sj}\n\n`),n.summary&&((0,y.p2)(`${h.oH}Summary:${h.Sj}\n`),(0,y.p2)(`${n.summary}\n\n`)),n.detailedSummary&&((0,y.p2)(`${h.oH}Detailed Summary:${h.Sj}\n`),(0,y.p2)(`${n.detailedSummary}\n`)),n.summary||n.detailedSummary||(0,y.p2)(`${h.Ip}(No summary returned)${h.Sj}\n`)):((0,y.p2)(`${h.Dk}✗ Classification failed${h.Sj}\n`),n.errorMessage&&(0,y.p2)(`${h.Ip}Error: ${n.errorMessage}${h.Sj}\n`))}))}}};