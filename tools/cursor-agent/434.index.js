try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="54c5f025-1e71-482a-906b-a05db3af0937",e._sentryDebugIdIdentifier="sentry-dbid-54c5f025-1e71-482a-906b-a05db3af0937")}()}catch(e){}!function(){try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"agent-cli@2026.01.28-fd13201"}}catch(e){}}(),exports.id=434,exports.ids=[156,302,434],exports.modules={"../agent-ui-state/dist/index.js":(e,t,n)=>{n.d(t,{VX:()=>o,RN:()=>P,b:()=>j,Du:()=>L,II:()=>O,OE:()=>R,N1:()=>C,HG:()=>D,Yb:()=>_,cp:()=>F,ti:()=>N,as:()=>A,k4:()=>Y,bE:()=>z,Gv:()=>I,HE:()=>H,P4:()=>W});class o extends Error{constructor(e){super(e),this.name="MergeError"}}var r=n("../proto/dist/generated/agent/v1/agent_pb.js"),s=n("../proto/dist/generated/agent/v1/shell_exec_pb.js"),i=n("../proto/dist/generated/agent/v1/shell_tool_pb.js");function l(e){const t=e.call;return!("readToolCall"!==t.tool.case&&"lsToolCall"!==t.tool.case&&"globToolCall"!==t.tool.case&&"grepToolCall"!==t.tool.case&&"readLintsToolCall"!==t.tool.case&&"semSearchToolCall"!==t.tool.case)}function a(e){return"taskToolCall"===e.call.tool.case}function c(e,t){return!(!l(t)||!function(e){return e.calls.every(l)}(e))||!(!a(t)||!function(e){return e.calls.every(a)}(e))}function d(e){const t={id:e.callId,call:e.toolCall,completed:!1,aborted:!1};if("taskToolCall"===e.toolCall.tool.case){const n=e.toolCall.tool.value.args,o=null==n?void 0:n.agentId,r=Object.assign({type:"task",status:"running"},o?{agentId:o}:{});return Object.assign(Object.assign({},t),{additionalData:r})}return t}function u(e,t){const n=e.groups[e.groups.length-1],o=d(t);return void 0===n?{type:"tool-call-segment",groups:[{type:"tool-call-group",calls:[o]}]}:c(n,o)?Object.assign(Object.assign({},e),{groups:[...e.groups.slice(0,-1),Object.assign(Object.assign({},n),{calls:[...n.calls,o]})]}):Object.assign(Object.assign({},e),{groups:[...e.groups,{type:"tool-call-group",calls:[o]}]})}function p(e){return{type:"tool-call-segment",groups:[{type:"tool-call-group",calls:[d(e)]}]}}function h(e,t){return{type:"tool-call-segment",groups:e.groups.map((e=>Object.assign(Object.assign({},e),{calls:e.calls.map((e=>e.id===t.callId?Object.assign(Object.assign({},e),{call:t.toolCall,completed:!0}):e))})))}}function g(e,t){return{type:"tool-call-segment",groups:e.groups.map((e=>Object.assign(Object.assign({},e),{calls:e.calls.map((e=>{var n,o;if(e.id===t.callId&&"shellToolCallDelta"===t.toolCallDelta.delta.case&&"shellToolCall"===e.call.tool.case){const l=t.toolCallDelta.delta.value,a=e.call.tool.value,c=null===(n=a.result)||void 0===n?void 0:n.result;let d="",u="";"success"===(null==c?void 0:c.case)&&(d=c.value.stdout||"",u=c.value.stderr||""),"stdout"===l.delta.case?d+=l.delta.value.content:"stderr"===l.delta.case&&(u+=l.delta.value.content);const p=new i.$M({args:a.args,result:new s.W4({result:{case:"success",value:new s.QR({stdout:d,stderr:u})},sandboxPolicy:null===(o=a.result)||void 0===o?void 0:o.sandboxPolicy})});return Object.assign(Object.assign({},e),{call:new r.ToolCall({tool:{case:"shellToolCall",value:p}})})}return e}))})))}}function m(e){return void 0===e?[]:"text"===e.type?[{type:"text",content:e.content,completed:!0}]:"plan"===e.type?[{type:"plan",tool:e.tool,status:e.status}]:"tool-call-segment"===e.type?e.groups:[]}function f(e,t){var n;if("createPlanToolCall"===t.toolCall.tool.case)return Object.assign({},e);if("tool-call-segment"===(null===(n=e.pendingState)||void 0===n?void 0:n.type))return Object.assign(Object.assign({},e),{pendingState:h(e.pendingState,t)});throw new o("No pending state")}function v(e,t){var n;if("createPlanToolCall"===t.toolCall.tool.case)return Object.assign(Object.assign({},e),{pendingState:{type:"plan",tool:t.toolCall,status:"accepted"}});switch(null===(n=e.pendingState)||void 0===n?void 0:n.type){case"tool-call-segment":return Object.assign(Object.assign({},e),{pendingState:u(e.pendingState,t)});case"text":case"plan":case void 0:return Object.assign(Object.assign({},e),{completedSteps:[...e.completedSteps,...m(e.pendingState)],pendingState:p(t)})}}function x(e,t){var n;switch(null===(n=e.pendingState)||void 0===n?void 0:n.type){case"text":return Object.assign(Object.assign({},e),{pendingState:{type:"text",content:e.pendingState.content+t.text,completed:!1}});case"plan":return Object.assign({},e);case"tool-call-segment":case void 0:return Object.assign(Object.assign({},e),{completedSteps:[...e.completedSteps,...m(e.pendingState)],pendingState:{type:"text",content:t.text,completed:!1}})}return e}function b(e,t){return{type:"agent",userMessage:e,isPlanExecution:t,completedSteps:[],pendingState:void 0,thinkingContent:void 0}}function y(e,t){var n;return"tool-call-segment"===(null===(n=e.pendingState)||void 0===n?void 0:n.type)?Object.assign(Object.assign({},e),{pendingState:g(e.pendingState,t)}):e}function j(e,t,n=0){var o;let r;const s=e=>{var t;const n=e.call.tool;if("editToolCall"===n.case)return null===(t=n.value.args)||void 0===t?void 0:t.path},i=e=>{for(let t=e.calls.length-1;t>=0;t--){const n=s(e.calls[t]);if(n)return n}},l=e=>{for(let t=e.length-1;t>=0;t--){const n=e[t];if("tool-call-group"===n.type){const e=i(n);if(e)return e}}};if("agent"===(null===(o=e.pendingTurn)||void 0===o?void 0:o.type)){const t=e.pendingTurn;if(t.pendingState){const e=(e=>{if("tool-call-segment"===e.type)for(let t=e.groups.length-1;t>=0;t--){const n=i(e.groups[t]);if(n)return n}})(t.pendingState);e&&(r=e)}if(!r){const e=l(t.completedSteps);e&&(r=e)}}if(!r)for(let t=e.completedTurns.length-1;t>=0;t--){const n=e.completedTurns[t];if("shell"===n.type)continue;const o=l(n.steps);if(o){r=o;break}}const a=r?t.findIndex((e=>e.path===r)):-1;return a>=0?a:n}function w(e){if(!e.result)return"running";switch(e.result.result.case){case"success":return"success";case"error":return"error";default:return"running"}}function k(e,t,n){var o,r,s,i;const l={id:t,call:e,completed:!0,aborted:!1};if("taskToolCall"!==e.tool.case)return l;const a=e.tool.value,c="success"===(null===(o=a.result)||void 0===o?void 0:o.result.case)?a.result.result.value.agentId:void 0,d=null===(r=a.args)||void 0===r?void 0:r.agentId,u=null!=c?c:d;if(!u)return Object.assign(Object.assign({},l),{additionalData:{type:"task",status:w(a)}});const p=null!==(i=null==n?void 0:n._visitedAgentIds)&&void 0!==i?i:new Set;if(p.has(u))return Object.assign(Object.assign({},l),{additionalData:{type:"task",status:w(a),agentId:u}});const h=null===(s=null==n?void 0:n.subagentStates)||void 0===s?void 0:s[u];let g;if(h){const e=new Set(p).add(u);g=C(h.conversationState,Object.assign(Object.assign({},n),{_visitedAgentIds:e}))}return Object.assign(Object.assign({},l),{additionalData:{type:"task",status:w(a),subagentState:g,agentId:u}})}function C(e,t){var n,o;const r=function(e,t){return e.turns?e.turns.map(((e,n)=>function(e,t,n){switch(e.turn.case){case"agentConversationTurn":return function(e,t,n){var o,r;const s=null!==(r=null===(o=e.userMessage)||void 0===o?void 0:o.text)&&void 0!==r?r:"",i=[];let l;for(let o=0;o<e.steps.length;o++){const r=e.steps[o];switch(r.message.case){case"assistantMessage":l&&(i.push(l),l=void 0),i.push({type:"text",content:r.message.value.text,completed:!0});break;case"toolCall":{const e=k(r.message.value,`loaded-${t}-${o}`,n);l&&c(l,e)?l.calls.push(e):(l&&i.push(l),l={type:"tool-call-group",calls:[e]});break}}}return l&&i.push(l),{type:"agent",userMessage:s,steps:i}}(e.turn.value,t,n);case"shellConversationTurn":return{type:"shell",shellCommand:null!==(a=null===(r=(o=e.turn.value).shellCommand)||void 0===r?void 0:r.command)&&void 0!==a?a:"",stdout:null!==(d=null===(s=o.shellOutput)||void 0===s?void 0:s.stdout)&&void 0!==d?d:"",stderr:null!==(u=null===(i=o.shellOutput)||void 0===i?void 0:i.stderr)&&void 0!==u?u:"",exitCode:null!==(p=null===(l=o.shellOutput)||void 0===l?void 0:l.exitCode)&&void 0!==p?p:0};case void 0:throw new Error(`Turn at index ${t} has no case`);default:{const n=e.turn;throw console.error(`Turn at index ${t} has unknown type:`,{turnCase:n.case}),new Error(`Unknown turn type at index ${t}: ${n.case}`)}}var o,r,s,i,l,a,d,u,p}(e,n,t))):[]}(e,t);return Object.assign(Object.assign({},{summary:void 0,completedTurns:[],pendingTurn:void 0,summarizing:!1,liveTokens:0,rejectedPlan:!1}),{summary:null!==(o=null===(n=e.summary)||void 0===n?void 0:n.summary)&&void 0!==o?o:void 0,completedTurns:r})}var S=n("../agent-core/dist/index.js");function E(e,t){if("stdout"===t.event.case)return Object.assign(Object.assign({},e),{stdout:e.stdout+t.event.value.data});if("stderr"===t.event.case)return Object.assign(Object.assign({},e),{stderr:e.stderr+t.event.value.data});if("exit"===t.event.case)return Object.assign(Object.assign({},e),{exitCode:t.event.value.code});throw new o("Invalid shell output delta update")}function $(e){return{type:"shell",shellCommand:e,stdout:"",stderr:"",exitCode:void 0}}function M(e){if("agent"===e.type)return{type:"agent",userMessage:e.userMessage,isPlanExecution:e.isPlanExecution,steps:[...e.completedSteps,...m(e.pendingState)]};if("shell"===e.type)return{type:"shell",shellCommand:e.shellCommand,stdout:e.stdout,stderr:e.stderr,exitCode:e.exitCode};throw new o("Turn is not an agent turn")}function T(e,t){var n;return Object.assign(Object.assign({},e),{thinkingContent:(null!==(n=e.thinkingContent)&&void 0!==n?n:"")+t.text})}function A(e,t){if("summary"===t.type)return{summary:t.summary,completedTurns:[],pendingTurn:void 0,summarizing:!1,liveTokens:0,rejectedPlan:!1};if("summary-started"===t.type)return Object.assign(Object.assign({},e),{summarizing:!0});if("summary-completed"===t.type)return Object.assign(Object.assign({},e),{summarizing:!1});if("token-delta"===t.type)return Object.assign(Object.assign({},e),{liveTokens:e.liveTokens+t.tokens});if("text-delta"===t.type)return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return Object.assign(Object.assign({},e),{pendingTurn:x(e.pendingTurn,t)})}(e,t);if("tool-call-started"===t.type)return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return Object.assign(Object.assign({},e),{pendingTurn:v(e.pendingTurn,t)})}(e,t);if("tool-call-completed"===t.type)return function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return"createPlanToolCall"===t.toolCall.tool.case?Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{pendingState:{type:"plan",tool:t.toolCall,status:"accepted"}})}):Object.assign(Object.assign({},e),{pendingTurn:f(e.pendingTurn,t)})}(e,t);if("tool-call-delta"===t.type){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return"taskToolCallDelta"===t.toolCallDelta.delta.case?function(e,t,n){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");const r=e.pendingTurn.pendingState;if("tool-call-segment"!==(null==r?void 0:r.type))return e;const s=n.interactionUpdate;if(!s)return e;const i=(0,S.yy)(s);if(!i)return e;const l=t.callId,{segment:a,tokenDelta:c}=function(e,t,n){let r=0;const s=e.groups.map((e=>Object.assign(Object.assign({},e),{calls:e.calls.map((e=>{if(e.id!==t)return e;const s=function(e,t){var n,r;const s=e.additionalData,i=null!==(n=null==s?void 0:s.subagentState)&&void 0!==n?n:{completedTurns:[],pendingTurn:{type:"agent",userMessage:"",completedSteps:[],pendingState:void 0,thinkingContent:void 0},liveTokens:0,summarizing:!1,summary:void 0,rejectedPlan:!1},l=i.liveTokens;let a;try{a=A(i,t)}catch(e){if(!(e instanceof o))throw e;a=i}const c=a.liveTokens-l,d={type:"task",status:null!==(r=null==s?void 0:s.status)&&void 0!==r?r:"running",subagentState:a,agentId:null==s?void 0:s.agentId};return{call:Object.assign(Object.assign({},e),{additionalData:d}),tokenDelta:c}}(e,n);return r+=s.tokenDelta,s.call}))})));return{segment:{type:"tool-call-segment",groups:s},tokenDelta:r}}(r,l,i);return Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{pendingState:a}),liveTokens:e.liveTokens+c})}(e,t,t.toolCallDelta.delta.value):Object.assign(Object.assign({},e),{pendingTurn:y(e.pendingTurn,t)})}return"user-message-appended"===t.type?function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");const n=t.userMessage.simulatedMsgReason===r.SimulatedMsgReason.PLAN_EXECUTION,s=b(t.userMessage.text,n);return Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,M(e.pendingTurn)],pendingTurn:s,liveTokens:0})}(e,t):"thinking-delta"===t.type?function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return Object.assign(Object.assign({},e),{pendingTurn:T(e.pendingTurn,t)})}(e,t):"thinking-completed"===t.type?function(e){if(!e.pendingTurn)throw new o("No pending turn");if("agent"!==e.pendingTurn.type)throw new o("Pending turn is not an agent turn");return Object.assign(Object.assign({},e),{pendingTurn:(t=e.pendingTurn,Object.assign(Object.assign({},t),{thinkingContent:""}))});var t}(e):"shell-output-delta"===t.type?function(e,t){if(!e.pendingTurn)throw new o("No pending turn");if("shell"!==e.pendingTurn.type)throw new o("Pending turn is not a shell turn");return Object.assign(Object.assign({},e),{pendingTurn:E(e.pendingTurn,t)})}(e,t):e}function I(e){var t;const n=e.pendingTurn;return"agent"===(null==n?void 0:n.type)&&"plan"===(null===(t=n.pendingState)||void 0===t?void 0:t.type)?e:Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,...e.pendingTurn?[M(e.pendingTurn)]:[]],pendingTurn:void 0})}function D(e,t){return Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,...e.pendingTurn?[M(e.pendingTurn)]:[]],pendingTurn:b(t),liveTokens:0,rejectedPlan:!1})}function _(e,t){return Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,...e.pendingTurn?[M(e.pendingTurn)]:[]],pendingTurn:$(t),liveTokens:0,rejectedPlan:!1})}function P(e){return e.pendingTurn?"agent"===e.pendingTurn.type?Object.assign(Object.assign({},e),{pendingTurn:(t=e.pendingTurn,"tool-call-segment"===(null===(n=t.pendingState)||void 0===n?void 0:n.type)?Object.assign(Object.assign({},t),{pendingState:(o=t.pendingState,{type:"tool-call-segment",groups:o.groups.map((e=>Object.assign(Object.assign({},e),{calls:e.calls.map((e=>Object.assign(Object.assign({},e),{completed:!1,aborted:!0})))})))})}):t),liveTokens:0}):"shell"===e.pendingTurn.type?Object.assign(Object.assign({},e),{pendingTurn:(r=e.pendingTurn,Object.assign(Object.assign({},r),{exitCode:130})),liveTokens:0}):e:e;var t,n,o,r}function L(){return{completedTurns:[],pendingTurn:void 0,liveTokens:0,summarizing:!1,summary:void 0,rejectedPlan:!1}}function R(e){var t;const n=e.pendingTurn;return"agent"===(null==n?void 0:n.type)&&"plan"===(null===(t=n.pendingState)||void 0===t?void 0:t.type)}function O(e){var t;const n=e.pendingTurn;return"agent"===(null==n?void 0:n.type)&&"plan"===(null===(t=n.pendingState)||void 0===t?void 0:t.type)?"accepted"===n.pendingState.status?0:1:0}function Y(e,t){var n,o;return"agent"===(null===(n=e.pendingTurn)||void 0===n?void 0:n.type)&&"plan"===(null===(o=e.pendingTurn.pendingState)||void 0===o?void 0:o.type)?Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{pendingState:Object.assign(Object.assign({},e.pendingTurn.pendingState),{status:0===t?"accepted":"rejected"})})}):e}function z(e){var t,n;return"agent"===(null===(t=e.pendingTurn)||void 0===t?void 0:t.type)&&"plan"===(null===(n=e.pendingTurn.pendingState)||void 0===n?void 0:n.type)?Object.assign(Object.assign({},e),{completedTurns:[...e.completedTurns,M({type:"agent",userMessage:e.pendingTurn.userMessage,completedSteps:[...e.pendingTurn.completedSteps,{type:"plan",tool:e.pendingTurn.pendingState.tool,status:"rejected"}],pendingState:void 0,thinkingContent:void 0})],pendingTurn:void 0,rejectedPlan:!0}):e}function N(e){var t,n;return"agent"===(null===(t=e.pendingTurn)||void 0===t?void 0:t.type)&&"plan"===(null===(n=e.pendingTurn.pendingState)||void 0===n?void 0:n.type)?Object.assign(Object.assign({},e),{pendingTurn:Object.assign(Object.assign({},e.pendingTurn),{completedSteps:[...e.pendingTurn.completedSteps,{type:"plan",tool:e.pendingTurn.pendingState.tool,status:"accepted"}],pendingState:void 0,thinkingContent:void 0})}):e}function F(e){return Object.assign(Object.assign({},e),{rejectedPlan:!1})}function B(e,t,n,o){const r=`${e}-step-${t}`;return"text"===n.type?[{type:"agent-text",text:n.content,key:r}]:"plan"===n.type?[{type:"plan",call:n.tool,decisionIndex:"accepted"===n.status?0:1,key:r}]:[{type:"agent-tool-calls",calls:n.calls,key:r,isLastTurn:o}]}function U(e,t,n){return"agent"===t.type?[!0===t.isPlanExecution?{type:"plan-execution",message:t.userMessage,key:`${e}-plan-execution`}:{type:"user-message",message:t.userMessage,key:`${e}-user-message`},...t.steps.flatMap(((t,o)=>B(e,o,t,n)))]:"shell"===t.type?[{type:"shell-turn",command:t.shellCommand,key:`${e}-shell-turn`,stdout:t.stdout,stderr:t.stderr,exitCode:t.exitCode}]:[]}function q(e,t){return"text"===t.type?[{type:"agent-text",text:t.content,completed:t.completed,key:e}]:"plan"===t.type?[{type:"plan",call:t.tool,decisionIndex:"accepted"===t.status?0:1,key:e}]:t.groups.flatMap(((t,n)=>({type:"agent-tool-calls",calls:t.calls,isLastStepOfTurn:!0,key:`${e}-pending-state-${n}`,isLastTurn:!0})))}function H(e,t,n){var o,r;const s=[{type:"header",key:"header",isRepository:null!==(o=null==n?void 0:n.isRepository)&&void 0!==o&&o,folderMode:null!==(r=null==n?void 0:n.folderMode)&&void 0!==r?r:"cwd"}];t&&s.push({type:"debug-info",serverUrl:t.serverUrl,key:"debug-info"}),e.summary&&s.push({type:"summary",summary:e.summary,key:"summary"});const i=[];let l=0;for(const t of e.completedTurns){const n=!e.pendingTurn&&l===e.completedTurns.length-1;s.push(...U(`turn-${l}`,t,n)),l++}if(e.pendingTurn){const{static:t,dynamic:n}=(a=`turn-${l}`,"agent"===(c=e.pendingTurn).type?function(e,t){var n;return void 0===t.pendingState&&0===t.completedSteps.length?{static:[],dynamic:[!0===t.isPlanExecution?{type:"plan-execution",message:t.userMessage,key:`${e}-plan-execution`}:{type:"user-message",message:t.userMessage,key:`${e}-user-message`}]}:"text"===(null===(n=t.pendingState)||void 0===n?void 0:n.type)&&0===t.completedSteps.length?{static:[],dynamic:[!0===t.isPlanExecution?{type:"plan-execution",message:t.userMessage,key:`${e}-plan-execution`}:{type:"user-message",message:t.userMessage,key:`${e}-user-message`},...void 0!==t.pendingState?q(e,t.pendingState):[]]}:{static:[!0===t.isPlanExecution?{type:"plan-execution",message:t.userMessage,key:`${e}-plan-execution`}:{type:"user-message",message:t.userMessage,key:`${e}-user-message`},...t.completedSteps.flatMap(((t,n)=>B(e,n,t,!0)))],dynamic:void 0!==t.pendingState?q(e,t.pendingState):[]}}(a,c):"shell"===c.type?function(e,t){return{static:[],dynamic:[{type:"shell-turn",command:t.shellCommand,key:`${e}-shell-turn`,stdout:t.stdout,stderr:t.stderr,exitCode:t.exitCode}]}}(a,c):{static:[],dynamic:[]});s.push(...t),i.push(...n)}var a,c;return{staticItems:s,dynamicItems:i}}function W(e,t){if(t<0)throw new Error("maxTurns must be non-negative");if(0===t)return Object.assign(Object.assign({},e),{completedTurns:[],pendingTurn:void 0});if(t>e.completedTurns.length+(e.pendingTurn?1:0))return e;const n=e.completedTurns.slice(-t);return Object.assign(Object.assign({},e),{completedTurns:n,pendingTurn:void 0})}},"./src/always-deny-decision-provider.ts":(e,t,n)=>{n.d(t,{N:()=>o});class o{requestApproval(e){return Promise.resolve({approved:!1})}}},"./src/background.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{y:()=>E});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),l=n("../proto/dist/generated/aiserver/v1/tools_pb.js"),a=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),c=n("./src/components/animated-dots.tsx"),d=n("./src/components/app-header.tsx"),u=n("./src/components/background-edit-tool-ui.tsx"),p=n("./src/components/background-prompt-bar.tsx"),h=n("./src/components/background-shell-tool-ui.tsx"),g=n("./src/components/background-tool-group-ui.tsx"),m=n("./src/components/hexagon-loader.tsx"),f=n("./src/components/markdown.tsx"),v=n("./src/components/prompt/ephemeral-lines-view.tsx"),x=n("./src/components/step-container.tsx"),b=n("./src/components/user-message-ui.tsx"),y=n("./src/constants.ts"),j=n("./src/debug.ts"),w=n("./src/hooks/prompt/use-ephemeral.ts"),k=n("./src/hooks/use-send-to-background.ts"),C=e([s,c,d,u,p,h,g,m,f,v,x,b]);[s,c,d,u,p,h,g,m,f,v,x,b]=C.then?(await C)():C;const S=e=>{const t=[],n=new Set([l.XaY.EDIT_FILE,l.XaY.EDIT_FILE_V2]),o=[],r=()=>{0!==o.length&&(t.push({type:"tool-group",toolCalls:[...o],index:t.length}),o.length=0)};let s=0;for(let i=0;i<e.length;i++){const l=e[i];if("text"===l.type){if(!l.isDone)continue;r(),t.push({type:"markdown",text:l.text,index:i})}else if("tool"===l.type)n.has(l.toolCall.tool)?(o.length>0&&r(),t.push({type:"individual-tool",call:l.toolCall,result:l.toolResult,index:i})):o.push({call:l.toolCall,result:l.toolResult});else if("user"===l.type){r();const e=s>0;s++,t.push({type:"user-message",content:l.text,index:i,isFollowup:e})}}return r(),t},E=({bcId:e,isAttached:t,backgroundComposerClient:n,isRepository:o,debugInfo:C,modelManager:E,modelDetails:$,responses:M,status:T,isLoadingConversation:A,addOptimisticFollowup:I,removeOptimisticFollowup:D,repoUrl:_,branchName:P,onRequestReview:L,onOpenComposerPicker:R,onSwitchComposer:O,changes:Y,isLoadingDiffs:z})=>{const{sendFollowupToBackground:N,isSubmittingFollowup:F}=(0,k.$)(n),B=(0,a.useMemo)((()=>{var e,t;if($&&$.modelName)return null!==(t=null===(e=E.normalizeModelId($.modelName))||void 0===e?void 0:e.displayName)&&void 0!==t?t:$.modelName}),[$,E]),[U,q]=(0,a.useState)(""),H=(0,w.N)();(0,a.useEffect)((()=>{if(e)try{n.notifyBackgroundComposerShown({bcId:e},{timeoutMs:1e4}).catch((()=>{}))}catch(e){}}),[e,n]);const W=(0,a.useMemo)((()=>{const e=[];return e.push({id:"resume",title:"Resume Session",description:"Open the picker or switch by id with '/resume <id>'",args:[{id:"id",required:!1}],run:(e,t)=>{const n=(t[0]||"").trim();n?null==O||O(n):null==R||R(),q("")}}),e.push({id:"switch",title:"Switch Background",description:"Switch to a cloud agent by id",args:[{id:"id",required:!0}],run:(e,t)=>{const n=(t[0]||"").trim();n&&(null==O||O(n),q(""))}}),e}),[R,O]),{itemsToDisplay:G,firstLiveStepIndex:X}=(0,a.useMemo)((()=>{const e=S(M.bubbles),n=[{type:"header",debugInfo:C,index:1}];for(let t=0;t<e.length;t++)n.push(Object.assign(Object.assign({},e[t]),{index:n.length}));(0,j.debugLogJSON)("computed",n),(0,j.debugLogJSON)("responses",M);let o=0;if(t){for(let e=0;e<n.length;e++){switch(n[e].type){case"header":case"markdown":case"user-message":case"individual-tool":break;case"tool-group":if(e===n.length-1){o=e;break}break;default:throw new Error("Unhandled UIBackgroundItem")}if(-1!==o)break}o=n.length}return{itemsToDisplay:n,firstLiveStepIndex:o}}),[M,C,t]),K=e=>{var t,n,i,a,c,p,m;const v=e.index>0&&("individual-tool"===(null===(t=G[e.index-1])||void 0===t?void 0:t.type)||"tool-group"===(null===(n=G[e.index-1])||void 0===n?void 0:n.type)||"markdown"===(null===(i=G[e.index-1])||void 0===i?void 0:i.type));switch(e.type){case"header":return(0,r.jsx)(d.j,{isBackground:!0,debugInfo:e.debugInfo||void 0,isRepository:o,folderMode:"git",locationDisplayOverride:_,branchDisplayOverride:P});case"markdown":return(0,r.jsx)(x.C,{shouldPadTop:v,paddingRight:4,children:(0,r.jsx)(f.oz,{content:e.text})});case"user-message":return(0,r.jsx)(s.az,{paddingLeft:y.rd,children:(0,r.jsx)(b.H,{content:e.content,overrideBorderColor:e.isFollowup?y.GM:void 0})});case"individual-tool":{const t=e.call.tool;if((0,j.debugLog)("tool",l.XaY[t]),t===l.XaY.EDIT_FILE||t===l.XaY.EDIT_FILE_V2){let t;"editFileResult"===(null===(a=e.result)||void 0===a?void 0:a.result.case)&&(t=e.result.result.value);const n=e.call.params;let o;n.case,o=n.value.relativeWorkspacePath;const i=o.startsWith("/workspace/")?o.slice(11):o;return(0,r.jsx)(s.az,{paddingLeft:y.rd,children:(0,r.jsx)(x.C,{shouldPadTop:v,children:(0,r.jsx)(u.l,{path:i,result:t})})})}if(t===l.XaY.RUN_TERMINAL_COMMAND_V2){const t=e.call.params,n="runTerminalCommandV2Params"===t.case?t.value:void 0,o=null!==(c=null==n?void 0:n.command)&&void 0!==c?c:"",i=null!==(p=null==n?void 0:n.cwd)&&void 0!==p?p:void 0;let l;return"runTerminalCommandV2Result"===(null===(m=e.result)||void 0===m?void 0:m.result.case)&&(l=e.result.result.value),(0,r.jsx)(s.az,{paddingLeft:y.rd,children:(0,r.jsx)(x.C,{shouldPadTop:v,children:(0,r.jsx)(h.d,{command:o,cwd:i,result:l})})})}return(0,r.jsx)(s.az,{paddingLeft:y.rd,children:(0,r.jsx)(x.C,{shouldPadTop:v,children:(0,r.jsxs)(s.EY,{children:["Tool: ",e.call.tool]})})})}case"tool-group":{const t=e.index===G.length-1;return(0,r.jsx)(s.az,{paddingLeft:y.rd,children:(0,r.jsx)(x.C,{shouldPadTop:v,children:(0,r.jsx)(g.i,{toolCalls:e.toolCalls,forceCompleted:!t})})})}default:throw new Error("Unhandled UIBackgroundItem")}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.jC,{items:G.slice(0,X),children:e=>(0,r.jsx)(s.az,{children:K(e)},`static-bg-item-${e.index}`)}),X<G.length&&(0,r.jsx)(s.az,{flexDirection:"column",children:G.slice(X).map((e=>(0,r.jsx)(s.az,{children:K(e)},`live-bg-item-${e.index}`)))}),(A||z&&T!==i.R6p.CREATING)&&(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,paddingTop:A?2:0,paddingLeft:2,children:[(0,r.jsx)(s.az,{width:1,children:(0,r.jsx)(m.A,{customInterval:210,activeColor:"cyan"},"bg-load-hex")}),(0,r.jsx)(s.az,{flexDirection:"row",children:(0,r.jsx)(s.EY,{bold:!0,children:A?"Loading conversation":"Loading diffs"})})]})}),(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsx)(p.m,{prompt:U,setPrompt:q,onSubmit:t=>{const n=t.trim();if(!n)return;if(!e)return;const o=n,r=I(o);N(e,o,{synchronous:!0,bubbleId:r}).then((e=>{"error"===e.type&&D(r)})).catch((()=>{D(r)})),q("")},isDisabled:!e,isProcessing:!1,topStatusMarginTop:G.length>0?3:1,topStatus:(()=>{const e=(()=>{const e=M.bubbles;for(let t=e.length-1;t>=0;t--){const n=e[t];if("thinking"===n.type)return!n.isDone}return!1})(),t=e||T===i.R6p.RUNNING||T===i.R6p.CREATING;return F||t?(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,children:[(0,r.jsx)(s.az,{width:1,children:(0,r.jsx)(m.A,{customInterval:210,activeColor:"green"},"bg-gen-hex")}),(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsx)(s.EY,{bold:!0,children:F?"Pending":e?"Thinking":T===i.R6p.RUNNING?"Generating":"Starting VM"}),(0,r.jsx)(s.EY,{bold:!0,children:(0,r.jsx)(c.U,{})})]})]}):null})(),modelLabel:B,branchName:P,repoUrl:_,onRequestReview:L,bcId:e,changes:Y,isLoadingDiffs:z,slashCommands:W,backgroundComposerClient:n,printEphemeral:(e,t)=>H.set(e,t)})},"prompt"),(0,r.jsx)(v.A,{lines:H.lines})]})};o()}catch(e){o(e)}}))},"./src/commands/chat.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.r(t),n.d(t,{runChat:()=>M});var r=n("node:fs"),s=n("node:path"),i=n("../cursor-config/dist/index.js"),l=n("../shell-exec/dist/index.js"),a=n("./src/analytics.ts"),c=n("./src/api-key-auth.ts"),d=n("./src/client.ts"),u=n("./src/console-io.ts"),p=n("./src/execution-mode/approval.tsx"),h=n("./src/instrument.ts"),g=n("./src/mcp/approval.tsx"),m=n("./src/onboarding.tsx"),f=n("./src/run-agent.tsx"),v=n("./src/statsig.ts"),x=n("./src/tracing.ts"),b=n("./src/utils/api-endpoint.ts"),y=n("./src/utils/auth-errors.ts"),j=n("./src/utils/command-name.ts"),w=n("./src/utils/output-format.ts"),k=n("./src/workspace/approval.tsx"),C=n("./src/commands/resume.tsx"),S=e([p,g,m,f,k,C]);[p,g,m,f,k,C]=S.then?(await S)():S;var E=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function $(e){if(!e)return;const t={},n=Array.isArray(e)?e:[e];for(const e of n){const n=e.indexOf(":");-1===n&&(0,u.uQ)(1,`Error: Invalid header format "${e}". Expected format: "Header-Name: Header-Value"`);const o=e.substring(0,n).trim(),r=e.substring(n+1).trim();o||(0,u.uQ)(1,`Error: Invalid header format "${e}". Header name cannot be empty.`),t[o]=r}return Object.keys(t).length>0?t:void 0}function M(e,t,o,S){return E(this,arguments,void 0,(function*(e,t,o,{rgPath:S,diagnosticsProvider:E,codebaseReferenceProvider:M,configProvider:T,credentialManager:A}){var I,D,_;yield(0,x.H)({backendUrl:(0,b.G6)(o.endpoint),credentialManager:A,configProvider:T});const P=(0,b.G6)(o.endpoint);try{(0,d.Bu)(A,{endpoint:P,insecure:o.insecure,configProvider:T})}catch(e){}(0,h.F0)({credentialManager:A,backendUrl:P,insecure:o.insecure,channel:T.get().channel});const L=!0===o.printenv;let R,O;if(!1!==o.resume)if(!0===o.resume){const e=(0,d.c3)(A,P,T),t=yield(0,C.oh)(e);t||process.exit(0),"chat"===t.kind?R=t.id:"background"===t.kind&&(O=t.id)}else if("string"==typeof o.resume){const e=o.resume.match(/^-(\d+)$/);if(e){const t=Number(e[1]),n=Number.isFinite(t)&&t>0?t:1,o=yield(0,C.xT)(n);o||(0,u.uQ)(1,"No previous chats found."),R=o||void 0}else if("-1"===o.resume){const e=yield(0,C.$0)();e||(0,u.uQ)(1,"No previous chats found."),R=e}else R=o.resume}const Y=!process.stdin.isTTY,z=Boolean(process.stdout.isTTY),N=!0===o.print||!z||Y;L&&!N&&(0,u.uQ)(1,"Error: --printenv can only be used with --print/headless mode");const{isAuthenticated:F,usingAuthTokenFromEnv:B}=yield(0,c.D)(A,{authToken:o.authToken}),{isAuthenticated:U,usingApiKeyFromEnv:q}=F?{isAuthenticated:!1,usingApiKeyFromEnv:!1}:yield(0,c.T)(A,{apiKey:o.apiKey,endpoint:P});if(!(F||U||(yield(0,m.h4)(A,m.hT.LOGIN)))){N&&(0,u.uQ)(1,`Error: Authentication required. Please run '${(0,j.mf)()} login' first, or set CURSOR_API_KEY environment variable.`);const e=(0,i.Vi)({credentialManager:A,endpoint:P,configProvider:T});(yield(0,m.f4)(A,T,e))||(0,u.uQ)(1,`Authentication required to use Cursor Agent. Please run '${(0,j.mf)()} login' to authenticate.`)}let H=t.join(" ");if(Y){const e=(yield new Promise((e=>{let t="";try{process.stdin.setEncoding("utf8")}catch(e){}process.stdin.on("data",(e=>{t+=String(e)})),process.stdin.on("end",(()=>e(t))),process.stdin.on("error",(()=>e(t)))}))).trim();e.length>0&&(H=e)}if(o.toolGallery){const{runToolGallery:e}=yield n.e(722).then(n.bind(n,"./src/tool-gallery.tsx"));return void(yield e())}if(o.ianDev){const{runIanDev:e}=yield n.e(743).then(n.bind(n,"./src/ian-dev.tsx"));if(o.debug){const{initDebug:e}=yield Promise.resolve().then(n.bind(n,"./src/debug.ts"));yield e()}return void(yield e())}if(o.markdownTest){const{runMarkdownTest:e}=yield n.e(309).then(n.bind(n,"./src/markdown-test.tsx"));return void(yield e())}if(o.colorGallery){const{runColorGallery:e}=yield n.e(549).then(n.bind(n,"./src/color-gallery.tsx"));return void(yield e())}const W=q||B?"env":o.apiKey||o.authToken?"flag":"login";let G;process.argv.some((e=>e.startsWith("--output-format")))&&!N&&(0,u.uQ)(1,"Error: --output-format can only be used with --print"),process.argv.some((e=>e.startsWith("--stream-partial-output")))&&!N&&(0,u.uQ)(1,"Error: --stream-partial-output can only be used with --print");try{G=N?(0,w.nt)(o.outputFormat):void 0}catch(e){const t=e instanceof Error?e.message:String(e);(0,u.uQ)(1,t)}o.streamPartialOutput&&"stream-json"!==G&&(0,u.uQ)(1,"Error: --stream-partial-output requires --output-format stream-json");const X=N&&(0,v.QF)("nal_agent_retries");try{(0,a.sx)("cli.run.mode",{headless:N||!z||Y,print_flag:!0===o.print,output_text:"text"===G,output_json:"json"===G,output_stream_json:"stream-json"===G,stream_partial_output:!0===o.streamPartialOutput,api_key_env:q})}catch(e){}if(!N){const e=o.workspace?(0,s.resolve)(o.workspace):process.cwd(),t=yield(0,k.c)(e);"quit"===t&&process.exit(0),"already_approved"===t&&"quit"===(yield(0,g.Ny)(e))&&process.exit(0),(yield(0,p.K)(T))&&process.exit(0),"enabled"===(null!==(D=null===(I=T.get().sandbox)||void 0===I?void 0:I.mode)&&void 0!==D?D:"disabled")&&(l.pe.isSandboxSupported()||(process.env.AGENT_CLI_SESSION_WARNING_SANDBOX_UNSUPPORTED="1"))}let K;o.cloud||o.background?K="background":o.plan||"plan"===o.mode?K="plan":"ask"===o.mode&&(K="ask");const Q={backendUrl:P,endpoint:o.endpoint,insecure:null!==(_=o.insecure)&&void 0!==_&&_,print:N,outputFormat:G,streamPartialOutput:o.streamPartialOutput,debug:Boolean(o.debug),withDiffs:Boolean(o.withDiffs),resumeChatId:R,resumeBcId:O,rgPath:S,configProvider:T,diagnosticsProvider:E,codebaseReferenceProvider:M,model:o.model,usingApiKeyFromEnv:q,apiKeySource:W,isBrowserUseEnabled:Boolean(o.browser),force:Boolean(o.force),sandboxOverride:o.sandbox,approveMcps:N&&Boolean(o.approveMcps),mode:K,workspace:o.workspace,headers:$(o.header),agentEndpoint:o.agentEndpoint,enableRetries:X,customSystemPrompt:(()=>{const e=o.systemPrompt;if("string"==typeof e&&e.trim().length>0){const t=(0,s.resolve)(e);(0,r.existsSync)(t)||(0,u.uQ)(1,`Error: --system-prompt file not found: ${t}`);try{const e=(0,r.readFileSync)(t,"utf8");return e&&0!==e.trim().length||(0,u.uQ)(1,`Error: --system-prompt file is empty: ${t}`),e.trim()}catch(e){(0,u.uQ)(1,`Error: failed to read --system-prompt file: ${t}`)}}})(),printEnv:L,disableAutoUpdate:o.disableAutoUpdate};try{yield(0,f.J)(e,H,Q,A)}catch(t){if(!(t instanceof y.hY))throw t;{N&&(0,u.uQ)(1,`${t.message}\n\nPlease run '${(0,j.mf)()} login' to authenticate.`);const n=(0,i.Vi)({credentialManager:A,endpoint:P,configProvider:T});(yield(0,m.f4)(A,T,n,t.message))||(0,u.uQ)(1,`Authentication required. Please run '${(0,j.mf)()} login' to authenticate.`),yield(0,f.J)(e,H,Q,A)}}}))}o()}catch(T){o(T)}}))},"./src/commands/install-core-posix.ts":(e,t,n)=>{n.d(t,{BV:()=>u});var o=n("node:child_process"),r=n("node:fs"),s=n("node:os"),i=n("node:path"),l=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const a=6e4;function c(e){const t=i.join(s.homedir(),".local","bin");r.mkdirSync(t,{recursive:!0});const n=i.join(e,"cursor-agent"),o=i.join(t,"agent"),l=i.join(t,"cursor-agent"),a=(e,t)=>{try{r.unlinkSync(t)}catch(e){}r.symlinkSync(e,t)};a(n,o),a(n,l)}function d(){const e=i.join(s.homedir(),".local","bin");r.mkdirSync(e,{recursive:!0});const t=i.join(e,"cursor"),n=["#!/bin/sh","set -eu","","# Find cursor executable in PATH, excluding the current shim","find_cursor() {",'  old_IFS="$IFS"',"  IFS=:","  for dir in $PATH; do",'    [ -n "$dir" ] || continue','    cursor_path="$dir/cursor"','    if [ "$cursor_path" != "$HOME/.local/bin/cursor" ] && [ -x "$cursor_path" ]; then','      IFS="$old_IFS"','      echo "$cursor_path"',"      return 0","    fi","  done",'  IFS="$old_IFS"',"  return 1","}","","OTHER_CURSOR=$(find_cursor || true)","",'if [ -n "${OTHER_CURSOR:-}" ]; then','  exec "$OTHER_CURSOR" "$@"',"else",'  if [ "$1" != "agent" ]; then',"    echo \"Error: No Cursor IDE installation found. Use 'cursor agent' or 'agent' to run the agent.\" 1>&2",'    echo "Or, install Cursor at https://cursor.com/download" 1>&2',"    exit 1","  fi",'  exec "$HOME/.local/bin/agent" "$@"',"fi",""].join("\n");r.writeFileSync(t,n,{mode:493});try{r.chmodSync(t,493)}catch(e){}}function u(e){return l(this,void 0,void 0,(function*(){const{version:t,urlPrefix:n,showProgress:l=!1,skipIfLocked:u=!1}=e,p=i.join(s.homedir(),".local","share","cursor-agent",".install.lock"),h=function(e){const t=i.dirname(e);try{r.mkdirSync(t,{recursive:!0})}catch(e){}try{if(r.existsSync(e)){const t=r.statSync(e);if(Date.now()-t.mtimeMs>a)try{r.statSync(e).ino===t.ino&&r.unlinkSync(e)}catch(e){}}return r.openSync(e,"wx")}catch(e){if(e&&"object"==typeof e&&"code"in e&&"EEXIST"===e.code)return null;throw e}}(p);if(null===h){if(u)return;throw new Error("Another CLI update is already in progress. Wait for it to finish or remove ~/.local/share/cursor-agent/.install.lock if no update is running.")}try{const{os:a,arch:u}=function(){const e=s.platform(),t=s.arch();let n,o;switch(e){case"linux":n="linux";break;case"darwin":n="darwin";break;default:throw new Error(`Unsupported operating system: ${e}`)}switch(t){case"x64":o="x64";break;case"arm64":o="arm64";break;default:throw new Error(`Unsupported architecture: ${t}`)}return{os:n,arch:o}}(),p=i.join(s.homedir(),".local","share","cursor-agent","versions"),h=i.join(p,t),g=i.join(p,`.${t}`);if(r.existsSync(h))return c(h),void d();try{r.rmSync(g,{recursive:!0,force:!0})}catch(e){}r.mkdirSync(g,{recursive:!0});const m=`${n.endsWith("/")?n:`${n}/`}${a}/${u}/agent-cli-package.tar.gz`;try{const t=l?["-fSL","--progress-bar",m]:["-fSL","-s",m];yield new Promise(((n,r)=>{const s=e.showProgress?"inherit":"ignore",i=(0,o.spawn)("tar",["--strip-components=1","-xzf","-","-C",g],{stdio:["pipe","ignore",s]}),l=(0,o.spawn)("curl",t,{stdio:["ignore","pipe",s]});l.stdout.pipe(i.stdin);let a=null,c=null,d=!1;const u=()=>{null===a||null===c||d||(d=!0,0===a?0===c?n():r(new Error(`Extraction failed (tar exit ${c})`)):r(new Error(`Download failed (curl exit ${a})`)))};l.on("error",(e=>{if(!d){d=!0;try{i.kill("SIGTERM")}catch(e){}r(e)}})),i.on("error",(e=>{if(!d){d=!0;try{l.kill("SIGTERM")}catch(e){}r(e)}})),l.on("close",(e=>{var t;a=null!=e?e:1;try{null===(t=i.stdin)||void 0===t||t.end()}catch(e){}if(0!==a)try{i.kill("SIGTERM")}catch(e){}u()})),i.on("close",(e=>{if(c=null!=e?e:1,0!==c)try{l.kill("SIGTERM")}catch(e){}u()}))}));try{r.rmSync(h,{recursive:!0,force:!0})}catch(e){}r.renameSync(g,h)}catch(e){try{r.rmSync(g,{recursive:!0,force:!0})}catch(e){}throw new Error(`Download failed: ${e instanceof Error?e.message:String(e)}`)}c(h),d()}finally{!function(e,t){try{r.closeSync(t)}catch(e){}try{r.unlinkSync(e)}catch(e){}}(p,h)}}))}},"./src/commands/logout.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.r(t),n.d(t,{handleLogout:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../keychain/dist/index.js"),l=n("./src/components/login-ui.tsx"),a=n("./src/statsig.ts"),c=e([s,l]);[s,l]=c.then?(await c)():c;var d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function u(e,t){return d(this,void 0,void 0,(function*(){const{rerender:n}=(0,s.XX)((0,r.jsx)(l.L,{status:"starting"}));try{(yield e.getAccessToken())||(n((0,r.jsx)(l.L,{status:"success",message:"Authentication tokens removed."})),process.exit(0))}catch(e){e instanceof i.fI&&(n((0,r.jsx)(l.L,{status:"success",message:"Authentication tokens removed."})),process.exit(0))}try{n((0,r.jsx)(l.L,{status:"in-progress"})),yield e.clearAuthentication(),yield t.transform((e=>Object.assign(Object.assign({},e),{privacyCache:void 0,authInfo:void 0}))),(0,a.yX)(t),n((0,r.jsx)(l.L,{status:"success",message:"Authentication tokens removed."}))}catch(e){n((0,r.jsx)(l.L,{status:"error",message:`Failed to remove authentication tokens: ${e}`})),process.exit(1)}process.exit(0)}))}o()}catch(p){o(p)}}))},"./src/commands/resume.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{$0:()=>g,oh:()=>h,xT:()=>m});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:fs"),i=n("node:path"),l=n("../ink/build/index.js"),a=n("./src/components/unified-list-pager.tsx"),c=n("./src/state/index.ts"),d=n("./src/state/sqlite-blob-store.ts"),u=e([l,a]);[l,a]=u.then?(await u)():u;var p=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function h(e){return p(this,void 0,void 0,(function*(){return new Promise((t=>{const n=(0,l.XX)((0,r.jsx)(a.W,{client:e,onClose:()=>{n.unmount(),t(null)},onSelectChat:e=>{n.unmount(),t({kind:"chat",id:e})},onSelectBackground:e=>{n.unmount(),t({kind:"background",id:e})}}))}))}))}function g(){return p(this,void 0,void 0,(function*(){return yield m(1)}))}function m(e){return p(this,void 0,void 0,(function*(){var t,n;try{if(!Number.isFinite(e)||e<=0)return null;const o=(0,c.r)(),r=(0,s.readdirSync)(o,{withFileTypes:!0}),l=(yield Promise.all(r.filter((e=>e.isDirectory())).map((e=>p(this,void 0,void 0,(function*(){const t=(0,i.join)(o,e.name);try{const n=(0,i.join)(t,"store.db");let o=Number.MAX_SAFE_INTEGER;try{const e=(0,s.statSync)(n),t=Math.floor(e.birthtimeMs||e.mtimeMs);t>0&&(o=Math.min(o,t))}catch(e){}try{const e=(0,s.statSync)(t),n=Math.floor(e.birthtimeMs||e.mtimeMs);n>0&&(o=Math.min(o,n))}catch(e){}o===Number.MAX_SAFE_INTEGER&&(o=0);const r=yield d.M.initAndLoad(n),l=r.get("latestRootBlobId");if(!l||0===l.length)return null;const a=r.get("createdAt"),c=f(a&&Number.isFinite(a)?a:o);return{name:e.name,createdAtMs:c}}catch(e){return null}})))))).filter((e=>null!==e));return l.sort(((e,t)=>(t.createdAtMs||0)-(e.createdAtMs||0))),null!==(n=null===(t=l[Math.max(0,Math.min(l.length-1,e-1))])||void 0===t?void 0:t.name)&&void 0!==n?n:null}catch(e){return null}}))}const f=e=>{const t="number"==typeof e?e:0;return t>0&&Number.isFinite(t)?t<1e11?Math.floor(1e3*t):t>=1e14&&t<1e17?Math.floor(t/1e3):t>=1e17?Math.floor(t/1e6):Math.floor(t):0};o()}catch(v){o(v)}}))},"./src/commands/set-line-numbers.ts":(e,t,n)=>{n.d(t,{x:()=>r});var o=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function r(e){return o(this,void 0,void 0,(function*(){var t,n;const r=!(null!==(n=null===(t=e.get().display)||void 0===t?void 0:t.showLineNumbers)&&void 0!==n&&n);return yield function(e,t){return o(this,void 0,void 0,(function*(){yield e.transform((e=>Object.assign(Object.assign({},e),{display:Object.assign(Object.assign({},e.display),{showLineNumbers:t})})))}))}(e,r),r}))}},"./src/commands/update-core.ts":(e,t,n)=>{n.d(t,{N:()=>a});var o=n("./src/analytics.ts"),r=n("./src/console-io.ts"),s=n("./src/commands/install-core-posix.ts");n("node:child_process");var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function l(e){const t=e.match(/^(\d{4})\.(\d{2})\.(\d{2})/);if(!t)throw new Error(`Invalid version format: ${e}`);const[,n,o,r]=t;return 1e6*parseInt(n,10)+1e3*parseInt(o.replace(/^0/,""),10)+parseInt(r.replace(/^0/,""),10)}function a(e){return i(this,void 0,void 0,(function*(){const{dashboardClient:t,showProgress:n=!0,isAutoUpdate:a=!1}=e,c=null!=="2026.01.28-fd13201"?"2026.01.28-fd13201":"unknown",d=null!=="2026.01.28-fd13201"?"2026.01.28-fd13201":"";n&&(0,r.p2)("Checking for updates...");const u=yield function(e,t){return i(this,void 0,void 0,(function*(){const n="prod-stable-internal"===t?"prod":t,o=yield e.getCliDownloadUrl({channel:n});if(!o.url||!o.version)throw new Error("Invalid response from server: missing URL or version information");return{version:o.version,url:o.url}}))}(t,e.channel);if(!function(e,t,n=!1){try{const o=l(e),r=l(t);return o!==r?o<r:!n&&e!==t}catch(n){return(0,r.p2)(`Invalid version format: ${e} or ${t}`),e!==t}}(d,u.version,a))return void(n&&(0,r.p2)("Already up to date"));n&&(0,r.p2)(`Latest version available: ${u.version}`);let p=!1;try{yield(0,s.BV)({version:u.version,urlPrefix:u.url,showProgress:n,skipIfLocked:a}),n&&(0,r.p2)("Done"),p=!0}finally{(0,o.sx)("cli.updated",{update_type:a?"auto":"manual",from_version:c,to_version:u.version,success:p})}}))}},"./src/components/alt-screen.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{I:()=>h,m:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/context/terminal-state-context.tsx"),c=n("./src/hooks/use-debounced-callback.ts"),d=n("./src/hooks/use-mounted-effect.ts"),u=e([s,a]);[s,a]=u.then?(await u)():u;const p=e=>{e.write("[H[2J[3J")},h=({children:e,clearScreenTrigger:t,clearOnMount:n=!0})=>{const{stdout:o}=(0,s.t$)(),u=(0,a.PH)(),[h,g]=(0,i.useState)(n),m=(0,c.Y)((()=>{g(!0),p(o),setImmediate((()=>{g(!1)}))}),l.Zo,{leading:!0,trailing:!0}),f=(0,c.Y)((()=>{p(o)}),l.Zo,{leading:!0,trailing:!0});return(0,i.useEffect)((()=>{n&&(p(o),setImmediate((()=>{g(!1)})))}),[n,o]),(0,d.H)((()=>{o&&m()}),[o,u,m]),(0,d.H)((()=>{o&&f()}),[t,o,f]),(0,r.jsx)(r.Fragment,{children:h?null:e})};o()}catch(e){o(e)}}))},"./src/components/animated-dots.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{U:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=({interval:e=160})=>{const[t,n]=(0,i.useState)(1);(0,i.useEffect)((()=>{const t=setInterval((()=>{n((e=>3===e?0:e+1))}),e);return()=>clearInterval(t)}),[e]);const o=".".repeat(t).padEnd(3," ");return(0,r.jsx)(s.EY,{children:o})};o()}catch(e){o(e)}}))},"./src/components/app-header.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{j:()=>v});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:os"),i=n.n(s),l=n("node:path"),a=n.n(l),c=n("../ink/build/index.js"),d=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),u=n("./src/constants.ts"),p=n("./src/hooks/use-current-branch.ts"),h=n("./src/hooks/use-git-root.ts"),g=n("./src/utils/path-utils.ts"),m=n("./src/utils/version.ts"),f=e([c]);c=(f.then?(await f)():f)[0];const v=({debugInfo:e,isRepository:t,folderMode:n="cwd",badge:o,locationDisplayOverride:s,branchDisplayOverride:l,isBackground:f})=>{const v=(0,d.useMemo)((()=>{const e=process.cwd(),t=i().homedir(),n=e.startsWith(t)?`~${e.slice(t.length)}`:e;return{root:e,displayPath:n,name:a().basename(e)||e}}),[]),x=(0,m.x)(),b=(0,p.h)(v),y=(0,h._)(v),j=(0,d.useMemo)((()=>{if(!y)return"";const e=i().homedir();return y.startsWith(e)?`~${y.slice(e.length)}`:y}),[y]);return(0,r.jsxs)(c.az,{flexDirection:"column",children:[e&&(0,r.jsx)(c.az,{marginX:1,marginBottom:1,paddingX:1,children:(0,r.jsxs)(c.az,{flexDirection:"row",alignItems:"center",gap:1,children:[(0,r.jsx)(c.EY,{color:"gray",bold:!0,children:"DEBUG MODE"}),(0,r.jsx)(c.EY,{color:"gray",children:"â€¢"}),(0,r.jsx)(c.EY,{color:"yellow",children:e.serverUrl})]})}),"true"!==process.env.AGENT_CLI_HIDE_HEADER&&(0,r.jsxs)(c.az,{marginX:1,paddingX:1,flexDirection:"column",flexGrow:1,marginTop:e?0:1,borderLeft:!0,children:[(0,r.jsxs)(c.EY,{color:"foreground",children:[f?"Cursor Cloud Agent":"Cursor Agent",(0,r.jsxs)(c.EY,{dimColor:!0,children:[" ","unknown"!==x?`v${x}`:""]}),o?(0,r.jsxs)(r.Fragment,{children:[" ",o]}):null]}),(0,r.jsxs)(c.EY,{color:"foreground",dimColor:!0,children:[(0,r.jsx)(c.EY,{wrap:"truncate-start",children:(0,g.tk)(null!=s?s:"cwd"===n?v.displayPath:j,u.DN)}),(null!=l?l:b)?(0,r.jsxs)(c.EY,{children:[" Â· ",null!=l?l:b]}):null]}),t?null:(0,r.jsx)(c.EY,{color:"gray",children:"(cwd is not a git repository, cursor rules and ignore files don't apply)"})]})]})};o()}catch(e){o(e)}}))},"./src/components/approval-dialog.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{b:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];var l=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function a({title:e,description:t,content:n,options:o,selectedOption:i,variant:l="warning"}){const a="info"===l,c=a?"blue":"yellow",d=a?"blue":"yellow",u=a?"â„¹ ":"âš  ";return(0,r.jsx)(s.az,{flexDirection:"column",marginTop:1,marginX:2,children:(0,r.jsxs)(s.az,{flexDirection:"column",borderStyle:"round",borderColor:c,paddingX:2,paddingY:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:d,bold:!0,children:u}),(0,r.jsx)(s.EY,{color:"foreground",bold:!0,children:e})]})}),(0,r.jsxs)(s.az,{marginTop:1,flexDirection:"column",children:[(0,r.jsx)(s.az,{flexDirection:"column",gap:1,children:t.map((e=>(0,r.jsx)(s.EY,{color:"foreground",children:e},e)))}),n&&(0,r.jsx)(s.az,{marginTop:1,marginLeft:2,flexDirection:"column",children:n})]}),(0,r.jsx)(s.az,{marginTop:2,flexDirection:"column",children:o.map(((e,t)=>(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:i===t?"green":"gray",children:i===t?"â–¶ ":"  "}),(0,r.jsxs)(s.EY,{color:i===t?"foreground":"gray",bold:i===t,children:["[",e.key,"] ",e.label]})]},e.value)))}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"Use arrow keys to navigate, Enter to select, or press the key shown"})})]})})}function c(e){return l(this,arguments,void 0,(function*({title:e,description:t,content:n,options:o,onAction:i,variant:c}){return new Promise((d=>{let u=0;const{rerender:p,waitUntilExit:h}=(0,s.XX)((0,r.jsx)(a,{title:e,description:t,content:n,options:o,selectedOption:u,variant:c}),{exitOnCtrlC:!1}),g=e=>l(this,void 0,void 0,(function*(){yield i(e),d(e)}));process.stdin.setRawMode(!0),process.stdin.resume();const m=s=>{const i=s.toString(),l=s[0];if(3===s.length&&27===s[0]&&91===s[1]){if(66===s[2])return u=(u+1)%o.length,void p((0,r.jsx)(a,{title:e,description:t,content:n,options:o,selectedOption:u,variant:c}));if(65===s[2])return u=(u-1+o.length)%o.length,void p((0,r.jsx)(a,{title:e,description:t,content:n,options:o,selectedOption:u,variant:c}))}if(13===l)return process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),void g(o[u].value);const d=i.toLowerCase(),h=o.find((e=>e.key.toLowerCase()===d));return h?(process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),void g(h.value)):27===l||3===l?(process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),void g(o[o.length-1].value)):void 0};process.stdin.on("data",m),h().then((()=>{process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),d(o[o.length-1].value)})).catch((()=>{process.stdin.removeListener("data",m),process.stdin.setRawMode(!1),process.stdin.pause(),d(o[o.length-1].value)}))}))}))}o()}catch(d){o(d)}}))},"./src/components/ask-question-form.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{o:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/tool-row-box.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=e=>{var t;const n=null!==(t=null==e?void 0:e.trim())&&void 0!==t?t:"";return n.length>0?n:"Clarifying Questions"},c=(e,t)=>e&&t?"â€º [x]":e?"â€º [ ]":t?"  [x]":"  [ ]",d=({args:e,selection:t,isAsync:n})=>{const o=a(e.title);return(0,r.jsx)(i.Y,{flexDirection:"column",borderColor:"cyan",borderDimColor:!1,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,gap:1,children:[(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsxs)(s.EY,{bold:!0,color:"cyan",children:[o,n?" (async)":""]})}),(0,r.jsx)(s.az,{flexDirection:"column",gap:1,children:e.questions.map(((e,n)=>{var o;const i=n===t.activeQuestionIndex,l=null!==(o=t.selectionsByQuestionId[e.id])&&void 0!==o?o:[];return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{color:i?"cyan":"foreground",children:[n+1,". ",e.prompt,e.allowMultiple?" (multi-select)":""]}),(0,r.jsx)(s.az,{flexDirection:"column",marginLeft:2,children:e.options.map(((e,n)=>{const o=l.includes(e.id),a=i&&n===t.activeOptionIndex,d=c(a,o);return(0,r.jsxs)(s.EY,{color:a?"cyan":"gray",children:[d," ",e.label]},e.id)}))})]},e.id)}))}),(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsx)(s.EY,{color:"gray",children:"â†‘/â†“ option Â· â†/â†’ question Â· Space/Enter select Â· Enter to submit Â· Esc to skip"})})]})})};o()}catch(e){o(e)}}))},"./src/components/ask-question-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=e=>{const t={};if("success"!==(null==e?void 0:e.result.case))return t;for(const n of e.result.value.answers)t[n.questionId]=n.selectedOptionIds.slice();return t},d=e=>{switch(null==e?void 0:e.result.case){case"success":return{status:"success"};case"rejected":return{status:"rejected",note:(null==e?void 0:e.result.value.reason)||"Questions skipped by user"};case"error":return{status:"error",errorMessage:(null==e?void 0:e.result.value.errorMessage)||"Unknown error"};case"async":return{status:"pending",note:"Awaiting async responses"};default:return{status:"pending"}}},u=({tool:{args:e,result:t}})=>{var n;if(!e)return null;const o=c(t),{status:a,note:u,errorMessage:p}=d(t),h=(null===(n=e.title)||void 0===n?void 0:n.trim())||"Clarifying Questions",g=e.questions.length;return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"AskQuestion",primary:`${h} (${g})`,status:a,note:u}),p&&(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",p]})}),(0,r.jsx)(s.az,{flexDirection:"column",marginLeft:i.SK,gap:1,children:e.questions.map(((e,t)=>{var n;const i=null!==(n=o[e.id])&&void 0!==n?n:[],l=e.allowMultiple?" (multi-select)":"";return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{children:[t+1,". ",e.prompt,(0,r.jsx)(s.EY,{color:"gray",children:l})]}),(0,r.jsx)(s.az,{flexDirection:"column",marginLeft:2,children:e.options.map((e=>{const t=i.includes(e.id);return(0,r.jsxs)(s.EY,{color:t?"green":"gray",children:[t?"[x]":"[ ]"," ",e.label]},e.id)}))})]},e.id)}))})]})};o()}catch(e){o(e)}}))},"./src/components/background-edit-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{l:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/components/highlighted-code.tsx"),c=n("./src/components/inline-delta.tsx"),d=n("./src/components/tool-row-box.tsx"),u=e([s,a,c,d]);[s,a,c,d]=u.then?(await u)():u;const p=({path:e,result:t})=>{var n;const o=null==t?void 0:t.diff,u=(0,i.useMemo)((()=>(null==o?void 0:o.chunks)&&0!==o.chunks.length?o.chunks.map((e=>{var t;return null!==(t=e.linesAdded)&&void 0!==t?t:0})).reduce(((e,t)=>e+t),0):0),[null==o?void 0:o.chunks]),p=(0,i.useMemo)((()=>(null==o?void 0:o.chunks)&&0!==o.chunks.length?o.chunks.map((e=>{var t;return null!==(t=e.linesRemoved)&&void 0!==t?t:0})).reduce(((e,t)=>e+t),0):0),[null==o?void 0:o.chunks]),h=(0,i.useMemo)((()=>{var e,t,n,r,s;const i=o;if(!i||!i.chunks||0===i.chunks.length)return;let l="";for(const o of i.chunks){l+=`@@ -${null!==(e=o.oldStart)&&void 0!==e?e:0},${null!==(t=o.oldLines)&&void 0!==t?t:0} +${null!==(n=o.newStart)&&void 0!==n?n:0},${null!==(r=o.newLines)&&void 0!==r?r:0} @@\n`;const i=null!==(s=o.diffString)&&void 0!==s?s:"";if(i)for(const e of i.split("\n"))e?e.startsWith("@@")||(l+=`${e}\n`):l+="\n"}return l.trimEnd()}),[o]),g=(0,i.useMemo)((()=>{var e;if(t)return t.rejected?"Edit rejected":(null===(e=t.recoverableError)||void 0===e?void 0:e.modelMessage)?t.recoverableError.modelMessage:u>0||p>0?(0,r.jsx)(c._,{added:u,removed:p}):void 0}),[t,u,p]),m=(0,i.useMemo)((()=>(null==t?void 0:t.rejected)?"yellow":"gray"),[null==t?void 0:t.rejected]);return e?(0,r.jsxs)(d.Y,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,paddingX:1,children:[(0,r.jsx)(s.az,{flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:e})}),"string"==typeof g?(0,r.jsx)(s.EY,{color:m,wrap:"truncate",children:g}):g?(0,r.jsx)(s.az,{children:g}):null]}),h?(0,r.jsx)(a.d,{content:h,language:null!==(n=(0,l.Ak)(e))&&void 0!==n?n:"diff",isDiff:!0,showLineNumbers:!1,maxLines:12,truncationHint:l.hD?"ctrl+r to review":void 0,paddingX:1}):null]}):null};o()}catch(e){o(e)}}))},"./src/components/background-prompt-bar.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{m:()=>y});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/console-io.ts"),a=n("./src/constants.ts"),c=n("./src/context/vim-mode-context.tsx"),d=n("./src/hooks/prompt/use-at-palette.ts"),u=n("./src/hooks/prompt/use-slash-palette.ts"),p=n("./src/hooks/use-background-actions.ts"),h=n("./src/components/prompt/decision-dropdown.tsx"),g=n("./src/components/prompt/palette-at-list.tsx"),m=n("./src/components/prompt/palette-slash-list.tsx"),f=n("./src/components/prompt/prompt-footer.tsx"),v=n("./src/components/text-input.tsx"),x=e([s,h,g,m,f,v]);[s,h,g,m,f,v]=x.then?(await x)():x;var b=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const y=({prompt:e,setPrompt:t,onSubmit:n,topStatus:o,topStatusMarginTop:x,isDisabled:y=!1,isProcessing:j=!1,modelLabel:w="Loading...",isMaxMode:k,placeholder:C="Add a follow-up",promptSymbol:S="â†’",branchName:E,onRequestReview:$,bcId:M,changes:T,slashCommands:A=[],backgroundComposerClient:I,printEphemeral:D})=>{var _;const{exit:P}=(0,s.nm)(),[L,R]=(0,i.useState)(!1),[O,Y]=(0,i.useState)(null),[z,N]=(0,i.useState)(!0),{vimEnabled:F,mode:B}=(0,c.v)(),U=null!==(_=null==T?void 0:T.length)&&void 0!==_?_:0,[q,H]=(0,i.useState)(0),W=i.useRef(null),G=(0,i.useCallback)((e=>{W.current?W.current(e):t(e)}),[t]),X=i.useMemo((()=>{if(U>0){const e="Try /apply-changes-locally or /checkout-locally";return C?`${C} â€” ${e}`:e}return C}),[C,U]),[K,Q]=(0,i.useState)(!1),[J,V]=(0,i.useState)(""),[Z,ee]=(0,i.useState)(void 0),[te,ne]=(0,i.useState)("Continue"),[oe,re]=(0,i.useState)("Cancel"),se=(0,i.useRef)(null),[ie,le]=(0,i.useState)(0),ae=(0,i.useCallback)((e=>new Promise((t=>{var n,o;V(e.title),ee(e.detail),ne(null!==(n=e.continueLabel)&&void 0!==n?n:"Continue"),re(null!==(o=e.cancelLabel)&&void 0!==o?o:"Cancel"),se.current=t,le(0),Q(!0)}))),[]),ce=(0,d.g)(e),de=(0,p.V)(I),ue=i.useMemo((()=>[...U>0?[{id:"checkout-locally",title:"Checkout Locally",description:"Check out the current cloud agent's branch",run:()=>b(void 0,void 0,void 0,(function*(){if(M){null==D||D([[{text:"âŸ² ",color:"cyan"},{text:"Preparing checkoutâ€¦",dim:!0}]]),G("");try{yield de.checkoutLocally(M,{print:D,confirm:ae})}catch(e){null==D||D([[{text:"Error:",color:"red",bold:!0},{text:` ${e instanceof Error?e.message:String(e)}`}]])}}else null==D||D([[{text:"Error:",color:"red",bold:!0},{text:" No active cloud agent"}]])}))},{id:"apply-changes-locally",title:"Apply Changes Locally",description:"Apply this cloud agent's diffs into the working tree",run:()=>b(void 0,void 0,void 0,(function*(){if(M){null==D||D([[{text:"âŸ² ",color:"cyan"},{text:"Merging changesâ€¦ (conflicts will be shown)",dim:!0}]]),G("");try{yield de.applyChangesLocally(M,{print:D,confirm:ae})}catch(e){null==D||D([[{text:"Error:",color:"red",bold:!0},{text:` ${e instanceof Error?e.message:String(e)}`}]])}}else null==D||D([[{text:"Error:",color:"red",bold:!0},{text:" No active cloud agent"}]])}))}]:[]]),[M,de,ae,D,G,U]),pe=i.useMemo((()=>[...A,...ue]),[A,ue]),he=i.useMemo((()=>({insertText:G})),[G]),ge=(0,u.e)(e,pe,he),me=ce.active||ge.active,fe=(0,i.useDeferredValue)(ge.items),ve=(0,i.useDeferredValue)(ce.suggestions),xe=(0,i.useCallback)((e=>{const t=ce.acceptExpansion(e);return null!=t&&t!==e?(G(t),H((e=>e+1)),t):null}),[ce,G]);(0,i.useEffect)((()=>{if(!L)return;const e=setTimeout((()=>R(!1)),a.kd);return()=>clearTimeout(e)}),[L]),(0,i.useEffect)((()=>{L&&e.length>0&&(R(!1),Y(null))}),[e,L]);const be=(0,i.useCallback)(((e=!1)=>{N(!1),setTimeout((()=>{if(M){const e=`https://cursor.com/agents/${M}`;(0,l.p2)(`\n  [90mOpen Cloud Agent in:[0m [1m[36m${e}[0m`)}P(),process.exit(0)}),100)}),[M,P]),ye=(0,i.useCallback)((()=>{e.length>0?G(""):L?(G(""),be()):(R(!0),Y("ctrlC"))}),[e.length,L,G,be]),je=(0,i.useCallback)((()=>{U>0&&(null==$||$())}),[U,$]),we=(0,i.useCallback)((()=>{if(L||!j)return G(""),void be();R(!0),Y("ctrlD")}),[L,j,be,G]),ke=0===e.length,Ce="ctrlD"===O?"Press Ctrl+D again to exit":"ctrlC"===O?"Press Ctrl+C again to exit":void 0;(0,s.Ge)(((e,t)=>{if(K){if(t.downArrow||"j"===e||"J"===e)return void le((e=>Math.min(e+1,1)));if(t.upArrow||"k"===e||"K"===e)return void le((e=>Math.max(e-1,0)));if(t.escape||t.ctrl&&"c"===e||"n"===e||"N"===e){const e=se.current;return se.current=null,Q(!1),void(null==e||e(!1))}if(t.return){const e=se.current,t=0===ie;return se.current=null,Q(!1),void(null==e||e(t))}if("y"===e||"Y"===e){const e=se.current;return se.current=null,Q(!1),void(null==e||e(!0))}}else{if(ge.active&&ge.items.length>0){if(t.downArrow)return void ge.next();if(t.upArrow)return void ge.prev();if(t.escape)return void ge.hide()}if(ce.active&&ce.suggestions.length>0){if(t.downArrow)return void ce.next();if(t.upArrow)return void ce.prev();if(t.escape)return void ce.suppress()}}}),{isActive:K||ce.active||ge.active});if(!z)return null;if(y)return(0,r.jsx)(s.az,{flexDirection:"column",borderColor:"foreground",borderTop:!0,borderStyle:"single",paddingLeft:1,marginX:1,children:(0,r.jsx)(s.az,{flexDirection:"row",children:(0,r.jsx)(s.EY,{color:"gray",children:"Input disabled"})})});const Se=!K&&o;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.az,{marginTop:null!=x?x:0,marginBottom:0,marginX:1,paddingLeft:1,children:Se?o:null}),(0,r.jsxs)(s.az,{flexDirection:"column",borderColor:K?"yellow":"foreground",borderTop:!0,borderStyle:"single",paddingLeft:1,marginX:1,children:[K&&(0,r.jsx)(s.az,{marginBottom:0,flexDirection:"column",children:(0,r.jsx)(h.A,{title:J,highlightColor:"yellow",options:[{label:te,hint:"y"},{label:oe,hint:"esc/n"}],selectedIndex:ie,subtitle:Z})}),!K&&(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsxs)(s.EY,{color:"foreground",dimColor:0===e.length,children:[S," "]}),(0,r.jsx)(s.az,{flexGrow:1,children:(0,r.jsx)(v.A,{value:e,onChange:t,onSubmit:e=>{if(!K){if(ce.active&&null!=xe(e))return;if(e.startsWith("/")){if(ge.active){const t=ge.acceptExpansion(e);if(null!=t&&t!==e)return G(t),void H((e=>e+1))}return b(void 0,void 0,void 0,(function*(){const t=yield ge.runIfExecutable(e,pe,{insertText:e=>G(e),clearInput:()=>G("")});"handled"!==t&&"executed"!==t&&n(e)})),ce.hide(),void ge.hide()}n(e),ce.hide(),ge.hide()}},placeholder:X,rightPlaceholder:j?"ctrl+c to stop":0===e.length&&F?"insert"===B?"INSERT":"NORMAL":void 0,onCtrlC:ye,onCtrlD:ke?we:void 0,onCtrlR:je,allowExplicitNewline:!0,onTab:()=>{if(ge.active){const t=ge.acceptExpansion(e);if(null!=t)return G(t),void H((e=>e+1))}if(null==xe(e))return!e.startsWith("/")||e.endsWith(" ")||(e=>{const t=(e=>{if(!e.startsWith("/"))return null;const t=e.slice(1).split(/\s+/).filter(Boolean),n=t[0]||"",o=t.slice(1),r=pe.find((e=>e.id.toLowerCase()===n.toLowerCase())),s=((null==r?void 0:r.args)||[]).filter((e=>!1!==e.required)).length;return{cmdId:n,args:o,required:s,hasCmd:!!r}})(e);return Boolean((null==t?void 0:t.hasCmd)&&t.args.length>=t.required)})(e)?void 0:(G(`${e} `),void H((e=>e+1)))},showCursor:!0,focus:!0,cursorToEndSignal:q,replaceValueRef:W,onReplace:t})})]})]}),!K&&(0,r.jsx)(s.az,{height:me?Math.min(ge.active?Math.min(ge.items.length,a.kQ):Math.min(ce.suggestions.length,a.kQ),a.kQ):0,flexDirection:"column",marginTop:0,children:me&&(ge.active?(0,r.jsx)(m.A,{items:fe,activeIndex:ge.index,windowStart:ge.windowStart,highlightColor:"foreground"}):(0,r.jsx)(g.A,{suggestions:ve,activeIndex:ce.index,windowStart:ce.windowStart,highlightColor:"foreground"}))}),!K&&(0,r.jsx)(f.A,{show:!me,hasText:e.length>0,exitMode:L,modelLabel:w,isMaxMode:k,changedFilesCount:U,showReviewHint:U>0,exitHintText:Ce,headlineLabel:(0,r.jsxs)(s.EY,{color:"magenta",children:["â—Ž Cloud Agent",E?(0,r.jsxs)(s.EY,{color:"foreground",dimColor:!0,children:[" ","Â· ",E]}):null]}),headlineColor:"magenta"})]})};o()}catch(e){o(e)}}))},"./src/components/background-shell-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{d:()=>h});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/utils/characters.ts"),c=n("./src/utils/path-utils.ts"),d=n("./src/components/highlighted-code.tsx"),u=n("./src/components/tool-row-box.tsx"),p=e([s,d,u]);[s,d,u]=p.then?(await p)():p;const h=({command:e,cwd:t,result:n,expand:o})=>{var p;const h=(0,i.useMemo)((()=>(e||"").trim()),[e]),g=(0,i.useMemo)((()=>{const e=t||(null==n?void 0:n.resultingWorkingDirectory)||void 0;if(!e)return;const o=(0,c.fw)(e),r="."===o?"current dir":o;return(0,c.tk)(r,l.DN)}),[t,null==n?void 0:n.resultingWorkingDirectory]),m=(0,i.useMemo)((()=>{var e;if(!n)return;if(n.rejected)return"Rejected";const t=null!==(e=n.exitCodeV2)&&void 0!==e?e:n.exitCode;return null!=t?`exit ${t}`:void 0}),[n]),[f,v]=(0,i.useState)(null),[x,b]=(0,i.useState)(0),y=(0,i.useMemo)((()=>!n),[n]);(0,i.useEffect)((()=>{y?null===f&&v(Date.now()):(null!==f&&v(null),b(0))}),[y,f]),(0,i.useEffect)((()=>{if(null===f)return;const e=setInterval((()=>{b(Date.now()-f)}),100);return()=>clearInterval(e)}),[f]);const j=(0,i.useMemo)((()=>{if(!n)return null;if(n.rejected)return{text:"Request rejected",color:"yellow"};return{text:(e=>e.replace(/(\S{80})(?=\S)/g,"$1â€‹"))((e=n.outputRaw||n.output||"",(0,a.aJ)(e))),color:void 0};var e}),[n]);return(0,r.jsxs)(u.Y,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",paddingX:1,children:[(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:"$ "})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsxs)(s.EY,{wrap:"wrap",children:[(0,r.jsx)(s.EY,{color:"foreground",children:h}),m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:m})]}):null,y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:null!==(p=(e=>{if(!e&&0!==e)return null;if(e<1e3)return`${e}ms`;const t=e/1e3;return`${t.toFixed(t>=10?0:1)}s`})(x))&&void 0!==p?p:void 0})]}):null,g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.EY,{color:"gray",children:["in ",g]})]}):null]})})]}),n&&j?"yellow"===j.color?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"yellow",wrap:"wrap",children:j.text})}):j.text?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.d,{content:j.text,language:"plaintext",showLineNumbers:!1,maxLines:o?l.U5:l.Ok,truncationHint:o?void 0:"ctrl+o to expand"}),o?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"ctrl+o to collapse"})}):null]}):null:null]})};o()}catch(e){o(e)}}))},"./src/components/background-tool-group-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{i:()=>h});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../proto/dist/generated/aiserver/v1/tools_pb.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/constants.ts"),c=n("./src/components/tool-call-header.tsx"),d=e([s,c]);function u(e){if(null==e)return"UNKNOWN";const t=i.XaY[e];return"string"==typeof t?t:`TOOL_${String(e)}`}function p(e,t){const n=e.toUpperCase();return n.includes("SEMSEARCH")||n.includes("SEMANTIC_SEARCH")?(0,a.F_)("semSearchToolCall",t)||(t?"Searched":"Searching"):n.includes("GREP")?(0,a.F_)("grepToolCall",t)||(t?"Grepped":"Grepping"):n.includes("READ")?(0,a.F_)("readToolCall",t)||(t?"Read":"Reading"):n.includes("GLOB")?(0,a.F_)("globToolCall",t)||(t?"Globbed":"Globbing"):n.includes("LIST")?(0,a.F_)("lsToolCall",t)||(t?"Listed":"Listing"):n.includes("EDIT")?(0,a.F_)("editToolCall",t)||(t?"Edited":"Editing"):n.includes("SHELL")||n.includes("TERMINAL")?(0,a.F_)("shellToolCall",t)||(t?"Ran":"Running"):t?e:`${e}â€¦`}[s,c]=d.then?(await d)():d;const h=({toolCalls:e,forceCompleted:t})=>{const n=e.every((e=>!!e.result)),o=(0,l.useMemo)((()=>{const t=new Set,n=[];for(const o of e){const e=o.call.tool;t.has(e)||(t.add(e),n.push(e))}return n}),[e]),i=(0,l.useMemo)((()=>{var t;const n={};for(const o of e){const e=o.call.tool;n[e]=(null!==(t=n[e])&&void 0!==t?t:0)+1}return n}),[e]),a=(0,l.useMemo)((()=>{const t={};for(const n of e){const e=n.call.tool,o=!!n.result;void 0===t[e]?t[e]=o:t[e]=t[e]&&o}return t}),[e]),d=(0,l.useMemo)((()=>{var e;const t=[];for(const n of o){const o=null!==(e=i[n])&&void 0!==e?e:0;if(o<=0)continue;const r=u(n).toUpperCase(),s=r.includes("EDIT")?`${o} edit${1===o?"":"s"}`:r.includes("SHELL")||r.includes("TERMINAL")?`${o} shell${1===o?"":"s"}`:r.includes("SEMSEARCH")||r.includes("SEMANTIC_SEARCH")?`${o} search${1===o?"":"es"}`:r.includes("GREP")?`${o} grep${1===o?"":"s"}`:r.includes("READ")?`${o} file${1===o?"":"s"}`:r.includes("GLOB")?`${o} glob${1===o?"":"s"}`:r.includes("LIST")?`${o} director${1===o?"y":"ies"}`:`${o} call${1===o?"":"s"}`;t.push(s)}return t.join(", ")}),[o,i]),h=(0,l.useMemo)((()=>{var n;const o=[],r=new Set;for(const s of e){const e=s.call.tool;if(r.has(e))continue;r.add(e);const i=u(e),l=!!t||null!==(n=a[e])&&void 0!==n&&n;o.push(p(i,l))}const s=o.join(", ");return s?s.charAt(0).toUpperCase()+s.slice(1):"Tools"}),[e,a,t]),g=n||t?"success":"pending";return e&&0!==e.length?(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(c.C,{name:h,primary:d,status:g})}):null};o()}catch(g){o(g)}}))},"./src/components/create-plan-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{U:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/markdown.tsx"),l=n("./src/components/prompt/decision-dropdown.tsx"),a=n("./src/components/tool-row-box.tsx"),c=e([s,i,l,a]);[s,i,l,a]=c.then?(await c)():c;const d=12,u=800,p=({tool:{args:e,result:t},isSuggestingPlan:n=!1,planDecisionIndex:o=0,state:c,expand:p=!0})=>{var h,g,m;const f="success"===(null===(h=null==t?void 0:t.result)||void 0===h?void 0:h.case),v=function(e){if(!e||"string"!=typeof e)return null;const t=e.replace(/^file:\/\/+/,"");return t.length>0?t:null}(null==t?void 0:t.planUri);if(!(null==e?void 0:e.plan))return null;const x="rejected"===c,b="accepted"===c,y=p||n?null:function(e){const t=e.split("\n");let n=e,o=!1;return t.length>d&&(n=t.slice(0,d).join("\n"),o=!0),n.length>u&&(n=n.slice(0,u),o=!0),{text:n.trimEnd(),wasTruncated:o}}(e.plan),j=null!==(g=null==y?void 0:y.text)&&void 0!==g?g:e.plan,w=null!==(m=null==y?void 0:y.wasTruncated)&&void 0!==m&&m,k=()=>(0,r.jsxs)(s.az,{flexDirection:"column",gap:0,children:[(0,r.jsx)(s.az,{borderStyle:"single",borderColor:"gray",borderDimColor:!0,paddingX:1,children:(0,r.jsx)(i.oz,{content:j})}),w?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"â€¦(plan truncated) ctrl+o to expand"})}):null,v&&f?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsxs)(s.EY,{color:"gray",dimColor:!0,children:["Saved to ",v," â€” open in editor to review"]})}):null]});if(x)return(0,r.jsx)(a.Y,{flexDirection:"column",borderColor:"gray",borderDimColor:!0,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,children:[(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsx)(s.EY,{dimColor:!0,children:"Plan (rejected)"})}),k()]})});if(n&&f){const t=[{label:"Accept and proceed",hint:"(y)"},{label:"Reject and propose changes",hint:"(n or esc)"}];return(0,r.jsx)(a.Y,{flexDirection:"column",borderColor:"yellow",borderDimColor:!1,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,children:[(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsx)(s.EY,{bold:!0,color:"yellow",children:"Suggested Plan"})}),(0,r.jsx)(s.az,{borderStyle:"single",borderColor:"gray",borderDimColor:!0,paddingX:1,children:(0,r.jsx)(i.oz,{content:e.plan})}),v?(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsxs)(s.EY,{color:"gray",dimColor:!0,children:["Saved to ",v," â€” open in editor to review"]})}):null,(0,r.jsx)(l.A,{title:"",highlightColor:"yellow",options:t,selectedIndex:o})]})})}return(0,r.jsx)(a.Y,{flexDirection:"column",borderColor:"gray",borderDimColor:!0,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,children:[(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsx)(s.EY,{color:x?"gray":b?"green":"yellow",dimColor:x,children:x?"Rejected Plan":b?"Plan (accepted)":"Suggested Plan"})}),k()]})})};o()}catch(e){o(e)}}))},"./src/components/cube-overlay.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{a:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/assets/ascii.json"),a=n("./src/ephemeral-bridge.ts"),c=n("./src/components/onboarding-ui.tsx"),d=e([s,c]);[s,c]=d.then?(await d)():d;const u=({onClose:e})=>{var t,n;const o=(0,i.useMemo)((()=>l),[]),[d]=(0,i.useState)(.6),[u]=(0,i.useState)(1),[p]=(0,i.useState)(0),h=(0,i.useMemo)((()=>(0,c.Wv)(o)),[o]);(0,s.Ge)(((t,n)=>{(n.escape||n.return||"q"===t||"Q"===t||n.ctrl&&"c"===t)&&e()}));const{stdout:g}=(0,s.t$)(),m=Math.max(1,null!==(t=null==g?void 0:g.columns)&&void 0!==t?t:80),f=Math.max(1,null!==(n=null==g?void 0:g.rows)&&void 0!==n?n:24),v=(0,i.useMemo)((()=>(0,c.vY)(o,u,p,h)),[o,u,p,h]),x=(0,i.useMemo)((()=>(0,c.W7)(o,d)),[o,d]);return(0,i.useEffect)((()=>((0,a.al)((()=>{})),()=>(0,a.al)(null))),[]),(0,r.jsx)(s.az,{width:m,height:f,flexDirection:"row",alignItems:"center",justifyContent:"center",children:(0,r.jsx)(s.az,{width:v,height:x,children:(0,r.jsx)(c.Hk,{frames:o,intervalMs:50,verticalScale:d,horizontalScale:u,offsetColumns:p,trimLeftColumns:h})})})};o()}catch(e){o(e)}}))},"./src/components/delete-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Y:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;const c=(0,l.Kr)(e.path);let d,u="pending";const p=null==t?void 0:t.result,h=null==p?void 0:p.case;switch(h){case void 0:u="pending";break;case"success":u="success";break;case"rejected":u="rejected";break;case"permissionDenied":u="error",d=String(null!==(o=null===(n=null==p?void 0:p.value)||void 0===n?void 0:n.clientVisibleError)&&void 0!==o?o:"")||"Permission denied";break;case"fileNotFound":case"notFile":case"fileBusy":case"error":u="error";break;default:u="pending"}const g=(0,i.F_)("deleteToolCall","success"===u)||("success"===u?"Deleted":"Deleting");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:g,primary:c,status:u}),"fileNotFound"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"File not found"})}),"notFile"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"Path is not a file"})}),"permissionDenied"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:d})}),"fileBusy"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"File is busy"})}),"error"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"Delete failed"})}),"rejected"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"yellow",children:"Request rejected"})}),"success"===h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:"Completed"})})]})};o()}catch(e){o(e)}}))},"./src/components/edit-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{N:()=>p});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/highlighted-code.tsx"),c=n("./src/components/inline-delta.tsx"),d=n("./src/components/tool-row-box.tsx"),u=e([s,a,c,d]);[s,a,c,d]=u.then?(await u)():u;const p=({tool:e,aborted:t})=>{var n,o,u;const p=e.args,h=e.result;if(!p||!p.path)return null;const g=(0,l.Kr)(p.path);if(!h||!h.result){const e=(0,i.F_)("editToolCall",!1)||"Editing";return(0,r.jsx)(d.Y,{flexDirection:"column",paddingRight:2,paddingLeft:1,children:(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{color:"foreground",children:[(0,r.jsx)(s.EY,{bold:!0,children:e})," ",g,t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:"Aborted"})]}):null]})})})}const m=h.result;let f,v,x="gray";if(t)f="Aborted",x="gray";else switch(m.case){case"success":{const e=null!==(n=m.value.linesRemoved)&&void 0!==n?n:0,t=null!==(o=m.value.linesAdded)&&void 0!==o?o:0;f=(0,r.jsx)(c._,{removed:e,added:t}),v=m.value.diffString;break}case"fileNotFound":f="File not found",x="gray";break;case"readPermissionDenied":f="Permission denied reading",x="gray";break;case"writePermissionDenied":f=String(m.value.error)||"Permission denied writing",x="gray";break;case"rejected":f="Edit rejected",x="yellow";break;case"error":f=m.value.error||"Edit error",x="gray";break;default:m.case,f="Unknown edit result",x="gray"}return(0,r.jsxs)(d.Y,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,paddingX:1,children:[(0,r.jsx)(s.az,{flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:g})}),"string"==typeof f?(0,r.jsx)(s.EY,{color:x,wrap:"truncate",children:f}):f?(0,r.jsx)(s.az,{children:f}):null]}),v?(0,r.jsx)(a.d,{content:v,language:null!==(u=(0,i.Ak)(p.path))&&void 0!==u?u:"diff",isDiff:!0,showLineNumbers:!1,maxLines:12,truncationHint:i.hD?"ctrl+r to review":void 0,paddingX:1}):null]})};o()}catch(e){o(e)}}))},"./src/components/fetch-mcp-resource-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{J:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o,a;const c=null==e?void 0:e.server,d=null==e?void 0:e.uri,u=null==e?void 0:e.downloadPath;let p,h,g="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:g="pending";break;case"error":g="error",h=(null==t?void 0:t.result.value.error)||"Unknown error";break;case"success":{g="success";const e=null==t?void 0:t.result.value;(null==e?void 0:e.downloadPath)?p=`Downloaded to ${e.downloadPath}`:"text"===(null===(o=null==e?void 0:e.content)||void 0===o?void 0:o.case)?p=`${e.content.value.length} characters`:"blob"===(null===(a=null==e?void 0:e.content)||void 0===a?void 0:a.case)&&(p=`${e.content.value.length} bytes`);break}case"rejected":g="rejected",p=(null==t?void 0:t.result.value.reason)||"Rejected";break;case"notFound":g="error",h=`Resource not found: ${(null==t?void 0:t.result.value.uri)||d}`;break;default:g="pending"}const m=c?`(${c})`:"",f=u?`${d} â†’ ${u}`:d;return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"FetchMcpResource",primary:m,status:g,note:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{color:"gray",children:f}),p&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:p})]})]})}),h&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",h]})})]})};o()}catch(e){o(e)}}))},"./src/components/file-change-review.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Z:()=>E});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/chalk@5.4.1/node_modules/chalk/source/index.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/constants.ts"),c=n("./src/context/agent-state-context.tsx"),d=n("./src/context/theme-context.tsx"),u=n("./src/context/vim-mode-context.tsx"),p=n("./src/debug.ts"),h=n("./src/hooks/use-screen-size.ts"),g=n("./src/hooks/use-shared-animation.ts"),m=n("./src/hooks/use-text-input.ts"),f=n("./src/utils/characters.ts"),v=n("./src/utils/color-mixing.ts"),x=n("./src/utils/diff-colors.ts"),b=n("./src/utils/diff-sequences.ts"),y=n("./src/utils/inline-diff.ts"),j=n("./src/utils/path-utils.ts"),w=n("./src/utils/prompt-utils.ts"),k=e([s,d,h,m]);[s,d,h,m]=k.then?(await k)():k;var C=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function S(e,t,n,o){if(!t||0===t.length)return e;const r=(0,v.PT)();let s;const i=null!=o&&o;if("truecolor"===r){const e=i?a.Qn:a.Yb,t="added"===n?e.addBgHex:e.removeBgHex,o="added"===n?e.addFgHex:e.removeFgHex,r=(0,v.E2)(t),l=(0,v.E2)(o);s=r&&l?`[48;2;${r.r};${r.g};${r.b}m[38;2;${l.r};${l.g};${l.b}m`:"[1m[4m"}else if("ansi256"===r){const e=i?a.f2:a.$n;s=`[48;5;${"added"===n?e.addBg:e.removeBg}m[38;5;${"added"===n?e.addFg:e.removeFg}m`}else s="[1m[4m";let l="",c=0;for(const n of t)n.start>c&&(l+=e.slice(c,n.start)),l+=`${s}${e.slice(n.start,n.end)}[0m`,c=n.end;return c<e.length&&(l+=e.slice(c)),l}const E=({fileChangeTracker:e,changes:t,onExit:o,onSubmitPrompt:k,initialSelectedIndex:E,wrapLines:$=!0,isGenerating:M})=>{var A,I,D;const{isGenerating:_}=(0,c.C9)(),P=null!=M?M:_,L=(0,l.useMemo)((()=>[/(^|\/)yarn\.lock$/,/(^|\/)pnpm-lock\.yaml$/,/(^|\/)package-lock\.json$/,/(^|\/)bun\.lockb$/,/(^|\/)Cargo\.lock$/,/(^|\/)Gemfile\.lock$/,/(^|\/)poetry\.lock$/,/(^|\/)Pipfile\.lock$/,/(^|\/)composer\.lock$/,/(^|\/)go\.sum$/,/(^|\/)Podfile\.lock$/,/(^|\/)gradle\.lockfile$/,/\.(png|jpe?g|gif|bmp|webp|ico|pdf|zip|tar|tgz|gz|rar|7z|jar|wasm|woff2?|ttf|otf)$/i,/\.min\.js$/]),[]),R=(0,l.useCallback)((e=>{var t,n,o,r;if(a.ye.has(e.path))return{gated:!0,reason:"Forced gated for testing"};const s=e.path;for(const e of L)if(e.test(s))return{gated:!0,reason:"Lock file diff hidden"};const i=null!==(n=null===(t=e.before)||void 0===t?void 0:t.length)&&void 0!==n?n:0,l=null!==(r=null===(o=e.after)||void 0===o?void 0:o.length)&&void 0!==r?r:0;return e.before&&-1!==e.before.indexOf("\0")||e.after&&-1!==e.after.indexOf("\0")?{gated:!0,reason:"Binary file diff hidden"}:i+l>a.Le||i>a.Le||l>a.Le?{gated:!0,reason:"File too large to render diff"}:{gated:!1,reason:""}}),[L]),O=(0,l.useCallback)((e=>["",`   ${i.Ay.dim(`${e} â€” not shown`)}`,`   ${i.Ay.dim("You can still keep or undo this change.")}`,""]),[]),[Y,z]=(0,l.useState)(null!=E?E:0),[N,F]=(0,l.useState)(""),[B,U]=(0,l.useState)(!1),[q,H]=(0,l.useState)(!1),[W,G]=(0,l.useState)(""),[X,K]=(0,l.useState)({}),{stdout:Q}=(0,s.t$)(),J=(0,h.l)(),{setReviewSelectedIndex:V,pendingDecisions:Z,rejectPendingDecision:ee}=(0,c.C9)(),{vimEnabled:te,mode:ne,setMode:oe}=(0,u.v)(),re=a.Eo||P||Z.length>0,se=(0,g.e)(g.q,!re),[ie,le]=(0,l.useState)(null),ae=(0,l.useRef)(null),ce=(0,l.useRef)([]),de=(0,l.useCallback)(((e,t)=>{ce.current.push({name:e,data:t,ts:Date.now()})}),[]),ue=(0,l.useRef)(null),pe=(0,l.useCallback)((()=>C(void 0,void 0,void 0,(function*(){return ue.current||(ue.current=n.e(891).then(n.bind(n,"../../node_modules/.pnpm/shiki@3.7.0/node_modules/shiki/dist/index.mjs"))),(yield ue.current).codeToTokens}))),[]),he=(0,l.useRef)(new Map);(0,l.useEffect)((()=>{const e=()=>{var e,t,n;const o=ce.current.splice(0);if(0===o.length)return;const r={};for(const s of o){const o=null===(e=null==s?void 0:s.data)||void 0===e?void 0:e.durMs;if("number"==typeof o&&Number.isFinite(o)){const e=null!==(t=null==s?void 0:s.name)&&void 0!==t?t:"unknown";r[e]=(null!==(n=r[e])&&void 0!==n?n:0)+o}}Object.keys(r).length>0&&(0,p.debugLogJSON)("perf.summary",r)},t=setTimeout(e,800);return()=>{clearTimeout(t),e()}}),[]);const ge=(0,l.useMemo)((()=>(0,v.PT)()),[]),me=(0,l.useCallback)((e=>{if(!e)return"";const t=(0,v.E2)(e);return t?"truecolor"===ge?`[38;2;${t.r};${t.g};${t.b}m`:"ansi256"===ge?`[38;5;${(0,v.LQ)(t.r,t.g,t.b)}m`:"":""}),[ge]),fe=(0,l.useCallback)((e=>{if(!e)return"";const t=(0,v.E2)(e);return t?"truecolor"===ge?`[48;2;${t.r};${t.g};${t.b}m`:"ansi256"===ge?`[48;5;${(0,v.LQ)(t.r,t.g,t.b)}m`:"":""}),[ge]);(0,l.useEffect)((()=>{if(Q){try{Q.write("[?1049h[?7l[?1h=[?25l")}catch(e){}return()=>{try{Q.write("[?1l>[?7h[?1049l")}catch(e){}}}}),[Q]),(0,l.useEffect)((()=>{null!=E&&V(E)}),[E,V]),(0,l.useEffect)((()=>{0===t.length&&o()}),[t.length,o]);const ve=(0,l.useCallback)(((e,t)=>{const n=e.split(/\r?\n/),o=t.split(/\r?\n/),r=[];let s=0,i=0;const l=(e,t)=>n[e]===o[t],a=(e,t,l)=>{for(let e=s;e<t;e++)r.push({type:"removed",content:n[e],beforeLineNumber:e+1});for(let e=i;e<l;e++)r.push({type:"added",content:o[e],afterLineNumber:e+1});for(let o=0;o<e;o++)r.push({type:"common",content:n[t+o],beforeLineNumber:t+o+1,afterLineNumber:l+o+1});s=t+e,i=l+e};try{(0,b.A)(n.length,o.length,l,a)}catch(e){return o.map((e=>({type:"added",content:e})))}for(let e=s;e<n.length;e++)r.push({type:"removed",content:n[e],beforeLineNumber:e+1});for(let e=i;e<o.length;e++)r.push({type:"added",content:o[e],afterLineNumber:e+1});const c=(0,y.f)(r);for(const{removedIdx:e,addedIdx:t}of c){const n=r[e],o=r[t],{before:s,after:i}=(0,y.U)(n.content,o.content);n.inlineChanges=s,o.inlineChanges=i}return r}),[]),xe=(0,l.useCallback)(((e,t)=>{const n=[];if(e.forEach(((e,t)=>{"common"!==e.type&&n.push(t)})),0===n.length)return[];const o=[];let r=null;n.forEach((e=>{r?e<=r.end+2*t+1?r.end=e:(o.push(r),r={start:e,end:e}):r={start:e,end:e}})),r&&o.push(r);const s=[];for(let n=0;n<o.length;n++){const r=o[n],i=Math.max(0,r.start-t),l=Math.min(e.length-1,r.end+t);for(let t=i;t<=l;t++)s.push(e[t]);if(n<o.length-1){const e=Math.max(0,o[n+1].start-t),r=Math.max(0,e-l-1);r>0&&s.push({type:"gap",content:"",gapCount:r})}}return s}),[]),be=(0,l.useCallback)((e=>e.reduce(((e,t)=>"common"!==t.type?e+1:e),0)<=10&&e.length<=400?10:a.oy),[]),[ye,je]=(0,l.useState)({}),we=(0,l.useRef)(new Set),ke=(0,l.useRef)(ye);(0,l.useEffect)((()=>{ke.current=ye}),[ye]);const Ce=(0,l.useCallback)((e=>{var t;const n=Date.now(),o=R(e);if(o.gated){const t=O(o.reason),r={lines:t,kinds:new Array(t.length).fill("other"),total:2,added:0,removed:0},s=Date.now()-n;return de("computePrecomputed",{path:e.path,gated:!0,durMs:s}),r}if(void 0===e.after){const o=(null!==(t=e.before)&&void 0!==t?t:"").split(/\r?\n/),r={lines:["[deleted]"],kinds:["removed"],total:1,added:0,removed:Math.max(0,o.length)},s=Date.now()-n;return de("computePrecomputed",{path:e.path,type:"deleted",durMs:s}),r}if(void 0===e.before){const t=e.after.split(/\r?\n/),o=t.map(((e,t)=>`${(t+1).toString().padStart(4," ")} ${a.rW}[2m [0m ${e}`)),r={lines:o,kinds:new Array(o.length).fill("added"),total:o.length,added:t.length,removed:0},s=Date.now()-n;return de("computePrecomputed",{path:e.path,type:"created",lines:o.length,durMs:s}),r}let r=Ae.current.get(e.path);if(!r){const t=ve(e.before,e.after),n=be(t);r={diffLines:t,filtered:xe(t,n),contextLines:n},Ae.current.set(e.path,r)}const{diffLines:s,filtered:i}=r;let l=0,c=0;for(const e of s)"added"===e.type?l++:"removed"===e.type&&c++;const d=new Array(i.length),u=i.map(((e,t)=>{var n;const o=e.beforeLineNumber?e.beforeLineNumber.toString().padStart(4," "):"    ",r=e.afterLineNumber?e.afterLineNumber.toString().padStart(4," "):"    ";switch(e.type){case"added":{d[t]="added";const n=S(e.content,e.inlineChanges,"added",void 0);return`${o} ${r} ${a.rW}[32m+[39m ${n}[0m`}case"removed":{d[t]="removed";const n=S(e.content,e.inlineChanges,"removed",void 0);return`${o} ${r} ${a.rW}[31m-[39m ${n}[0m`}case"gap":return d[t]="other",`${o} ${r} ${a.rW}[2mâ‹¯ ${null!==(n=e.gapCount)&&void 0!==n?n:0} lines truncated â‹¯[0m`;default:return d[t]="other",`${o} ${r} ${a.rW}[2m [0m ${e.content}`}})),p={lines:u,kinds:d,total:u.length,added:l,removed:c},h=Date.now()-n;return de("computePrecomputed",{path:e.path,type:"modified",total:u.length,added:l,removed:c,durMs:h}),p}),[R,O,ve,be,xe,de]),[Se,Ee]=(0,l.useState)({}),$e=(0,l.useRef)(new Set),Me=(0,l.useRef)([]),Te=(0,l.useRef)([]),Ae=(0,l.useRef)(new Map),Ie=(0,l.useCallback)((e=>{const t=globalThis.requestIdleCallback;t?t(e):setTimeout(e,0)}),[]),De=(0,l.useCallback)((()=>new Promise((e=>{const t=globalThis.requestIdleCallback;t?t((()=>e())):setTimeout((()=>e()),0)}))),[]),_e=(0,l.useCallback)((e=>{const t=e.path;if(ke.current[t]||we.current.has(t))return;we.current.add(t);const n=Date.now();Ie((()=>{const o=Ce(e);if(je((e=>Object.assign(Object.assign({},e),{[t]:o}))),Te.current.push(t),Te.current.length>60){const e=Te.current.shift();e&&je((t=>{const n=Object.assign({},t);return delete n[e],n}))}we.current.delete(t);const r=Date.now()-n;de("ensurePrecomputed",{path:t,durMs:r})}))}),[Ce,de,Ie]),[Pe,Le]=(0,l.useState)(!1),Re=(0,l.useCallback)(((e,t)=>{const n=(()=>{const n=t.lines.length,o=t.kinds.length;if(n!==o){let r=t.kinds.slice(0,n);return r.length<n&&(r=r.concat(new Array(n-r.length).fill("other"))),r=r.map((e=>"added"===e||"removed"===e||"other"===e?e:"other")),null===p.debugLogJSON||void 0===p.debugLogJSON||(0,p.debugLogJSON)("highlight.kinds_mismatch",{path:e,lines:n,kinds:o}),{lines:t.lines,kinds:r,total:t.total}}const r=t.kinds.map((e=>"added"===e||"removed"===e||"other"===e?e:"other"));return{lines:t.lines,kinds:r,total:t.total}})();Ee((t=>{const o=Object.assign(Object.assign({},t),{[e]:n});for(Me.current.push(e);Me.current.length>60;){const e=Me.current.shift();e&&e in o&&delete o[e]}return o}))}),[]);(0,l.useEffect)((()=>{const e=setTimeout((()=>Le(!0)),250);return()=>clearTimeout(e)}),[]);const Oe=(0,d.pW)(),Ye=(0,l.useMemo)((()=>{if("truecolor"===ge){const e=null!=Oe&&Oe?a.B0.addHex:a.Fv.addHex;return me(e)}return"ansi256"===ge?`[38;5;${null!=Oe&&Oe?a.Kj.add:a.yp.add}m`:a.ki}),[ge,Oe,me]),ze=(0,l.useMemo)((()=>{if("truecolor"===ge){const e=null!=Oe&&Oe?a.B0.removeHex:a.Fv.removeHex;return me(e)}return"ansi256"===ge?`[38;5;${null!=Oe&&Oe?a.Kj.remove:a.yp.remove}m`:a.s0}),[ge,Oe,me]);(0,l.useEffect)((()=>{Ee({}),$e.current.clear()}),[]);const Ne=(e,t)=>t.length>10?`Sent a new follow-up: ${t.slice(0,10)}...`:`Sent a new follow-up: ${t}`,Fe=(0,l.useMemo)((()=>{if("basic"===ge)return"[42m";if("ansi256"===ge)return`[48;5;${null!=Oe&&Oe?a.Xh.add:a.XM.add}m`;const{addHex:e}=(0,x.a)(Oe);return fe(e)}),[ge,Oe,fe]),Be=(0,l.useMemo)((()=>{if("basic"===ge)return"[41m";if("ansi256"===ge)return`[48;5;${null!=Oe&&Oe?a.Xh.remove:a.XM.remove}m`;const{removeHex:e}=(0,x.a)(Oe);return fe(e)}),[ge,Oe,fe]),Ue=(0,l.useMemo)((()=>se%2==0?"â¬¡":Z.length>0?i.Ay.yellow("â¬¢"):i.Ay.green("â¬¢")),[se,Z.length]),qe=(0,l.useCallback)((e=>(0,f.aJ)(e)),[]),He=(0,l.useMemo)((()=>[`${i.Ay.white.bold("â†‘/â†“")} ${i.Ay.dim("scroll Â·")} ${i.Ay.white.bold("â†/â†’")} ${i.Ay.dim("switch file")}`,(t.length>1?"â†/â†’ switch file, ":"")+"q exit","j/k scroll, Space/f page, b back","Ctrl-d/u half, Ctrl-e/y line, g/G top/bot","",i.Ay.dim("Press q, Esc, Ctrl-C, or Ctrl-R to close")]),[t.length]),[We,Ge]=(0,l.useState)(!1),[,Xe]=(0,l.useTransition)();(0,l.useEffect)((()=>{Ge(!1)}),[]);const[Ke,Qe]=(0,l.useState)(!1);(0,l.useEffect)((()=>{Qe(!1),Xe((()=>Qe(!0)))}),[]);const Je=t[Y];(0,l.useEffect)((()=>{Je&&_e(Je)}),[Je,_e]);const Ve=(0,l.useMemo)((()=>{var e,n,o,r,s;const l=[],c=[],d=[];for(let u=0;u<t.length;u++){const p=u!==Y&&We,h=t[u],g=l.length,m=Math.max(10,null!==(n=null!==(e=null==J?void 0:J.width)&&void 0!==e?e:null==Q?void 0:Q.columns)&&void 0!==n?n:80),f=Math.max(0,m-2),v=(0,j.fw)(h.path),x=void 0===h.before,b=void 0===h.after,y=ye[h.path]||{lines:[],total:0,added:0,removed:0},w="reject"===X[h.path]?` ${a.s0}âœ–${a.Sj}`:"accept"===X[h.path]?` ${a.ki}âœ”${a.Sj}`:"",k=w?" ":"",C=(()=>{const e=[];return y.added>0&&e.push(`${Ye}+${y.added}${a.Sj}`),y.removed>0&&e.push(`${ze}-${y.removed}${a.Sj}`),e.length?`[2m${e.join(" ")}[0m`:""})(),S=`${u+1}/${t.length} `,E=x?` ${a.ki}[new]${a.Sj}`:"",$=`[1m ${S}${"reject"===X[h.path]?"[9m[29m":""}${E}${w}${k} [0m`,M=qe(C?`${$} ${C}`:$).length,T=Math.max(0,f-M),A=v.length<=T?v:(0,j.RZ)(v,Math.max(0,T)),I=`[1m ${S}${"reject"===X[h.path]?`[9m${A}[29m`:A}${E}${w}${k} [0m`,D=C?`${I} ${C}`:I;l.push(D),c.push("other"),l.push(""),c.push("other");let _=[],P=[];p||(_=(null===(o=Se[h.path]||ye[h.path])||void 0===o?void 0:o.lines)||[]),p||(P=(null===(r=Se[h.path]||ye[h.path])||void 0===r?void 0:r.kinds)||new Array(_.length).fill("other")),p||_&&0!==_.length||_e(h),"reject"===X[h.path]&&(_=_.map((e=>i.Ay.dim(e))));for(let e=0;e<_.length;e++)l.push(_[e]),c.push(null!==(s=P[e])&&void 0!==s?s:"other");l.push(""),c.push("other");const L=l.length;d.push({path:h.path,start:g,end:L,defaultKind:x?"added":b?"removed":"other",isNew:x}),u<t.length-1&&(l.push(""),c.push("other"))}return{lines:l,kinds:c,sections:d}}),[t,ye,Se,null==J?void 0:J.width,null==Q?void 0:Q.columns,X,We,Y,_e,Ye,ze,qe]),Ze=(0,l.useRef)(0),et=Ve.lines.length,tt=B,nt=Math.max(10,null!==(I=null!==(A=null==J?void 0:J.width)&&void 0!==A?A:null==Q?void 0:Q.columns)&&void 0!==I?I:80),ot=Math.max(0,nt-2),rt=!q&&0===W.length,st=i.Ay.grey("i to insert"),it=qe(st).length,lt=1,at=(rt&&Math.max(0,ot-it-lt),q?W.length>0?`${W} `:`For ${(null==Je?void 0:Je.path)&&Je.path.split("/").pop()||"this file"}${te&&"normal"!==ne?"":" (Esc cancel)"}`:N.length>0?N:"Add a follow-up"),ct=2,dt=3,ut=Math.max(0,ot-ct-dt),pt=((e,t,n)=>{let o=0,r=0,s=!1,i=1;for(;o<e.length;){if(27===e.charCodeAt(o)&&"["===e[o+1]){let t=o+2;for(;t<e.length&&"m"!==e[t];)t++;o=Math.min(e.length,t+1);continue}o++,r++;const l=s?n:t;(l<=0||r>l)&&(i++,s=!0,r=1)}return Math.max(1,i)})(at,rt?Math.max(0,ut-it-lt+2):ut,ut),ht=Je?pt+4+(ie?1:0):0,gt=((null!==(D=null==J?void 0:J.height)&&void 0!==D?D:null==Q?void 0:Q.rows)||24)-ht-1,mt=Math.max(1,gt);(0,l.useEffect)((()=>{const e=Je;if(!e)return;if(!Pe)return;const t=e.path,n=(0,a.Ak)(t);if(R(e).gated)return;const o=`${t}|${Oe?"L":"D"}`;if(Se[t]||$e.current.has(t)||he.current.has(o))return;$e.current.add(t);const r=C(void 0,void 0,void 0,(function*(){try{const o=Date.now(),r=yield pe();if(de("import.shiki",{durMs:Date.now()-o}),void 0===e.after)return void Re(t,{lines:["[deleted]"],kinds:["removed"],total:1});if(void 0===e.before){const o=(yield r(e.after,{lang:n,theme:Oe?"light-plus":"github-dark-default"})).tokens.map(((e,t)=>{const n=`[2m${(t+1).toString().padStart(4," ")}[0m`,o=e.map((e=>`${me(e.color)}${fe(e.bgColor)}${e.content}[0m`)).join("");return`${n} ${a.rW}[2m [0m ${o}`})),s=new Array(o.length).fill("added");return void Re(t,{lines:o,kinds:s,total:o.length})}const s=Oe?"light-plus":"github-dark-default";let i=Ae.current.get(t);if(!i){const n=ve(e.before,e.after),o=be(n);i={diffLines:n,filtered:xe(n,o),contextLines:o},Ae.current.set(t,i)}const{filtered:l}=i,c=[],d=[];for(const e of l)null!=e.afterLineNumber&&c.push(e.afterLineNumber-1),null!=e.beforeLineNumber&&d.push(e.beforeLineNumber-1);const u=[],p=[],h=new Set,g=new Set;for(const e of c)h.has(e)||(h.add(e),u.push(e));for(const e of d)g.has(e)||(g.add(e),p.push(e));const m=e.after.split(/\r?\n/),f=e.before.split(/\r?\n/),v=u.map((e=>{var t;return null!==(t=m[e])&&void 0!==t?t:""})).join("\n"),x=p.map((e=>{var t;return null!==(t=f[e])&&void 0!==t?t:""})).join("\n"),b=new Map,y=new Map;for(let e=0;e<u.length;e++)b.set(u[e]+1,e+1);for(let e=0;e<p.length;e++)y.set(p[e]+1,e+1);let j=null,w=null,k=0;if(yield De(),u.length>0){const e=Date.now();w=yield r(v,{lang:n,theme:s}),k+=Date.now()-e}if(yield De(),p.length>0){const e=Date.now();j=yield r(x,{lang:n,theme:s}),k+=Date.now()-e}de("shiki.tokens",{path:t,durMs:k});const C=new Array(l.length),S=l.map(((e,t)=>{var n;const o=`[2m${e.beforeLineNumber?e.beforeLineNumber.toString().padStart(4," "):"    "}[0m`,r=`[2m${e.afterLineNumber?e.afterLineNumber.toString().padStart(4," "):"    "}[0m`;let s;if("common"===e.type&&e.afterLineNumber&&w){const t=b.get(e.afterLineNumber);t&&t-1>=0&&t-1<w.tokens.length&&(s=w.tokens[t-1])}else if("added"===e.type&&e.afterLineNumber&&w){const t=b.get(e.afterLineNumber);t&&t-1>=0&&t-1<w.tokens.length&&(s=w.tokens[t-1])}else if("removed"===e.type&&e.beforeLineNumber&&j){const t=y.get(e.beforeLineNumber);t&&t-1>=0&&t-1<j.tokens.length&&(s=j.tokens[t-1])}s||(s=[{content:e.content}]);const i=s.map((t=>{return`${me(t.color)}${n=t,"added"===e.type||"removed"===e.type?"":fe(n.bgColor)}${t.content}[0m`;var n})).join("");switch(e.type){case"added":return C[t]="added",`${o} ${r} ${a.rW}${Ye}+${a.Sj} ${i}`;case"removed":return C[t]="removed",`${o} ${r} ${a.rW}${ze}-${a.Sj} ${i}`;case"gap":return C[t]="other",`${o} ${r} ${a.rW}[2mâ‹¯ ${null!==(n=e.gapCount)&&void 0!==n?n:0} lines truncated â‹¯[0m`;default:return C[t]=(e.type,"other"),`${o} ${r} ${a.rW}[2m [0m ${i}`}})),E=Date.now();Re(t,{lines:S,kinds:C,total:S.length}),de("shiki.cacheSet",{path:t,durMs:Date.now()-E,lines:S.length})}catch(e){$e.current.delete(t)}finally{$e.current.delete(t)}}));he.current.set(o,r),r.finally((()=>he.current.delete(o))).catch((()=>he.current.delete(o)))}),[Je,ve,Oe,pe,Pe,Se[null==Je?void 0:Je.path],fe,be,me,xe,R,De,de,Re,Ye,ze]);const ft=e=>{if(!Pe)return;const t=e.path,n=`${t}|${Oe?"L":"D"}`;Se[t]||$e.current.has(t)||he.current.has(n)||R(e).gated||($e.current.add(t),C(void 0,void 0,void 0,(function*(){try{const n=Date.now(),o=yield pe();de("import.shiki.preload",{durMs:Date.now()-n});const r=(0,a.Ak)(t);if(void 0===e.after)return void Re(t,{lines:["[deleted]"],kinds:["removed"],total:1});if(void 0===e.before){const n=Date.now(),s=yield o(e.after,{lang:r,theme:Oe?"light-plus":"github-dark-default"});de("shiki.tokens.preload",{path:t,durMs:Date.now()-n});const i=s.tokens.map(((e,t)=>{const n=(t+1).toString().padStart(4," "),o=e.map((e=>`${me(e.color)}${fe(e.bgColor)}${e.content}[0m`)).join("");return`${n} ${a.rW}[2m [0m ${o}`})),l=new Array(i.length).fill("added"),c=Date.now();return Re(t,{lines:i,kinds:l,total:i.length}),void de("shiki.cacheSet.preload",{path:t,durMs:Date.now()-c,lines:i.length})}const s=Oe?"light-plus":"github-dark-default";let i=Ae.current.get(t);if(!i){const n=ve(e.before,e.after),o=be(n);i={diffLines:n,filtered:xe(n,o),contextLines:o},Ae.current.set(t,i)}const{filtered:l}=i,c=[],d=[];for(const e of l)null!=e.afterLineNumber&&c.push(e.afterLineNumber-1),null!=e.beforeLineNumber&&d.push(e.beforeLineNumber-1);const u=[],p=[],h=new Set,g=new Set;for(const e of c)h.has(e)||(h.add(e),u.push(e));for(const e of d)g.has(e)||(g.add(e),p.push(e));const m=e.after.split(/\r?\n/),f=e.before.split(/\r?\n/),v=u.map((e=>{var t;return null!==(t=m[e])&&void 0!==t?t:""})).join("\n"),x=p.map((e=>{var t;return null!==(t=f[e])&&void 0!==t?t:""})).join("\n"),b=new Map,y=new Map;for(let e=0;e<u.length;e++)b.set(u[e]+1,e+1);for(let e=0;e<p.length;e++)y.set(p[e]+1,e+1);let j=null,w=null,k=0;if(yield De(),u.length>0){const e=Date.now();w=yield o(v,{lang:r,theme:s}),k+=Date.now()-e}if(yield De(),p.length>0){const e=Date.now();j=yield o(x,{lang:r,theme:s}),k+=Date.now()-e}de("shiki.tokens.preload",{path:t,durMs:k});const C=new Array(l.length),S=l.map(((e,t)=>{var n;const o=e.beforeLineNumber?e.beforeLineNumber.toString().padStart(4," "):"    ",r=e.afterLineNumber?e.afterLineNumber.toString().padStart(4," "):"    ";let s;if("common"===e.type&&e.afterLineNumber&&w){const t=b.get(e.afterLineNumber);t&&t-1>=0&&t-1<w.tokens.length&&(s=w.tokens[t-1])}else if("added"===e.type&&e.afterLineNumber&&w){const t=b.get(e.afterLineNumber);t&&t-1>=0&&t-1<w.tokens.length&&(s=w.tokens[t-1])}else if("removed"===e.type&&e.beforeLineNumber&&j){const t=y.get(e.beforeLineNumber);t&&t-1>=0&&t-1<j.tokens.length&&(s=j.tokens[t-1])}s||(s=[{content:e.content}]);const i=s.map((t=>{return`${me(t.color)}${n=t,"added"===e.type||"removed"===e.type?"":fe(n.bgColor)}${t.content}[0m`;var n})).join("");switch(e.type){case"added":return C[t]="added",`${o} ${r} ${a.rW}${a.ki}+${a.Sj} ${i}`;case"removed":return C[t]="removed",`${o} ${r} ${a.rW}${a.s0}-${a.Sj} ${i}`;case"gap":return C[t]="other",`${o} ${r} ${a.rW}[2mâ‹¯ ${null!==(n=e.gapCount)&&void 0!==n?n:0} lines truncated â‹¯[0m`;default:return C[t]="other",`${o} ${r} ${a.rW}[2m [0m ${i}`}})),E=Date.now();Re(t,{lines:S,kinds:C,total:S.length}),de("shiki.cacheSet.preload",{path:t,durMs:Date.now()-E,lines:S.length})}catch(e){}finally{$e.current.delete(t)}})))},{cursorOffset:vt}=(0,m.t)(W,G,{focus:q,showCursor:!0,highlightPastedText:!1,allowExplicitNewline:!1,onSubmit:e=>{const t=e.trim();if(t.length>0&&Je){const e=Ve.sections[Y],n=Ze.current;if(e){const o=Math.max(e.start,n),r=Math.min(e.end-1,n+mt-1),s=Math.max(1,o-e.start+1),l=Math.max(s,r-e.start+1),a=(0,w.C)(Je.path,t,{startLine:s,endLine:l});if(Z.length>0)for(const e of Z)ee(e.id,"auto-rejected before follow-up");k(a),le(i.Ay.dim(Ne(0,t))),ae.current&&clearTimeout(ae.current),ae.current=setTimeout((()=>le(null)),1800),G("")}else{const e=(0,w.C)(Je.path,t);if(Z.length>0)for(const e of Z)ee(e.id,"auto-rejected before follow-up");k(e),le(i.Ay.dim(Ne(0,t))),ae.current&&clearTimeout(ae.current),ae.current=setTimeout((()=>le(null)),1800),G("")}}},onCtrlC:()=>{G(""),H(!1)}});(0,l.useEffect)((()=>()=>{ae.current&&clearTimeout(ae.current)}),[]);const xt=e=>{const n=t.length;if(0===n)return;const o=(e%n+n)%n;z(o),V(o)};(0,s.Ge)(((e,n)=>{if(Pe||Le(!0),q)return n.ctrl&&("r"===e||"R"===e)||""===e?void o():n.escape?void(te?"normal"===ne&&(G(""),H(!1)):(G(""),H(!1))):n.return?void W.trim().length:n.ctrl&&"c"===e?(G(""),void H(!1)):void 0;if(n.ctrl&&("r"===e||"R"===e)||""===e)o();else{if("i"===e)return F(""),G(""),H(!0),U(!1),void oe("insert");if(n.return)return F(""),G(""),H(!0),U(!1),void oe("insert");if(B&&("q"===e||n.ctrl&&"c"===e||n.escape||n.backspace))U(!1);else if(n.escape||"q"===e||n.ctrl&&"c"===e)o();else if("?"!==e)if(!n.tab&&"\t"!==e||q)if((!n.shift||!n.tab&&"\t"!==e)&&"[Z"!==e||q)if("h"!==e&&"H"!==e||q)if("l"!==e&&"L"!==e||q){if(n.leftArrow){const e=Y-1<0?t.length-1:Y-1;xt(e)}else if(n.rightArrow){const e=(Y+1)%t.length;xt(e)}}else{const e=(Y+1)%t.length;xt(e)}else{const e=Y-1<0?t.length-1:Y-1;xt(e)}else{const e=Y-1<0?t.length-1:Y-1;xt(e)}else{const e=(Y+1)%t.length;xt(e)}else U((e=>!e))}}));const bt=(0,l.useRef)(null);return Je?(0,r.jsx)(T,{ref:bt,contentHeight:mt,totalLines:et,topHeaderLeft:`${t.length} ${1===t.length?"file":"files"} edited`,topHeaderRight:"esc when done",precomputedLines:Ve.lines,precomputedKinds:Ve.kinds,sections:Ve.sections.map((e=>({start:e.start,end:e.end,defaultKind:e.defaultKind}))),activeSectionIndex:Y,commandBuffer:N,onCommandBufferChange:F,inputDisabled:!1,wrapLines:$,wrapDeferRest:!Ke,overlayTitle:tt?"Help":void 0,overlayLines:tt?He:null,onViewportTopChange:e=>{Ze.current=e;const n=e+mt;for(let o=0;o<Ve.sections.length;o++){const r=Ve.sections[o];if(r.start<n+5&&r.end>e-5){const e=t[o],n=null==e?void 0:e.path;n&&_e(e),!n||Se[n]||$e.current.has(n)||he.current.has(`${n}|${Oe?"L":"D"}`)||ft(e)}}},onUserScroll:()=>{},onJumpApplied:()=>{},bottomLines:(()=>{var e;const t=` ${i.Ay.white.bold("â†‘/â†“")} ${i.Ay.dim("scroll Â·")} ${i.Ay.white.bold("â†/â†’")} ${i.Ay.dim("switch file")}`,n=` ${Ue} ${i.Ay.bold("Generating")}${i.Ay.dim("  â€” ")} ${i.Ay.white.bold("â†‘/â†“")} ${i.Ay.dim("scroll")}`,o=a.Eo||P,r=Z.length,s=r>0?` ${i.Ay.yellow(Ue)} ${i.Ay.yellow.bold("Pending decision")} ${i.Ay.yellow(`(${r})`)}${i.Ay.dim("  â€” ")} ${i.Ay.yellow("ctrl-r to respond")}`:null,l=`${a.Sj}`+(s||(o?n:t))+`${a.Sj}`,c=(()=>{const e=te&&"normal"===ne?i.Ay.bgGray:i.Ay.inverse;if(q){if(W.length>0){let t="",n=0,o=0,r=!1;const s=0,i=Math.max(0,ot-ct-dt-(rt?it+lt:0)),l=Math.max(0,ot-ct-dt);for(const a of W){const c=r?l:i;t+=0===s&&vt===W.length&&c>0&&o===c-1&&n===W.length-1||n>=vt-s&&n<=vt?e(a):a,n++,o++,c>0&&o>=c&&(r=!0,o=0)}return vt===W.length&&(t+=e(" ")),t}{const t=`For ${(null==Je?void 0:Je.path)&&Je.path.split("/").pop()||"this file"}${te&&"normal"!==ne?"":" (Esc cancel)"}`,n=t.slice(0,1),o=t.slice(1);return`${e(n)}${i.Ay.grey(o)}`}}return N.length>0?N:i.Ay.grey("Add a follow-up")})(),d=Oe?i.Ay.black:i.Ay.white,u=i.Ay.gray,p=0===W.length?d.dim("â†’"):d("â†’"),h=`${c}`,g=qe,m=ot,f=q?d:u,v=f(`â”Œ${"â”€".repeat(m)}â”`),x=f("â”‚"),b=[];ie&&b.push(` ${ie}`);const y=(()=>{const e=h,t=[];let n=0,o=0,r=0,s=!1;const i=()=>{const e=m-ct-dt;if(s)return Math.max(0,e);const t=rt?Math.max(0,e-it-lt+2):e;return Math.max(0,t)};for(;n<e.length;){if(27===e.charCodeAt(n)&&"["===e[n+1]){let t=n+2;for(;t<e.length&&"m"!==e[t];)t++;n=Math.min(e.length,t+1);continue}n++,o++;const l=i();l<=0?(t.push(""),s=!0,o=0,r=n):o>l&&(t.push(e.slice(r,n-1)),s=!0,r=n-1,o=1)}return t.push(e.slice(r)),t})();b.push(v);for(let t=0;t<y.length;t++){const n=null!==(e=y[t])&&void 0!==e?e:"",o=g(n).length,r=0===t,s=` ${p} `;if(r&&rt){const e=Math.max(0,lt+ct-2),t=Math.max(0,m-dt-o-it-e),r=`${x}${s}${n}[0m${" ".repeat(t)}${st}${" ".repeat(e)}${x}`;b.push(r)}else{const e=r?s:" ".repeat(dt),t=Math.max(0,m-dt-o-ct),i=`${x}${e}${n}[0m${" ".repeat(t+ct)}${x}`;b.push(i)}}const j=f(`â””${"â”€".repeat(m)}â”˜`),w=l;return b.push(j,w),b})(),promptActive:q,rowBgAdd:Fe,rowBgRemove:Be}):null},$=e=>e>=768&&e<=879||e>=65056&&e<=65071||8205===e||e>=65038&&e<=65039,M=e=>e>=4352&&(e<=4447||9001===e||9002===e||e>=11904&&e<=42191||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65135||e>=65281&&e<=65376||e>=65504&&e<=65510),T=l.forwardRef((({contentHeight:e,totalLines:t,topHeaderLeft:n,topHeaderRight:o,precomputedLines:r,precomputedKinds:c,sections:d,activeSectionIndex:u,commandBuffer:p,onCommandBufferChange:g,inputDisabled:m,promptActive:f,bottomLines:v,wrapLines:x,wrapDeferRest:b,onViewportTopChange:y,onViewportStatsChange:j,onJumpApplied:w,onUserScroll:k,overlayTitle:C,overlayLines:S,rowBgAdd:E,rowBgRemove:T},A)=>{const[I,D]=(0,l.useState)(0),_=(0,l.useRef)(3),P=(0,l.useRef)(r),L=(0,l.useRef)(c),R=/\x1b\[[0-9;]*m/g,O=l.useMemo((()=>{try{return/\p{Extended_Pictographic}/u}catch(e){return null}}),[]),Y=(0,l.useCallback)((e=>{const t=e.replace(R,"");let n=0;for(const e of t){const t=e.codePointAt(0);$(t)||((null==O?void 0:O.test(e))?n+=2:n+=M(t)?2:1)}return n}),[O]),z=(0,l.useCallback)((n=>{const o=x&&(H.lines.length||r.length)||t,s=Math.max(0,o-e);return Math.min(Math.max(0,n),s)}),[x,r.length,t,e]),N=(0,l.useCallback)((e=>{D((t=>{const n=z(t+e);return n!==t?(null==k||k(),n):t}))}),[z,k]);(0,l.useEffect)((()=>{const t=Math.max(1,Math.floor(e/10));_.current=t}),[e]),(0,s.Ge)(((n,o)=>{var r,s;if(m)return;if(f)return o.upArrow?void N(-1):o.downArrow?void N(1):o.ctrl&&"f"===n?void N(Math.max(1,e-1)):o.ctrl&&"b"===n?void N(-Math.max(1,e-1)):o.ctrl&&"d"===n?void N(Math.max(1,Math.floor(e/2))):o.ctrl&&"u"===n?void N(-Math.max(1,Math.floor(e/2))):void 0;if(/^[0-9]$/.test(n))return void g(p+n);if(o.backspace||o.delete)return void g(p.slice(0,-1));if(" "===n){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,e-1))}if("f"===n){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,e-1))}if("b"===n){const t=parseInt(p||"1",10);return g(""),void N(-t*Math.max(1,e-1))}if("j"===n){const e=parseInt(p||"1",10);return g(""),void N(e)}if("k"===n){const e=parseInt(p||"1",10);return g(""),void N(-e)}if(o.upArrow){const e=parseInt(p||"1",10);return g(""),void N(-e)}if(o.downArrow){const e=parseInt(p||"1",10);return g(""),void N(e)}if(o.ctrl&&"f"===n){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,e-1))}if(o.ctrl&&"b"===n){const t=parseInt(p||"1",10);return g(""),void N(-t*Math.max(1,e-1))}if(o.ctrl&&"d"===n){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,Math.floor(e/2)))}if(o.ctrl&&"u"===n){const t=parseInt(p||"1",10);return g(""),void N(-t*Math.max(1,Math.floor(e/2)))}if(o.ctrl&&"e"===n){const e=parseInt(p||"1",10);return g(""),void N(e)}if(o.ctrl&&"y"===n){const e=parseInt(p||"1",10);return g(""),void N(-e)}const i=o;if(i.pageDown){const t=parseInt(p||"1",10);return g(""),void N(t*Math.max(1,e-1))}if(i.pageUp){const t=parseInt(p||"1",10);return g(""),void N(-t*Math.max(1,e-1))}if("g"===n)return g(""),void D(0);if("G"!==n);else{const e=parseInt(p||"0",10);if(g(""),e>0)D(z(e-1));else{const e=x&&null!==(s=null===(r=P.current)||void 0===r?void 0:r.length)&&void 0!==s?s:t;D(z(e))}}}));const{stdout:F}=(0,s.t$)(),B=(0,h.l)(),U=(0,l.useRef)({start:[],count:[]}),q=(0,l.useRef)([]),H=(0,l.useMemo)((()=>{var e,t,n,o,s,i;if(!x){const e=r.length,t=new Array(e),n=new Array(e);for(let o=0;o<e;o++)t[o]=o,n[o]=1;return{lines:r,kinds:c,start:t,count:n}}const l=Math.max(1,(null!==(t=null!==(e=null==B?void 0:B.width)&&void 0!==e?e:null==F?void 0:F.columns)&&void 0!==t?t:80)-4),p=[],h=[],g=new Array(r.length),m=new Array(r.length);let f=0;const v=d[u]||{start:0,end:0},y=Math.max(1,a.rW.length),j=new RegExp(`^\\s*\\d{4}\\s\\d{4}\\s{${y}}(?:[+-]\\s)?`),w=new RegExp(`^\\s{5}\\d{4}\\s{${y}}`);for(let e=0;e<r.length;e++){const t=r[e];g[e]=f;let a=0;const d=e>=v.start&&e<v.end;if(b&&!d){p.push(t),h.push(null!==(n=c[e])&&void 0!==n?n:"other"),a++,f++,m[e]=a;continue}if(0===t.length){p.push(""),h.push(null!==(o=c[e])&&void 0!==o?o:"other"),a++,f++,m[e]=a;continue}const u=t.replace(/\x1b\[[0-9;]*m/g,"");let x=null;const y=u.match(j);if(y&&(x=y[0].length),null==x){const e=u.match(w);e&&(x=e[0].length)}null==x&&(x=12);const k=2,C=" ".repeat(x+k),S=x+k,E=Math.max(1,l-S);let T=0,A=0,I=0,D="",_="",P=!1,L=-1,R=-1;const Y=(e,t)=>{const n=e.charCodeAt(t);if(Number.isNaN(n))return{advance:1,w:0,isSpace:!1};if(27===n&&91===e.charCodeAt(t+1)){let n=t+2;for(;n<e.length&&"m"!==e[n];)n++;return{advance:Math.min(e.length-t,n-t+1),w:0,isSpace:!1}}let o=1,r=n;if(n>=55296&&n<=56319&&t+1<e.length){const s=e.charCodeAt(t+1);s>=56320&&s<=57343&&(o=2,r=65536+(n-55296<<10)+(s-56320))}if(32===r)return{advance:o,w:1,isSpace:!0};if($(r)||8205===r)return{advance:o,w:0,isSpace:!1};if(M(r))return{advance:o,w:2,isSpace:!1};const s=e.slice(t,t+o);return(null==O?void 0:O.test(s))?{advance:o,w:2,isSpace:!1}:{advance:o,w:1,isSpace:!1}};for(;T<t.length;){if(""===t[T]&&"["===t[T+1]){let e=T+2;for(;e<t.length&&"m"!==t[e];)e++;if(e<t.length){const n=t.slice(T,e+1);"[0m"===n?D="":D+=n,T=e+1;continue}break}const{advance:n,w:o,isSpace:r}=Y(t,T);T+=n,I+=o,r&&(L=T,R=I);const i=P?E:l;if(I>=i){const n=L>A?L:T,o=L>A?R:i;p.push(`${_+t.slice(A,n)}[0m`),h.push(null!==(s=c[e])&&void 0!==s?s:"other"),a++,A=n,I-=o,_=C+D,P=!0,L=-1,R=-1,f++}}A<t.length&&(p.push(`${_+t.slice(A)}[0m`),h.push(null!==(i=c[e])&&void 0!==i?i:"other"),a++,f++),m[e]=a}return{lines:p,kinds:h,start:g,count:m}}),[r,c,x,b,u,d,null==B?void 0:B.width,null==F?void 0:F.columns,O]);(0,l.useEffect)((()=>{U.current={start:H.start,count:H.count}}),[H]),(0,l.useEffect)((()=>{var e;P.current=x?H.lines:r,L.current=x?null!==(e=H.kinds)&&void 0!==e?e:[]:c,D((e=>{const t=z(e);return t!==e?t:e}))}),[H,r,c,x,z]),(0,l.useEffect)((()=>{var e;const t=x?H.lines:r,n=new Array(t.length);for(let o=0;o<t.length;o++)n[o]=Y(null!==(e=t[o])&&void 0!==e?e:"");q.current=n}),[H,r,x,Y]);const W=(0,l.useMemo)((()=>{var e,t,n;const o=new Array(d.length),s=new Array(d.length);if(x)for(let r=0;r<d.length;r++){const i=d[r];o[r]=null!==(e=H.start[i.start])&&void 0!==e?e:0,s[r]=(null!==(t=H.start[i.end-1])&&void 0!==t?t:0)+(null!==(n=H.count[i.end-1])&&void 0!==n?n:1)}else for(let e=0;e<d.length;e++){const t=d[e];o[e]=t.start,s[e]=t.end}return{start:o,end:s,total:x?H.lines.length:r.length}}),[d,x,H,r]);(0,l.useEffect)((()=>{null==y||y(I);const t=W.total,n=W.start,o=W.end,r=I,s=Math.min(r+e,t),i=new Array(d.length).fill(0);for(let e=0;e<d.length;e++){const t=Math.max(0,Math.min(o[e],s)-Math.max(n[e],r));i[e]=t}let l=0,a=-1;const c=r+e/2;for(let e=0;e<i.length;e++){const t=i[e];if(t>a)a=t,l=e;else if(t===a&&t>0){const t=(n[e]+o[e])/2,r=(n[l]+o[l])/2;Math.abs(t-c)<Math.abs(r-c)&&(l=e)}}null==j||j({top:r,vis:i,dominantIndex:l})}),[I,y,j,d,e,W.end,W.start,W.total]);const G=(0,l.useCallback)((e=>{var t;if(e<0||e>=d.length)return;const n=null!==(t=W.start[e])&&void 0!==t?t:0;D(z(n)),null==w||w()}),[d,W,z,w]),X=(0,l.useCallback)((t=>{var n,o;if(t<0||t>=d.length)return;const r=null!==(n=W.start[t])&&void 0!==n?n:0,s=null!==(o=W.end[t])&&void 0!==o?o:r,i=Math.max(1,s-r),l=Math.max(0,Math.floor(r+i/2-e/2));D(z(l)),null==w||w()}),[d,W,e,z,w]);(0,l.useImperativeHandle)(A,(()=>({scrollToSectionStart:G,scrollToSectionCenter:X})),[G,X]);const K=(0,l.useRef)(u);(0,l.useEffect)((()=>{var n;if(u<0||u>=d.length)return;if(K.current===u)return;K.current=u;const o=null!==(n=W.start[u])&&void 0!==n?n:0,s=x&&(H.lines.length||r.length)||t,i=Math.max(0,s-e),l=Math.min(Math.max(0,o),i);D(l),null==w||w()}),[u,e,w,r.length,H.lines.length,W.start,d.length,t,x]),(0,l.useEffect)((()=>{var t,s,l,a,c,u,p,h,g,m,f,v,b,y,j,w,k,C,S,$,M,A;if(!F)return;const D=x?H.lines:r,_=n?1:0;let P="";if(P+="[?2026h",1===_){const e=Math.max(10,null!==(s=null!==(t=null==B?void 0:B.width)&&void 0!==t?t:null==F?void 0:F.columns)&&void 0!==s?s:80),r=e=>e.replace(/\x1b\[[0-9;]*m/g,""),l=null!=n?n:"",a=null!=o?o:"",c=r(l).length,d=r(a).length,u=Math.max(0,e-2),p=Math.max(0,u-c-d),h=i.Ay.dim(l);let g;if(/^esc(\s|$)/.test(a)){const e=a.slice(3);g=i.Ay.white("esc")+i.Ay.dim(e)}else g=i.Ay.dim(a);P+=`[1;1H[2K ${h}${" ".repeat(p)}${g} [0m`}const R=I,O=Math.min(D.length,R+e),z=D.slice(R,O),N=L.current.slice(R,O),G=Math.max(10,null!==(a=null!==(l=null==B?void 0:B.width)&&void 0!==l?l:null==F?void 0:F.columns)&&void 0!==a?a:80),X=/\x1b\[(?:49|48;5;\d{1,3}|48;2;\d{1,3};\d{1,3};\d{1,3})m/g,K=/\x1b\[[0-9;]*m/g;let Q=null,J=null;for(let e=0;e<d.length;e++){const t=null!==(c=W.start[e])&&void 0!==c?c:0,n=null!==(u=W.end[e])&&void 0!==u?u:0;if(R>=t&&R<n){const t=d[e].start,o=null!==(p=U.current.start[t])&&void 0!==p?p:t,r=null!==(h=U.current.count[t])&&void 0!==h?h:1;Math.max(1,r),R>o&&R<n&&(Q=null!==(g=D[o])&&void 0!==g?g:null,J=e);break}}let V=(()=>{var e,t,n;let o=0;for(;o<d.length&&!(R>=(null!==(e=W.start[o])&&void 0!==e?e:0)&&R<(null!==(t=W.end[o])&&void 0!==t?t:0))&&R>=(null!==(n=W.end[o])&&void 0!==n?n:0);)o++;return o})();for(let t=0;t<e;t++){const e=R+t,n=_+t+1;for(;V<d.length&&e>=(null!==(m=W.end[V])&&void 0!==m?m:0);)V++;const o=V<d.length&&e>=(null!==(f=W.start[V])&&void 0!==f?f:0)&&e<(null!==(v=W.end[V])&&void 0!==v?v:0)?V:-1;P+=`[${n};1H[2K`;const r=null!==(b=z[t])&&void 0!==b?b:"";let s=null!==(y=N[t])&&void 0!==y?y:"other";if(0===t&&null!=Q&&o===J){P+=Q,P+=`[${n+1};1H[2K`;continue}if(-1===o){P+=r;continue}const i=d[o].start,l=null!==(j=U.current.start[i])&&void 0!==j?j:i,a=null!==(w=U.current.count[i])&&void 0!==w?w:1,c=l+Math.max(1,a);if(e>=l&&e<c)P+=null!==(C=null!==(k=D[l+Math.max(0,e-l)])&&void 0!==k?k:D[l])&&void 0!==C?C:r;else{if(("other"===s||null==s)&&o>=0){const e=d[o];"added"!==(null==e?void 0:e.defaultKind)&&"removed"!==(null==e?void 0:e.defaultKind)||(s=e.defaultKind)}if("added"!==s&&"removed"!==s||"added"===(null===(S=d[o])||void 0===S?void 0:S.defaultKind))P+=r;else{const t="added"===s?E:T;if(t){const n=null!==($=q.current[e])&&void 0!==$?$:Y(r),o=Math.max(0,G-n),s=r.replace(X,"").replace(K,(e=>`${e}${t}`));P+=`${t}${s}${" ".repeat(o)}[0m`}else P+=r}}}P+="[?2026l";try{null===(M=F.cork)||void 0===M||M.call(F)}catch(e){}F.write(P);try{null===(A=F.uncork)||void 0===A||A.call(F)}catch(e){}}),[F,H,r,I,e,B,n,o,E,T,d,W,Y,x]);const Q=null!=S?S:[],J=Q.length>0;return(0,l.useEffect)((()=>{var t,o,r,s,l,a,c,d;if(!F)return;const u=n?1:0;let p="[?2026h";if(J){const n=Math.max(10,null!==(o=null!==(t=null==B?void 0:B.width)&&void 0!==t?t:null==F?void 0:F.columns)&&void 0!==o?o:80),l=e=>e.replace(/\x1b\[[0-9;]*m/g,""),a=Math.max(24,Math.min(Math.floor(.6*n),80)),c=Q.length+3,d=Math.max(1,Math.floor((e-c)/2)),h=Math.max(1,Math.floor((n-(a+2))/2)),g=C?` ${i.Ay.bold(C)} `:"",m=l(g).length,f=Math.max(0,a-m),v=`${i.Ay.yellow("â”Œ")}${i.Ay.yellow(g)}${i.Ay.yellow("â”€".repeat(f))}${i.Ay.yellow("â”")}`,x=d+(Q.length+3)-1;for(let e=d;e<=x;e++){h>1&&(p+=`[${u+e};${h-1}H `);const t=h+a+2;t<=(null!==(s=null!==(r=null==B?void 0:B.width)&&void 0!==r?r:null==F?void 0:F.columns)&&void 0!==s?s:80)&&(p+=`[${u+e};${t}H `)}p+=`[${u+d};${h}H${v}`,p+=`[${u+d+1};${h}H${i.Ay.yellow("â”‚")} ${" ".repeat(Math.max(0,a-2))} ${i.Ay.yellow("â”‚")}`;let b=d+2;for(const e of Q){const t=l(e).length,n=Math.max(0,a-t-2);p+=`[${u+b};${h}H${i.Ay.yellow("â”‚")} ${e}${" ".repeat(n)} ${i.Ay.yellow("â”‚")}`,b++}p+=`[${u+b};${h}H${i.Ay.yellow("â””")}${i.Ay.yellow("â”€").repeat(a)}${i.Ay.yellow("â”˜")}`}let h=u+e+1;for(const e of v)p+=`[${h};1H[2K${e}`,h++;const g=null!==(a=null!==(l=null==B?void 0:B.height)&&void 0!==l?l:F.rows)&&void 0!==a?a:24;for(let e=h;e<=g;e++)p+=`[${e};1H[2K`;p+=`[${Math.min(h,g)};1H`,p+="[?2026l";try{null===(c=F.cork)||void 0===c||c.call(F)}catch(e){}F.write(p);try{null===(d=F.uncork)||void 0===d||d.call(F)}catch(e){}}),[F,v,C,B,e,n,J,Q]),null}));o()}catch(A){o(A)}}))},"./src/components/glob-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{P:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;if(!e.globPattern)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.EY,{color:"gray",children:"Failed to search - Missing required parameters: globPattern"})});const c=(null===(n=e.globPattern)||void 0===n?void 0:n.length)>40?`...${e.globPattern.slice(-37)}`:e.globPattern||"",d=(0,l.Kr)(e.targetDirectory||".");let u="pending";switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:u="pending";break;case"error":u="error";break;case"success":u="success";break;default:u="pending"}const p=(0,i.F_)("globToolCall","success"===u)||("success"===u?"Globbed":"Globbing");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:p,primary:`"${c}"`,status:u,note:`in ${d}`}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.error]})}):null})(),(()=>{const e=null==t?void 0:t.result;return"success"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Found ",e.value.totalFiles||0," file",1===(e.value.totalFiles||0)?"":"s",e.value.clientTruncated&&" (truncated)"]})}):null})()]})};o()}catch(e){o(e)}}))},"./src/components/grep-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{h:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n,o;if(!e||!e.pattern)return null;const c=(null===(n=e.pattern)||void 0===n?void 0:n.length)>40?`...${e.pattern.slice(-37)}`:e.pattern||"",d=(0,l.Kr)(e.path||"");let u="pending";switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:u="pending";break;case"error":u="error";break;case"success":u="success";break;default:u="pending"}const p=(0,i.F_)("grepToolCall","success"===u)||("success"===u?"Grepped":"Grepping");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:p,primary:`"${c}"`,status:u,note:`in ${d}`}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.error]})}):null})(),(()=>{const e=null==t?void 0:t.result;if("success"===(null==e?void 0:e.case)){let t=0;const n=Object.values(e.value.workspaceResults).at(0);if(!n)return null;const{result:o}=n;if(!o.value)return null;const l=o.value.ripgrepTruncated||o.value.clientTruncated;switch(o.case){case"count":t=o.value.totalMatches;break;case"files":t=o.value.totalFiles;break;case"content":t=o.value.totalMatchedLines}return(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Found ",t," matches ",l?" (truncated)":""]})})}return null})()]})};o()}catch(e){o(e)}}))},"./src/components/hexagon-loader.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/hooks/use-shared-animation.ts"),a=e([s]);s=(a.then?(await a)():a)[0];const c=(0,i.memo)((function({customInterval:e,activeColor:t="white",inactiveColor:n}){const o=null!=e?e:l.q,a=(0,l.e)(o),c=(0,i.useMemo)((()=>a%2==0?"â¬¡":"â¬¢"),[a]);return(0,r.jsx)(s.EY,{color:a%2==1?t:n,children:c})}));o()}catch(e){o(e)}}))},"./src/components/highlighted-code.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>ne,d:()=>te});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../utils/dist/index.js"),l=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/shellscript.mjs"),a=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/c.mjs"),c=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/cpp.mjs"),d=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/csharp.mjs"),u=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/css.mjs"),p=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/dart.mjs"),h=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/docker.mjs"),g=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/go.mjs"),m=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/html.mjs"),f=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/ini.mjs"),v=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/java.mjs"),x=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/javascript.mjs"),b=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/json.mjs"),y=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/jsx.mjs"),j=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/kotlin.mjs"),w=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/less.mjs"),k=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/lua.mjs"),C=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/make.mjs"),S=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/markdown.mjs"),E=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/php.mjs"),$=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/powershell.mjs"),M=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/python.mjs"),T=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/r.mjs"),A=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/ruby.mjs"),I=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/rust.mjs"),D=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/scss.mjs"),_=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/sql.mjs"),P=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/swift.mjs"),L=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/toml.mjs"),R=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/tsx.mjs"),O=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/typescript.mjs"),Y=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/xml.mjs"),z=n("../../node_modules/.pnpm/@shikijs+langs@3.9.2/node_modules/@shikijs/langs/dist/yaml.mjs"),N=n("../../node_modules/.pnpm/@shikijs+themes@3.9.2/node_modules/@shikijs/themes/dist/github-dark-default.mjs"),F=n("../../node_modules/.pnpm/@shikijs+themes@3.9.2/node_modules/@shikijs/themes/dist/light-plus.mjs"),B=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),U=n("../../node_modules/.pnpm/@shikijs+core@3.7.0/node_modules/@shikijs/core/dist/index.mjs"),q=n("../../node_modules/.pnpm/@shikijs+engine-javascript@3.7.0/node_modules/@shikijs/engine-javascript/dist/engine-compile.mjs"),H=n("./src/constants.ts"),W=n("./src/context/theme-context.tsx"),G=n("./src/utils/color-mixing.ts"),X=n("./src/utils/diff-colors.ts"),K=n("./src/utils/inline-diff.ts"),Q=e([s,W]);[s,W]=Q.then?(await Q)():Q;const J=({lineNumber:e,showLineNumbers:t,lineNumberWidth:n,children:o,isDiff:i=!1,rowBgHex:l,rowBgAnsi256Index:a,signChar:c,signColor:d})=>{const u="number"==typeof a?`[48;5;${a}m`:void 0,p="number"==typeof a?"[49m":void 0,h=Boolean(l&&!u);return(0,r.jsxs)(s.az,{flexDirection:"row",backgroundColor:l,flexGrow:1,width:"100%",children:[t&&(0,r.jsx)(s.az,{width:n+2,borderRight:!i,borderLeft:!1,borderTop:!1,borderBottom:!1,borderColor:"gray",borderStyle:"single",justifyContent:"flex-end",flexShrink:0,children:(0,r.jsxs)(s.EY,{dimColor:!0,backgroundColor:h?l:void 0,children:[u?(0,r.jsx)(s.EY,{children:u}):null,e.toString().padStart(n," ")," ",p?(0,r.jsx)(s.EY,{children:p}):null]})}),c?(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsxs)(s.EY,{backgroundColor:h?l:void 0,children:[u?(0,r.jsx)(s.EY,{children:u}):null,(0,r.jsx)(s.EY,{color:d,bold:!0,children:c})," ",p?(0,r.jsx)(s.EY,{children:p}):null]})}):null,(0,r.jsx)(s.az,{paddingLeft:c?0:i?1:0,flexShrink:1,flexGrow:1,children:(0,r.jsxs)(s.EY,{backgroundColor:h?l:void 0,children:[u?(0,r.jsx)(s.EY,{children:u}):null,o,p?(0,r.jsx)(s.EY,{children:p}):null]})})]})},V=(0,U.gX)({themes:[N.A,F.A],langs:[x.A,O.A,R.A,y.A,b.A,m.A,u.A,D.A,w.A,l.A,l.A,z.A,L.A,S.A,g.A,I.A,v.A,a.A,c.A,d.A,E.A,A.A,P.A,j.A,_.A,T.A,p.A,k.A,h.A,C.A,Y.A,f.A,$.A,M.A],engine:(0,q.l)()}),Z=new i.qK({max:300}),ee=(e,t,n)=>`${t}::${e}::${n}`,te=e=>{var{content:t,language:n,showLineNumbers:o=!0,lineNumberWidth:i=4,startLineNumber:l=1,maxLines:a,isDiff:c=!1,truncationHint:d,tabSize:u=4,dimmed:p=!1}=e,h=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(e,["content","language","showLineNumbers","lineNumberWidth","startLineNumber","maxLines","isDiff","truncationHint","tabSize","dimmed"]);const g=(0,B.useMemo)((()=>t.split("\n")),[t]),m=(0,W.pW)(),f=(0,B.useMemo)((()=>(0,G.PT)()),[]),v=(0,B.useMemo)((()=>{const e=new Map;if(!c)return e;const t=g.map(((e,t)=>{const n=(0,X.U)(e);return{type:"added"===n?"added":"removed"===n?"removed":"common",content:e.slice(1),originalIndex:t}})),n=(0,K.f)(t);for(const{removedIdx:o,addedIdx:r}of n){const n=t[o],s=t[r],{before:i,after:l}=(0,K.U)(n.content,s.content);i.length>0&&e.set(n.originalIndex,i),l.length>0&&e.set(s.originalIndex,l)}return e}),[g,c]),x=(0,B.useMemo)((()=>{if("truecolor"===f)return m?H.Qn:H.Yb;const e=m?H.f2:H.$n;return{addBgHex:(0,G.LR)(e.addBg),addFgHex:(0,G.LR)(e.addFg),removeBgHex:(0,G.LR)(e.removeBg),removeFgHex:(0,G.LR)(e.removeFg)}}),[f,m]),b=(0,B.useMemo)((()=>m?"light-plus":"github-dark-default"),[m]),y=(0,B.useMemo)((()=>{if("truecolor"===f)return m?H.iP:H.eh;const e=m?H.Xh.add:H.XM.add,t=m?H.Xh.remove:H.XM.remove;return{addHex:(0,G.LR)(e),removeHex:(0,G.LR)(t)}}),[f,m]),j=(0,B.useMemo)((()=>"ansi256"!==f?null:m?{add:H.Xh.add,remove:H.Xh.remove}:{add:H.XM.add,remove:H.XM.remove}),[f,m]),w=(0,B.useMemo)((()=>{if("truecolor"===f)return m?H.B0:H.Fv;const e=m?H.Kj:H.yp;return{addHex:(0,G.LR)(e.add),removeHex:(0,G.LR)(e.remove)}}),[f,m]),k=(0,B.useMemo)((()=>{try{const e=ee(n,b,t),o=Z.get(e);if(o)return o;const r=V.codeToTokens(t,{lang:n,theme:b});return Z.set(e,r),r}catch(e){return null}}),[t,n,b]),C=(e,t)=>{for(const n of t)if(e>=n.start&&e<n.end)return!0;return!1},S=(e,t,n)=>{var o,i,l,a,c;if(!n||0===n.length)return(0,r.jsx)(r.Fragment,{children:e.map(((e,n)=>{var o,i,l,a;return(0,r.jsx)(s.EY,{color:null!==(o=e.color)&&void 0!==o?o:void 0,backgroundColor:"other"===t?e.bgColor:void 0,italic:Boolean(1&(null!==(i=e.fontStyle)&&void 0!==i?i:0)),bold:Boolean(2&(null!==(l=e.fontStyle)&&void 0!==l?l:0)),underline:Boolean(4&(null!==(a=e.fontStyle)&&void 0!==a?a:0)),children:e.content},`${e.content}-${n}`)}))});const d=[];let u=0;for(let p=0;p<e.length;p++){const h=e[p],g=null!==(o=h.content)&&void 0!==o?o:"";let m=0;for(;m<g.length;){const e=C(u+m,n);let o=m+1;for(;o<g.length&&C(u+o,n)===e;)o++;const f=g.slice(m,o),v=e?"added"===t?x.addBgHex:x.removeBgHex:"other"===t?h.bgColor:void 0,b=e?"added"===t?x.addFgHex:x.removeFgHex:null!==(i=h.color)&&void 0!==i?i:void 0;d.push((0,r.jsx)(s.EY,{color:b,backgroundColor:v,italic:Boolean(1&(null!==(l=h.fontStyle)&&void 0!==l?l:0)),bold:Boolean(2&(null!==(a=h.fontStyle)&&void 0!==a?a:0)),underline:Boolean(4&(null!==(c=h.fontStyle)&&void 0!==c?c:0)),children:f},`${p}-${u}-${m}`)),m=o}u+=g.length}return(0,r.jsx)(r.Fragment,{children:d})},E=k?k.tokens.length:g.length,$="number"==typeof a&&a>0?Math.min(E,a):E,M=E-$,T=(e,t,n)=>{if(n<=0)return t;const o=t=>{let o=0,r=0;for(let s=0;s<t&&s<e.length;s++)if("\t"===e[s]){const e=n-o%n,t=0===e?n:e;r+=t,o+=t}else r++,o++;return r};return t.map((e=>({start:o(e.start),end:o(e.end)})))},A=(e,t)=>{if(!e||u<=0)return{text:e,endColumn:t+Array.from(e).length};let n=t,o="";for(const t of Array.from(e))if("\t"===t){const e=u-n%u;o+=" ".repeat(0===e?u:e),n+=0===e?u:e}else o+=t,n+=1;return{text:o,endColumn:n}},I=e=>{let t=0;return e.map((e=>{var n;const o=null!==(n=e.content)&&void 0!==n?n:"",{text:r,endColumn:s}=A(o,t);return t=s,Object.assign(Object.assign({},e),{content:r})}))};return(0,r.jsxs)(s.az,Object.assign({flexDirection:"column",width:"100%"},h,{children:[Array.from({length:$},((e,t)=>{var n,a,d,h,m;const b=null!==(n=g[t])&&void 0!==n?n:"",C=c?(0,X.U)(b):"other",E="ansi256"===f?void 0:"added"===C?y.addHex:"removed"===C?y.removeHex:void 0,$="ansi256"===f?"added"===C?null==j?void 0:j.add:"removed"===C?null==j?void 0:j.remove:void 0:void 0,M=k?null!==(a=k.tokens[t])&&void 0!==a?a:[]:null;let D,_,P;if(M)if("added"===C||"removed"===C){let e=1;const n=[];for(const t of M){if(e<=0){n.push(t);continue}const o=null!==(d=t.content)&&void 0!==d?d:"";o.length<=e?e-=o.length:(n.push(Object.assign(Object.assign({},t),{content:o.slice(e)})),e=0)}_=null!==(h=b[0])&&void 0!==h?h:"",P="added"===C?w.addHex:w.removeHex;const o=I(n),i=v.get(t),l=i&&i.length>0?T(b.slice(1),i,u):void 0;D=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:S(o,C,l)})}else{const e=I(M);D=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:S(e,C)})}else if("added"===C||"removed"===C){_=null!==(m=b[0])&&void 0!==m?m:"";const e=b.slice(1);P="added"===C?w.addHex:w.removeHex;const n=v.get(t);if(n&&n.length>0){const t=A(e,0).text,o=T(e,n,u),i=[];let l=0;for(let e=0;e<o.length;e++){const n=o[e];n.start>l&&i.push((0,r.jsx)(s.EY,{children:t.slice(l,n.start)},`pre-${e}`));const a="added"===C?x.addBgHex:x.removeBgHex,c="added"===C?x.addFgHex:x.removeFgHex;i.push((0,r.jsx)(s.EY,{backgroundColor:a,color:c,children:t.slice(n.start,n.end)},`hl-${e}`)),l=n.end}l<t.length&&i.push((0,r.jsx)(s.EY,{children:t.slice(l)},"post")),D=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:i})}else D=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:(0,r.jsx)(s.EY,{children:A(e,0).text})})}else D=(0,r.jsx)(s.EY,{wrap:"wrap",dimColor:p,children:A(b,0).text});const L=l+t;return(0,r.jsx)(J,{lineNumber:L,showLineNumbers:o,lineNumberWidth:i,isDiff:c,rowBgHex:E,rowBgAnsi256Index:$,signChar:_,signColor:P,children:D},L)})),M>0&&(0,r.jsx)(J,{lineNumber:l+$,showLineNumbers:o,lineNumberWidth:i,isDiff:c,children:(0,r.jsxs)(s.EY,{dimColor:!0,children:["â€¦ truncated (",M," more line",1===M?"":"s",")",d?(0,r.jsxs)(s.EY,{children:[" Â· ",d]}):null]})})]}))},ne=te;o()}catch(e){o(e)}}))},"./src/components/index.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Hw:()=>S.H,Yl:()=>h.Y});var r=n("./src/components/approval-dialog.tsx"),s=n("./src/components/background-edit-tool-ui.tsx"),i=n("./src/components/background-shell-tool-ui.tsx"),l=n("./src/components/background-tool-group-ui.tsx"),a=n("./src/components/delete-tool-ui.tsx"),c=n("./src/components/grep-tool-ui.tsx"),d=n("./src/components/login-ui.tsx"),u=n("./src/components/merged-read-search-tool-ui.tsx"),p=n("./src/components/message-input.tsx"),h=n("./src/components/overflow-text.tsx"),g=n("./src/components/path-display.tsx"),m=n("./src/components/plan-execution-message.tsx"),f=n("./src/components/prompt-bar.tsx"),v=n("./src/components/read-todos-tool-ui.tsx"),x=n("./src/components/read-tool-ui.tsx"),b=n("./src/components/search-results-ui.tsx"),y=n("./src/components/sem-search-tool-ui.tsx"),j=n("./src/components/shell-tool-ui.tsx"),w=n("./src/components/task-tool-ui.tsx"),k=n("./src/components/todos-ui.tsx"),C=n("./src/components/update-todos-tool-ui.tsx"),S=n("./src/components/user-message-ui.tsx"),E=n("./src/components/web-search-tool-ui.tsx"),$=n("./src/components/write-shell-stdin-tool-ui.tsx"),M=e([r,s,i,l,a,c,d,u,p,h,g,m,f,v,x,b,y,j,w,k,C,S,E,$]);[r,s,i,l,a,c,d,u,p,h,g,m,f,v,x,b,y,j,w,k,C,S,E,$]=M.then?(await M)():M,o()}catch(e){o(e)}}))},"./src/components/inline-delta.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{_:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({added:e=0,removed:t=0})=>{const n=(null!=e?e:0)>0,o=(null!=t?t:0)>0;return n||o?(0,r.jsxs)(s.EY,{children:[n?(0,r.jsxs)(s.EY,{color:"green",children:["+",e]}):null,n&&o?(0,r.jsx)(s.EY,{children:" "}):null,o?(0,r.jsxs)(s.EY,{color:"red",children:["-",t]}):null]}):null};o()}catch(e){o(e)}}))},"./src/components/items-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{g:()=>y});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:fs"),i=n("node:os"),l=n("node:path"),a=n("../ink/build/index.js"),c=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),d=n("./src/hooks/use-screen-size.ts"),u=n("./src/utils/git.ts"),p=n("./src/utils/rule-command-utils.ts"),h=n("./src/components/text-input.tsx"),g=e([a,d,h]);[a,d,h]=g.then?(await g)():g;const x={rules:"rule",commands:"command",skills:"skill"},b=10;function m(e){const t=[],n=(0,l.join)(e,".cursor","rules");if((0,s.existsSync)(n))try{const e=(0,s.readdirSync)(n).filter((e=>e.endsWith(".mdc")));for(const o of e)t.push({id:`project-${o}`,name:o.replace(".mdc",""),path:(0,l.join)(n,o),scope:"project"})}catch(e){}const o=(0,l.join)((0,i.homedir)(),".cursor","rules");if((0,s.existsSync)(o))try{const e=(0,s.readdirSync)(o).filter((e=>e.endsWith(".mdc")));for(const n of e)t.push({id:`user-${n}`,name:n.replace(".mdc",""),path:(0,l.join)(o,n),scope:"user"})}catch(e){}return t}function f(e){const t=[],n=(0,l.join)(e,".cursor","commands");if((0,s.existsSync)(n))try{const e=(0,s.readdirSync)(n).filter((e=>e.endsWith(".md")));for(const o of e)t.push({id:`project-${o}`,name:o.replace(".md",""),path:(0,l.join)(n,o),scope:"project"})}catch(e){}const o=(0,l.join)((0,i.homedir)(),".cursor","commands");if((0,s.existsSync)(o))try{const e=(0,s.readdirSync)(o).filter((e=>e.endsWith(".md")));for(const n of e)t.push({id:`user-${n}`,name:n.replace(".md",""),path:(0,l.join)(o,n),scope:"user"})}catch(e){}return t}function v(e){const t=[],n=(e,n)=>{if((0,s.existsSync)(e))try{const o=(0,s.readdirSync)(e,{withFileTypes:!0});for(const r of o)if(r.isDirectory()){const o=(0,l.join)(e,r.name,"SKILL.md");(0,s.existsSync)(o)&&t.push({id:`${n}-${r.name}`,name:r.name,path:o,scope:n})}}catch(e){}};return n((0,l.join)(e,".cursor","skills"),"project"),n((0,l.join)((0,i.homedir)(),".cursor","skills"),"user"),n((0,l.join)((0,i.homedir)(),".cursor","skills-cursor"),"builtin"),t}const y=({mode:e,onClose:t,onSelect:n,viewState:o,onViewStateChange:g,viewingItemPath:y,onViewingItemPathChange:j,editContent:w,onEditContentChange:k})=>{var C,S,E,$;const M=(0,c.useMemo)((()=>(0,u.ky)(process.cwd())||process.cwd()),[]),[T,A]=(0,c.useState)([]),[I,D]=(0,c.useState)(!1),[_,P]=(0,c.useState)(0),[L,R]=(0,c.useState)(0),O=(0,c.useRef)(T),Y=(0,c.useRef)(_),z=(0,c.useRef)(L);O.current=T,Y.current=_,z.current=L;const[N,F]=(0,c.useState)("list"),B=null!=o?o:N,U=(0,c.useCallback)((e=>{g?g(e):F(e)}),[g]),[q,H]=(0,c.useState)(""),[W,G]=(0,c.useState)(0),[X,K]=(0,c.useState)(""),[Q,J]=(0,c.useState)(""),[V,Z]=(0,c.useState)(""),[ee,te]=(0,c.useState)(""),[ne,oe]=(0,c.useState)(0),[re,se]=(0,c.useState)(""),[ie,le]=(0,c.useState)(null),[ae,ce]=(0,c.useState)(null),de=null!=y?y:ae,ue=(0,c.useCallback)((e=>{j?j(e):ce(e)}),[j]),pe=(0,c.useMemo)((()=>{var e;return de&&null!==(e=T.find((e=>e.path===de)))&&void 0!==e?e:null}),[de,T]),he="builtin"!==(null==pe?void 0:pe.scope),[ge,me]=(0,c.useState)(0),[fe,ve]=(0,c.useState)(""),[xe,be]=(0,c.useState)(void 0),ye=null!=w?w:xe,je=(0,c.useCallback)((e=>{k?k(e):be(e)}),[k]);(0,c.useEffect)((()=>{if(de&&("view"===B||"edit"===B)&&!re)try{const e=(0,s.readFileSync)(de,"utf-8");se(e),"edit"===B&&void 0===ye&&je(e)}catch(e){U("list"),ue(null)}}),[de,B,U,ue,re,ye,je]);const{stdout:we}=(0,a.t$)(),ke=(0,d.l)(),Ce=null!==(S=null!==(C=null==ke?void 0:ke.height)&&void 0!==C?C:null==we?void 0:we.rows)&&void 0!==S?S:24,Se=null!==($=null!==(E=null==ke?void 0:ke.width)&&void 0!==E?E:null==we?void 0:we.columns)&&void 0!==$?$:80,Ee=Math.min(b,Math.max(5,Ce-8)),$e=Math.max(20,Se-14);(0,c.useEffect)((()=>{let t;switch(e){case"rules":t=m(M);break;case"commands":t=f(M);break;case"skills":t=v(M);break;default:throw new Error(`Unhandled mode: ${e}`)}const n={id:"create-new",name:`Create new ${x[e]}`,path:"",scope:"project",isCreateNew:!0};A([n,...t]),D(!0)}),[e,M]),(0,c.useEffect)((()=>{if(T.length>0){_>=T.length&&P(T.length-1);const e=Math.max(0,T.length-Ee);L>e&&R(e)}}),[T.length,_,L,Ee]);const Me=(0,c.useCallback)((()=>{U("create-description"),H("")}),[U]),Te=(0,c.useCallback)((()=>{if(q.trim())switch(e){case"rules":U("create-rule-type"),G(0);break;case"commands":U("create-command-name"),J((0,p.Zc)(q)),Z("");break;case"skills":U("create-skill-name"),te((0,p.uM)(q));break;default:throw new Error(`Unhandled mode: ${e}`)}}),[q,e,U]),Ae=(0,c.useCallback)((()=>{"glob"===p.TP[W].value?(U("create-glob-pattern"),K("")):(U("create-scope"),oe(0))}),[W,U]),Ie=(0,c.useCallback)((()=>{X.trim()&&(U("create-scope"),oe(0))}),[X,U]),De=(0,c.useCallback)((e=>{J(e),(0,p.Ux)(e)?Z((0,p.nQ)()):Z("")}),[]),_e=(0,c.useCallback)((()=>{const e=(0,p._M)(Q);e&&(J(e),Z(""),U("create-scope"),oe(0))}),[Q,U]),Pe=(0,c.useCallback)((e=>{te(e)}),[]),Le=(0,c.useCallback)((()=>{const e=(0,p.mc)(ee);e&&(te(e),U("create-scope"),oe(0))}),[ee,U]),Re=(0,c.useCallback)((()=>{let t,n,o,r;const a="user"===(0,p.Zs)(e)[ne].value?(0,l.join)((0,i.homedir)(),".cursor"):(0,l.join)(M,".cursor");switch(e){case"rules":{t=(0,p.Fv)(q),t||(t=`new-rule-${Date.now()}`),n=(0,l.join)(a,"rules"),o=(0,l.join)(n,`${t}.mdc`);const e=p.TP[W].value;r=(0,p.jh)({description:q,name:t,ruleType:e,globPattern:X||void 0});break}case"commands":t=Q||`new-command-${Date.now()}`,n=(0,l.join)(a,"commands"),o=(0,l.join)(n,`${t}.md`),r=(0,p.kt)({name:t,description:q});break;case"skills":t=ee||`new-skill-${Date.now()}`,n=(0,l.join)(a,"skills",t),o=(0,l.join)(n,"SKILL.md"),r=(0,p.K8)({name:t,description:q});break;default:throw new Error(`Unhandled mode: ${e}`)}try{if((0,s.existsSync)(n)||(0,s.mkdirSync)(n,{recursive:!0}),(0,s.existsSync)(o))return ve(`Already exists: ${o}`),void U("success");let t;switch((0,s.writeFileSync)(o,r,"utf-8"),e){case"rules":t=m(M);break;case"commands":t=f(M);break;case"skills":t=v(M);break;default:throw new Error(`Unhandled mode: ${e}`)}const i={id:"create-new",name:`Create new ${x[e]}`,path:"",scope:"project",isCreateNew:!0};A([i,...t]),se(r),ue(o),je(r),me(0),U("edit")}catch(e){ve(`Error: ${e instanceof Error?e.message:String(e)}`),U("success")}}),[q,ne,e,M,W,X,Q,ee,U,ue,je]),Oe=(0,c.useCallback)((e=>{if(n)n(e);else try{const t=(0,s.readFileSync)(e.path,"utf-8");se(t),ue(e.path),me(0),U("view")}catch(t){ve(`Error reading file: ${e.path}`),U("success")}}),[n,U,ue]),Ye=(0,c.useCallback)((()=>{(null==pe?void 0:pe.path)?(je(re),U("edit")):(ve("No file selected to edit"),U("success"))}),[pe,re,U,je]),ze=(0,c.useCallback)((()=>{if((null==pe?void 0:pe.path)&&void 0!==ye)try{(0,s.writeFileSync)(pe.path,ye,"utf-8"),se(ye),ve(`Saved: ${pe.path}`),U("success")}catch(e){ve(`Error saving: ${e instanceof Error?e.message:String(e)}`),U("success")}}),[pe,ye,U]),Ne=(0,c.useCallback)((()=>{U("view")}),[U]),Fe=(0,c.useCallback)((()=>{if(ie)try{if("skills"===e){const e=(0,l.dirname)(ie.path);(0,s.rmSync)(e,{recursive:!0,force:!0})}else(0,s.unlinkSync)(ie.path);let t;switch(ve(`Deleted: ${ie.name}`),le(null),U("success"),e){case"rules":t=m(M);break;case"commands":t=f(M);break;case"skills":t=v(M);break;default:throw new Error(`Unhandled mode: ${e}`)}const n={id:"create-new",name:`Create new ${x[e]}`,path:"",scope:"project",isCreateNew:!0};A([n,...t]),_>=t.length+1&&P(Math.max(0,t.length))}catch(e){ve(`Error deleting: ${e instanceof Error?e.message:String(e)}`),le(null),U("success")}}),[ie,e,M,U,_]),Be=(0,c.useCallback)((()=>{le(null),U(de?"view":"list")}),[U,de]),Ue=(0,c.useCallback)((e=>e.includes("[M")||e.includes("[<")||e.includes("[?")||/\x1b\[<\d+;\d+;\d+[Mm]/.test(e)||/\x1b\[M[\x20-\xff]{3}/.test(e)),[]),qe=Math.max(5,Ce-10),He=re.split("\n"),We=Math.max(0,He.length-qe),Ge=(0,c.useCallback)(((o,r)=>{if(Ue(o))return;if(r.ctrl&&"c"===o)return void t();if(r.escape||"q"===o||"Q"===o)return void t();const i=O.current,l=z.current,a=i.length;if(r.upArrow||"k"===o||"K"===o)P((e=>{const t=e>0?e-1:a-1;if(0===e&&t===a-1){const e=Math.max(0,a-Ee);R(e)}else t<l&&R(t);return t}));else if(r.downArrow||"j"===o||"J"===o)P((e=>{const t=e<a-1?e+1:0;return e===a-1&&0===t?R(0):t>=l+Ee&&R(t-Ee+1),t}));else if(!r.ctrl||"u"!==o&&"b"!==o)if(!r.ctrl||"d"!==o&&"f"!==o){if("g"===o)return P(0),void R(0);if("G"!==o)if("d"===o||"D"===o||r.delete){const e=Y.current,t=i[a>0?Math.min(Math.max(0,e),a-1):0];t&&!t.isCreateNew&&"builtin"!==t.scope&&(le(t),U("delete-confirm"))}else if("v"!==o&&"V"!==o||"skills"!==e){if(r.return){const t=Y.current,o=i[a>0?Math.min(Math.max(0,t),a-1):0];(null==o?void 0:o.isCreateNew)?Me():o&&("skills"===e&&n&&!o.isCreateNew?n(o):Oe(o))}}else{const e=O.current,t=Y.current,n=e[e.length>0?Math.min(Math.max(0,t),e.length-1):0];if(null==n?void 0:n.isCreateNew)Me();else if(n)try{const e=(0,s.readFileSync)(n.path,"utf-8");se(e),ue(n.path),null==j||j(n.path),U("view"),null==g||g("view")}catch(e){}}else{P(a-1);const e=Math.max(0,a-Ee);R(e)}}else P((e=>{const t=Math.min(a-1,e+Ee),n=Math.max(0,a-Ee);return R((e=>Math.min(n,Math.max(t-Ee+1,e+Ee)))),t}));else P((e=>{const t=Math.max(0,e-Ee);return R((e=>Math.max(0,Math.min(t,e-Ee)))),t}))}),[Ue,t,Ee,U,Me,Oe,e,n,g,j,ue]);(0,a.Ge)(Ge,{isActive:"list"===B});const Xe=(0,c.useCallback)(((e,n)=>{Ue(e)||(n.ctrl&&"c"===e?t():n.escape&&U("list"))}),[Ue,t,U]);(0,a.Ge)(Xe,{isActive:"create-description"===B});const Ke=(0,c.useCallback)(((n,o)=>{if(Ue(n))return;if(o.ctrl&&"c"===n)return void t();const r=(0,p.Zs)(e).length;if(o.upArrow||"k"===n||"K"===n)oe((e=>e>0?e-1:r-1));else if(o.downArrow||"j"===n||"J"===n)oe((e=>e<r-1?e+1:0));else if(o.return)Re();else if(o.escape)if("rules"===e){const e=p.TP[W].value;U("glob"===e?"create-glob-pattern":"create-rule-type")}else U("skills"===e?"create-skill-name":"create-command-name")}),[Ue,t,e,W,U,Re]);(0,a.Ge)(Ke,{isActive:"create-scope"===B});const Qe=(0,c.useCallback)(((e,n)=>{Ue(e)||(n.ctrl&&"c"===e?t():n.upArrow||"k"===e||"K"===e?G((e=>e>0?e-1:p.TP.length-1)):n.downArrow||"j"===e||"J"===e?G((e=>e<p.TP.length-1?e+1:0)):n.return?Ae():n.escape&&U("create-description"))}),[Ue,t,U,Ae]);(0,a.Ge)(Qe,{isActive:"create-rule-type"===B});const Je=(0,c.useCallback)(((e,n)=>{Ue(e)||(n.ctrl&&"c"===e?t():n.escape&&U("create-rule-type"))}),[Ue,t,U]);(0,a.Ge)(Je,{isActive:"create-glob-pattern"===B});const Ve=(0,c.useCallback)(((e,n)=>{Ue(e)||(n.ctrl&&"c"===e?t():n.escape&&U("create-description"))}),[Ue,t,U]);(0,a.Ge)(Ve,{isActive:"create-command-name"===B});const Ze=(0,c.useCallback)(((e,n)=>{Ue(e)||(n.ctrl&&"c"===e?t():n.escape&&U("create-description"))}),[Ue,t,U]);(0,a.Ge)(Ze,{isActive:"create-skill-name"===B});const et=(0,c.useCallback)(((e,n)=>{if(!Ue(e)){if(!n.ctrl||"c"!==e)return n.escape||"q"===e||"Q"===e?(U("list"),void ue(null)):void(n.upArrow||"k"===e||"K"===e?me((e=>Math.max(0,e-1))):n.downArrow||"j"===e||"J"===e?me((e=>Math.min(We,e+1))):!n.ctrl||"u"!==e&&"b"!==e?!n.ctrl||"d"!==e&&"f"!==e?"g"!==e?"G"!==e?"e"!==e&&"E"!==e?n.return||"\r"===e||"\n"===e?he&&Ye():("d"===e||"D"===e||n.delete)&&pe&&he&&(le(pe),U("delete-confirm")):he&&Ye():me(We):me(0):me((e=>Math.min(We,e+qe))):me((e=>Math.max(0,e-qe))));t()}}),[Ue,t,U,ue,We,qe,he,Ye,pe]);(0,a.Ge)(et,{isActive:"view"===B});const tt=(0,c.useCallback)(((e,n)=>{Ue(e)||(n.ctrl&&"c"===e?t():!n.ctrl||"s"!==e&&"S"!==e?n.escape&&Ne():ze())}),[Ue,t,ze,Ne]);(0,a.Ge)(tt,{isActive:"edit"===B});const nt=(0,c.useCallback)(((e,n)=>{Ue(e)||(n.ctrl&&"c"===e||n.return||n.escape)&&t()}),[Ue,t]);(0,a.Ge)(nt,{isActive:"success"===B});const ot=(0,c.useCallback)(((e,n)=>{Ue(e)||(n.ctrl&&"c"===e?t():"y"!==e&&"Y"!==e?("n"===e||"N"===e||n.escape)&&Be():Fe())}),[Ue,t,Fe,Be]);(0,a.Ge)(ot,{isActive:"delete-confirm"===B});const rt=(0,c.useCallback)((e=>e.length<=$e?e:`${e.slice(0,$e-1)}â€¦`),[$e]),st={rules:"Rules",commands:"Commands",skills:"Skills"}[e],{visibleItems:it,adjustedScrollOffset:lt,clampedActiveIndex:at}=(0,c.useMemo)((()=>{if(0===T.length)return{visibleItems:[],adjustedScrollOffset:0,clampedActiveIndex:0};const e=Math.min(Math.max(0,_),T.length-1),t=Math.max(0,T.length-Ee),n=Math.min(Math.max(0,L),t);return{visibleItems:T.slice(n,n+Ee),adjustedScrollOffset:n,clampedActiveIndex:e}}),[T,Ee,_,L]);if("delete-confirm"===B&&ie)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"red",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{bold:!0,color:"red",children:["Delete ",x[e],"?"]})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{children:["Are you sure you want to delete"," ",(0,r.jsx)(a.EY,{bold:!0,color:"yellow",children:ie.name}),"?"]})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{dimColor:!0,children:ie.path})}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"y to confirm â€¢ n or Esc to cancel"})})]});if("success"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.EY,{color:fe.startsWith("Error")?"red":"green",children:fe}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to close"})})]});if("create-description"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{bold:!0,color:"cyan",children:["Create New"," ","rules"===e?"Rule":"skills"===e?"Skill":"Command"]})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{children:["Describe what this"," ","rules"===e?"rule":"skills"===e?"skill":"command"," ","should do:"]})}),(0,r.jsxs)(a.az,{children:[(0,r.jsx)(a.EY,{color:"gray",children:"â€º "}),(0,r.jsx)(h.A,{value:q,onChange:H,onSubmit:Te,placeholder:"rules"===e?"e.g., Always use TypeScript strict mode":"e.g., Run tests for current file",focus:!0})]}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to continue â€¢ Esc to cancel"})})]});if("create-rule-type"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:"Create New Rule"})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{children:"When should this rule be applied?"})}),p.TP.map(((e,t)=>{const n=t===W;return(0,r.jsxs)(a.az,{paddingLeft:1,flexDirection:"column",children:[(0,r.jsx)(a.az,{children:(0,r.jsxs)(a.EY,{color:n?"cyan":"gray",bold:n,children:[n?"â†’ ":"  ",e.label]})}),(0,r.jsx)(a.az,{paddingLeft:4,children:(0,r.jsx)(a.EY,{dimColor:!0,children:e.description})})]},e.value)})),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"â†‘/â†“ to select â€¢ Enter to confirm â€¢ Esc to cancel"})})]});if("create-glob-pattern"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:"Create New Rule"})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{children:"Enter the file pattern (glob) this rule should apply to:"})}),(0,r.jsxs)(a.az,{children:[(0,r.jsx)(a.EY,{color:"gray",children:"â€º "}),(0,r.jsx)(h.A,{value:X,onChange:K,onSubmit:Ie,placeholder:"e.g., **/*.tsx, src/**/*.ts",focus:!0})]}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to continue â€¢ Esc to cancel"})})]});if("create-command-name"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:"Create New Command"})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{children:"Enter the command name (how you'll invoke it with /):"})}),(0,r.jsxs)(a.az,{children:[(0,r.jsx)(a.EY,{color:"cyan",children:"/"}),(0,r.jsx)(h.A,{value:Q,onChange:De,onSubmit:_e,placeholder:"e.g., run-tests",focus:!0})]}),V&&(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsxs)(a.EY,{color:"yellow",children:["âš  ",V]})}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to continue â€¢ Esc to cancel"})})]});if("create-skill-name"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:"Create New Skill"})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsx)(a.EY,{children:"Enter the skill name (folder name for the skill):"})}),(0,r.jsx)(a.az,{children:(0,r.jsx)(h.A,{value:ee,onChange:Pe,onSubmit:Le,placeholder:"e.g., deploy-to-prod",focus:!0})}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Enter to continue â€¢ Esc to cancel"})})]});if("create-scope"===B)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{bold:!0,color:"cyan",children:["Create New"," ","rules"===e?"Rule":"skills"===e?"Skill":"Command"]})}),(0,r.jsx)(a.az,{marginBottom:1,children:(0,r.jsxs)(a.EY,{children:["Is this"," ","rules"===e?"rule":"skills"===e?"skill":"command"," ","just for you or for the project?"]})}),(0,p.Zs)(e).map(((e,t)=>{const n=t===ne;return(0,r.jsxs)(a.az,{paddingLeft:1,children:[(0,r.jsxs)(a.EY,{color:n?"cyan":"gray",bold:n,children:[n?"â†’ ":"  ",e.label]}),(0,r.jsxs)(a.EY,{dimColor:!0,children:[" (",e.hint,")"]})]},e.value)})),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"â†‘/â†“ to select â€¢ Enter to confirm â€¢ Esc to cancel"})})]});if("view"===B&&pe){const e=He.slice(ge,ge+qe),t=ge>0,n=ge<We;return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(a.az,{marginBottom:1,children:[(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:pe.name}),(0,r.jsxs)(a.EY,{dimColor:!0,children:[" ","(",pe.scope,he?"":" â€¢ read-only",")"]})]}),t&&(0,r.jsx)(a.az,{children:(0,r.jsx)(a.EY,{dimColor:!0,children:"â†‘ more above"})}),(0,r.jsx)(a.az,{flexDirection:"column",borderStyle:"single",borderColor:"gray",paddingX:1,children:e.map(((e,t)=>(0,r.jsxs)(a.az,{children:[(0,r.jsx)(a.EY,{dimColor:!0,children:String(ge+t+1).padStart(3," ")}),(0,r.jsx)(a.EY,{dimColor:!0,children:" â”‚ "}),(0,r.jsx)(a.EY,{children:rt(e)})]},`line-${ge+t}`)))}),n&&(0,r.jsx)(a.az,{children:(0,r.jsx)(a.EY,{dimColor:!0,children:"â†“ more below"})}),(0,r.jsxs)(a.az,{marginTop:1,flexDirection:"column",children:[(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:he?"â†‘/â†“ to scroll â€¢ Enter to edit â€¢ d to delete â€¢ Esc to cancel":"â†‘/â†“ to scroll â€¢ Esc to go back (read-only)"}),(0,r.jsx)(a.EY,{dimColor:!0,children:rt(pe.path)})]})]})}if("edit"===B&&pe)return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"green",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(a.az,{marginBottom:1,children:[(0,r.jsxs)(a.EY,{bold:!0,color:"green",children:["Editing: ",pe.name]}),(0,r.jsxs)(a.EY,{dimColor:!0,children:[" (",pe.scope,")"]})]}),(0,r.jsx)(a.az,{flexDirection:"column",borderStyle:"single",borderColor:"gray",paddingX:1,children:(0,r.jsx)(h.A,{value:null!=ye?ye:"",onChange:je,focus:!0,allowExplicitNewline:!0})}),(0,r.jsxs)(a.az,{marginTop:1,flexDirection:"column",children:[(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"Ctrl+S to save â€¢ Esc to cancel"}),(0,r.jsx)(a.EY,{dimColor:!0,children:pe.path})]})]});if(("view"===B||"edit"===B)&&de&&!I)return(0,r.jsx)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,children:(0,r.jsx)(a.EY,{dimColor:!0,children:"Loading..."})});const ct=T.filter((e=>!e.isCreateNew)).length,dt=x[e],ut=`${ct} ${1===ct?dt:`${dt}s`}`;return(0,r.jsxs)(a.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(a.az,{marginBottom:1,children:[(0,r.jsx)(a.EY,{bold:!0,color:"cyan",children:st}),(0,r.jsxs)(a.EY,{dimColor:!0,children:[" (",ut,")"]})]}),lt>0&&(0,r.jsx)(a.az,{paddingLeft:2,children:(0,r.jsx)(a.EY,{dimColor:!0,children:"â†‘ more above"})}),it.map(((e,t)=>{const n=lt+t===at,o=e.isCreateNew?"":` (${e.scope})`;return(0,r.jsx)(a.az,{paddingLeft:1,children:(0,r.jsxs)(a.EY,{color:n?"cyan":"white",bold:n,children:[n?"â†’ ":"  ",e.isCreateNew?(0,r.jsxs)(a.EY,{color:n?"green":"gray",children:["+ ",e.name]}):(0,r.jsxs)(r.Fragment,{children:[e.name,(0,r.jsx)(a.EY,{dimColor:!0,children:o})]})]})},e.id)})),lt+it.length<T.length&&(0,r.jsx)(a.az,{paddingLeft:2,children:(0,r.jsx)(a.EY,{dimColor:!0,children:"â†“ more below"})}),(0,r.jsx)(a.az,{marginTop:1,children:(0,r.jsx)(a.EY,{dimColor:!0,italic:!0,children:"skills"===e?"â†‘/â†“ to navigate â€¢ Enter to use â€¢ v to view â€¢ d to delete â€¢ Esc to cancel":"â†‘/â†“ to navigate â€¢ Enter to select â€¢ d to delete â€¢ Esc to cancel"})})]})};o()}catch(j){o(j)}}))},"./src/components/list-mcp-resources-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o,a;const c=null==e?void 0:e.server;let d,u,p,h,g="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:g="pending";break;case"error":{const e=(null==t?void 0:t.result.value.error)||"Unknown error";e.includes("does not support MCP resources")?(g="success",p="No MCP resources available"):(g="error",u=e);break}case"success":g="success",h=null!==(a=null===(o=null==t?void 0:t.result.value.resources)||void 0===o?void 0:o.length)&&void 0!==a?a:0,d=0===h?"No resources found":`Found ${h} resource${1===h?"":"s"}`;break;case"rejected":g="rejected",d=(null==t?void 0:t.result.value.reason)||"Rejected";break;default:g="pending"}const m=c?`(${c})`:"";return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"ListMcpResources",primary:m,status:g,note:d}),p&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{dimColor:!0,children:p})}),u&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",u]})})]})};o()}catch(e){o(e)}}))},"./src/components/login-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{L:()=>a,a:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({status:e,message:t,userInfo:n,loginUrl:o})=>(0,r.jsx)(s.az,{flexDirection:"column",padding:1,children:(()=>{switch(e){case"starting":return(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{children:"Starting login process..."})});case"in-progress":return(0,r.jsxs)(s.az,{flexDirection:"column",gap:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{children:"Authenticating with Cursor..."})}),t&&(0,r.jsx)(s.EY,{children:t}),o&&(0,r.jsx)(s.EY,{color:"gray",wrap:"no-wrap",children:o})]});case"success":return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"green",children:"âœ“ "}),(null==n?void 0:n.email)?(0,r.jsxs)(s.EY,{children:["Logged in as ",n.email]}):(null==n?void 0:n.userId)?(0,r.jsxs)(s.EY,{children:["Logged in as user id ",n.userId]}):(0,r.jsx)(s.EY,{children:"Login successful!"})]}),t&&(0,r.jsx)(s.EY,{children:t})]});case"error":return(0,r.jsx)(s.az,{flexDirection:"column",children:t&&(0,r.jsx)(s.EY,{color:"red",children:t})})}})()}),a=({status:e,message:t})=>(0,r.jsx)(s.az,{flexDirection:"column",padding:1,children:(()=>{switch(e){case"starting":return(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{children:"Preparing to log out..."})});case"in-progress":return(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{children:"Logging out..."})});case"success":return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsx)(s.EY,{color:"green",children:"âœ“ Logout successful"}),t&&(0,r.jsx)(s.EY,{children:t})]});case"error":return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsx)(s.EY,{color:"red",children:"âœ— Logout failed"}),t&&(0,r.jsx)(s.EY,{color:"red",children:t})]})}})()});o()}catch(e){o(e)}}))},"./src/components/ls-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{U:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;const c=(0,l.Kr)(e.path||""),d=e.ignore&&e.ignore.length>0?` (ignoring: ${e.ignore.join(", ")})`:"";let u,p="pending",h=0,g=0;if("success"===(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case)&&t.result.value.directoryTreeRoot){const e=t=>{h+=t.childrenFiles.length,g+=t.childrenDirs.length;for(const n of t.childrenDirs||[])e(n)};e(t.result.value.directoryTreeRoot)}switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:p="pending";break;case"error":p="error";break;case"success":case"timeout":p="success",u=`${h} file${1===h?"":"s"}, ${g} director${1===g?"y":"ies"}${d}`;break;case"rejected":p="rejected",u=(null==t?void 0:t.result.value.reason)||void 0;break;default:p="pending"}const m=(0,i.F_)("lsToolCall","success"===p)||("success"===p?"Listed":"Listing");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:m,primary:c,status:p,note:u}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.error]})}):null})()]})};o()}catch(e){o(e)}}))},"./src/components/markdown.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Ay:()=>C,oz:()=>k});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/ink-link@4.1.0_ink@6.0.0_@types+react@19.0.7_react-devtools-core@7.0.1_react@19.2.3_/node_modules/ink-link/dist/index.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/constants.ts"),c=n("./src/context/config-context.tsx"),d=n("./src/context/theme-context.tsx"),u=n("./src/debug.ts"),p=n("./src/utils/color-mixing.ts"),h=n("./src/components/highlighted-code.tsx"),g=e([s,i,d,h]);function m(e){var t;const n=null!==(t=e.split(/[\\/]/).pop())&&void 0!==t?t:e,o=n.lastIndexOf(".");if(o<=0||o===n.length-1)return null;switch(n.slice(o+1).toLowerCase()){case"ts":return"typescript";case"tsx":return"tsx";case"js":return"javascript";case"jsx":return"jsx";case"py":return"python";case"java":return"java";case"c":return"c";case"cc":case"cpp":case"cxx":return"cpp";case"cs":case"csharp":return"csharp";case"go":return"go";case"rs":return"rust";case"php":return"php";case"rb":return"ruby";case"swift":return"swift";case"kt":case"kts":return"kotlin";case"scala":return"scala";case"html":case"htm":return"html";case"css":return"css";case"scss":return"scss";case"json":return"json";case"yml":case"yaml":return"yaml";case"xml":return"xml";case"md":case"markdown":return"markdown";case"sh":case"bash":return"bash";case"sql":return"sql";case"dockerfile":case"docker":return"dockerfile";case"vue":return"vue";case"svelte":return"svelte";case"txt":case"text":return"text";default:return null}}function f(e,t){let n=e.indexOf("*",t);for(;-1!==n;){if("*"!==e[n+1])return n;n=e.indexOf("*",n+2)}return-1}function v(e,t,n){var o;const l=[];let a=0;const c=function(e){const t=[];let n=0;const o=e=>{e.length>0&&t.push({type:"text",content:e})};for(;n<e.length;){const r=e.indexOf("`",n),s=e.indexOf("*",n),i=e.indexOf("[",n);let l=-1,a=null;if(-1!==r&&(l=r,a="back"),-1!==s&&(-1===l||s<l)?e.startsWith("**",s)?(l=s,a="bold"):(l=s,a="italic"):-1!==s&&s===l&&e.startsWith("**",s)&&(a="bold"),-1!==i&&(-1===l||i<l)){const t=e.indexOf("]",i+1);-1!==t&&t+1<e.length&&"("===e[t+1]&&-1!==e.indexOf(")",t+2)&&(l=i,a="link")}if(-1===l||null===a){o(e.slice(n));break}if(l>n&&o(e.slice(n,l)),"link"===a){const o=e.indexOf("]",l+1),r=e.indexOf(")",o+2),s=e.slice(l+1,o),i=e.slice(o+2,r);t.push({type:"link",content:s,url:i}),n=r+1;continue}if("back"===a){const r=e.indexOf("`",l+1);if(-1!==r){t.push({type:"code",content:e.slice(l+1,r)}),n=r+1;continue}o("`"),n=l+1;continue}if("bold"===a){const r=e.indexOf("**",l+2);if(-1!==r){const o=e.slice(l+2,r);o.length>0&&t.push({type:"bold",content:o}),n=r+2;continue}o("*"),n=l+1;continue}const c=f(e,l+1);if(-1===c)o("*"),n=l+1;else{const r=e.slice(l+1,c);r.trim().length>0?t.push({type:"italic",content:r}):o(`*${r}*`),n=c+1}}return t}(e);for(const e of c)"text"===e.type?l.push((0,r.jsx)(s.EY,{children:e.content},a++)):"code"===e.type?l.push((0,r.jsx)(s.EY,{wrap:"wrap",color:n,backgroundColor:t,children:e.content},a++)):"bold"===e.type?l.push((0,r.jsx)(s.EY,{bold:!0,wrap:"wrap",children:e.content},a++)):"italic"===e.type?l.push((0,r.jsx)(s.EY,{italic:!0,wrap:"wrap",children:e.content},a++)):"link"===e.type&&l.push((0,r.jsx)(i.A,{url:null!==(o=e.url)&&void 0!==o?o:"",children:(0,r.jsx)(s.EY,{wrap:"wrap",children:e.content})},a++));return(0,r.jsx)(r.Fragment,{children:l})}function x(e){var t;let n=0;for(const o of e){const e=null!==(t=o.codePointAt(0))&&void 0!==t?t:0;n+=e>=4352&&e<=4447||e>=11904&&e<=40959||e>=44032&&e<=55215||e>=63744&&e<=64255||e>=65072&&e<=65103||e>=65280&&e<=65376||e>=65504&&e<=65510||e>=127744&&e<=129535||e>=129536&&e<=129791||e>=9728&&e<=9983||e>=9984&&e<=10175?2:1}return n}function b(e){let t=e;return t=t.replace(/\*\*(?!\s)(.+?)(?<!\s)\*\*/g,"$1"),t=t.replace(/__(?!\s)(.+?)(?<!\s)__/g,"$1"),t=t.replace(/(?<!\*)\*(?!\s|\*)(.+?)(?<!\s|\*)\*(?!\*)/g,"$1"),t=t.replace(/(?<!\w)_(?!\s)(.+?)(?<!\s)_(?!\w)/g,"$1"),t=t.replace(/`([^`]+)`/g,"$1"),t}function y(e){return x(b(e))}[s,i,d,h]=g.then?(await g)():g;const j=l.memo((({headers:e,rows:t,renderInline:n})=>{var o;const i=Math.max(e.length,...t.map((e=>e.length))),a=[];for(let n=0;n<i;n++){const r=y(null!==(o=e[n])&&void 0!==o?o:""),s=t.reduce(((e,t)=>{var o;const r=y(null!==(o=t[n])&&void 0!==o?o:"");return Math.max(e,r)}),0);a.push(Math.max(r,s))}const c=(e,t,o)=>{var i;const l=null!==(i=a[t])&&void 0!==i?i:0;if(/[*`_]/.test(e)){const t=b(e),i=y(e),a=Math.max(0,l-i);return o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{bold:!0,children:t}),a>0&&(0,r.jsx)(s.EY,{children:" ".repeat(a)})]}):n?(0,r.jsxs)(r.Fragment,{children:[n(e),a>0&&(0,r.jsx)(s.EY,{children:" ".repeat(a)})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:t}),a>0&&(0,r.jsx)(s.EY,{children:" ".repeat(a)})]})}const c=function(e,t){const n=x(e),o=Math.max(0,t-n);return e+" ".repeat(o)}(e,l);return o?(0,r.jsx)(s.EY,{bold:!0,children:c}):(0,r.jsx)(s.EY,{children:c})},d=(e,t,n)=>{const o=[...e];for(;o.length<i;)o.push("");return(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsx)(s.EY,{color:"gray",children:"| "}),o.map(((e,o)=>(0,r.jsxs)(l.Fragment,{children:[c(e,o,t),(0,r.jsx)(s.EY,{color:"gray",children:" | "})]},`${n}-cell-${o}`)))]},n)};return(0,r.jsxs)(s.az,{flexDirection:"column",marginY:1,children:[d(e,!0,"header"),(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsx)(s.EY,{color:"gray",children:"|"}),a.map(((e,t)=>(0,r.jsx)(l.Fragment,{children:(0,r.jsxs)(s.EY,{color:"gray",children:["-".repeat(e+2),"|"]})},`sep-${t}`)))]}),t.map(((e,t)=>d(e,!1,`row-${t}`)))]})})),w=l.memo((({content:e,language:t,startLineNumber:n,path:o})=>{const i=(0,c.$i)()&&e.split("\n").length>1;return(0,r.jsxs)(s.az,{flexDirection:"column",children:[o&&(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsxs)(s.EY,{bold:!0,children:[" ",o," ",n?`lines ${n}-${n+e.split("\n").length-1}`:""]})}),(0,r.jsx)(h.d,{content:e,language:t,startLineNumber:null!=n?n:1,showLineNumbers:i})]})})),k=l.memo((({content:e})=>{const t=(0,l.useMemo)((()=>function(e){var t,n;const o=e.split(/\r?\n/),r=[];let s=0,i=0,l=0;const a=()=>"md-"+l++;for(;s<o.length;){const e=o[s];if(e.trim().startsWith("```")){const t=e.trim().slice(3).trim();let n,i,l=t||"text";const c=t.match(/^(\d+):(\d+):(.+)$/);if(c){n=Number.parseInt(c[1],10),i=c[3].trim();const e=m(i);l=null!=e?e:"text"}else if(t&&/[/\\.]/.test(t)&&!/\s/.test(t)){i=t;const e=m(t);l=null!=e?e:l}const d=[];if(s++,!i&&s<o.length&&!o[s].trim().startsWith("```")){const e=o[s].trim().match(/^(?:â¬¢\s+)?Read\s+(.+)$/);if(e){const t=e[1].trim();if(/[/\\.]/.test(t)&&!/\s/.test(t)){i=t;const e=m(t);l=null!=e?e:l,s++}}}for(;s<o.length&&!o[s].trim().startsWith("```");)d.push(o[s]),s++;r.push({type:"code-block",id:a(),content:d.join("\n"),language:l,startLineNumber:n,path:i}),s++;continue}const l=e.match(/^(#{1,6})\s+(.+)$/);if(l){r.push({type:"heading",id:a(),content:l[2],level:l[1].length}),s++;continue}if(e.includes("|")&&s+1<o.length){const t=o[s+1];if(t&&/^\|?\s*:?-+:?\s*(\|\s*:?-+:?\s*)*\|?\s*$/.test(t.trim())){const t=e=>{let t=e.trim();return t.startsWith("|")&&(t=t.slice(1)),t.endsWith("|")&&(t=t.slice(0,-1)),t.split("|").map((e=>e.trim()))},n=t(e),l=[];for(s+=2;s<o.length;){const e=o[s];if(!e.includes("|")||e.trim().startsWith("```"))break;if(!e.trim())break;l.push(t(e)),s++}r.push({type:"table",id:a(),content:"",tableData:{id:i++,headers:n,rows:l}});continue}}const c=e.match(/^(\s*)(\d+)[.)]\s+/);if(c){const n=null!==(t=c[1])&&void 0!==t?t:"";let o=0;for(const e of n)o+="\t"===e?2:1;const i=Math.max(0,Math.floor(o/2)),l=Number.parseInt(c[2],10);r.push({type:"list-item",id:a(),content:e.replace(/^(\s*)(\d+)[.)]\s+/,""),level:i,ordered:!0,index:Number.isFinite(l)?l:1}),s++;continue}if(/^(-{3,}|\*{3,}|_{3,})$/.test(e.trim())){r.push({type:"horizontal-rule",id:a(),content:""}),s++;continue}const d=e.match(/^(\s*)[-*+]\s+/);if(d){const t=null!==(n=d[1])&&void 0!==n?n:"";let o=0;for(const e of t)o+="\t"===e?2:1;const i=Math.max(0,Math.floor(o/2));r.push({type:"list-item",id:a(),content:e.replace(/^(\s*)[-*+]\s+/,""),level:i,ordered:!1}),s++}else e.trim().startsWith("> ")?(r.push({type:"blockquote",id:a(),content:e.replace(/^\s*>\s?/,"")}),s++):(e.trim()&&r.push({type:"text",id:a(),content:e}),s++)}return r}(e)),[e]),n=(0,d.pW)(),o=(0,l.useMemo)((()=>(0,p.PT)()),[]),i=(0,l.useMemo)((()=>{if((0,u.debugLog)("colorMode",o),(0,u.debugLog)("isLightTheme",n),"truecolor"===o)return n?a.dU.backgroundHex:a.F3.backgroundHex;const e=n?a.i1.background:a.sg.background;return(0,p.LR)(e)}),[n,o]),c=(0,l.useMemo)((()=>{if("truecolor"===o)return n?a.dU.foregroundHex:a.F3.foregroundHex;const e=n?a.i1.foreground:a.sg.foreground;return(0,p.LR)(e)}),[n,o]);return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:t.map(((e,l)=>{var d,u,h,g,m;switch(e.type){case"code-block":{const t=e.language,n=["javascript","typescript","python","java","c","cpp","csharp","go","rust","php","ruby","swift","kotlin","scala","html","css","scss","json","yaml","xml","markdown","bash","shell","sql","dockerfile","tsx","jsx","vue","svelte","text"].includes(t);return(0,r.jsx)(s.az,{marginY:1,children:(0,r.jsx)(w,{content:e.content,language:n?t:"text",startLineNumber:e.startLineNumber,path:e.path})},e.id)}case"heading":{const t=n,i=o,l="truecolor"===i?1===e.level?t?a.cM.h1Hex:a.CV.h1Hex:2===e.level?t?a.cM.h2Hex:a.CV.h2Hex:t?a.cM.hnHex:a.CV.hnHex:null,c=(()=>{if("truecolor"!==i){const n=1===e.level?t?a.bR.h1:a.XQ.h1:2===e.level?t?a.bR.h2:a.XQ.h2:t?a.bR.hn:a.XQ.hn;return(0,p.LR)(n)}return null})(),u=null!==(d=null!=l?l:c)&&void 0!==d?d:void 0;return(0,r.jsx)(s.az,{marginBottom:1,marginTop:1,children:(0,r.jsx)(s.EY,Object.assign({bold:!0},u?{color:u}:{},{wrap:"wrap",children:e.content}))},e.id)}case"list-item":{const n="list-item"!==(null!==(h=null===(u=t[l+1])||void 0===u?void 0:u.type)&&void 0!==h?h:null),o=2*Math.max(0,null!==(g=e.level)&&void 0!==g?g:0),a=!0===e.ordered,d=a?`${(null!==(m=e.index)&&void 0!==m?m:1).toString()}.`:"â€¢",p=a?Math.max(d.length+1,3):2;return(0,r.jsxs)(s.az,{flexDirection:"row",marginBottom:n?1:0,children:[(0,r.jsx)(s.az,{width:o}),(0,r.jsx)(s.az,{width:p,children:(0,r.jsx)(s.EY,{color:"gray",children:d})}),(0,r.jsx)(s.az,{flexGrow:1,paddingRight:2,children:(0,r.jsx)(s.EY,{wrap:"wrap",children:v(e.content,i,c)})})]},e.id)}case"blockquote":return(0,r.jsx)(s.az,{paddingLeft:2,borderLeft:!0,borderColor:"gray",children:(0,r.jsx)(s.EY,{color:"gray",italic:!0,wrap:"wrap",children:v(e.content,i,c)})},e.id);case"table":if(e.tableData){const{id:t,headers:n,rows:o}=e.tableData;return(0,r.jsx)(j,{headers:n,rows:o,renderInline:e=>v(e,i,c)},`table-${t}`)}return null;case"horizontal-rule":return(0,r.jsx)(s.az,{marginY:1,children:(0,r.jsx)(s.EY,{dimColor:!0,children:"â”€".repeat(40)})},e.id);default:return(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{wrap:"wrap",children:v(e.content,i,c)})},e.id)}}))})})),C=k;o()}catch(S){o(S)}}))},"./src/components/mcp-servers-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{g:()=>x});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:os"),i=n("node:path"),l=n("../ink/build/index.js"),a=n("../mcp-agent-exec/dist/index.js"),c=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),d=n("./src/hooks/use-screen-size.ts"),u=n("./src/mcp/project-paths.ts"),p=n("./src/utils/oauth-callback.ts"),h=n("./src/utils/open-browser.ts"),g=e([l,d]);[l,d]=g.then?(await g)():g;var m=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const v=10;function f(e){try{if(!e||"object"!=typeof e)return[];const t=null==e?void 0:e.properties;return t&&"object"==typeof t?Object.keys(t):[]}catch(e){return[]}}const x=({ctx:e,mcpLoader:t,disabledStore:n,onClose:o})=>{var g,x;const b=(0,c.useMemo)((()=>{const{projectRoot:e}=(0,u.C)(process.cwd());return e}),[]),[y,j]=(0,c.useState)([]),[w,k]=(0,c.useState)(0),C=(0,c.useRef)(y),S=(0,c.useRef)(w);C.current=y,S.current=w;const[E,$]=(0,c.useState)("loading"),[M,T]=(0,c.useState)([]),[A,I]=(0,c.useState)(null),[D,_]=(0,c.useState)(null),[P,L]=(0,c.useState)(0),[R,O]=(0,c.useState)(""),[Y,z]=(0,c.useState)(!1),{stdout:N}=(0,l.t$)(),F=(0,d.l)(),B=null!==(x=null!==(g=null==F?void 0:F.height)&&void 0!==g?g:null==N?void 0:N.rows)&&void 0!==x?x:24,U=Math.min(v,Math.max(5,B-8)),q=(0,c.useCallback)((()=>m(void 0,void 0,void 0,(function*(){$("loading");try{const o=(0,i.join)(b,".cursor","mcp.json"),r=(0,i.join)((0,s.homedir)(),".cursor","mcp.json"),[l,c]=yield Promise.all([(0,a.h1)(r).catch((()=>({mcpServers:{}}))),(0,a.h1)(o).catch((()=>({mcpServers:{}})))]),d=(0,a.N_)(l,c),p=Object.keys(d.mcpServers);if(0===p.length)return j([]),void $("list");const h=yield n.getDisabledServers(),{approvalPath:g}=(0,u.C)(process.cwd()),f=new a.mF(g,b),v=yield f.getApprovals(),x=(yield t.load(e)).getClients(),y=yield Promise.all(p.map((t=>m(void 0,void 0,void 0,(function*(){if(h.includes(t))return{id:t,status:"disabled"};const n=d.mcpServers[t],o=(0,a.Ko)(t,n,b);if(!v.includes(o))return{id:t,status:"unapproved"};const r=x[t];if(!r)return{id:t,status:"error"};try{const n=yield r.getState(e);return{id:t,status:n.kind}}catch(e){return{id:t,status:"error"}}})))));j(y),$("list")}catch(e){O(e instanceof Error?e.message:"Failed to load MCP servers"),$("error")}}))),[e,t,n,b]);(0,c.useEffect)((()=>{q()}),[q]),(0,c.useEffect)((()=>{w>=y.length&&y.length>0&&k(y.length-1)}),[y.length,w]);const H=(0,c.useCallback)((o=>m(void 0,void 0,void 0,(function*(){z(!0);try{const r=process.cwd(),{projectRoot:l,approvalPath:c}=(0,u.C)(r),d=new a.mF(c,l),p=(0,i.join)((0,s.homedir)(),".cursor","mcp.json"),h=(0,i.join)(l,".cursor","mcp.json"),[g,m]=yield Promise.all([(0,a.h1)(p).catch((()=>({mcpServers:{}}))),(0,a.h1)(h).catch((()=>({mcpServers:{}})))]),f=(0,a.N_)(g,m).mcpServers[o];if(f){const e=(0,a.Ko)(o,f,l);(yield d.getApprovals()).includes(e)||(yield d.addApproval(e))}yield n.removeDisabledServer(o),yield t.load(e,!1),yield q()}catch(e){yield q()}finally{z(!1)}}))),[e,t,n,q]),W=(0,c.useCallback)((n=>m(void 0,void 0,void 0,(function*(){var o;z(!0);try{let r;try{r=yield t.loadClient(e,n)}catch(e){return O(`Failed to load MCP server '${n}': ${(0,p.u1)(e)}`),$("error"),void z(!1)}const s=yield r.getState(e);if("requires_authentication"===s.kind&&s.url){const e=s.url;O(`Opening browser for authentication...\nListening on ${p.Yt} for OAuth callback...`),$("error"),(0,h.g1)(e)&&(0,h.ph)(e);try{const e=yield(0,p.T5)();yield s.callback(e),null===(o=t.clearClient)||void 0===o||o.call(t,n),yield q()}catch(e){O(`Authentication callback failed: ${(0,p.u1)(e)}`),$("error")}}else"ready"===s.kind?yield q():"requires_authentication"===s.kind?(O(`Authentication URL unavailable for '${n}'`),$("error")):(O(`Cannot login to '${n}': server is in '${s.kind}' state`),$("error"))}catch(e){O(e instanceof Error?e.message:"Login failed"),$("error")}finally{z(!1)}}))),[e,t,q]),G=(0,c.useCallback)((n=>m(void 0,void 0,void 0,(function*(){z(!0);try{let o;try{o=yield t.loadClient(e,n)}catch(e){return O(`Failed to load MCP server '${n}'`),$("error"),void z(!1)}const[r,s,i]=yield Promise.all([o.getTools(e),o.listResources(e).catch((()=>({resources:[]}))),o.listPrompts(e).catch((()=>[]))]);T(r.map((e=>({name:e.name,args:f(e.inputSchema)}))).sort(((e,t)=>e.name.localeCompare(t.name))));const l=o.config;I({url:l&&"url"in l?l.url:void 0,command:l&&"command"in l?l.command:void 0,resourceCount:s.resources.length,promptCount:i.length}),_(n),L(0),$("tools")}catch(e){O(e instanceof Error?e.message:"Failed to load tools"),$("error")}finally{z(!1)}}))),[e,t]),X=(0,c.useCallback)((()=>m(void 0,void 0,void 0,(function*(){const e=C.current,t=S.current;if(0===e.length||Y)return;const n=e[t];if(n)switch(n.status){case"disabled":case"unapproved":yield H(n.id);break;case"requires_authentication":yield W(n.id);break;case"ready":yield G(n.id);break;case"error":case"loading":break;default:n.status}}))),[Y,H,W,G]),K=(0,c.useCallback)((e=>e.includes("[M")||e.includes("[<")||e.includes("[?")||/\x1b\[<\d+;\d+;\d+[Mm]/.test(e)||/\x1b\[M[\x20-\xff]{3}/.test(e)),[]),Q=Math.max(5,B-10),J=Math.max(0,M.length-Q),V=(0,c.useCallback)(((e,t)=>{if(K(e))return;if(t.ctrl&&"c"===e)return void o();if(t.escape||"q"===e||"Q"===e)return void o();const n=C.current.length;t.upArrow||"k"===e||"K"===e?k((e=>e>0?e-1:Math.max(0,n-1))):t.downArrow||"j"===e||"J"===e?k((e=>e<n-1?e+1:0)):!t.ctrl||"u"!==e&&"b"!==e?!t.ctrl||"d"!==e&&"f"!==e?"g"!==e?"G"!==e?t.return&&!Y&&X():k(Math.max(0,n-1)):k(0):k((e=>Math.min(Math.max(0,n-1),e+U))):k((e=>Math.max(0,e-U)))}),[K,o,U,Y,X]);(0,l.Ge)(V,{isActive:"list"===E});const Z=(0,c.useCallback)(((e,t)=>{if(!K(e)){if(!t.ctrl||"c"!==e)return t.escape||"q"===e||"Q"===e?($("list"),void _(null)):void(t.upArrow||"k"===e||"K"===e?L((e=>Math.max(0,e-1))):t.downArrow||"j"===e||"J"===e?L((e=>Math.min(J,e+1))):!t.ctrl||"u"!==e&&"b"!==e?!t.ctrl||"d"!==e&&"f"!==e||L((e=>Math.min(J,e+Q))):L((e=>Math.max(0,e-Q))));o()}}),[K,o,J,Q]);(0,l.Ge)(Z,{isActive:"tools"===E});const ee=(0,c.useCallback)(((e,t)=>{K(e)||(t.ctrl&&"c"===e?o():t.escape||"q"===e||"Q"===e?"error"===E?($("list"),O("")):o():t.return&&"error"===E&&($("list"),O("")))}),[K,o,E]);(0,l.Ge)(ee,{isActive:"loading"===E||"error"===E});const{visibleItems:te,adjustedScrollOffset:ne,clampedActiveIndex:oe}=(0,c.useMemo)((()=>{if(0===y.length)return{visibleItems:[],adjustedScrollOffset:0,clampedActiveIndex:0};const e=Math.min(Math.max(0,w),y.length-1),t=Math.max(0,y.length-U);let n;return n=e>=t+U?t:e<U?0:Math.min(e-U+1,t),{visibleItems:y.slice(n,n+U),adjustedScrollOffset:n,clampedActiveIndex:e}}),[y,U,w]);if("loading"===E)return(0,r.jsxs)(l.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(l.az,{marginBottom:1,children:(0,r.jsx)(l.EY,{bold:!0,color:"cyan",children:"MCP Servers"})}),(0,r.jsx)(l.EY,{color:"cyan",children:"Loading MCP servers..."})]});if("error"===E)return(0,r.jsxs)(l.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsx)(l.az,{marginBottom:1,children:(0,r.jsx)(l.EY,{bold:!0,color:"cyan",children:"MCP Servers"})}),(0,r.jsx)(l.EY,{color:R.startsWith("âœ“")?"green":R.includes("Browser")?"cyan":"red",children:R}),(0,r.jsx)(l.az,{marginTop:1,children:(0,r.jsx)(l.EY,{dimColor:!0,italic:!0,children:"Enter to continue â€¢ Esc to go back"})})]});if("tools"===E&&D){const e=M.slice(P,P+Q),t=P>0,n=P<J;return(0,r.jsxs)(l.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(l.az,{flexDirection:"column",marginBottom:1,children:[(0,r.jsx)(l.EY,{bold:!0,color:"cyan",children:D}),(null==A?void 0:A.url)&&(0,r.jsxs)(l.EY,{dimColor:!0,children:["URL: ",A.url]}),(null==A?void 0:A.command)&&(0,r.jsxs)(l.EY,{dimColor:!0,children:["Command: ",A.command]}),(0,r.jsxs)(l.EY,{dimColor:!0,children:[M.length," tools",A&&A.resourceCount>0&&` â€¢ ${A.resourceCount} resources`,A&&A.promptCount>0&&` â€¢ ${A.promptCount} prompts`]})]}),t&&(0,r.jsx)(l.az,{children:(0,r.jsx)(l.EY,{dimColor:!0,children:"â†‘ more above"})}),0===M.length?(0,r.jsx)(l.EY,{color:"yellow",children:"No tools available for this server"}):(0,r.jsx)(l.az,{flexDirection:"column",children:e.map((e=>(0,r.jsx)(l.az,{gap:1,children:(0,r.jsxs)(l.EY,{children:[(0,r.jsxs)(l.EY,{color:"cyan",children:["â€¢ ",e.name]}),e.args.length>0&&(0,r.jsxs)(l.EY,{dimColor:!0,children:[" (",e.args.join(", "),")"]})]})},e.name)))}),n&&(0,r.jsx)(l.az,{children:(0,r.jsx)(l.EY,{dimColor:!0,children:"â†“ more below"})}),(0,r.jsx)(l.az,{marginTop:1,children:(0,r.jsx)(l.EY,{dimColor:!0,italic:!0,children:"â†‘/â†“ to scroll â€¢ Esc to go back"})})]})}const re=y.length,se=`${re} ${1===re?"server":"servers"}`;return(0,r.jsxs)(l.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(l.az,{marginBottom:1,children:[(0,r.jsx)(l.EY,{bold:!0,color:"cyan",children:"MCP Servers"}),(0,r.jsxs)(l.EY,{dimColor:!0,children:[" (",se,")"]})]}),0===y.length?(0,r.jsxs)(l.az,{flexDirection:"column",children:[(0,r.jsx)(l.EY,{color:"yellow",children:"No MCP servers configured"}),(0,r.jsx)(l.az,{marginTop:1,children:(0,r.jsx)(l.EY,{dimColor:!0,children:"Configure servers in .cursor/mcp.json or ~/.cursor/mcp.json"})})]}):(0,r.jsxs)(r.Fragment,{children:[ne>0&&(0,r.jsx)(l.az,{paddingLeft:2,children:(0,r.jsx)(l.EY,{dimColor:!0,children:"â†‘ more above"})}),te.map(((e,t)=>{const n=ne+t===oe,o=function(e){switch(e){case"ready":return"green";case"disabled":default:return"gray";case"unapproved":case"requires_authentication":case"loading":return"yellow";case"error":return"red"}}(e.status),s=function(e){switch(e){case"ready":return"enabled";case"disabled":return"disabled";case"unapproved":return"needs approval";case"requires_authentication":return"requires auth";case"loading":return"loading";case"error":return"error";default:return"unknown"}}(e.status),i=function(e){switch(e){case"ready":return"view tools";case"disabled":case"unapproved":return"enable";case"requires_authentication":return"login";case"loading":return"loading...";default:return""}}(e.status);return(0,r.jsxs)(l.az,{paddingLeft:1,children:[(0,r.jsxs)(l.EY,{color:n?"cyan":"white",bold:n,children:[n?"â†’ ":"  ",e.id]}),(0,r.jsx)(l.EY,{children:" - "}),(0,r.jsx)(l.EY,{color:o,children:s}),n&&i&&(0,r.jsxs)(l.EY,{dimColor:!0,children:[" (Enter to ",i,")"]})]},e.id)})),ne+U<y.length&&(0,r.jsx)(l.az,{paddingLeft:2,children:(0,r.jsx)(l.EY,{dimColor:!0,children:"â†“ more below"})})]}),(0,r.jsx)(l.az,{marginTop:1,children:(0,r.jsx)(l.EY,{dimColor:!0,italic:!0,children:"â†‘/â†“ to navigate â€¢ Enter to select â€¢ Esc to close"})})]})};o()}catch(b){o(b)}}))},"./src/components/mcp-tool-decision-preview.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{t:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/highlighted-code.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=({providerIdentifier:e,toolName:t,args:n})=>{const o=Object.keys(n).length>0;return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"cyan",bold:!0,children:e}),(0,r.jsx)(s.EY,{color:"gray",children:": "}),(0,r.jsx)(s.EY,{color:"magenta",children:t})]}),o&&(0,r.jsx)(s.az,{marginLeft:2,children:(0,r.jsx)(i.A,{content:JSON.stringify(n,null,2),language:"json",showLineNumbers:!1})})]})};o()}catch(e){o(e)}}))},"./src/components/mcp-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{v:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o,a;if(!e)return null;const c=null!==(n=e.providerIdentifier)&&void 0!==n?n:"MCP",d=null!==(o=e.toolName)&&void 0!==o?o:"<Unknown Tool>";Object.entries(e.args||{}).length>0&&JSON.stringify(e.args,null,2);let u,p,h,g="pending";switch(null===(a=null==t?void 0:t.result)||void 0===a?void 0:a.case){case void 0:g="pending";break;case"error":g="error",p=(null==t?void 0:t.result.value.error)||"Unknown error";break;case"success":g="success",h="Success";break;case"rejected":g="rejected",u="MCP tool rejected";break;case"permissionDenied":g="error",p="Permission denied";break;default:g="pending"}return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:c,primary:d,status:g,note:u}),p&&(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",p]})})]})};o()}catch(e){o(e)}}))},"./src/components/merged-read-search-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{r:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/utils/path-utils.ts"),c=n("./src/components/tool-call-header.tsx"),d=e([s,c]);[s,c]=d.then?(await d)():d;const u=({tools:e,treatAsPending:t=!1})=>{var n;const o=e.every((e=>e.completed)),d=[],u=[],p=[],h=[],g=[];e.forEach((e=>{"readToolCall"===e.call.tool.case?d.push(e.call.tool.value):"grepToolCall"===e.call.tool.case?u.push(e.call.tool.value):"semSearchToolCall"===e.call.tool.case?p.push(e.call.tool.value):"globToolCall"===e.call.tool.case?h.push(e.call.tool.value):"lsToolCall"===e.call.tool.case&&g.push(e.call.tool.value)}));const m=(0,i.useMemo)((()=>{const t=new Set,n=[];for(const o of e){const e=o.call.tool.case;e&&(t.has(e)||(t.add(e),n.push(e)))}return n}),[e]),f={readToolCall:d.length,grepToolCall:u.length,semSearchToolCall:p.length,globToolCall:h.length,lsToolCall:g.length},v={readToolCall:e=>`${e} file${1===e?"":"s"}`,grepToolCall:e=>`${e} ${1===e?"grep":"greps"}`,semSearchToolCall:e=>`${e} ${1===e?"search":"searches"}`,globToolCall:e=>`${e} ${1===e?"glob":"globs"}`,lsToolCall:e=>`${e} director${1===e?"y":"ies"}`},x=[];for(const e of m){const t=null!==(n=f[e])&&void 0!==n?n:0,o=v[e];t>0&&o&&x.push(o(t))}const b=x.join(", "),y=o&&!t?"success":"pending",j=m.map((e=>(0,l.F_)(e,o&&!t)||void 0)).filter((e=>Boolean(e))).join(", ")||"Read",w=j.charAt(0).toUpperCase()+j.slice(1).toLowerCase(),k=(0,i.useMemo)((()=>{const t=e.map((e=>{var t,n,o,r,s,i,c,d,u;const p=Boolean(e.completed),h=e.call.tool.case;if("readToolCall"===h){const n=e.call.tool.value.args,o=(0,a.Kr)(null!==(t=null==n?void 0:n.path)&&void 0!==t?t:""),r=(0,a.me)(null==n?void 0:n.offset,null==n?void 0:n.limit);return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Read":"Reading"),rest:`${o}${r?` ${r}`:""}`}}if("grepToolCall"===h){const t=e.call.tool.value.args,r=null!==(n=null==t?void 0:t.pattern)&&void 0!==n?n:"",s=r.length>40?`...${r.slice(-37)}`:r,i=(0,a.Kr)(null!==(o=null==t?void 0:t.path)&&void 0!==o?o:"");return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Grepped":"Grepping"),rest:`"${s}" in ${i}`}}if("semSearchToolCall"===h){const t=e.call.tool.value.args,n=null!==(r=null==t?void 0:t.query)&&void 0!==r?r:"",o=n.length>40?`...${n.slice(-37)}`:n,i=null!==(s=null==t?void 0:t.targetDirectories)&&void 0!==s?s:[],c=i.length>0?(0,a.Kr)(i[0]||"."):"",d=c?` in ${c}`:"";return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Searched":"Searching"),rest:`"${o}"${d}`}}if("globToolCall"===h){const t=e.call.tool.value.args,n=null!==(i=null==t?void 0:t.globPattern)&&void 0!==i?i:"",o=n.length>40?`...${n.slice(-37)}`:n,r=(0,a.Kr)(null!==(c=null==t?void 0:t.targetDirectory)&&void 0!==c?c:"");return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Globbed":"Globbing"),rest:`"${o}" in ${r}`}}if("lsToolCall"===h){const t=null!==(u=null===(d=e.call.tool.value.args)||void 0===d?void 0:d.path)&&void 0!==u?u:"",n=(0,a.Kr)(t);return{id:e.id,verb:(0,l.F_)(h,p)||(p?"Listed":"Listing"),rest:`${n}`}}return null})).filter(Boolean),n=t.length;let o=Math.max(0,n-3);return n-3==1&&(o=Math.max(0,o-1)),{visible:t.slice(o),collapsed:o,earlierHiddenLabel:o>0?`${o} earlier ${1===o?"item":"items"} hidden`:""}}),[e]);return 0===e.length?null:(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,paddingLeft:1,children:[(0,r.jsx)(c.C,{name:w,primary:b,status:y}),0===k.visible.length?null:(0,r.jsxs)(s.az,{flexDirection:"column",marginLeft:l.SK,children:[k.collapsed>0?(0,r.jsxs)(s.EY,{color:"gray",wrap:"truncate",children:[(0,r.jsx)(s.EY,{bold:!0,children:"â€¦"})," ",k.earlierHiddenLabel]}):null,k.visible.map((e=>(0,r.jsxs)(s.EY,{color:"gray",children:[(0,r.jsx)(s.EY,{bold:!0,children:e.verb}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{wrap:"truncate-start",children:e.rest})]},e.id)))]})]})};o()}catch(e){o(e)}}))},"./src/components/message-input.tsx":(e,t,n)=>{n.a(e,(async(e,t)=>{try{n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js");var o=n("../ink/build/index.js"),r=n("./src/components/text-input.tsx"),s=e([o,r]);[o,r]=s.then?(await s)():s,t()}catch(e){t(e)}}))},"./src/components/overflow-text.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Y:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({content:e,maxLines:t,color:n="white",showHiddenIndicator:o=!0,width:i})=>{var l;const{stdout:a}=(0,s.t$)(),c=(null!==(l=null!=i?i:null==a?void 0:a.columns)&&void 0!==l?l:80)-4,d=e.split("\n").map((e=>""===e.trim()?"":function(e,t){const n=e.split(" "),o=[];let r="";for(const e of n)if(e.length>t){r&&(o.push(r.trim()),r="");let n=e;for(;n.length>t;)o.push(n.slice(0,t)),n=n.slice(t);r=`${n} `}else r.length+e.length+1>t?r?(o.push(r.trim()),r=`${e} `):r=`${e} `:r+=`${e} `;return r.trim()&&o.push(r.trim()),o.join("\n")}(e,c))).join("\n").split("\n"),u=1===Math.max(0,d.length-t)?t+1:t,p=d.slice(-u),h=Math.max(0,d.length-u);return(0,r.jsxs)(s.az,{flexDirection:"column",children:[o&&h>0&&(0,r.jsxs)(s.EY,{dimColor:!0,children:["... (",h," lines hidden)"]}),(0,r.jsx)(s.EY,{color:n,children:p.join("\n")})]})};o()}catch(e){o(e)}}))},"./src/components/path-display.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{g:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=({path:e,maxLength:t=50,separatorColor:n="#aaaaaa",segmentColor:o,ellipsisColor:l="#aaaaaa",dimSeparators:a=!0})=>{const{segments:c,ellipsisIndex:d,separator:u}=function(e,t){const n=e.includes("\\")?"\\":"/";if(e.length<=t)return{segments:e.split(n),separator:n};const o=e.split(n),r=o[o.length-1];if(r.length+3>t)return{segments:["...",r.substring(0,t-3)],ellipsisIndex:0,separator:n};const s=n.length,i=t-r.length-3;let l=0;const a=[];let c=-1;for(let e=0;e<o.length-1;e++){const t=o[e].length+(e>0?s:0);if(!(l+t<=i)){c=a.length;break}a.push(o[e]),l+=t}return-1!==c?(a.splice(c,0,"..."),a.push(r),{segments:a,ellipsisIndex:c,separator:n}):{segments:o,separator:n}}(e,t);return(0,r.jsx)(s.EY,{children:c.map(((e,t)=>{const c=t===d;return(0,r.jsxs)(i.Fragment,{children:[t>0&&!c&&(0,r.jsx)(s.EY,{color:n,dimColor:a,children:u}),c?(0,r.jsx)(s.EY,{color:l,dimColor:!0,children:e}):(0,r.jsx)(s.EY,{color:o,children:e})]},e)}))})};o()}catch(e){o(e)}}))},"./src/components/plan-execution-message.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{p:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/tool-row-box.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=({content:e})=>{const t=function(e){var t;const n=null===(t=e.split("\n\n")[0])||void 0===t?void 0:t.trim();return n&&n.length>0?n:"Plan"}(e);return(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(i.Y,{flexDirection:"column",borderColor:"gray",borderDimColor:!0,children:(0,r.jsx)(s.az,{flexDirection:"row",alignItems:"center",paddingX:1,paddingY:0,children:(0,r.jsxs)(s.EY,{color:"gray",dimColor:!0,children:["Building: ",t]})})})})};o()}catch(e){o(e)}}))},"./src/components/prompt-bar.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{q:()=>J});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:fs"),i=n.n(s),l=n("node:path"),a=n.n(l),c=n("../agent-kv/dist/index.js"),d=n("../ink/build/index.js"),u=n("../local-exec/dist/index.js"),p=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),h=n("./src/analytics.ts"),g=n("./src/console-io.ts"),m=n("./src/constants.ts"),f=n("./src/context/agent-state-context.tsx"),v=n("./src/context/sudo-password-context.tsx"),x=n("./src/context/vim-mode-context.tsx"),b=n("./src/debug.ts"),y=n("./src/ephemeral-bridge.ts"),j=n("./src/hooks/prompt/use-at-palette.ts"),w=n("./src/hooks/prompt/use-ephemeral.ts"),k=n("./src/hooks/prompt/use-prompt-history.ts"),C=n("./src/hooks/prompt/use-slash-palette.ts"),S=n("./src/hooks/use-sudo-password-requests.ts"),E=n("./src/pending-decision-store.ts"),$=(n("./src/utils/clipboard.ts"),n("./src/utils/command-name.ts")),M=n("./src/utils/open-browser.ts"),T=n("./src/utils/path-utils.ts"),A=n("./src/components/prompt/decision-dropdown.tsx"),I=n("./src/components/prompt/ephemeral-lines-view.tsx"),D=n("./src/components/prompt/palette-at-list.tsx"),_=n("./src/components/prompt/palette-slash-list.tsx"),P=n("./src/components/prompt/pending-decisions-banner.tsx"),L=n("./src/components/prompt/prompt-footer.tsx"),R=n("./src/components/text-input.tsx"),O=e([d,A,I,D,_,P,L,R]);[d,A,I,D,_,P,L,R]=O.then?(await O)():O;var Y=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const F=200,B=(e,t,n)=>{var o,r,s;const i=null!==(r=null===(o=null==n?void 0:n.operation)||void 0===o?void 0:o.details)&&void 0!==r?r:{},l=null!==(s=i.notAllowedCommands)&&void 0!==s?s:[];if(!1!==i.canAllowlist&&l.length>0){const n=`Add ${l.map((e=>`${t}(${e})`)).join(", ")} to allowlist?`;e.push({label:n,hint:"(tab)",action:"allowlistApprove"})}},U=(e,t)=>{var n,o,r;const s=[],i="sandbox-only"===(null==t?void 0:t.type)?"Auto-run in sandbox":"Run Everything",l="disabled"!==(null==t?void 0:t.type);switch(null===(n=null==e?void 0:e.operation)||void 0===n?void 0:n.type){case u.S5.Shell:e.operation.details.isSandboxAvailable?s.push({label:"Run outside sandbox (once)",hint:"(y)",action:"approve"}):s.push({label:"Run (once)",hint:"(y)",action:"approve"}),B(s,"Shell",e),l&&s.push({label:i,hint:"(shift+tab)",action:"autoRunApprove"}),s.push({label:"Skip",hint:"(esc or n)",action:"propose"});break;case u.S5.Mcp:{const t=null===(o=null==e?void 0:e.operation)||void 0===o?void 0:o.details;s.push({label:"Run (once)",hint:"(y)",action:"approve"}),(null==t?void 0:t.toolName)&&(null==t?void 0:t.providerIdentifier)&&s.push({label:"Allowlist MCP Tool",hint:"(tab)",action:"allowlistApprove"}),s.push({label:"Reject & propose changes",hint:"(p)",action:"propose"}),s.push({label:"Skip",hint:"(esc or n)",action:"reject"});break}case u.S5.Delete:s.push({label:"Delete",hint:"(y)",action:"approve"}),s.push({label:"Keep",hint:"(n)",action:"reject"});break;case u.S5.Write:{const t=null===(r=null==e?void 0:e.operation)||void 0===r?void 0:r.details,n="string"==typeof(null==t?void 0:t.path)?t.path:void 0;s.push({label:"Proceed",hint:"(y)",action:"approve"}),s.push({label:"Reject & propose changes",hint:"(esc or n or p)",action:"propose"}),"string"==typeof n&&n.length>0?s.push({label:`Add Write(${(0,T.tk)(n,30)}) to allowlist?`,hint:"(tab)",action:"allowlistApprove"}):s.push({label:"Add to allowlist",hint:"(tab)",action:"allowlistApprove"}),l&&s.push({label:i,hint:"(shift+tab)",action:"autoRunApprove"});break}case E.yB:s.push({label:"Allow search",hint:"(y)",action:"approve"}),l&&s.push({label:i,hint:"(shift+tab)",action:"autoRunApprove"}),s.push({label:"Skip",hint:"(esc or n)",action:"reject"});break;case E.uS:{const t=e.operation.details.domain;s.push({label:"Run (once)",hint:"(y)",action:"approve"}),s.push({label:`Run and don't ask again for ${t}`,hint:"(tab)",action:"allowlistDomainApprove"}),s.push({label:"Skip",hint:"(esc or n)",action:"reject"});break}}return s},q={[u.S5.Shell]:"Run this command?",[u.S5.Mcp]:"Run this MCP tool?",[u.S5.Delete]:"Delete this file?",[u.S5.Write]:"Write to this file?",[E.yB]:"Allow this web search?",[E.uS]:"Allow this web fetch?"},H=e=>{switch(e.operation.type){case u.S5.Mcp:case E.yB:case E.uS:case u.S5.Delete:return"reject";default:return"propose"}},W=p.memo((function({prompt:e,setPrompt:t,placeholder:n,rightPlaceholder:o,ghostText:s,isDisabled:i,onSubmit:l,onTab:a,onShiftTab:c,onCtrlC:u,onCtrlD:p,onCtrlR:h,cursorToEndSignal:g,cursorToStartSignal:m,replaceValueRef:f,onReplace:v,onCursorInfoChange:x,onDownAtLastLine:b,onUpAtFirstLine:y,onPaste:j,focus:w=!0,visualFocus:k=!1,allowExplicitNewline:C,validSlashCommands:S,suppressArrowKeys:E=!1,disableTextInput:$=!1,debounceMs:M=0}){return i?(0,r.jsx)(d.az,{children:(0,r.jsx)(R.A,{value:e,onChange:()=>{},onSubmit:()=>{},placeholder:n,rightPlaceholder:o,onTab:()=>{},onShiftTab:()=>{},onCtrlC:()=>{},onCtrlD:()=>{},onCtrlR:()=>{},showCursor:!1,visualFocus:!1,focus:!1,cursorToEndSignal:g,replaceValueRef:f,onReplace:v,onCursorInfoChange:()=>{},onUpAtFirstLine:()=>{},onDownAtLastLine:()=>{},allowExplicitNewline:!1,dimmed:!0,debounceMs:M})}):(0,r.jsx)(d.az,{children:(0,r.jsx)(R.A,{value:e,onChange:t,onSubmit:l,placeholder:n,rightPlaceholder:o,ghostText:s,onTab:a,onShiftTab:c,onCtrlC:u,onCtrlD:p,onCtrlR:h,showCursor:!0,visualFocus:k,cursorToEndSignal:g,cursorToStartSignal:m,replaceValueRef:f,onReplace:v,onCursorInfoChange:x,onUpAtFirstLine:y,onDownAtLastLine:b,focus:w,onPaste:j,allowExplicitNewline:C,validSlashCommands:S,suppressArrowKeys:E,disableTextInput:$,debounceMs:M})})})),G="Pasted text",X=new RegExp(`\\[${N=G,N.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")} #(\\d+)(?: \\+\\d+(?: lines)?)?\\]`,"g"),K=e=>{var t,n;return(null!==(n=null===(t=e.match(/\n/g))||void 0===t?void 0:t.length)&&void 0!==n?n:0)+1},Q=(e,t)=>`[${G} #${e} +${K(t)} lines]`;function z(e,t){return 0===t.size?e:e.replace(X,((e,n)=>{const o=Number(n),r=t.get(o);return null!=r?r:e}))}const J=({value:e,onChange:t,onSubmit:n,onSubmitShell:o,topStatus:s,topStatusMarginTop:l,inputMode:T="message",isDisabled:R=!1,isProcessing:O=!1,isSendingToBackground:N=!1,onCtrlC:B,borderColorFocused:G,borderColorBlurred:X,promptSymbol:K="â†’",isEmptyChat:J=!1,onRequestReview:se,onNoReviewAvailable:ie,slashCommands:ce,onBeginRejection:de,onResumeChat:ue,getChatId:pe,onSkipRejectionReason:he,onCancelRejectionReason:ge,onAddToAllowList:me,onAddWebFetchDomainToAllowlist:fe,onImagesUpdated:ve,onLogout:xe,onNewChat:be,onSummarize:ye,onTransferToCloud:je,checkCloudAgentAccess:we,isCloudHandoffEnabled:ke=!1,rgPath:Ce,disableModeSwitch:Se=!1,isRepository:Ee=!0,externalCursorToEndSignal:$e,isSuggestingPlan:Me=!1,onExecutePlan:Te,onRejectPlan:Ae,onDiscardPlan:Ie,planDecisionIndex:De=0,onPlanDecisionIndexChange:_e,askQuestionPrompt:Pe=null,onAskQuestionSelectionChange:Le,onAskQuestionSubmit:Re,onAskQuestionSkip:Oe,switchModePrompt:Ye=null,onSwitchModeDecisionIndexChange:ze,onSwitchModeApprove:Ne,onSwitchModeReject:Fe,onSendQueuedNow:Be,onCancelFirstQueued:Ue,onPopLastForEdit:qe,onClearPoppedForEdit:He,onOpenMcpPager:We,onOpenSandboxPager:Ge,onOpenSkillsPager:Xe,inputDisabled:Ke=!1,isOverlayActive:Qe=!1,onBeforeExit:Je,autoRunAvailability:Ve})=>{const{currentModel:Ze,mode:et,pendingDecisions:tt,setCurrentModel:nt,changedFiles:ot,rejectPendingDecision:rt,approvePendingDecision:st,agentStore:it,modelManager:lt,queuedMessages:at,setIsCompact:ct,conversationTokenPercent:dt}=(0,f.C9)(),ut=at.length>0,{mode:pt,vimEnabled:ht}=(0,x.v)(),{isFocused:gt}=(0,d.iQ)({autoFocus:!0}),{exit:mt}=(0,d.nm)(),ft=(0,v.h)(),{currentRequest:vt}=(0,S.k)(ft),xt=null!==vt,[bt,yt]=(0,p.useState)(!1),[jt,wt]=(0,p.useState)(null),[kt,Ct]=(0,p.useState)(!1),[St,Et]=(0,p.useState)(!0),[$t,Mt]=(0,p.useState)(!1),[Tt,At]=(0,p.useState)(!1),[It,Dt]=(0,p.useState)({active:!1}),_t=(0,p.useRef)(null),Pt=(0,p.useRef)(!1);(0,p.useEffect)((()=>{if(!bt)return;const e=setTimeout((()=>yt(!1)),m.kd);return()=>clearTimeout(e)}),[bt]),(0,p.useEffect)((()=>{bt&&e.length>0&&(yt(!1),wt(null))}),[e,bt]);const Lt=(0,p.useCallback)(((e=!1)=>{Et(!1),setTimeout((()=>{Y(void 0,void 0,void 0,(function*(){const t=it.getId(),n=it.getMetadata("latestRootBlobId");yield it.dispose(),t&&n.length>0&&(e&&((0,g.p2)("\n  [32mâœ“ Logout successful[0m"),(0,g.p2)("\n  [90mAuthentication tokens removed.[0m")),(0,g.p2)(`\n  [90mTo resume this session:[0m [1m[36m${(0,$.mf)()} --continue[0m [90mor[0m [1m[36m${(0,$.mf)()} --resume=${t}[0m`)),Je&&(yield Je()),mt(),process.exit(0)}))}),100)}),[it,mt,Je]),[Rt,Ot]=(0,p.useState)(0),[Yt,zt]=(0,p.useState)(0),Nt=(0,p.useRef)(null),[Ft,Bt]=(0,p.useState)(!0),[Ut,qt]=(0,p.useState)(0),Ht=(0,p.useRef)(!1),Wt=(0,w.N)(),{set:Gt,clear:Xt}=Wt,Kt=(0,k.a)(),Qt=(0,p.useRef)(0),Jt=(0,p.useRef)(e),Vt=(0,p.useRef)(0);(0,p.useEffect)((()=>((0,y.al)((e=>{Gt(e)})),()=>(0,y.al)(null))),[Gt]),(0,p.useEffect)((()=>{Vt.current=Wt.lines.length}),[Wt.lines.length]);const Zt=e=>e.length>0&&!e.endsWith(" ")?`${e} `:e;let en="none";const tn=()=>{if("none"!==en&&!Kt.inHistory)return;if(0===e.length&&qe){const e=qe();if(e)return hn(e),void Ot((e=>e+1))}if(null==He||He(),(()=>{const t=Kt.begin(e);if(null==t)return!1;const n=Zt(t);return Wt.preserveNextClear(),hn(n),zt((e=>e+1)),!0})())return;const t=Kt.up();if(null!=t){const e=Zt(t);Wt.preserveNextClear(),hn(e),zt((e=>e+1))}},nn=()=>{("none"===en||Kt.inHistory)&&Kt.inHistory&&(()=>{if("none"!==en&&!Kt.inHistory)return;const t=Kt.down(e);if(!t)return;const n=Zt(t.value);Wt.preserveNextClear(),hn(n),Ot((e=>e+1)),t.exited&&(Ht.current=!0)})()},on=()=>{ot.length>0?null==se||se():null==ie||ie()},rn=()=>{m.hD&&on()},sn=(0,j.g)(e,{rgPath:Ce},Kt.inHistory),ln=(0,p.useRef)((()=>{})),an=(0,p.useRef)((e=>e)),cn=(0,p.useRef)(((e,t)=>t)),dn=(0,p.useCallback)((e=>{Vt.current>0&&!e.startsWith("/")&&e.trim().length>0&&Xt(),t(e),ln.current(e)}),[Xt,t]),un=(0,p.useRef)(!1),pn=(0,p.useCallback)((t=>{if(!e&&"!"===t)return Mt(!0),dn(""),void Ot((e=>e+1));if(!e&&"&"===t&&Ee&&ke)return we?Y(void 0,void 0,void 0,(function*(){var e;const t=yield we();t.hasAccess?At(!0):Dt({active:!0,setupUrl:null!==(e=t.setupUrl)&&void 0!==e?e:"https://cursor.com/dashboard?tab=cloud-agents"})})):At(!0),dn(""),void Ot((e=>e+1));t.includes("")&&(t=t.replace(/\x1f/g,""));const n=Date.now(),o=Jt.current,r=un.current,s=((e,t)=>{if(e===t)return null;let n=0;const o=Math.min(e.length,t.length);for(;n<o&&e[n]===t[n];)n++;let r=e.length-1,s=t.length-1;for(;r>=n&&s>=n&&e[r]===t[s];)r--,s--;const i=s+1;return n>i?null:{start:n,end:i}})(o,t),i=r&&null!=s?an.current(t,null!=s?s:void 0):t;dn(i),r&&(un.current=!1),Qt.current=n,Jt.current=i,Kt.inHistory&&Kt.reset(),Ht.current=!1}),[dn,Kt,e,Ee,we,ke]),hn=(0,p.useCallback)((e=>{Nt.current?Nt.current(e):dn(e)}),[dn]),gn=(0,p.useCallback)((e=>Y(void 0,void 0,void 0,(function*(){ue?yield ue(e):Gt([[{text:`Resuming chat ${e}...`,color:"cyan"}]])}))),[ue,Gt]),mn=(0,p.useMemo)((()=>({onModelChange:nt,insertText:e=>hn(e),print:(e,t)=>{Gt(e,t)},onHistoryCleared:()=>Kt.clearAllLocal(),exit:e=>Lt(e),onResumeChat:gn,getChatId:pe,logout:xe,onNewChat:be,onSummarize:ye,onTransferToCloud:je,onOpenMcpPager:We,onOpenSandboxPager:Ge,onOpenSkillsPager:Xe,submitMessage:(e,t)=>{const o=z(e,Yn.current);Kt.record(o),n(o,t),Xt()}})),[nt,hn,Gt,Kt,Lt,gn,pe,xe,be,ye,je,We,Ge,Xe,n,Xt]),fn=(0,C.e)(e,ce,mn,Kt.inHistory,Ut),vn=(0,p.useMemo)((()=>new Set(ce.map((e=>e.id.toLowerCase())))),[ce]),xn=(0,p.useMemo)((()=>{var t,n;if(!fn.active||0===fn.items.length)return;const o=fn.items[fn.index];if(!o)return;const r=e.startsWith("/")?e.slice(1):"",s=r.split(/\s+/).filter(Boolean),i=null!==(n=null===(t=s[0])||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:"";return o.identifier.toLowerCase()===i&&o.ghostText&&1===s.length&&!r.endsWith(" ")?` ${o.ghostText}`:void 0}),[fn.active,fn.items,fn.index,e]),bn=(()=>{var e;if(bt||kt)return"gray";if(Tt||It.active)return"magenta";if($t)return"yellow";if(G||X)return null!==(e=null!=G?G:X)&&void 0!==e?e:"foreground";switch(T){case"ask-question":case"switch-mode":case"plan-revision":return"cyan";case"decision":return"yellow";case"rejection-reason":return"red";default:return"foreground"}})(),yn=(0,p.useCallback)((()=>({onModelChange:nt,insertText:e=>{""===e&&Wt.preserveNextClear(),hn(e)},enterShellMode:()=>{Mt(!0),hn(""),Ot((e=>e+1))},clearInput:()=>{Wt.preserveNextClear(),hn("")},print:(e,t)=>Wt.set(e,t),exit:e=>Lt(e),onHistoryCleared:()=>Kt.clearAllLocal(),onResumeChat:gn,getChatId:pe,logout:xe,onNewChat:be,onSummarize:ye,onTransferToCloud:je,submitMessage:(e,t)=>{const o=z(e,Yn.current);hn(""),n(o,t)},onOpenMcpPager:We,onOpenSandboxPager:Ge,onOpenSkillsPager:Xe})),[hn,Lt,gn,n,Wt,Kt,nt,xe,be,ye,je,pe,We,Ge,Xe]),jn=(0,p.useCallback)((e=>{var t;let n,o=!1;if(e.startsWith("/"))n=e.slice(1);else{const r=/^(.*?)(\s+)\/(\S.*)$/.exec(e);if(!r)return null;n=null!==(t=r[3])&&void 0!==t?t:"",o=!0}const r=n.split(/\s+/).filter(Boolean),s=r[0]||"",i=r.slice(1),l=ce.find((e=>e.id.toLowerCase()===s.toLowerCase())),a=((null==l?void 0:l.args)||[]).filter((e=>!1!==e.required)).length,c=!(!l||o&&!0!==l.inline);return{cmdId:s,args:i,required:a,hasCmd:c,isInline:o}}),[ce]),wn=(0,p.useCallback)((e=>{const t=jn(e);return Boolean((null==t?void 0:t.hasCmd)&&t.args.length>=t.required)}),[jn]),kn=(0,p.useCallback)((e=>Y(void 0,void 0,void 0,(function*(){const t=yield fn.runIfExecutable(e,ce,yn(),(e=>Ct(e)));return"unknown"!==t&&("executed"===t&&(yield Kt.record(e)),"handled"===t||"executed"===t)}))),[fn,ce,yn,Kt]),Cn=(0,p.useCallback)((e=>Y(void 0,void 0,void 0,(function*(){var t,r;if(0===e.trim().length&&ut&&Be)return void(yield Be());if($t&&0===e.trim().length)return;if(sn.active){const t=sn.acceptExpansion(e);if(null!=t){const n=cn.current(e,t);return hn(n),void Ot((e=>e+1))}}if(fn.active){const t=fn.acceptExpansion(e);if(null!=t&&t!==e&&(t!==`${e} `||!wn(e)))return hn(t),void Ot((e=>e+1))}if(e.startsWith("/")){if(fn.active,wn(e)){const n=jn(e);if((!n||"help"!==n.cmdId.toLowerCase()||0!==n.args.length)&&!(fn.active&&(null===(t=fn.items[fn.index])||void 0===t?void 0:t.identifier)&&e.trimEnd().endsWith(fn.items[fn.index].identifier))&&(yield kn(e)))return}{const t=jn(e);if((!t||"help"!==t.cmdId.toLowerCase()||0!==t.args.length)&&(yield kn(e)))return;if((null==t?void 0:t.hasCmd)&&"help"===t.cmdId.toLowerCase()&&0===t.args.length&&!e.endsWith(" "))return hn(`${e} `),void Ot((e=>e+1))}const n=jn(e);if((null==n?void 0:n.hasCmd)&&n.args.length<n.required&&!e.endsWith(" "))return hn(`${e} `),void Ot((e=>e+1))}if(/^(.*?)(\s+)\/(\S.*)$/.exec(e)&&(yield kn(e)))return;const s=e.trim();if("quit"===s||"exit"===s)return void Lt(!1);const i=z(e,Yn.current);"plan-revision"!==T&&(yield Kt.record(i));let l=!1;if($t){if(!o)return void Wt.set(["Shell mode isn't available in this context.","Press Esc to exit shell mode or submit a normal message."]);Mt(!1),hn(""),Ot((e=>e+1)),l=!0,yield o(i)}else{if(It.active){const e=null!==(r=It.setupUrl)&&void 0!==r?r:"https://cursor.com/dashboard?tab=cloud-agents";try{yield(0,M.ph)(e)}catch(e){Wt.set([`Failed to open setup: ${String(e)}`])}return Dt({active:!1}),hn(""),void Ot((e=>e+1))}if(Tt){if(!je)return void Wt.set(["Cloud transfer isn't available in this context.","Press Esc to exit cloud transfer mode or submit a normal message."]);At(!1),hn(""),Ot((e=>e+1)),l=!0,yield je(i||void 0)}else n(i,{display:e})}Wt.clear(),setTimeout((()=>{sn.hide(),fn.hide(),l&&Rn.current.size>0&&(Rn.current.clear(),On.current=[],null==ve||ve([]))}),0)}))),[sn,fn,Wt,ve,Kt,n,o,je,$t,Tt,It,Lt,hn,T,wn,jn,kn,ut,Be]),Sn=(0,p.useCallback)((e=>{Cn(e).catch((e=>{(0,b.debugLog)("handleSubmitVoid error",e)}))}),[Cn]),En=(0,p.useRef)(0),$n=(0,p.useCallback)((()=>{const t=Date.now();if("at"===en&&sn.active){if(t-En.current<F)return;const n=sn.acceptExpansion(e);if(null!=n){const t=cn.current(e,n);return hn(t),Ot((e=>e+1)),En.current=Date.now(),void(Kt.inHistory&&Kt.reset())}}if("slash"===en&&fn.active){if(t-En.current<F)return;const n=fn.acceptExpansion(e);if(null!=n)return hn(n),Ot((e=>e+1)),En.current=Date.now(),void(Kt.inHistory&&Kt.reset())}if("/"===e&&fn.active&&fn.items.length>0){const t=fn.acceptExpansion(e);if(null!=t)return hn(t),Ot((e=>e+1)),void(Kt.inHistory&&Kt.reset())}if(e.startsWith("/")&&!e.endsWith(" ")&&!wn(e))return hn(`${e} `),void Ot((e=>e+1))}),[sn,e,fn,hn,wn,en,Kt]),Mn=(0,p.useCallback)((()=>{if(bt)return hn(""),null==B||B(),void Lt();if((0,b.debugLog)("handleCtrlC",T),"decision"!==T){if("plan-revision"===T)return null==Ie||Ie(),t(""),sn.hide(),fn.hide(),void Kt.reset();if(Me)return t(""),null==Ae||Ae(),void(null==B||B());if($t)return Mt(!1),hn(""),sn.hide(),fn.hide(),void Kt.reset();if(Tt)return At(!1),hn(""),sn.hide(),fn.hide(),void Kt.reset();if(It.active)return Dt({active:!1}),hn(""),sn.hide(),fn.hide(),void Kt.reset();if("rejection-reason"===T)return null==he||he(),t(""),sn.hide(),fn.hide(),void Kt.reset();if(e.length>0)return Wt.preserveNextClear(),hn(""),sn.hide(),fn.hide(),Kt.reset(),yt(!0),wt("ctrlC"),void(0,h.B5)();if((0,b.debugLog)("handleCtrlC isProcessing",O),(0,b.debugLog)("handleCtrlC exitMode",bt),O)return null==B||B(),yt(!0),wt("ctrlC"),void(0,h.B5)();yt(!0),wt("ctrlC"),(0,h.B5)()}}),[T,Me,$t,Tt,It.active,e.length,O,bt,Ie,Ae,t,sn,fn,Kt,B,hn,he,Wt,Lt]),Tn=(0,p.useCallback)((()=>{if(bt||!O)return hn(""),null==B||B(),void Lt();null==B||B(),yt(!0),wt("ctrlD"),(0,h.B5)()}),[bt,O,Lt,hn,B]),An=0===e.length,In="ctrlD"===jt?"Press Ctrl+D again to exit":"ctrlC"===jt?"Press Ctrl+C again to exit":void 0;en=sn.active?"at":fn.active?"slash":"none",(0,p.useEffect)((()=>{0===e.length&&(sn.hide(),fn.hide(),Kt.reset())}),[e,sn,fn,Kt]),fn.active||j.q.test(e)&&sn.active;const Dn="decision"===T&&tt.length>0,_n=null!==Ye||null!==Pe,[Pn,Ln]=(0,p.useState)(0);(0,p.useEffect)((()=>{Dn&&!Pt.current&&null==_t.current&&e.length>0&&(_t.current=e,t("")),!Dn&&Pt.current&&"message"===T&&0===e.length&&null!=_t.current&&(t(_t.current),_t.current=null),Pt.current=Dn}),[Dn,T,e,t]),(0,p.useEffect)((()=>{"message"!==T||Dn||0!==e.length||null==_t.current||(t(_t.current),_t.current=null)}),[T,Dn,e,t]);const Rn=(0,p.useRef)(new Map),On=(0,p.useRef)([]),Yn=((0,p.useRef)(0),(0,p.useRef)(new Map)),zn=(0,p.useRef)(1);(0,p.useEffect)((()=>{0===e.length&&Rn.current.size>0&&(Rn.current.clear(),On.current=[],null==ve||ve([]))}),[e.length,ve]);const Nn=(0,p.useCallback)((e=>{const t=Rn.current.get(e);if(t)return t;const n=`@image[${a().basename(e).replace(/\s+/g,"_").replace(/[^A-Za-z0-9._-]/g,"")}]`;return Rn.current.set(e,n),On.current.push(e),null==ve||ve(On.current.map((e=>({token:Rn.current.get(e),path:e})))),n}),[ve]),Fn=(0,p.useCallback)((e=>{const t=new Set;for(const n of e.matchAll(/@image\[[^\]]+\]/g))t.add(n[0]);const n=Rn.current,o=[];for(const e of On.current){const r=n.get(e);r&&t.has(r)&&o.push(e)}const r=new Map;for(const e of o){const t=n.get(e);r.set(e,t)}Rn.current=r,On.current=o.slice(),null==ve||ve(On.current.map((e=>({token:Rn.current.get(e),path:e}))))}),[ve]);ln.current=Fn;const Bn=(0,p.useCallback)(((e,t)=>{var n,o,r,s,l,a,c,d,u,p,h,g,m,f,v;if(!Z(e))return e;let x=0;const b=e=>{if(x>=64)return e;const t=ae(e),n=new Set([t]);n.add(t.replace(/\u00A0/g," ")),n.add(t.replace(/\u202F/g," ")),t.includes(" ")&&(n.add(t.replace(/ /g,"Â ")),n.add(t.replace(/ /g,"â€¯")));let o=null;for(const e of n)try{if(i().existsSync(e)){o=e;break}}catch(e){}if(!o){if(!le(t))return e;o=t}const r=Nn(o);return x++,r},y=[],j=(e,n)=>!t||n>t.start&&e<t.end;for(const t of e.matchAll(re)){const e=null!==(n=t.index)&&void 0!==n?n:0,s=null!==(o=t[1])&&void 0!==o?o:"",i=null!==(r=t[2])&&void 0!==r?r:"",l=e+s.length,a=l+i.length;j(l,a)&&y.push({start:l,end:a,path:i.replace(/'\s'/g," ")})}for(const t of e.matchAll(ee)){const e=null!==(s=t.index)&&void 0!==s?s:0,n=null!==(l=t[0])&&void 0!==l?l:"",o=null!==(a=t[1])&&void 0!==a?a:"",r=e,i=e+n.length;j(r,i)&&y.push({start:r,end:i,path:o})}for(const t of e.matchAll(te)){const e=null!==(c=t.index)&&void 0!==c?c:0,n=null!==(d=t[0])&&void 0!==d?d:"",o=null!==(u=t[1])&&void 0!==u?u:"",r=e,s=e+n.length;j(r,s)&&y.push({start:r,end:s,path:o})}for(const t of e.matchAll(ne)){const e=null!==(p=t.index)&&void 0!==p?p:0,n=null!==(h=t[1])&&void 0!==h?h:"",o=null!==(g=t[2])&&void 0!==g?g:"",r=e+n.length,s=r+o.length;j(r,s)&&y.push({start:r,end:s,path:o})}for(const t of e.matchAll(oe)){const e=null!==(m=t.index)&&void 0!==m?m:0,n=null!==(f=t[1])&&void 0!==f?f:"",o=null!==(v=t[2])&&void 0!==v?v:"",r=e+n.length,s=r+o.length;j(r,s)&&y.push({start:r,end:s,path:o})}if(0===y.length)return e;y.sort(((e,t)=>e.start-t.start||t.end-t.start-(e.end-e.start)));const w=[];let k=-1;for(const e of y)e.start<k||(w.push(e),k=e.end);let C="",S=0;for(const t of w)S<t.start&&(C+=e.slice(S,t.start)),C+=b(t.path),S=t.end;return C+=e.slice(S),C=C.replace(/(@image\[[^\]]+\])(?!\s)/g,"$1 "),C}),[Nn]);an.current=Bn;const Un=(0,p.useCallback)(((e,t)=>{var n,o,r;const s=((e,t)=>{if(e===t)return null;let n=0;const o=Math.min(e.length,t.length);for(;n<o&&e[n]===t[n];)n++;let r=e.length-1,s=t.length-1;for(;r>=n&&s>=n&&e[r]===t[s];)r--,s--;const i=s+1;return n>i?null:{start:n,end:i}})(e,t);if(null==s)return t;const l=new RegExp(String.raw`@((?:file://)?[^\s'"()]+?\.(${V.join("|")}))`,"gi"),a=[];for(const e of t.matchAll(l)){const t=null!==(n=e.index)&&void 0!==n?n:0,i=null!==(o=e[0])&&void 0!==o?o:"",l=null!==(r=e[1])&&void 0!==r?r:"",c=t,d=t+i.length;d>s.start&&c<s.end&&a.push({start:c,end:d,path:l})}if(0===a.length)return t;a.sort(((e,t)=>e.start-t.start||t.end-e.end));const c=[];let d=-1;for(const e of a)e.start<d||(c.push(e),d=e.end);let u="",p=0;for(const e of c){p<e.start&&(u+=t.slice(p,e.start));const n=ae(e.path);let o=null;const r=new Set([n]);r.add(n.replace(/\u00A0/g," ")),r.add(n.replace(/\u202F/g," "));try{for(const e of r)if(i().existsSync(e)){o=e;break}}catch(e){}!o&&le(n)&&(o=n),u+=o?Nn(o):t.slice(e.start,e.end),p=e.end}return u+=t.slice(p),u=u.replace(/(@image\[[^\]]+\])(?!\s)/g,"$1 "),u}),[Nn]);cn.current=Un,(0,d.Ge)(((n,o)=>{var r,s,i;if(Ye){const e=Ye.decisionIndex;if(o.upArrow)return void(null==ze||ze(Math.max(0,e-1)));if(o.downArrow)return void(null==ze||ze(Math.min(1,e+1)));if(o.return)return void(0===e?null==Ne||Ne():null==Fe||Fe());if("y"===n||"Y"===n)return void(null==Ne||Ne());const t=o.escape||o.ctrl&&("c"===n||"C"===n);return"n"===n||"N"===n||t?void(null==Fe||Fe()):void 0}if(Pe){const{args:e,selection:t}=Pe,s=e.questions,i=s[t.activeQuestionIndex];if(!i)return;const l=i.options.length,a=o.rightArrow||o.tab&&!o.shift,c=o.leftArrow||o.tab&&o.shift,d=t.activeQuestionIndex===s.length-1,u=(e,t)=>{var n;return 0===e.options.length||(null!==(n=t[e.id])&&void 0!==n?n:[]).length>0},p=e=>s.every((t=>u(t,e))),h=(e,n,o)=>{var r;const i=s[e];if(!i)return t;const l=null!==(r=n[i.id])&&void 0!==r?r:[];if(o)return Object.assign(Object.assign({},t),{selectionsByQuestionId:n,activeQuestionIndex:e,activeOptionIndex:0});const a=Math.max(0,Math.min(i.options.length-1,t.activeOptionIndex)),c=l.length>0?i.options.findIndex((e=>l.includes(e.id))):-1,d=c>=0?Math.min(i.options.length-1,c):a;return Object.assign(Object.assign({},t),{selectionsByQuestionId:n,activeQuestionIndex:e,activeOptionIndex:d})},g=(e,t,n)=>{const o=h(e,t,n);null==Le||Le(o)},m=e=>{d?p(e)&&(null==Re||Re()):g(t.activeQuestionIndex+1,e,!0)},f=(e,t,n,o)=>n?"toggle"===o?e.includes(t)?e.filter((e=>e!==t)):[...e,t]:e.includes(t)?e:[...e,t]:[t];if(a||c){const e=a?1:-1,n=Math.max(0,Math.min(s.length-1,t.activeQuestionIndex+e));return void g(n,t.selectionsByQuestionId,a)}if("s"===n||"S"===n)return void(null==Re||Re());const v=o.escape||o.ctrl&&("c"===n||"C"===n);if("k"===n||"K"===n||v)return void(null==Oe||Oe());if(0===l)return void(o.return&&m(t.selectionsByQuestionId));if(o.upArrow){const e=Object.assign(Object.assign({},t),{activeOptionIndex:Math.max(0,t.activeOptionIndex-1)});return void(null==Le||Le(e))}if(o.downArrow){const e=Object.assign(Object.assign({},t),{activeOptionIndex:Math.min(l-1,t.activeOptionIndex+1)});return void(null==Le||Le(e))}if(o.return||" "===n){const e=i.options[t.activeOptionIndex];if(!e)return;const n=null!==(r=t.selectionsByQuestionId[i.id])&&void 0!==r?r:[],s=f(n,e.id,i.allowMultiple,o.return?"select":"toggle"),l=s===n?t.selectionsByQuestionId:Object.assign(Object.assign({},t.selectionsByQuestionId),{[i.id]:s});if(o.return)return d?(l!==t.selectionsByQuestionId&&(null==Le||Le(Object.assign(Object.assign({},t),{selectionsByQuestionId:l}))),void m(l)):void m(l);const a=Object.assign(Object.assign({},t),{selectionsByQuestionId:l});return void(null==Le||Le(a))}return}if(Me){if(o.upArrow)return void(null==_e||_e(Math.max(0,(null!=De?De:0)-1)));if(o.downArrow)return void(null==_e||_e(Math.min(1,(null!=De?De:0)+1)));if(o.return)return void(0===De?(t(""),null==Te||Te()):(t(""),null==Ae||Ae(),null==B||B()));if("y"===n||"Y"===n)return t(""),void(null==Te||Te());const e=o.escape||o.ctrl&&"c"===n||o.ctrl&&"C"===n;return"n"===n||"N"===n||e?(t(""),null==Ae||Ae(),void(null==B||B())):void 0}if((o.ctrl&&("d"===n||"D"===n)||""===n)&&"decision"===T)return void(An&&Tn());const l=""===n,a=o.ctrl&&"/"===n,c=o.meta&&"/"===n;if(l||a||c)return e.includes("")&&hn(e.replace(/\x1f/g,"")),void Y(void 0,void 0,void 0,(function*(){try{const e=yield lt.awaitAvailableModels(),t=yield lt.awaitCurrentModel();if(0===e.length)return;const n=t.modelId,o=Math.max(0,e.findIndex((e=>e.modelId===n))),r=e[(o+1)%e.length];if(!r||r.modelId===n)return;nt(r)}catch(e){}}));if(""===n||o.ctrl&&("y"===n||"Y"===n))return e.includes("")&&hn(e.replace(/\u0019/g,"")),void kn("/resume");if(""===n||o.ctrl&&("o"===n||"O"===n))return e.includes("")&&hn(e.replace(/\u000f/g,"")),void ct((e=>!e));switch(T){case"decision":{if(0===tt.length)return;const e=tt[0],r="j"===n||"J"===n||n.endsWith("j")||n.endsWith("J"),l="k"===n||"K"===n||n.endsWith("k")||n.endsWith("K"),a=U(e,Ve),c=a.length;if(o.downArrow||r)return void Ln((e=>Math.min(e+1,c-1)));if(o.upArrow||l)return void Ln((e=>Math.max(e-1,0)));if(o.escape)return"reject"===H(e)?rt(e.id,void 0):null==de||de(e.id),t(""),void Ln(0);if(m.hD&&(o.ctrl&&("r"===n||"R"===n)||""===n)&&ot.length>0)return void on();const d=""===n;if(o.ctrl&&"c"===n||d)return rt(e.id,void 0),t(""),void Ln(0);if("q"===n||"Q"===n)return rt(e.id,void 0),t(""),void Ln(0);if("y"===n||"Y"===n)return st(e.id),t(""),void Ln(0);if("n"===n||"N"===n)return"reject"===H(e)?rt(e.id,void 0):null==de||de(e.id),t(""),void Ln(0);if("p"===n||"P"===n)return null==de||de(e.id),t(""),void Ln(0);if(o.tab&&o.shift){if(Se)return;if("disabled"===(null==Ve?void 0:Ve.type))return;it.setMetadata("mode","auto-run");for(const e of tt)st(e.id);return t(""),void Ln(0)}if(o.tab&&!o.shift){const n=e.operation.type;if(n===u.S5.Shell){const t=null!==(s=e.operation.details.notAllowedCommands)&&void 0!==s?s:[];for(const e of t)null==me||me("Shell",e);(0,b.debugLog)("allowlist-requested",Object.assign(Object.assign({},e.operation),{patterns:t}))}else if(n===u.S5.Write){const t=e.operation.details.path;null==me||me("Write",t),(0,b.debugLog)("allowlist-requested",e.operation)}else if(n===u.S5.Mcp){const t=e.operation.details;if((null==t?void 0:t.toolName)&&(null==t?void 0:t.providerIdentifier)){const e=`${t.providerIdentifier}:${t.toolName}`;null==me||me("Mcp",e),(0,b.debugLog)("mcp-allowlist-requested",{identifier:e})}}else if(n===E.uS){const t=e.operation.details.domain;null==fe||fe(t),(0,b.debugLog)("webfetch-domain-allowlist-requested",{domain:t})}return st(e.id),t(""),void Ln(0)}if(o.return){const n=a[Pn];if(!n)return;switch(n.action){case"approve":return st(e.id),t(""),void Ln(0);case"reject":return rt(e.id,void 0),t(""),void Ln(0);case"propose":return null==de||de(e.id),t(""),void Ln(0);case"allowlistApprove":if(e.operation.type===u.S5.Shell){const t=null!==(i=e.operation.details.notAllowedCommands)&&void 0!==i?i:[];for(const e of t)null==me||me("Shell",e);(0,b.debugLog)("allowlist-requested",Object.assign(Object.assign({},e.operation),{patterns:t}))}else if(e.operation.type===u.S5.Mcp){const t=e.operation.details;if((null==t?void 0:t.toolName)&&(null==t?void 0:t.providerIdentifier)){const e=`${t.providerIdentifier}:${t.toolName}`;null==me||me("Mcp",e),(0,b.debugLog)("mcp-allowlist-requested",{identifier:e})}}else if(e.operation.type===u.S5.Write){const t=e.operation.details.path;null==me||me("Write",t),(0,b.debugLog)("allowlist-requested",e.operation)}return st(e.id),t(""),void Ln(0);case"allowlistDomainApprove":if(e.operation.type===E.uS){const t=e.operation.details.domain;null==fe||fe(t),(0,b.debugLog)("webfetch-domain-allowlist-requested",{domain:t})}return st(e.id),t(""),void Ln(0);case"autoRunApprove":it.setMetadata("mode","auto-run");for(const e of tt)st(e.id);return t(""),void Ln(0);default:return}}return}case"message":if($t&&0===e.length&&o.escape)return void Mt(!1);if($t&&0===e.length&&(o.backspace||o.delete))return void Mt(!1);if(Tt&&0===e.length&&o.escape)return void At(!1);if(Tt&&0===e.length&&(o.backspace||o.delete))return void At(!1);if(It.active&&o.escape)return void Dt({active:!1});if(It.active&&0===e.length&&(o.backspace||o.delete))return void Dt({active:!1});switch(en){case"slash":{if(!fn.active||0===fn.items.length)return;const t=ht&&"normal"===pt&&"j"===n,r=ht&&"normal"===pt&&"k"===n;return m.hD&&(o.ctrl&&("r"===n||"R"===n)||""===n)?void rn():o.downArrow||t?void fn.next():o.upArrow||r?void fn.prev():o.escape?("/"===e&&hn(""),void fn.hide()):void 0}case"at":{if(!sn.active||0===sn.suggestions.length)return;const e=ht&&"normal"===pt&&"j"===n,t=ht&&"normal"===pt&&"k"===n;return m.hD&&(o.ctrl&&("r"===n||"R"===n)||""===n)?void rn():o.downArrow||e?void sn.next():o.upArrow||t?void sn.prev():o.escape?void sn.suppress():void 0}default:if(o.escape&&Kt.inHistory)return void Kt.reset()}if(o.escape&&0===e.length&&ut&&Ue)return void Ue();if(m.hD&&(o.ctrl&&("r"===n||"R"===n)||""===n))return void rn();if(ht&&"normal"===pt){if("k"===n&&"none"===en)return void tn();if("j"===n)return void nn()}return;case"rejection-reason":return o.escape||(o.backspace||o.delete)&&0===e.length?(null==ge||ge(),void t("")):void 0;default:return}}),{isActive:!Qe&&(gt||"decision"===T||"rejection-reason"===T||"none"!==en||!!Me||ut)});const qn="none"!==en,Hn=(0,p.useDeferredValue)(ot.length),Wn=(0,p.useDeferredValue)(dt),Gn=(0,p.useDeferredValue)(fn.items),Xn=(0,p.useDeferredValue)(sn.suggestions),Kn=(0,p.useMemo)((()=>{if(null==Wn)return;const e=Wn.toFixed(1);return e.endsWith(".0")?`${Math.round(Wn)}%`:`${e}%`}),[Wn]);return St?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.az,{marginTop:null!=l?l:0,marginBottom:0,marginX:1,paddingLeft:1,children:null!=s?s:(0,r.jsx)(d.EY,{children:" "})}),tt.length>0&&(0,r.jsx)(P.A,{decisions:tt}),(0,r.jsxs)(d.az,{display:"true"===process.env.AGENT_CLI_HIDE_PROMPT_BAR&&0===tt.length||Me||_n?"none":"flex",flexDirection:"column",borderColor:bn,borderTop:!0,borderStyle:"single",paddingLeft:1,marginX:1,children:[Dn?(()=>{var e;const t=tt[0],n=t.operation.type,o=U(t,Ve).map((e=>({label:e.label,hint:e.hint,disabled:e.disabled})));let s=null!==(e=q[n])&&void 0!==e?e:"Proceed with this edit?";t.operation.type===u.S5.Shell&&(s=t.operation.details.isSandboxAvailable?"Run this command outside the sandbox?":"Run this command?");const i=t.operation.type===u.S5.Shell?String(t.operation.details.reason):t.operation.type===u.S5.Write?`in ${String(t.operation.details.path)}`:void 0;return(0,r.jsx)(A.A,{title:s,highlightColor:bn,options:o,selectedIndex:Pn,subtitle:i})})():null,(0,r.jsxs)(d.az,{flexDirection:"row",display:Dn||Me||_n?"none":"flex",children:[(0,r.jsxs)(d.EY,{color:Tt||It.active?"magenta":$t?"yellow":"foreground",dimColor:!Tt&&!It.active&&!$t&&0===e.length,children:[Tt||It.active?"&":$t?"!":K," "]}),(0,r.jsx)(d.az,{flexGrow:1,children:(0,r.jsx)(W,{prompt:e,setPrompt:pn,placeholder:(()=>{var e;switch(T){case"ask-question":return"Answer questions (Enter to select/next, Esc to skip)";case"switch-mode":return"Approve mode switch (y/n)";case"decision":return"Waiting for decision (y/n/p)...";case"rejection-reason":return"Reason for rejection (Enter to submit, Esc to cancel)";case"plan-revision":return"Describe how to revise the plan (Enter to submit)";default:return $t?("number"==typeof(null===(e=process.stdout)||void 0===e?void 0:e.columns)?process.stdout.columns:80)>=50?"Run a command â€” e.g., "+(Ee?"git status":"ls"):"Run a command":J?"Plan, search, build anything":"Add a follow-up"}})(),rightPlaceholder:O?"ctrl+c to stop":ht?"insert"===pt?"INSERT":"NORMAL":void 0,ghostText:xn,isDisabled:R||Qe,onSubmit:Sn,onTab:$n,onShiftTab:"decision"===T||Se||_n?void 0:()=>{const e=c.yj.slice();if(J&&m.xZ&&Ee||e.splice(e.indexOf("background"),1),m.S8||e.splice(e.indexOf("plan"),1),"disabled"===(null==Ve?void 0:Ve.type)){const t=e.indexOf("auto-run");-1!==t&&e.splice(t,1)}const t=it.getMetadata("mode"),n=e.indexOf(t),o=e[(n+1)%e.length];it.setMetadata("mode",o)},onCtrlC:Mn,onCtrlD:An?Tn:void 0,onCtrlR:rn,visualFocus:"decision"===T&&tt.length>0,cursorToEndSignal:Rt+(null!=$e?$e:0),cursorToStartSignal:Yt,replaceValueRef:Nt,onReplace:dn,onCursorInfoChange:({offset:e,isAtLastLine:t})=>{qt(e),Bt(t)},onUpAtFirstLine:()=>{(Kt.inHistory||"none"===en)&&tn()},onDownAtLastLine:nn,onPaste:({kind:e,content:t})=>{try{const n=t,o=n.includes("\t")?n.replace(/\t/g,"  "):n,r=o.slice(0,64),s=Array.from(r).map((e=>e.charCodeAt(0).toString(16).padStart(2,"0"))).join(" ");if((0,b.debugLog)("paste-event",{kind:e,length:o.length,preview:r,hexSample:s}),o.length>800){const e=zn.current++;return Yn.current.set(e,o),Q(e,o)}if(o.length,o.length>0){const e=(e=>{if(!Z(e))return[];const t=[];for(const n of e.matchAll(ee))n[1]&&t.push(n[1]);for(const n of e.matchAll(te))n[1]&&t.push(n[1]);for(const n of e.matchAll(ne))n[2]&&t.push(n[2]);for(const n of e.matchAll(oe))n[2]&&t.push(n[2]);for(const n of e.matchAll(re))n[2]&&t.push(n[2].replace(/'\s'/g," "));return t})(o);e.length>0&&(un.current=!0)}}catch(e){(0,b.debugLog)("paste-event-error",String(e))}return t.includes("\t")?t.replace(/\t/g,"  "):null},allowExplicitNewline:!0,focus:"decision"!==T&&!Me&&!_n&&!xt,validSlashCommands:vn,suppressArrowKeys:"none"!==en||Ke,disableTextInput:Ke})})]})]}),m.hD&&Dn&&ot.length>0?(0,r.jsx)(d.az,{marginTop:0,marginX:2,justifyContent:"flex-end",children:(0,r.jsx)(d.EY,{color:"gray",dimColor:!0,children:"ctrl+r to review changed files"})}):null,"message"===T&&"none"===en&&!Me&&!_n&&"true"!==process.env.AGENT_CLI_HIDE_PROMPT_BAR&&(0,r.jsx)(L.A,{show:!0,hasText:e.length>0,exitMode:bt,modelLabel:(null==Ze?void 0:Ze.displayName)||"Starting...",isMaxMode:!0===(null==Ze?void 0:Ze.maxMode),tokenPercentLabel:Kn,changedFilesCount:Hn,showReviewHint:!Kt.inHistory,exitHintText:In,headlineLabel:(()=>{if(N)return"Sending to background";if(Tt)return process.stdout.columns>60?"âŠ™ Move to cloud agent":"âŠ™ Cloud agent";if(It.active)return process.stdout.columns>60?"âŠ™ Please set up cloud agents to move to cloud (Enter to open setup)":"âŠ™ Set up cloud agents (Enter)";if("auto-run"===et){const e="sandbox-only"===(null==Ve?void 0:Ve.type)?"Auto-run in sandbox":"Auto-run all commands";return J?`â–¶ï¸Ž ${e} (shift+tab to cycle)`:`â–¶ï¸Ž ${e} (shift+tab to turn off)`}return"background"===et?Ee?process.stdout.columns>60?"â—Ž Send to background (shift+tab to cycle)":"â—Ž Background (shift+tab to cycle)":void 0:"plan"===et?"â—Ž Plan (shift+tab to cycle)":"search"===et?"â—Ž Ask (shift+tab to cycle)":void 0})(),headlineColor:N?"green":Tt||It.active||"background"===et&&Ee?"magenta":"auto-run"===et?"yellow":"plan"===et?"cyan":"search"===et?"blue":void 0}),(0,r.jsx)(d.az,{height:qn?Math.min(sn.active?Math.min(sn.suggestions.length,m.kQ):Math.min(fn.items.length,m.kQ),m.kQ):0,flexDirection:"column",marginTop:0,children:qn&&(sn.active?(0,r.jsx)(D.A,{suggestions:Xn,activeIndex:sn.index,windowStart:sn.windowStart,highlightColor:bn}):(0,r.jsx)(_.A,{items:Gn,activeIndex:fn.index,windowStart:fn.windowStart,highlightColor:bn}))}),(0,r.jsx)(I.A,{lines:Wt.lines})]}):null},V=["png","jpg","jpeg","gif","webp","bmp","tif","tiff","heic","heif"],Z=e=>{const t=e.toLowerCase();for(const e of V)if(t.includes(`.${e}`))return!0;return t.includes("file://")},ee=new RegExp(String.raw`"((?:file://)?[^"\n]+?\.(${V.join("|")}))"`,"gi"),te=new RegExp(String.raw`'((?:file://)?[^'\n]+?\.(${V.join("|")}))'`,"gi"),ne=new RegExp(String.raw`(^|[^\w@-])((?:file://)?[^\s'"()]+?\.(${V.join("|")}))`,"gi"),oe=new RegExp(String.raw`(^|[^\w@-])((?:file://)?(?:/|~)[^\n]+?\.(${V.join("|")}))`,"gi"),re=/(^|[^\w@-])((?:file:\/\/)?[^\s'"()]+(?:'\s'[^\s'"()]+)+)/gi,se=e=>!!(/^(?:file:\/\/)?\//.test(e)||/^[A-Za-z]:[\\/]/.test(e)||/^\\\\/.test(e)||/^~\//.test(e)),ie=()=>{const e=[],t=[process.env.TMPDIR,process.env.TEMP,process.env.TMP];for(const n of t)n&&"string"==typeof n&&e.push(n);return e.push("/tmp","/var/tmp","/private/tmp","/var/folders","/private/var/folders"),Array.from(new Set(e.map((e=>e.replace(/\\/g,"/")))))},le=e=>{if(!se(e))return!1;const t=e.replace(/\\/g,"/");for(const e of ie())if(t.startsWith(e.endsWith("/")?e:`${e}/`))return!0;return!1},ae=e=>{let t=e.trim();if((t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'"))&&(t=t.slice(1,-1)),t.startsWith("file://"))try{const e=new URL(t);t=decodeURI(e.pathname)}catch(e){t=t.replace(/^file:\/\//,"")}return/^[A-Za-z]:[\\/]/.test(t)||/\\\\/.test(t)||(t=t.replace(/\\([\s()])/g,"$1"),t=t.replace(/'\s'/g," ")),t};o()}catch(ce){o(ce)}var N}))},"./src/components/prompt/decision-dropdown.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/context/theme-context.tsx"),c=n("./src/utils/color-mixing.ts"),d=e([s,a]);[s,a]=d.then?(await d)():d;const u=({title:e,highlightColor:t,options:n,selectedIndex:o,subtitle:d})=>{const u=(0,a.pW)(),p=(0,c.PT)(),h=(0,i.useMemo)((()=>{var e,t;if("ansi256"===p)return;const n=null!==(e=(0,c.E2)(null!=u&&u?l.bd:l.Ts))&&void 0!==e?e:null!=u&&u?{r:255,g:255,b:255}:{r:30,g:30,b:30},o=null!==(t=(0,c.E2)(null!=u&&u?l.Kp:l.Wn))&&void 0!==t?t:null!=u&&u?{r:255,g:243,b:223}:{r:245,g:217,b:159},r=null!=u&&u?l.FL:l.Rg;return(0,c.Ob)((0,c.Lh)(n,o,r))}),[u,p]),g=(0,i.useMemo)((()=>{if("ansi256"===p)return null!=u&&u?l.tg.activeBg:l.Lo.activeBg}),[p,u]),m=null!=u&&u?"black":"white";return(0,r.jsxs)(s.az,{flexDirection:"column",marginTop:0,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:t,children:e})}),d?(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:"gray",children:d})}):null,n.map(((e,n)=>{const i=n===o,l=!!e.disabled,a=i?h:void 0,c=i?m:"gray",d=i?u?"black":"white":"gray",p=i&&!l?e.hint?`${e.hint} (enter)`:"(enter)":e.hint;return(0,r.jsxs)(s.az,{width:"100%",flexDirection:"row",alignItems:"center",backgroundColor:a,children:[(0,r.jsx)(s.az,{width:i?1:0,backgroundColor:i?t:void 0}),(0,r.jsx)(s.az,{paddingLeft:i?0:1,paddingY:0,children:i&&null!=g?(0,r.jsxs)(s.EY,{children:[`[48;5;${g}m`,(0,r.jsx)(s.EY,{color:c,children:"â†’ "}),(0,r.jsx)(s.EY,{color:c,bold:!0,children:e.label}),p?(0,r.jsxs)(s.EY,{color:d,children:[" ",p]}):null,"[49m"]}):(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:c,children:i?"â†’ ":"  "}),(0,r.jsx)(s.EY,{color:c,bold:i,children:e.label}),p?(0,r.jsxs)(s.EY,{color:d,children:[" ",p]}):null]})})]},`${e.label}-${n}`)}))]})};o()}catch(e){o(e)}}))},"./src/components/prompt/ephemeral-lines-view.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=({lines:e})=>0===e.length?null:(0,r.jsx)(s.az,{flexDirection:"column",marginTop:1,paddingX:2,children:e.map((e=>{const t=(e=>{if("string"!=typeof e)return(0,r.jsx)(s.EY,{children:e.map(((e,t)=>(0,r.jsx)(s.EY,{color:e.color,bold:e.bold,dimColor:e.dim,children:e.text},`${e.text}-${e.color}-${t}`)))},0);if(0===e.trim().length)return(0,r.jsx)(s.EY,{children:" "},0);const t=e.toLowerCase();if(t.startsWith("error:"))return(0,r.jsx)(s.EY,{color:"red",children:e},0);if(t.startsWith("unknown command:"))return(0,r.jsx)(s.EY,{color:"yellow",children:e},0);if(/^available models:/i.test(e))return(0,r.jsx)(s.EY,{color:"cyan",children:e},0);if(/^(commands:|examples:|usage:)/i.test(e))return(0,r.jsx)(s.EY,{color:"cyan",bold:!0,children:e},0);if(e.startsWith("/")){const[t,...n]=e.split(" - ");return n.length>0?(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"cyan",children:t}),(0,r.jsxs)(s.EY,{color:"gray",children:[" - ",n.join(" - ")]})]},0):(0,r.jsx)(s.EY,{color:"cyan",children:e},0)}return e.startsWith("  /")?(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"gray",children:" "}),(0,r.jsxs)(s.EY,{color:"cyan",children:["/",e.slice(3)]})]},0):(0,r.jsx)(s.EY,{color:"gray",children:e},0)})(e),n="string"==typeof e?e:JSON.stringify(e);return(0,r.jsx)(i.Fragment,{children:t},n)}))}),c=i.memo(a);o()}catch(e){o(e)}}))},"./src/components/prompt/palette-aligned-list.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/hooks/use-screen-size.ts"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=(e,t)=>{const n=e.trim();if(0===n.length||t<=0)return"";if(n.length<=t)return n;const o=n.split(/\s+/);let r="";for(let e=0;e<o.length;e++){const n=o[e],s=0===r.length?n:`${r} ${n}`,i=1;if(s.length+i>t)return r.length>0?`${r}â€¦`:`${n.slice(0,Math.max(0,t-i))}â€¦`;r=s}return r},d=({items:e,activeIndex:t,windowStart:n,pageSize:o=i.kQ,highlightColor:a,maxLabelCols:d=40})=>{const{width:u}=(0,l.l)(),p=n>0,h=n+o<e.length,g=o-((p?1:0)+(h?1:0)),m=e.slice(n,n+g),f=Math.min(m.reduce(((e,t)=>Math.max(e,t.label.length)),0),d),v=t-n;return(0,r.jsxs)(s.az,{paddingX:2,flexDirection:"column",children:[p&&(0,r.jsx)(s.az,{paddingLeft:3,children:(0,r.jsx)(s.EY,{dimColor:!0,children:"â†‘ more above"})}),m.map(((e,t)=>{const n=t===v,o=n?a:"gray",i=n?"foreground":"gray";return(0,r.jsxs)(s.az,{width:"100%",flexDirection:"row",alignItems:"center",children:[(0,r.jsx)(s.az,{width:1,backgroundColor:n?a:void 0}),(0,r.jsx)(s.az,{width:2,children:(0,r.jsx)(s.EY,{color:o,children:n?"â†’ ":"  "})}),f>0&&(0,r.jsx)(s.az,{width:f,marginRight:2,children:(0,r.jsx)(s.EY,{color:i,bold:n,wrap:"truncate-end",children:e.label})}),(0,r.jsx)(s.az,{flexGrow:1,children:e.description?(0,r.jsx)(s.EY,{color:i,bold:n,wrap:"truncate-end",children:(()=>{const t=3+(f>0?f+2:0),n=Math.max(0,u-4-t);return c(e.description,n)})()}):null})]},`${e.key}-${t}`)})),h&&(0,r.jsx)(s.az,{paddingLeft:3,children:(0,r.jsx)(s.EY,{dimColor:!0,children:"â†“ more below"})})]})};o()}catch(e){o(e)}}))},"./src/components/prompt/palette-at-list.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("./src/constants.ts"),i=n("./src/components/prompt/palette-aligned-list.tsx"),l=e([i]);i=(l.then?(await l)():l)[0];const a=40,c=e=>{const t=e.endsWith("/"),n=t?e.slice(0,-1):e,o=n.lastIndexOf("/");if(-1===o)return{name:n+(t?"/":""),parent:"",isDir:t};const r=0===o?"/":n.slice(0,o);return{name:n.slice(o+1)+(t?"/":""),parent:r,isDir:t}},d=({suggestions:e,activeIndex:t,windowStart:n,pageSize:o=s.kQ,highlightColor:l})=>{const d=e.map(((e,t)=>{const{name:n,parent:o}=c(e);return{key:`at-${e}-${t}`,label:n,description:o}}));return(0,r.jsx)(i.A,{items:d,activeIndex:t,windowStart:n,pageSize:o,highlightColor:l,maxLabelCols:a})};o()}catch(e){o(e)}}))},"./src/components/prompt/palette-slash-list.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("./src/constants.ts"),i=n("./src/components/prompt/palette-aligned-list.tsx"),l=e([i]);i=(l.then?(await l)():l)[0];const a=({items:e,activeIndex:t,windowStart:n,pageSize:o=s.kQ,highlightColor:l})=>{const a=e=>{const t=e.isArgSuggestion&&e.parentCommandId,n=e.args.length>0?" "+e.args.map((e=>!1===e.required?`[${e.identifier}]`:`<${e.identifier}>`)).join(" "):"";return`/${t?`${e.parentCommandId} ${e.identifier}`:e.identifier}${n}`},c=e.map(((e,t)=>{var n;return{key:`${e.identifier}-${e.parentCommandId||"root"}-${t}`,label:a(e),description:null!==(n=e.description)&&void 0!==n?n:""}}));return(0,r.jsx)(i.A,{items:c,activeIndex:t,windowStart:n,pageSize:o,highlightColor:l,maxLabelCols:40})};o()}catch(e){o(e)}}))},"./src/components/prompt/pending-decisions-banner.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>h});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../local-exec/dist/index.js"),l=n("./src/pending-decision-store.ts"),a=n("./src/utils/path-utils.ts"),c=n("./src/components/highlighted-code.tsx"),d=n("./src/components/inline-delta.tsx"),u=n("./src/components/mcp-tool-decision-preview.tsx"),p=e([s,c,d,u]);[s,c,d,u]=p.then?(await p)():p;const h=({decisions:e})=>0===e.length?null:(0,r.jsx)(s.az,{flexDirection:"column",borderColor:"gray",borderStyle:"single",borderDimColor:!0,paddingX:1,marginX:1,children:e.map((e=>{const t=function(e){switch(e.operation.type){case i.S5.Shell:return function(e){const t=e.details.command||"",n=t.length>80?`${t.slice(0,77)}...`:t,o=e.details.reason,r="string"==typeof o?o:void 0;return r?`${n}\nReason: ${r}`:n}(e.operation);case i.S5.Delete:return`Delete file: ${(0,a.fw)(e.operation.details.path)}`;case i.S5.Write:return`Write file: ${(0,a.fw)(e.operation.details.path)}. Reason: ${e.operation.details.reason}\n\n${e.operation.details.diffString}`;case i.S5.Mcp:{const t=e.operation.details,n=Object.keys(t.args).length>0?`\nArgs: ${JSON.stringify(t.args,null,2)}`:"";return`MCP Provider: ${t.providerIdentifier}. MCP tool: ${t.toolName}${n}`}case l.yB:return`Web search: "${e.operation.details.searchTerm}"`;case l.uS:return`Web fetch: "${e.operation.details.url}"`;default:throw e.operation,new Error(`Unhandled operation type: ${e.operation.type}`)}}(e);let n;if(e.operation.type===i.S5.Shell){const t=e.operation.details.isSandboxEnabled?"ðŸ”’ ":"$ ";n=(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:3,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:t})}),(0,r.jsx)(s.az,{flexGrow:1,children:(0,r.jsxs)(s.EY,{color:"foreground",wrap:"wrap",children:[e.operation.details.command," ",(0,r.jsxs)(s.EY,{color:"gray",children:["in"," ",(0,a.tk)((0,a.fw)(e.operation.details.workingDirectory),50)]})]})})]})}else if(e.operation.type===i.S5.Write){let t=0,o=0;for(const n of e.operation.details.diffString.split("\n"))n.startsWith("+")?t++:n.startsWith("-")&&o++;const i=(0,a.Kr)((0,a.fw)(e.operation.details.path));n=(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"center",gap:1,children:[(0,r.jsx)(s.EY,{color:"foreground",children:i}),(0,r.jsx)(d._,{added:t,removed:o})]}),(0,r.jsx)(s.az,{borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,borderColor:"gray",borderStyle:"single",borderDimColor:!0,children:(0,r.jsx)(c.A,{content:e.operation.details.diffString,language:"diff",showLineNumbers:!1,maxLines:40,isDiff:!0})})]})}else if(e.operation.type===i.S5.Mcp){const t=e.operation.details;n=(0,r.jsx)(u.t,{providerIdentifier:t.providerIdentifier,toolName:t.toolName,args:t.args})}else if(e.operation.type===l.yB){const t=e.operation.details;n=(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:3,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"cyan",children:"ðŸ” "})}),(0,r.jsx)(s.az,{flexGrow:1,children:(0,r.jsxs)(s.EY,{color:"foreground",wrap:"wrap",children:[(0,r.jsx)(s.EY,{bold:!0,children:"Web Search: "}),t.searchTerm]})})]})})}else if(e.operation.type===l.uS){const t=e.operation.details;n=(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:3,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"cyan",children:"ðŸŒ "})}),(0,r.jsx)(s.az,{flexGrow:1,children:(0,r.jsxs)(s.EY,{color:"foreground",wrap:"wrap",children:[(0,r.jsx)(s.EY,{bold:!0,children:"Web Fetch: "}),t.url]})})]})})}else n=(0,r.jsx)(s.EY,{color:"foreground",dimColor:!0,children:t});return(0,r.jsx)(s.az,{flexDirection:"column",children:n},e.id)}))});o()}catch(e){o(e)}}))},"./src/components/prompt/prompt-footer.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=e([s]);s=(a.then?(await a)():a)[0];const c=({show:e,exitMode:t,modelLabel:n,isMaxMode:o,tokenPercentLabel:i,changedFilesCount:a,showReviewHint:c,headlineLabel:d,headlineColor:u,exitHintText:p,rightStatusLabel:h,showSlashHint:g=!0})=>e?(0,r.jsx)(s.az,{flexDirection:"column",marginX:2,children:t?(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{dimColor:!0,children:null!=p?p:"Press Ctrl+C again to exit"})}):(0,r.jsxs)(s.az,{marginTop:d?0:1,flexDirection:"column",children:[d?(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:u||"foreground",children:d})}):null,(0,r.jsxs)(s.az,{gap:2,justifyContent:"space-between",children:[(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,children:[h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:h}),(0,r.jsx)(s.EY,{dimColor:!0,children:"Â·"})]}):null,(0,r.jsx)(s.EY,{dimColor:!0,children:n}),o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Â·"}),(0,r.jsx)(s.EY,{color:"white",children:"MAX"})]}),i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Â·"}),(0,r.jsx)(s.EY,{dimColor:!0,children:i})]}):null,a>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Â·"}),(0,r.jsxs)(s.EY,{dimColor:!0,children:[a," file",1===a?"":"s"," edited"]})]})]}),(0,r.jsx)(s.az,{})]}),(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{dimColor:!0,children:[(()=>{const e=[];return g&&e.push("/ commands"),l.KD&&e.push("@ files"),e.push("! shell"),e.join(" Â· ")})(),l.hD&&c&&a>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:" Â· "}),(0,r.jsx)(s.EY,{dimColor:!0,children:"ctrl+r to review edits"})]})]})})]})}):null,d=i.memo(c);o()}catch(e){o(e)}}))},"./src/components/queued-message-banner.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{J:()=>g});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/hooks/use-screen-size.ts"),a=n("./src/utils/text-wrapping.ts"),c=e([s,l]);[s,l]=c.then?(await c)():c;const d="yellow",u="â—‹ ",p="  ",h=2,g=({messages:e,showTip:t=!0,inputIsEmpty:n=!0,maxLinesPerMessage:o=2})=>{const{width:c}=(0,l.l)(),g=Math.max(20,c-4),m=Math.max(1,g-4),f=Math.max(1,m-h),{allLines:v,totalMoreLines:x}=(0,i.useMemo)((()=>{var t,n;if(0===e.length)return{allLines:[],totalMoreLines:0};const r=[];let s=0;for(const i of e){const e=i.trim().split("\n"),l=[];for(const t of e){const e=(0,a.G)(t,f);l.push(...e)}if(l.length>o){s+=l.length-o,l.length=o;const e=l.length-1,n=null!==(t=l[e])&&void 0!==t?t:"";n.length>=f?l[e]=`${n.slice(0,f-1)}â€¦`:l[e]=`${n}â€¦`}for(let e=0;e<l.length;e++){const t=null!==(n=l[e])&&void 0!==n?n:"",o=0===e?u:p;r.push(`${o}${t}`)}}return{allLines:r,totalMoreLines:s}}),[e,o,f]),b=(0,i.useMemo)((()=>t?n?"enter send now Â· â†‘ edit Â· esc cancel":"â†‘ to edit":null),[t,n]);if(0===e.length)return null;const y=Math.max(0,g-14-1),j=`â”Œâ”€ follow-ups ${"â”€".repeat(y)}â”`,w=Math.max(0,g-2),k=`â””${"â”€".repeat(w)}â”˜`,C=e=>{const t=Math.max(0,m-e.length);return e+" ".repeat(t)},S=(x>0?`+${x} more line${x>1?"s":""} Â· `:"")+(null!=b?b:"");return(0,r.jsxs)(s.az,{flexDirection:"column",marginBottom:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:d,children:j})}),v.map(((e,t)=>(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{color:d,children:"â”‚ "}),(0,r.jsx)(s.EY,{dimColor:!0,children:C(e)}),(0,r.jsx)(s.EY,{color:d,children:" â”‚"})]},`queued-line-${t}`))),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{color:d,children:"â”‚ "}),(0,r.jsx)(s.EY,{dimColor:!0,children:C(S)}),(0,r.jsx)(s.EY,{color:d,children:" â”‚"})]}),(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:d,children:k})})]})};o()}catch(e){o(e)}}))},"./src/components/read-lints-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n;const o=(null==e?void 0:e.paths)||[],c=0===o.length?"project":1===o.length?(0,l.Kr)(o[0]):`${(0,l.Kr)(o[0])} (+${o.length-1} more)`;let d="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:d="pending";break;case"error":d="error";break;case"success":d="success";break;default:d="pending"}const u=`${(0,i.F_)("readLintsToolCall","success"===d)||("success"===d?"Read":"Reading")} Lints`;return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:u,primary:c,status:d}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.errorMessage]})}):null})(),(()=>{const e=null==t?void 0:t.result;if("success"===(null==e?void 0:e.case)){const t=e.value.totalDiagnostics||0,n=e.value.totalFiles||0;return(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Found ",t," issue",1===t?"":"s",n>0?` in ${n} file${1===n?"":"s"}`:""]})})}return null})()]})};o()}catch(e){o(e)}}))},"./src/components/read-todos-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{w:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/todos-ui.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=({tool:e,aborted:t})=>{const n=()=>{var t,n,o,r;const s=[];if((null===(n=null===(t=e.args)||void 0===t?void 0:t.statusFilter)||void 0===n?void 0:n.length)&&e.args.statusFilter.length>0){const t=e.args.statusFilter.map((e=>{switch(e){case 1:return"pending";case 2:return"in_progress";case 3:return"completed";case 4:return"cancelled";default:return"unknown"}}));s.push(`status: ${t.join(", ")}`)}return(null===(r=null===(o=e.args)||void 0===o?void 0:o.idFilter)||void 0===r?void 0:r.length)&&e.args.idFilter.length>0&&s.push(`ids: ${e.args.idFilter.join(", ")}`),s.length>0?` (${s.join("; ")})`:""};if(t)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsxs)(s.EY,{color:"foreground",children:[(0,r.jsx)(s.EY,{bold:!0,children:"Read to-dos"})," ",(0,r.jsx)(s.EY,{color:"gray",children:"Aborted"})]})})});if(!e.result)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(i.S,{todos:[],mode:"read",loading:!0,filters:n()})});const o=e.result.result;switch("success"===(null==o?void 0:o.case)&&o.value.totalCount,null==o?void 0:o.case){case"success":return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(i.S,{todos:o.value.todos,totalCount:o.value.totalCount,mode:"read",filters:n(),showHeader:!0})});case"error":return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.EY,{color:"gray",children:o.value.error})});default:return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(i.S,{todos:[],mode:"read"})})}};o()}catch(e){o(e)}}))},"./src/components/read-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{B:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n;if(!e)return null;const o=(0,l.Kr)(e.path),c=(0,l.me)(e.offset,e.limit);let d="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:d="pending";break;case"error":d="error";break;case"success":d="success";break;default:d="pending"}const u=(0,i.F_)("readToolCall","success"===d)||("success"===d?"Read":"Reading");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:u,primary:o,status:d,note:c}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.errorMessage]})}):null})()]})};o()}catch(e){o(e)}}))},"./src/components/running-agents-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{e:()=>c,q:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);function l(e,t){if(!e)return"";const n=e.split("/"),o=n[n.length-1]||e;return o.length<=t?o:`${o.slice(0,t-1)}â€¦`}function a(e,t){return e.length<=t?e:`${e.slice(0,t-1)}â€¦`}function c(e,t,n,o){const r=null==o?void 0:o.completed,s=null==o?void 0:o.aborted,i=t.args,c=(null==i?void 0:i.description)&&i.description.trim().length>0?a(i.description.trim(),40):"Subagent task",d=null==n?void 0:n.subagentState;let u;return s?u="Aborted":r?u="Done":(u=function(e){if(!(null==e?void 0:e.pendingTurn))return null;if("agent"!==e.pendingTurn.type)return null;const t=e.pendingTurn.pendingState;if("tool-call-segment"===(null==t?void 0:t.type)){const e=t.groups[t.groups.length-1];if(e&&e.calls.length>0){const t=e.calls[e.calls.length-1];if(t)return function(e){const t=e.tool.case,n=e.tool.value;switch(t){case"readToolCall":{const e=null==n?void 0:n.args,t=l(null==e?void 0:e.path,30);return t?`Reading ${t}`:"Reading file"}case"editToolCall":{const e=null==n?void 0:n.args,t=l(null==e?void 0:e.path,30);return t?`Editing ${t}`:"Editing file"}case"deleteToolCall":{const e=null==n?void 0:n.args,t=l(null==e?void 0:e.path,30);return t?`Deleting ${t}`:"Deleting file"}case"lsToolCall":{const e=null==n?void 0:n.args,t=l(null==e?void 0:e.path,30);return t?`Listing ${t}`:"Listing directory"}case"grepToolCall":{const e=null==n?void 0:n.args,t=(null==e?void 0:e.pattern)?a(e.pattern,20):"";return t?`Searching "${t}"`:"Searching"}case"globToolCall":{const e=null==n?void 0:n.args,t=(null==e?void 0:e.globPattern)?a(e.globPattern,25):"";return t?`Finding ${t}`:"Finding files"}case"shellToolCall":{const e=null==n?void 0:n.args,t=(null==e?void 0:e.command)?a(e.command,30):"";return t?`Running: ${t}`:"Running command"}case"taskToolCall":return"Running subagent";default:return"Workingâ€¦"}}(t.call)}}const n=e.pendingTurn.thinkingContent;return n&&n.length>0?"Thinkingâ€¦":"text"===(null==t?void 0:t.type)&&t.content?"Respondingâ€¦":null}(d),u||(u=(null==d?void 0:d.pendingTurn)?"Workingâ€¦":"Startingâ€¦")),{id:e,description:c,currentStep:u,completed:null!=r&&r,aborted:null!=s&&s}}s=(i.then?(await i)():i)[0];const d=({agents:e})=>{const t=e.filter((e=>!e.completed&&!e.aborted)).length,n=e.filter((e=>e.completed&&!e.aborted)).length,o=e.filter((e=>e.aborted)).length,i=0===t&&e.length>0;let l;if(i)l=0===o?`${n} ${1===n?"agent":"agents"} completed`:0===n?`${o} ${1===o?"agent":"agents"} aborted`:`${n} completed, ${o} aborted`;else{let e=`Running ${t} ${1===t?"agent":"agents"}â€¦`;const r=[];n>0&&r.push(`${n} done`),o>0&&r.push(`${o} aborted`),r.length>0&&(e+=` (${r.join(", ")})`),l=e}return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsxs)(s.az,{gap:1,alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:1,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"gray",children:"â¬¢"})}),(0,r.jsx)(s.EY,{bold:!0,color:"white",dimColor:i,children:l})]}),e.map((e=>{const t=e.aborted?"red":e.completed?"green":"gray",n=e.aborted?"âœ— ":e.completed?"âœ“ ":"";return(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{gap:1,children:[(0,r.jsx)(s.az,{width:1,flexShrink:0}),(0,r.jsx)(s.EY,{color:e.completed||e.aborted?"gray":void 0,children:e.description})]}),e.currentStep?(0,r.jsxs)(s.az,{gap:1,children:[(0,r.jsx)(s.az,{width:1,flexShrink:0}),(0,r.jsxs)(s.EY,{color:t,children:[n,e.currentStep]})]}):null]},e.id)}))]})};o()}catch(u){o(u)}}))},"./src/components/sandbox-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{J:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../shell-exec/dist/index.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=e([s]);s=(a.then?(await a)():a)[0];const d=[{id:"sandbox-no-network",label:"Auto-Run in Sandbox, network requires approval",config:{sandboxMode:"enabled",networkAccess:"allowlist",approvalMode:"allowlist"}},{id:"sandbox-with-network",label:"Auto-Run in Sandbox, with network access",config:{sandboxMode:"enabled",networkAccess:"enabled",approvalMode:"allowlist"}},{id:"no-sandbox",label:"No Sandbox, use regular permissions",config:{sandboxMode:"disabled",networkAccess:"allowlist",approvalMode:"allowlist"}}];function c(e,t){return e.sandboxMode===t.sandboxMode&&e.networkAccess===t.networkAccess&&e.approvalMode===t.approvalMode}const u=({configProvider:e,onClose:t})=>{const n=(0,l.useMemo)((()=>{var t,n,o,r,s;const i=e.get();return{sandboxMode:null!==(n=null===(t=i.sandbox)||void 0===t?void 0:t.mode)&&void 0!==n?n:"disabled",networkAccess:null!==(r=null===(o=i.sandbox)||void 0===o?void 0:o.networkAccess)&&void 0!==r?r:"allowlist",approvalMode:null!==(s=i.approvalMode)&&void 0!==s?s:"allowlist"}}),[e]),o=(0,l.useMemo)((()=>{const e=d.findIndex((e=>c(e.config,n)));return e>=0?e:0}),[n]),[a,u]=(0,l.useState)(n),[p,h]=(0,l.useState)(o),[g,m]=(0,l.useState)(!1),[f,v]=(0,l.useState)(""),x=(0,l.useMemo)((()=>(0,i.K3)()),[]),b=(0,l.useRef)(p),y=(0,l.useRef)(a),j=(0,l.useRef)(g),w=(0,l.useRef)(null);b.current=p,y.current=a,j.current=g,(0,l.useEffect)((()=>()=>{w.current&&clearTimeout(w.current)}),[]);const k=(0,l.useCallback)(((e,t=2e3)=>{w.current&&clearTimeout(w.current),v(e),w.current=setTimeout((()=>{v(""),w.current=null}),t)}),[]),C=(0,l.useCallback)((()=>{return t=void 0,n=void 0,r=function*(){if(j.current)return;const t=d[b.current];if(t)if(c(t.config,y.current))k("Already using this configuration");else if("enabled"!==t.config.sandboxMode||x){m(!0);try{yield e.transform((e=>{var n;return Object.assign(Object.assign({},e),{approvalMode:t.config.approvalMode,sandbox:{mode:t.config.sandboxMode,networkAccess:t.config.networkAccess,networkAllowlist:null===(n=e.sandbox)||void 0===n?void 0:n.networkAllowlist}})})),u(t.config),k("âœ“ Configuration updated")}catch(e){k(`Error: ${e instanceof Error?e.message:String(e)}`,3e3)}finally{m(!1)}}else k("Sandbox not supported on this platform (macOS only)",3e3)},new((o=void 0)||(o=Promise))((function(e,s){function i(e){try{a(r.next(e))}catch(e){s(e)}}function l(e){try{a(r.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,l)}a((r=r.apply(t,n||[])).next())}));var t,n,o,r}),[e,x,k]);return(0,s.Ge)((0,l.useCallback)(((e,n)=>{(function(e){return e.includes("[M")||e.includes("[<")||e.includes("[?")||/\x1b\[<\d+;\d+;\d+[Mm]/.test(e)||/\x1b\[M[\x20-\xff]{3}/.test(e)})(e)||(n.ctrl&&"c"===e||n.escape||"q"===e||"Q"===e?t():n.upArrow||"k"===e||"K"===e?h((e=>e>0?e-1:d.length-1)):n.downArrow||"j"===e||"J"===e?h((e=>e<d.length-1?e+1:0)):n.return&&!j.current&&C())}),[t,C])),(0,r.jsxs)(s.az,{flexDirection:"column",marginTop:1,paddingX:1,paddingTop:0,paddingBottom:1,borderStyle:"single",borderColor:"cyan",borderTop:!0,borderLeft:!1,borderRight:!1,borderBottom:!1,children:[(0,r.jsxs)(s.az,{marginBottom:1,children:[(0,r.jsx)(s.EY,{bold:!0,color:"cyan",children:"Command Execution Settings"}),f&&(0,r.jsxs)(s.EY,{color:f.startsWith("âœ“")?"green":"yellow",children:[" ",f]})]}),!x&&(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:"yellow",children:"âš  Sandbox requires macOS. Sandbox options are unavailable."})}),(0,r.jsx)(s.az,{flexDirection:"column",children:d.map(((e,t)=>{const n=t===p,o=c(e.config,a),i="enabled"===e.config.sandboxMode&&!x;return(0,r.jsx)(s.az,{flexDirection:"column",paddingLeft:1,children:(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{color:i?"gray":n?"cyan":"white",bold:n&&!i,children:n?"â†’ ":"  "}),o?(0,r.jsxs)(s.EY,{color:"green",bold:!0,children:["â— ",e.label]}):(0,r.jsxs)(s.EY,{color:i?"gray":n?"cyan":"white",bold:n&&!i,children:["â—‹ ",e.label]}),o&&(0,r.jsxs)(s.EY,{color:"green",dimColor:!0,children:[" ","(current)"]})]})},e.id)}))}),(0,r.jsxs)(s.az,{marginTop:1,flexDirection:"column",children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"When Sandbox is enabled, tools will auto-run in a sandbox if possible."}),(0,r.jsx)(s.EY,{dimColor:!0,children:"If not, they will respect the allowlist or ask for approval."})]}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{dimColor:!0,italic:!0,children:"â†‘/â†“ to navigate â€¢ Enter to select â€¢ Esc to close"})})]})};o()}catch(p){o(p)}}))},"./src/components/search-results-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{X:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/path-display.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const c=({result:e,index:t})=>{var n,o,l,a;const c=e.codeBlock;if(!c)return null;const d=c.relativeWorkspacePath;return(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.az,{flexDirection:"row",gap:1,children:[(0,r.jsxs)(s.EY,{color:"cyan",bold:!0,children:[(t+1).toString().padStart(3," "),"."]}),(0,r.jsx)(i.g,{path:d}),(0,r.jsxs)(s.EY,{color:"gray",children:["(L",null===(o=null===(n=c.range)||void 0===n?void 0:n.startPosition)||void 0===o?void 0:o.line," - L",null===(a=null===(l=c.range)||void 0===l?void 0:l.endPosition)||void 0===a?void 0:a.line,")"]})]})})},d=({query:e,results:t})=>0===t.length?(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsxs)(s.EY,{color:"yellow",children:['No results found for "',e,'"']})}):(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.EY,{color:"green",bold:!0,children:["Found ",t.length," result",1!==t.length?"s":"",' for "',e,'"']}),t.map(((e,t)=>{var n,o,s;return(0,r.jsx)(c,{result:e,index:t},`${null!==(o=null===(n=e.codeBlock)||void 0===n?void 0:n.relativeWorkspacePath)&&void 0!==o?o:""}-${null!==(s=e.score)&&void 0!==s?s:0}-${t}`)}))]});function a(e,t){(0,s.XX)((0,r.jsx)(d,{query:e,results:t}))}o()}catch(u){o(u)}}))},"./src/components/sem-search-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/path-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({tool:{args:e,result:t}})=>{var n;if(!e||!e.query)return null;const o=e.query.length>40?`...${e.query.slice(-37)}`:e.query;let c="pending";switch(null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.case){case void 0:c="pending";break;case"error":c="error";break;case"success":c="success";break;default:c="pending"}const d=(()=>{var t;const n=null!==(t=e.targetDirectories)&&void 0!==t?t:[];if(!n||0===n.length)return;const o=[];let r=0;for(let e=0;e<Math.min(n.length,3);e++){const t=(0,l.Kr)(n[e]||".");if(!(0===o.length||r+2+t.length<=100))break;o.push(t),r+=t.length+(o.length>1?2:0)}const s=n.length-o.length;return`in ${s>0?`${o.join(", ")} (+${s} more)`:o.join(", ")}`})(),u=(0,i.F_)("semSearchToolCall","success"===c)||("success"===c?"Searched":"Searching");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:u,primary:`"${o}"`,status:c,note:d}),(()=>{const e=null==t?void 0:t.result;return"error"===(null==e?void 0:e.case)?(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Error: ",e.value.errorMessage]})}):null})(),(()=>{const e=null==t?void 0:t.result;if("success"===(null==e?void 0:e.case)){const t=(e.value.results||"").match(/<search_result\b/g),n=t?t.length:0;return(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsxs)(s.EY,{color:"gray",children:["Found ",n," results"]})})}return null})()]})};o()}catch(e){o(e)}}))},"./src/components/shell-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{f:()=>m});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../local-exec/dist/index.js"),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/constants.ts"),c=n("./src/context/agent-state-context.tsx"),d=n("./src/utils/characters.ts"),u=n("./src/utils/path-utils.ts"),p=n("./src/components/highlighted-code.tsx"),h=e([s,p]);[s,p]=h.then?(await h)():h;const g=e=>{if(!e&&0!==e)return null;if(e<1e3)return`${e}ms`;const t=e/1e3;return`${t.toFixed(t>=10?0:1)}s`},m=({tool:e,expand:t,aborted:n,shellManager:o})=>{var h,m;const{pendingDecisions:f}=(0,c.C9)(),v=(0,c.tO)(),x=e.args,b=e.result,y=(0,l.useMemo)((()=>((null==x?void 0:x.command)||"").trim()),[null==x?void 0:x.command]),j=null!=t?t:!v,w=(0,l.useMemo)((()=>o&&(null==x?void 0:x.toolCallId)?o.getOrCreateShellEmitter(x.toolCallId):null),[o,null==x?void 0:x.toolCallId]),k=(0,l.useMemo)((()=>{const e=(null==x?void 0:x.workingDirectory)||void 0,t=null==b?void 0:b.result;let n=e;if(!n&&t)switch(t.case){case"success":case"failure":case"rejected":n=t.value.workingDirectory||void 0;break;default:n=void 0}if(!n)return;const o=(0,u.fw)(n),r="."===o?"current dir":o;return(0,u.tk)(r,a.DN)}),[null==x?void 0:x.workingDirectory,b]),C=(0,l.useMemo)((()=>f.some((e=>e.operation.type===i.S5.Shell&&(e.operation.details.command||"").trim()===y))),[f,y]),S=(0,l.useMemo)((()=>!(null==b?void 0:b.result)),[b]),E=(0,l.useMemo)((()=>{if(!(null==b?void 0:b.isBackground))return!1;const e=b.result;return"success"===(null==e?void 0:e.case)&&void 0!==e.value.shellId&&0!==e.value.shellId}),[b]),[$,M]=(0,l.useState)(void 0),T=(0,l.useMemo)((()=>Boolean(null==w?void 0:w.getSandboxed())),[w]),A=null==w?void 0:w.startedAt,I=null==w?void 0:w.endedAt,[D,_]=(0,l.useState)(0),[P,L]=(0,l.useState)(0),[R,O]=(0,l.useState)(void 0);(0,l.useEffect)((()=>{if(!w)return void M(void 0);M(w.getCurrentState());const e=e=>{M(e)};return w.addListener(e),()=>{w.removeListener(e)}}),[w]),(0,l.useEffect)((()=>{var e,t;if(E&&"success"===(null===(e=null==b?void 0:b.result)||void 0===e?void 0:e.case)&&void 0===R){const e=null!==(t=b.result.value.executionTime)&&void 0!==t?t:0;O(performance.now()-e)}else E||void 0===R||O(void 0)}),[E,b,R]);const Y=(0,l.useMemo)((()=>{var e,t;if(n)return"Aborted";const o=null==b?void 0:b.result;if(!o&&null!==(null==$?void 0:$.exitCode)&&void 0!==(null==$?void 0:$.exitCode))return`exit ${$.exitCode}`;if(o)switch(o.case){case"success":return null!==(e=g(o.value.executionTime))&&void 0!==e?e:void 0;case"failure":{const e=null!==(t=o.value.exitCode)&&void 0!==t?t:1,n=o.value.signal||"",r=g(o.value.executionTime),s=[];return s.push(`exit ${e}${n?` (${n})`:""}`),r&&s.push(r),s.join(" â€¢ ")}case"rejected":return"Rejected";default:return}}),[n,b,$]);(0,l.useEffect)((()=>{if(!(void 0!==A&&S||E&&void 0!==R)||C||n)return;const e=setInterval((()=>{_((e=>e+1))}),100);return()=>clearInterval(e)}),[A,S,E,R,C,n]);const z=E&&void 0!==R?Math.round(performance.now()-R):void 0!==A?Math.round((null!=I?I:performance.now())-A):P;(0,l.useEffect)((()=>{void 0!==A&&z>0&&L(z)}),[A,z]);const N=(0,l.useMemo)((()=>{if(n)return null;const e=e=>(0,d.aJ)(e),t=e=>e.replace(/(\S{80})(?=\S)/g,"$1â€‹"),o=null==b?void 0:b.result;if(!o&&(null==$?void 0:$.output)){const n=t(e($.output));if(!n)return null;const o=Buffer.byteLength(n,"utf8"),r=o>a.qg;return{text:r?Buffer.from(n,"utf8").subarray(0,a.qg).toString("utf8"):n,color:void 0,isTruncated:r,originalSize:o}}if(!o)return null;switch(o.case){case"success":case"failure":{const n=o.value.stdout||"",r=o.value.stderr||"",s=[];n&&s.push(t(e(n))),r&&s.push(t(e(r)));const i=s.join("\n");if(!i)return null;const l=Buffer.byteLength(i,"utf8"),c=l>a.qg;return{text:c?Buffer.from(i,"utf8").subarray(0,a.qg).toString("utf8"):i,color:void 0,isTruncated:c,originalSize:l}}case"rejected":{const e="string"==typeof o.value.reason?o.value.reason.trim():"";return e?{text:e,color:"yellow"}:null}default:return null}}),[b,n,$]);return x?(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsxs)(s.EY,{color:"foreground",children:[T?"ðŸ”’ $":"$"," "]})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsxs)(s.EY,{wrap:"wrap",children:[(0,r.jsx)(s.EY,{color:"foreground",children:y}),Y&&!E?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:Y}),n&&z>0?(0,r.jsxs)(s.EY,{color:"gray",children:[" â€¢ ",g(z)]}):null]}):null,!S&&!E||n?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.EY,{color:"gray",children:[C?"Waiting for approval...":null!==(h=g(z))&&void 0!==h?h:void 0,E?" (background)":""]})]}),k?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.EY,{color:"gray",children:["in ",k]})]}):null]})})]}),null!==N?"yellow"===N.color?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"yellow",wrap:"wrap",children:N.text})}):N.text?(0,r.jsxs)(s.az,{paddingLeft:2,flexDirection:"column",children:[(0,r.jsx)(p.d,{content:N.text,language:"plaintext",showLineNumbers:!1,maxLines:j?a.U5:a.Ok,truncationHint:j?void 0:"ctrl+o to expand",dimmed:!0}),N.isTruncated&&j?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsxs)(s.EY,{color:"yellow",dimColor:!0,children:["Output truncated at 1MiB limit (",Math.round((null!==(m=N.originalSize)&&void 0!==m?m:0)/1024)," KB total)"]})}):null,j?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"ctrl+o to collapse"})}):null]}):null:null]}):null};o()}catch(e){o(e)}}))},"./src/components/shell-turn-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{o:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/context/agent-state-context.tsx"),a=n("./src/components/highlighted-code.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({command:e,output:t,exitCode:n})=>{e=e.trim();const o=void 0!==n,c=!(0,l.tO)(),d=Buffer.byteLength(t,"utf8"),u=d>i.qg,p=u?Buffer.from(t,"utf8").subarray(0,i.qg).toString("utf8"):t;return(0,r.jsxs)(s.az,{flexDirection:"column",marginTop:1,marginBottom:1,children:[(0,r.jsxs)(s.az,{flexDirection:"row",alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:2,flexShrink:0,children:(0,r.jsx)(s.EY,{color:"foreground",children:"$ "})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsxs)(s.EY,{wrap:"wrap",children:[(0,r.jsx)(s.EY,{color:"foreground",children:e}),o?null!=n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.EY,{color:"gray",children:["exit ",n]})]}):null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:"Runningâ€¦"})]})]})})]}),t?(0,r.jsxs)(s.az,{paddingLeft:1,flexDirection:"column",children:[(0,r.jsx)(a.d,{content:p,language:"plaintext",showLineNumbers:!1,maxLines:c?i.U5:i.a6,truncationHint:c?void 0:"ctrl+o to expand",dimmed:!0}),u&&c?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsxs)(s.EY,{color:"yellow",dimColor:!0,children:["Output truncated at 1MiB limit (",Math.round(d/1024)," ","KB total)"]})}):null,c?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"ctrl+o to collapse"})}):null]}):null]})};o()}catch(e){o(e)}}))},"./src/components/step-container.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{C:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({children:e,shouldPadTop:t=!1,shouldMarginBottom:n=!1,overrideBorderColor:o="gray",paddingLeft:i=2,paddingRight:l=2})=>(0,r.jsx)(s.az,{paddingLeft:i,paddingRight:l,paddingTop:t?1:0,marginBottom:n?1:0,children:e});o()}catch(e){o(e)}}))},"./src/components/sudo-password-banner.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{t:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/hooks/use-sudo-password-requests.ts"),a=n("./src/components/sudo-password-prompt.tsx"),c=e([s,a]);function d({store:e}){const{currentRequest:t,submitPassword:n,cancelRequest:o}=(0,l.k)(e),c=(0,i.useCallback)((e=>{t&&n(t.id,e)}),[t,n]),d=(0,i.useCallback)((()=>{t&&o(t.id)}),[t,o]);return t?(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(a.H,{prompt:t.prompt,onSubmit:c,onCancel:d})}):null}[s,a]=c.then?(await c)():c,o()}catch(u){o(u)}}))},"./src/components/sudo-password-prompt.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{H:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);function a({prompt:e,onSubmit:t,onCancel:n}){const[o,l]=(0,i.useState)(""),[a,c]=(0,i.useState)(!1),d=(0,i.useCallback)((()=>{a||(c(!0),t(o))}),[t,o,a]);(0,s.Ge)(((e,t)=>{if(a)return;if(t.escape)return void n();if(t.return)return void d();if(t.backspace||t.delete)return void l((e=>e.slice(0,-1)));if(t.ctrl&&"c"===e)return void n();if(t.ctrl&&"u"===e)return void l("");if(t.ctrl||t.meta||t.upArrow||t.downArrow||t.leftArrow||t.rightArrow||t.tab)return;const o=e.replace(/[\x00-\x1F\x7F]/g,"");o.length>0&&l((e=>e+o))}),{isActive:!a});const u="*".repeat(o.length),p=o.length>0?u:"Enter password...",h=o.length>0?void 0:"gray";return(0,r.jsxs)(s.az,{flexDirection:"column",borderStyle:"round",borderColor:"yellow",paddingX:2,paddingY:1,marginY:1,children:[(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsxs)(s.EY,{children:[(0,r.jsxs)(s.EY,{color:"yellow",bold:!0,children:["ðŸ”"," "]}),(0,r.jsx)(s.EY,{color:"foreground",bold:!0,children:"Sudo Authentication Required"})]})}),(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:"gray",children:e})}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{color:"cyan",children:"Password: "}),(0,r.jsx)(s.EY,{color:h,dimColor:0===o.length,children:p}),!a&&(0,r.jsx)(s.EY,{inverse:!0,children:" "})]}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:a?"Authenticating...":"Press Enter to submit, Escape to cancel"})}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,italic:!0,children:"â„¹ Your password is secure and will not be visible to the AI model."})})]})}s=(l.then?(await l)():l)[0],o()}catch(c){o(c)}}))},"./src/components/summary.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{B:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/hooks/use-screen-size.ts"),l=n("./src/components/markdown.tsx"),a=e([s,i,l]);function c({summary:e}){const t=(0,i.l)();return(0,r.jsxs)(s.az,{borderStyle:"single",borderColor:"cyan",borderDimColor:!0,paddingLeft:1,paddingRight:4,marginTop:1,marginBottom:1,marginX:1,width:t.width-2,flexDirection:"column",gap:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsx)(s.EY,{color:"cyan",bold:!0,children:"Summary"})}),(0,r.jsx)(l.Ay,{content:e})]})}[s,i,l]=a.then?(await a)():a,o()}catch(d){o(d)}}))},"./src/components/switch-mode-approval.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{V:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/utils/interaction-utils.ts"),l=n("./src/components/prompt/decision-dropdown.tsx"),a=n("./src/components/tool-row-box.tsx"),c=e([s,l,a]);[s,l,a]=c.then?(await c)():c;const d=({prompt:e})=>{const t=(0,i.dy)(e.targetModeId);return(0,r.jsx)(a.Y,{flexDirection:"column",borderColor:"cyan",borderDimColor:!1,children:(0,r.jsxs)(s.az,{flexDirection:"column",paddingX:1,gap:1,children:[(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsxs)(s.EY,{bold:!0,color:"cyan",children:["Switch to ",t," mode?"]})}),e.explanation?(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsx)(s.EY,{color:"gray",children:e.explanation})}):null,(0,r.jsx)(l.A,{title:"",highlightColor:"cyan",options:[{label:"Approve mode switch",hint:"(y)"},{label:"Reject",hint:"(n or esc)"}],selectedIndex:e.decisionIndex})]})})};o()}catch(e){o(e)}}))},"./src/components/switch-mode-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{U:()=>u});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/interaction-utils.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=e=>{var t,n,o,r,s,i,a;switch(null===(t=e.result)||void 0===t?void 0:t.result.case){case"success":{const t=null!==(o=null===(n=e.result)||void 0===n?void 0:n.result.value.fromModeId)&&void 0!==o?o:"",i=null!==(s=null===(r=e.result)||void 0===r?void 0:r.result.value.toModeId)&&void 0!==s?s:"",a=(0,l.dy)(t),c=(0,l.dy)(i);return{status:"success",note:t.length>0&&i.length>0?`Switched from ${a} to ${c}`:"Mode switch approved"}}case"rejected":return{status:"rejected",note:(null===(i=e.result)||void 0===i?void 0:i.result.value.reason)||"Mode switch rejected"};case"error":return{status:"error",errorMessage:(null===(a=e.result)||void 0===a?void 0:a.result.value.error)||"Unknown error"};default:return{status:"pending"}}},u=({tool:e})=>{var t,n,o;const c=null!==(n=null===(t=e.args)||void 0===t?void 0:t.targetModeId)&&void 0!==n?n:"unknown",u=(0,l.dy)(c),{status:p,note:h,errorMessage:g}=d(e);return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(a.C,{name:"SwitchMode",primary:`â†’ ${u}`,status:p,note:h}),(null===(o=e.args)||void 0===o?void 0:o.explanation)?(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",children:e.args.explanation})}):null,g?(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",g]})}):null]})};o()}catch(e){o(e)}}))},"./src/components/task-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{K:()=>x});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/utils/task-tool.ts"),a=n("./src/components/markdown.tsx"),c=n("./src/components/overflow-text.tsx"),d=n("./src/components/tool-call-header.tsx"),u=e([s,a,c,d]);[s,a,c,d]=u.then?(await u)():u;const h=8,g=600,m="Subagent task",f=4,v=4;function p(e,t){return e.length<=t?e:`${e.slice(0,t-1)}â€¦`}const x=({tool:e,aborted:t,additionalData:n})=>{var o;const u=e.args,x=(null==u?void 0:u.description)&&u.description.trim().length>0?u.description.trim():m,b=(0,l.Nc)(null==u?void 0:u.subagentType),y=null==n?void 0:n.subagentState,j=null===(o=e.result)||void 0===o?void 0:o.result;let w,k,C,S=t?"error":"pending",E=!1;if(t)w="Subagent execution aborted";else{const e=null==j?void 0:j.case;switch(e){case void 0:S="pending";break;case"success":{S="success";const e="success"===(null==j?void 0:j.case)?j.value:void 0;k=(0,l.Uk)(null==e?void 0:e.conversationSteps),C=(0,l.uH)(null==e?void 0:e.durationMs),E=!0===(null==e?void 0:e.isBackground);break}case"error":S="error",w="error"===(null==j?void 0:j.case)&&j.value.error||"Unknown error";break;default:throw new Error(`Unhandled task result case: ${e}`)}}const $=[];b&&$.push(b),E&&$.push("background"),C&&$.push(C);const M=$.length>0?$.join(" â€¢ "):void 0,T=[];let A=0;const I=(e,t)=>{T.push({id:`${e}-${A++}`,content:t})};if("pending"===S&&!t){const e=function(e){if(!(null==e?void 0:e.pendingTurn))return null;if("agent"!==e.pendingTurn.type)return null;const t=e.pendingTurn.pendingState;if("tool-call-segment"!==(null==t?void 0:t.type))return null;const n=t.groups[t.groups.length-1];if(!n||0===n.calls.length)return null;const o=n.calls[n.calls.length-1];if(!o||o.completed)return null;const r=o.call.tool.case,s=(0,i.F_)(r,!1);if(!s)return null;const l=function(e){const t=e.tool.case,n=e.tool.value;if(!n)return"";switch(t){case"readToolCall":case"editToolCall":case"deleteToolCall":case"lsToolCall":{const e=n.args;return function(e){if(!e)return"";const t=e.split("/");return t[t.length-1]||e}(null==e?void 0:e.path)}case"grepToolCall":{const e=n.args;return(null==e?void 0:e.pattern)?`"${p(e.pattern,20)}"`:""}case"globToolCall":{const e=n.args;return(null==e?void 0:e.globPattern)?`"${p(e.globPattern,30)}"`:""}case"shellToolCall":{const e=n.args;return(null==e?void 0:e.command)?p(e.command,40):""}case"taskToolCall":{const e=n.args;return(null==e?void 0:e.description)?p(e.description,30):"subagent"}default:return""}}(o.call);return{verb:s,details:l}}(y),t=function(e){if(!(null==e?void 0:e.pendingTurn))return null;if("agent"!==e.pendingTurn.type)return null;const t=e.pendingTurn.pendingState;return"text"===(null==t?void 0:t.type)&&t.content?t.content:null}(y),n=function(e){return(null==e?void 0:e.pendingTurn)?"agent"!==e.pendingTurn.type?null:e.pendingTurn.thinkingContent||null:null}(y);if(e)I("current-tool",(0,r.jsxs)(s.EY,{color:"gray",children:[e.verb,e.details?` ${e.details}`:""]})),n&&I("thinking-content",(0,r.jsx)(c.Y,{content:n,maxLines:f,color:"dim"}));else if(n)I("thinking",(0,r.jsx)(c.Y,{content:n,maxLines:f,color:"dim"}));else if(t){const e=function(e,t){const n=e.split("\n");return n.length<=t?e:`${n.slice(0,t).join("\n")}â€¦`}(t,v);I("streaming-text",(0,r.jsx)(s.az,{flexDirection:"column",children:(0,r.jsx)(a.Ay,{content:e})}))}else(null==y?void 0:y.pendingTurn)?I("active",(0,r.jsx)(s.EY,{color:"gray",children:"Workingâ€¦"})):I("pending",(0,r.jsx)(s.EY,{color:"gray",children:"Waiting for subagent to finishâ€¦"}))}if("success"===S&&k){const{text:e,wasTruncated:t}=function(e){const t=e.split("\n");let n=e,o=!1;return t.length>h&&(n=t.slice(0,h).join("\n"),o=!0),n.length>g&&(n=n.slice(0,g),o=!0),{text:n.trimEnd(),wasTruncated:o}}(k);I("output",(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsx)(s.EY,{color:"gray",children:"Last output"}),(0,r.jsx)(s.EY,{wrap:"wrap",children:e}),t?(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"â€¦(output truncated)"}):null]}))}return"error"===S&&w&&I("error",(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",w]})),(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(d.C,{name:"Task",primary:x,status:S,note:M}),T.length>0?(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,flexDirection:"column",children:T.map(((e,t)=>(0,r.jsx)(s.az,{marginBottom:t<T.length-1?1:0,children:e.content},e.id)))}):null]})};o()}catch(b){o(b)}}))},"./src/components/todos-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../proto/dist/generated/agent/v1/todo_tool_pb.js"),l=n("./src/constants.ts"),a=n("./src/components/tool-call-header.tsx"),c=e([s,a]);[s,a]=c.then?(await c)():c;const d=({todos:e,totalCount:t,loading:n,error:o,mode:c,filters:d,showHeader:u=!0,isCreating:p=!1})=>{const h="read"===c?"Reading":p?"Creating":"Updating";if(n)return(0,r.jsx)(a.C,{name:"To-do",primary:`${h} to-dos${d?` ${d}`:""}...`,status:"pending"});if(o)return(0,r.jsx)(s.az,{paddingLeft:1,paddingRight:2,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error"," ","read"===c?"reading":p?"creating":"updating"," ","to-dos: ",o]})});if(0===e.length)return(0,r.jsx)(s.az,{paddingLeft:1,paddingRight:2,children:(0,r.jsxs)(s.EY,{color:"gray",children:["No to-dos found",d?` ${d}`:""]})});const g=e.filter((e=>e.status===i.Vj.COMPLETED)),m=e.filter((e=>e.status===i.Vj.IN_PROGRESS)),f=e.filter((e=>e.status===i.Vj.PENDING)),v=m.length+f.length,x=g.length,b=[];for(const e of g)b.push({icon:"â˜’",text:e.content});for(const e of m)b.push({icon:"â˜",text:e.content});for(const e of f)b.push({icon:"â˜",text:e.content});return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[u&&(0,r.jsx)(a.C,{name:"To-do",primary:v>0?`Working on ${v} ${1===v?"to-do":"to-dos"}${v>0&&x>0?` â€¢ ${x} done`:""}`:"All done",status:"success"}),(0,r.jsx)(s.az,{flexDirection:"column",marginLeft:l.SK,children:b.map(((e,t)=>(0,r.jsxs)(s.az,{flexDirection:"row",children:[(0,r.jsxs)(s.EY,{children:[e.icon," "]}),(0,r.jsx)(s.EY,{wrap:"wrap",children:e.text})]},`${e.icon}-${e.text}-${t}`)))})]})};o()}catch(e){o(e)}}))},"./src/components/tool-call-header.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{C:()=>l});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=e([s]);s=(i.then?(await i)():i)[0];const l=({name:e,primary:t,status:n,note:o})=>{const i=function(e){switch(e){case"success":return"white";case"error":default:return"gray";case"rejected":case"pending":return"yellow"}}(n);return(0,r.jsxs)(s.az,{gap:1,alignItems:"flex-start",children:[(0,r.jsx)(s.az,{width:1,flexShrink:0,children:(0,r.jsx)(s.EY,{color:i,dimColor:"success"===n,children:"success"===n?"â¬¢":"â¬¡"})}),(0,r.jsx)(s.az,{flexGrow:1,flexShrink:1,children:(0,r.jsxs)(s.EY,{wrap:"wrap",children:[(0,r.jsx)(s.EY,{bold:!0,children:e}),t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",children:t})]}):null,o?"string"==typeof o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"gray",wrap:"wrap",children:o})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.EY,{children:" "}),o]}):null]})})]})};o()}catch(e){o(e)}}))},"./src/components/tool-row-box.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Y:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/hooks/use-screen-size.ts"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=e=>{var{fullWidth:t,width:n,children:o}=e,l=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(e,["fullWidth","width","children"]);const a=(0,i.l)(),c=t?"100%":null!=n?n:Math.max(0,a.width-2);return(0,r.jsx)(s.az,Object.assign({borderStyle:"single",borderColor:"gray",borderDimColor:!0,gap:1,width:c},l,{children:o}))};o()}catch(e){o(e)}}))},"./src/components/unified-list-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{W:()=>j});var r=n("node:fs"),s=n("node:path"),i=n("../agent-kv/dist/index.js"),l=n("../ink/build/index.js"),a=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),c=n("../../node_modules/.pnpm/chalk@5.4.1/node_modules/chalk/source/index.js"),d=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),u=n("./src/constants.ts"),p=n("./src/hooks/use-screen-size.ts"),h=n("./src/state/index.ts"),g=n("./src/state/sqlite-blob-store.ts"),m=n("./src/utils/characters.ts"),f=n("./src/utils/git.ts"),v=e([l,p]);[l,p]=v.then?(await v)():v;var x=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const b=e=>{var t,n,o,r,s,i,l,a,c;if(!e)return;let d=0,u=0;const p=null!==(n=null===(t=e.diff)||void 0===t?void 0:t.diffs)&&void 0!==n?n:[];for(const e of p)d+=Math.max(0,null!==(o=e.added)&&void 0!==o?o:0),u+=Math.max(0,null!==(r=e.removed)&&void 0!==r?r:0);const h=null!==(s=e.submoduleDiffs)&&void 0!==s?s:[];for(const e of h){if(e.errored)continue;const t=null!==(l=null===(i=e.diff)||void 0===i?void 0:i.diffs)&&void 0!==l?l:[];for(const e of t)d+=Math.max(0,null!==(a=e.added)&&void 0!==a?a:0),u+=Math.max(0,null!==(c=e.removed)&&void 0!==c?c:0)}return d>0||u>0?{totalAdded:d,totalRemoved:u}:void 0},y=e=>{const t="number"==typeof e?e:0;return t<=0||!Number.isFinite(t)?0:t<1e11?Math.floor(1e3*t):t>=1e14&&t<1e17?Math.floor(t/1e3):t>=1e17?Math.floor(t/1e6):Math.floor(t)},j=({client:e,onClose:t,onSelectChat:n,onSelectBackground:o})=>{var v,j,w,k;const C=(0,d.useCallback)((t=>x(void 0,void 0,void 0,(function*(){if(!e)return;let n;const o=new Promise((e=>{n=setTimeout((()=>e(void 0)),1e4)})),r=x(void 0,void 0,void 0,(function*(){try{return yield e.getOptimizedDiffDetails({bcId:t})}catch(e){return}})),s=yield Promise.race([r,o]);return n&&clearTimeout(n),s?b(s):void 0}))),[e]),[S,E]=(0,d.useState)([]),[$,M]=(0,d.useState)(0),[T,A]=(0,d.useState)(0),[I,D]=(0,d.useState)(!0),[_,P]=(0,d.useState)(""),[L,R]=(0,d.useState)(!1),[O,Y]=(0,d.useState)(0),[z,N]=(0,d.useState)(""),[F,B]=(0,d.useState)(void 0),[U,q]=(0,d.useState)("Continue"),[H,W]=(0,d.useState)("Cancel"),[G,X]=(0,d.useState)(null),{stdout:K}=(0,l.t$)(),Q=(0,p.l)();(0,d.useEffect)((()=>{if(K){try{K.write("[?1049h[?7l[?1h=")}catch(e){}return()=>{try{K.write("[?1l>[?7h[?1049l")}catch(e){}}}}),[K]),(0,d.useEffect)((()=>{let t=!1;return x(void 0,void 0,void 0,(function*(){var n;try{let o=[];if(e&&u.xZ)try{const t=(0,f.X4)(),r=(null!==(n=(yield e.listBackgroundComposers({n:32,includeStatus:!0,preferredRepoUrl:t.preferredRepoUrl,additionalRepoUrls:t.additionalRepoUrls})).composers)&&void 0!==n?n:[]).map((e=>{var t,n,o,r,s,i,l;return{kind:"background",id:null!==(t=e.bcId)&&void 0!==t?t:"",name:e.name||"Cloud Agent",repoUrl:null!==(n=e.repoUrl)&&void 0!==n?n:"",branch:null!==(o=e.branchName)&&void 0!==o?o:"",status:null!==(r=e.status)&&void 0!==r?r:a.R6p.UNSPECIFIED,updatedAtMs:y(null!==(i=null!==(s=e.createdAtMs)&&void 0!==s?s:e.updatedAtMs)&&void 0!==i?i:0),isArchived:null!==(l=e.isArchived)&&void 0!==l&&l}})).filter((e=>e.id.length>0&&!e.isArchived));o=r}catch(e){o=[]}let l=[];try{const e=(0,h.r)(),t=(0,r.readdirSync)(e,{withFileTypes:!0}),n=yield Promise.all(t.filter((e=>e.isDirectory())).map((t=>x(void 0,void 0,void 0,(function*(){var n,o;try{const l=(0,s.join)(e,t.name),a=(0,s.join)(l,"store.db");let c=Number.MAX_SAFE_INTEGER;try{const e=(0,r.statSync)(a),t=Math.floor(e.birthtimeMs||e.mtimeMs);t>0&&(c=Math.min(c,t))}catch(e){}try{const e=(0,r.statSync)(l),t=Math.floor(e.birthtimeMs||e.mtimeMs);t>0&&(c=Math.min(c,t))}catch(e){}c===Number.MAX_SAFE_INTEGER&&(c=0);const d=yield g.M.initAndLoad(a),u=null!==(n=d.get("name"))&&void 0!==n?n:(0,i.sh)().name,p=d.get("latestRootBlobId");if(!p||0===p.length)return null;let h=y(null!==(o=d.get("createdAt"))&&void 0!==o?o:0);return h||(h=y(c)),{kind:"chat",id:t.name,name:u,updatedAtMs:h}}catch(e){return null}})))));l=n.filter((e=>null!==e))}catch(e){l=[]}const c=[...o,...l].sort(((e,t)=>(t.updatedAtMs||0)-(e.updatedAtMs||0)));t||E(c),e&&u.xZ&&x(void 0,void 0,void 0,(function*(){try{const e=c.filter((e=>"background"===e.kind));if(0===e.length)return;const n=yield Promise.allSettled(e.map((e=>x(void 0,void 0,void 0,(function*(){const t=yield C(e.id);return{id:e.id,stats:t}})))));if(t)return;const o=new Map;for(const e of n)"fulfilled"===e.status&&o.set(e.value.id,e.value.stats);E((e=>e.map((e=>{if("background"!==e.kind)return e;const t=o.get(e.id);return t?Object.assign(Object.assign({},e),{totalAdded:t.totalAdded,totalRemoved:t.totalRemoved}):e}))))}catch(e){}}))}finally{t||D(!1)}})),()=>{t=!0}}),[e,C]);const J=null!==(j=null!==(v=null==Q?void 0:Q.width)&&void 0!==v?v:null==K?void 0:K.columns)&&void 0!==j?j:80,V=null!==(k=null!==(w=null==Q?void 0:Q.height)&&void 0!==w?w:null==K?void 0:K.rows)&&void 0!==k?k:24,Z=Math.max(1,V-6);return(0,d.useEffect)((()=>{if(0===S.length)return M(0),void A(0);M((e=>Math.max(0,Math.min(e,S.length-1)))),A((e=>{const t=Math.max(0,S.length-Z);return Math.max(0,Math.min(e,t))}))}),[S.length,Z]),(0,d.useEffect)((()=>{$<T?A($):$>=T+Z&&A(Math.max(0,$-Z+1))}),[$,Z,T]),(0,l.Ge)(((i,l)=>{if(L){if(l.downArrow||"j"===i||"J"===i)return void Y((e=>Math.min(1,e+1)));if(l.upArrow||"k"===i||"K"===i)return void Y((e=>Math.max(0,e-1)));if(l.ctrl&&"d"===i)return void t();if(l.escape||l.ctrl&&"c"===i||"n"===i||"N"===i||"q"===i||"Q"===i)return R(!1),X(null),void Y(0);if(l.return||"y"===i||"Y"===i){const t=0===O||"y"===i||"Y"===i,n=G;if(R(!1),X(null),Y(0),t&&n){const{index:t,item:o}=n;if("chat"===o.kind){try{const e=(0,s.join)((0,h.r)(),o.id);(0,r.rmSync)(e,{recursive:!0,force:!0})}catch(e){}E((e=>e.filter(((e,n)=>n!==t))))}else E((e=>e.filter(((e,n)=>n!==t)))),x(void 0,void 0,void 0,(function*(){var t;try{yield null===(t=null==e?void 0:e.archiveBackgroundComposer)||void 0===t?void 0:t.call(e,{bcId:o.id})}catch(e){}}))}return}return}if(l.ctrl&&"d"===i||l.ctrl&&"c"===i||l.escape||"q"===i)return P(""),void t();if(/^[0-9]$/.test(i))return void P((e=>(e+i).replace(/^0+/,"")));if(l.backspace||l.delete){if(_.length>0)return void P((e=>e.slice(0,-1)));if(!(S.length>0)||I)return;const e=S[$];if(!e)return;return Y(0),"chat"===e.kind?(N("Delete session?"),B(`This will permanently remove the local session â€œ${e.name}â€.`),q("Delete"),W("Cancel")):(N("Delete cloud agent?"),B(`This will remove â€œ${e.name}â€ from the list.`),q("Delete"),W("Cancel")),X({index:$,item:e}),void R(!0)}const a=()=>{const e=parseInt(_||"1",10);return Number.isFinite(e)&&e>0?e:1},c=()=>P(""),d=S.length>0&&!I;if(l.upArrow||"k"===i){if(!d)return;const e=a();return c(),void M((t=>Math.max(0,t-e)))}if(l.downArrow||"j"===i){if(!d)return;const e=a();return c(),void M((t=>Math.min(S.length-1,t+e)))}if(l.ctrl&&"f"===i){if(!d)return;const e=a();c();const t=e*Math.max(1,Z-1);return M((e=>Math.min(S.length-1,e+t))),void A((e=>Math.min(Math.max(0,S.length-Z),e+t)))}if(l.ctrl&&"b"===i){if(!d)return;const e=a();c();const t=e*Math.max(1,Z-1);return M((e=>Math.max(0,e-t))),void A((e=>Math.max(0,e-t)))}if("g"===i){if(!d)return;return c(),M(0),void A(0)}if("G"===i){if(!d)return;const e=_.length>0,t=a();if(c(),e){const e=Math.max(0,Math.min(S.length-1,t-1));M(e),A((t=>{const n=Math.max(0,S.length-Z);return Math.max(0,Math.min(n,e-Math.floor(Z/2)))}))}else{const e=Math.max(0,S.length-1);M(e),A(Math.max(0,S.length-Z))}return}const u=l;if(u.pageDown){if(!d)return;const e=a();c();const t=e*Math.max(1,Z-1);return M((e=>Math.min(S.length-1,e+t))),void A((e=>Math.min(Math.max(0,S.length-Z),e+t)))}if(u.pageUp){if(!d)return;const e=a();c();const t=e*Math.max(1,Z-1);return M((e=>Math.max(0,e-t))),void A((e=>Math.max(0,e-t)))}if(l.return){c();const e=S[$];if(!e)return;"chat"===e.kind?null==n||n(e.id):null==o||o(e.id)}})),(0,d.useEffect)((()=>{var e,t,n,o,r,s;if(!K)return;const i=e=>(0,m.aJ)(e).length,l=(e,t)=>{const n=e.trim();return t<=0?"":n.length<=t?n:t<=3?n.slice(0,t):`${n.slice(0,Math.max(0,t-3))}...`},d=e=>{const t="string"==typeof e?e:"",n=t.indexOf("\n");return-1===n?t.replace(/\r/g,""):t.slice(0,n).replace(/\r/g,"")};if(L){const e=z,t=F,n=[{label:U,hint:"y"},{label:H,hint:"esc/n"}],o=Math.max(28,Math.min(60,J-12)),r=Math.max(8,o-4),s=e=>{const t=(null!=e?e:"").trim();return i(t)<=r?t:`${(0,m.aJ)(t).slice(0,Math.max(0,r-3))}...`},l=s(e),a=t?s(t):void 0,d=n.map(((e,t)=>{const n=t===O,o=n?c.Ay.white("â†’"):c.Ay.gray(" "),s=Math.max(0,r-2),i=`${e.label}${e.hint?` ${e.hint}`:""}`,l=(0,m.aJ)(i),a=l.length>s?`${l.slice(0,Math.max(0,s-3))}...`:l,d=e.label.length,u=a.slice(0,Math.min(d,a.length)),p=a.slice(u.length);return`${o} ${n?c.Ay.white.bold(u):c.Ay.gray(u)}${p.length>0?n?c.Ay.white.dim(p):c.Ay.gray(p):""}`})),u=[c.Ay.white.bold(l),...a?[c.Ay.gray(a)]:[],...d],p=c.Ay.gray.dim,h=2+u.length,g=4+Math.max(0,Math.floor((Z-h)/2)),f=Math.max(1,Math.floor((J-o)/2)+1),v=`${p("â”Œ")}${p("â”€".repeat(o-2))}${p("â”")}`;K.write(`[${g};${f}H${v}`);for(let e=0;e<u.length;e++){const t=g+1+e,n=u[e];K.write(`[${t};${f}H${p("â”‚")}`),K.write(" ");const s=i((0,m.aJ)(n)),l=Math.max(0,r-s);K.write(`${n}${" ".repeat(l)}`),K.write(" ");const a=f+o-1;K.write(`[${t};${a}H${p("â”‚")}`)}const x=`${p("â””")}${p("â”€".repeat(o-2))}${p("â”˜")}`;return void K.write(`[${g+h-1};${f}H${x}`)}const u=Math.max(0,Math.floor((J-25)/2)),p="â”€".repeat(J);if(K.write(`[1;1H[2K${c.Ay.gray(p)}`),K.write(`[2;1H[2K${" ".repeat(u)}${c.Ay.bold("Sessions and Cloud Agents")}`),K.write(`[3;1H[2K${c.Ay.gray(p)}`),I){const e=Math.floor(V/2),t="Loading sessions and cloud agents...",n="Press Ctrl-D, q or ESC to cancel";K.write(`[${e};1H[2K${" ".repeat(Math.max(0,Math.floor((J-t.length)/2)))}${c.Ay.gray(t)}`),K.write(`[${e+2};1H[2K${" ".repeat(Math.max(0,Math.floor((J-n.length)/2)))}${c.Ay.gray(n)}`);for(let t=4;t<=V-2;t++)t!==e&&t!==e+2&&K.write(`[${t};1H[2K`)}else if(0===S.length){const e=Math.floor(V/2),t="No sessions or cloud agents found.",n="Press Ctrl-D, q or ESC to go back";K.write(`[${e};1H[2K${" ".repeat(Math.max(0,Math.floor((J-t.length)/2)))}${c.Ay.gray(t)}`),K.write(`[${e+2};1H[2K${" ".repeat(Math.max(0,Math.floor((J-n.length)/2)))}${c.Ay.gray(n)}`);for(let t=4;t<=V-2;t++)t!==e&&t!==e+2&&K.write(`[${t};1H[2K`)}else{const u=T,p=Math.min(S.length,u+Z),h=S.slice(u,p);let g=null,m=null;if(L){Math.max(30,Math.min(72,J-8));const e=2+(F?1:0)+2;g=4+Math.max(0,Math.floor((Z-e)/2)),m=g+e-1}for(let p=0;p<Z;p++){const f=p+4;if(L&&null!==g&&null!==m&&f>=g&&f<=m)continue;const v=h[p];if(!v){K.write(`[${f};1H[2K`);continue}const x=u+p===$,b=new Date(Math.max(0,v.updatedAtMs||0)),y=new Date,j=Math.floor((Date.UTC(y.getFullYear(),y.getMonth(),y.getDate())-Date.UTC(b.getFullYear(),b.getMonth(),b.getDate()))/864e5),w=b.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let k;k=j<=0?`Today ${w}`:1===j?`Yesterday ${w}`:j<7?`${j} days ago`:`${b.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})} ${w}`;const C=x?"  â–¶ ":"    ",S="background"===v.kind?"â¬¢ ":"  ",E=i(S),M=e=>{switch(e){case a.R6p.ERROR:return c.Ay.red("â¬¢ ");case a.R6p.FINISHED:return c.Ay.green("â¬¢ ");case a.R6p.RUNNING:case a.R6p.CREATING:return c.Ay.yellow("â¬¢ ");default:return c.Ay.gray("â¬¢ ")}},T="background"===v.kind?M(v.status):S,A=x?c.Ay.white(k):c.Ay.gray(k),I=(e,t)=>(t||"").trim(),D="background"===v.kind?I(v.repoUrl,v.branch):"",_=C.length,P=C.length+E,R=P+1+k.length+_,O=Math.max(1,J-R),Y=d(v.name).trim();if("background"===v.kind){const a=D?" ":"",d=i(a),u=D?x?c.Ay.white(a):c.Ay.gray(a):"",p=v,h="number"==typeof p.totalAdded&&"number"==typeof p.totalRemoved&&((null!==(e=p.totalAdded)&&void 0!==e?e:0)>0||(null!==(t=p.totalRemoved)&&void 0!==t?t:0)>0),g=h?`  +${Math.max(0,null!==(n=p.totalAdded)&&void 0!==n?n:0)} -${Math.max(0,null!==(o=p.totalRemoved)&&void 0!==o?o:0)}`:"",m=i(g),b=Math.min(24,Math.max(10,Math.floor(.35*O))),y=Math.min(22,Math.max(8,Math.floor(.25*O))),j=Math.max(1,O-m);let w=Math.floor(.6*j),S=j-w-d;if(S<y){const e=y-S;w=Math.max(b,w-e),S=j-w-d}if(w<b){const e=b-w;S=Math.max(y,S-e),w=j-S-d}w=Math.max(1,w),S=Math.max(0,S);const E=l(Y,w),$=l(D,S),M=x?c.Ay.bold(c.Ay.white(E)):c.Ay.white(E),I=x?c.Ay.white($):c.Ay.gray($),L=$?`${M}${u}${I}`:`${M}`,R=`+${Math.max(0,null!==(r=p.totalAdded)&&void 0!==r?r:0)}`,z=`-${Math.max(0,null!==(s=p.totalRemoved)&&void 0!==s?s:0)}`,N=`  ${c.Ay.green(R)} ${c.Ay.red(z)}`,F=h?x?N:c.Ay.dim(N):"",B=Math.max(0,J-_-P-i(L+g)-1-k.length),U=`${C}${T}${L}${F}${" ".repeat(B)} ${A}${" ".repeat(_)}`;K.write(`[${f};1H[2K${U}`)}else{const e=l(Y,O),t=x?c.Ay.bold(c.Ay.white(e)):c.Ay.white(e),n=Math.max(0,J-_-P-i(t)-1-k.length),o=`${C}${T}${t}${" ".repeat(n)} ${A}${" ".repeat(_)}`;K.write(`[${f};1H[2K${o}`)}}}const h=V-1,g=V,f="â”€".repeat(J);if(K.write(`[${h};1H[2K${c.Ay.gray(f)}`),S.length>0){const e=`${Math.min($+1,S.length)}/${S.length}`,t="â†‘â†“/jk: navigate â€¢ Enter: select â€¢ Backspace: delete â€¢ Ctrl-D/q/ESC: back",n=`${c.Ay.bold(e)} ${c.Ay.gray("â€¢")} ${c.Ay.gray(t)}`,o=Math.max(0,Math.floor((J-(e.length+3+t.length))/2));K.write(`[${g};1H[2K${" ".repeat(o)}${n}`)}else{const e="Ctrl-D/q/ESC: back",t=Math.max(0,Math.floor((J-e.length)/2));K.write(`[${g};1H[2K${" ".repeat(t)}${c.Ay.gray(e)}`)}if(L){const e=z,t=F,n=[{label:U,hint:"y"},{label:H,hint:"esc/n"}],o=Math.max(30,Math.min(72,J-8)),r=Math.max(10,o-2),s=e=>{const t=(null!=e?e:"").trim();return i(t)<=r-2?t:`${(0,m.aJ)(t).slice(0,Math.max(0,r-5))}...`},l=s(e),a=t?s(t):void 0,d=n.map(((e,t)=>{const n=t===O,o=n?"â†’ ":"  ",s=e.hint?` ${c.Ay.gray(e.hint)}`:"",l=e.label,a=`${o}${l}${(0,m.aJ)(s)?` ${e.hint}`:""}`,d=(0,m.aJ)(a).length>r-2?`${(0,m.aJ)(a).slice(0,Math.max(0,r-5))}...`:a,u=n?`${c.Ay.white("â†’ ")}${c.Ay.black.bgYellow(l)}`+(e.hint?` ${c.Ay.gray(e.hint)}`:""):`  ${c.Ay.white(l)}`+(e.hint?` ${c.Ay.gray(e.hint)}`:"");return i(u)>r-2?(0,m.aJ)(d):u})),u=[c.Ay.white(l),...a?[c.Ay.gray(a)]:[],...d],p=c.Ay.yellow,h=2+u.length,g=4+Math.max(0,Math.floor((Z-h)/2)),f=Math.max(1,Math.floor((J-o)/2)+1),v=`${p("â”Œ")}${p("â”€".repeat(o-2))}${p("â”")}`;K.write(`[${g};${f}H${v}`);for(let e=0;e<u.length;e++){const t=g+1+e,n=u[e];K.write(`[${t};${f}H${p("â”‚")}`),K.write(` ${n}`);const r=f+o-1;K.write(`[${t};${r}H${p("â”‚")}`)}const x=`${p("â””")}${p("â”€".repeat(o-2))}${p("â”˜")}`;K.write(`[${g+h-1};${f}H${x}`)}}),[K,S,$,T,Z,J,V,I,L,O,z,F,U,H]),null};o()}catch(e){o(e)}}))},"./src/components/update-todos-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{v:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/todos-ui.tsx"),l=e([s,i]);[s,i]=l.then?(await l)():l;const a=({tool:e,aborted:t})=>{if(t)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.az,{paddingLeft:1,children:(0,r.jsxs)(s.EY,{color:"foreground",children:[(0,r.jsx)(s.EY,{bold:!0,children:"Update to-dos"})," ",(0,r.jsx)(s.EY,{color:"gray",children:"Aborted"})]})})});if(!e.result)return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(i.S,{todos:[],mode:"update",loading:!0})});const n=e.result.result;switch(null==n?void 0:n.case){case"success":return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(i.S,{todos:n.value.todos,totalCount:n.value.totalCount,mode:"update",showHeader:!0})});case"error":return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(s.EY,{color:"gray",children:n.value.error})});default:return(0,r.jsx)(s.az,{flexDirection:"column",paddingRight:2,children:(0,r.jsx)(i.S,{todos:[],mode:"update"})})}};o()}catch(e){o(e)}}))},"./src/components/usage-pager.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{z:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=({dailyMetrics:e,onClose:t})=>{var n,o,l;(0,i.useEffect)((()=>{var e;const t=process.stdin,n=t.isRaw;try{null===(e=t.setRawMode)||void 0===e||e.call(t,!0)}catch(e){}return()=>{var e;try{n||null===(e=t.setRawMode)||void 0===e||e.call(t,!1)}catch(e){}}}),[]),(0,s.Ge)(((e,n)=>{(n.escape||"q"===e||n.ctrl&&"c"===e)&&t()}));const a=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,c=new Map,d=[];let u=0;for(const t of e){const e=a(new Date(t.date));if(e){const o=t.agentLines+t.tabLines,r=null!==(n=c.get(e))&&void 0!==n?n:0;c.set(e,r+o),u+=o,o>0&&!d.includes(e)&&d.push(e)}}const p=(e,t)=>(e=>{const[t,n,o]=e.split("-").map(Number),r=new Date(t,n-1,o);return r.setDate(r.getDate()+1),a(r)})(e)===t,h=(e=>{if(0===e.length)return{longest:0,current:0};const t=[...new Set(e)].sort();let n=1,o=1;for(let e=1;e<t.length;e++){const r=t[e-1],s=t[e];p(r,s)?(o++,o>n&&(n=o)):o=1}const r=new Date;r.setHours(0,0,0,0);const s=new Date(r);s.setDate(s.getDate()-1);const i=a(r),l=a(s);let c=0;if(t.length>0){const e=t[t.length-1];if(e===i||e===l){c=1;for(let e=t.length-2;e>=0;e--){const n=t[e],o=t[e+1];if(!p(n,o))break;c++}}}return{longest:n,current:c}})(d),g=new Date;g.setHours(0,0,0,0);const m=new Date(g);m.setDate(1),m.setMonth(m.getMonth()-11);const f=new Date(m);f.setDate(f.getDate()-f.getDay());const v=new Date(g);6!==v.getDay()&&v.setDate(v.getDate()+(6-v.getDay()));const x=[],b=new Date(f);let y=[null,null,null,null,null,null,null];for(;b<=v;){const e=a(b),t=b>g?0:null!==(o=c.get(e))&&void 0!==o?o:0,n=b.getDay();y[n]={date:new Date(b),value:t},6===n&&(x.push(y),y=[null,null,null,null,null,null,null]),b.setDate(b.getDate()+1)}y.some((e=>null!==e))&&x.push(y);let j=1;for(const e of x)for(const t of e)t&&t.value>j&&(j=t.value);const w=["J","F","M","A","M","J","J","A","S","O","N","D"],k=new Array(x.length).fill("");for(let e=0;e<x.length;e++){const t=x[e];if(t)for(const n of t)if(n&&1===n.date.getDate()){k[e]=null!==(l=w[n.date.getMonth()])&&void 0!==l?l:"";break}}return(0,r.jsxs)(s.az,{flexDirection:"column",padding:1,children:[(0,r.jsxs)(s.az,{marginBottom:1,children:[(0,r.jsx)(s.EY,{bold:!0,color:"cyan",children:"Agent Edits"}),(0,r.jsx)(s.EY,{color:"gray",children:"   (Esc to close)"})]}),(0,r.jsx)(s.az,{marginBottom:1,children:(0,r.jsx)(s.EY,{color:"gray",children:"â”€".repeat(60)})}),(0,r.jsxs)(s.az,{flexDirection:"column",children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Accepted lines (last 12 months)"}),(0,r.jsx)(s.EY,{bold:!0,color:"cyan",children:(C=u,C.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"  "}),k.map(((e,t)=>(0,r.jsx)(s.EY,{dimColor:!0,children:e?e.padEnd(2):"  "},`month-${t}`)))]}),["","M","","W","","F",""].map(((e,t)=>(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:`${e||" "} `}),x.map(((e,n)=>{const o=e[t],i=o?o.date.toISOString():`empty-${n}`;if(o){const e=(e=>{if(0===e)return{char:"Â·",color:"gray"};const t=e/j;return t>.75?{char:"â–ˆ",color:"green"}:t>.5?{char:"â–“",color:"green"}:t>.25?{char:"â–’",color:"green"}:{char:"â–‘",color:"green"}})(o.value);return(0,r.jsx)(s.EY,{color:e.color,dimColor:0===o.value,children:`${e.char} `},i)}return(0,r.jsx)(s.EY,{dimColor:!0,children:"  "},i)}))]},`day-${t}`))),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Current streak: "}),(0,r.jsxs)(s.EY,{color:h.current>0?"green":"gray",children:[h.current," day",1!==h.current?"s":""]}),(0,r.jsx)(s.EY,{dimColor:!0,children:"   "}),(0,r.jsx)(s.EY,{dimColor:!0,children:"Longest streak: "}),(0,r.jsxs)(s.EY,{color:"cyan",children:[h.longest," day",1!==h.longest?"s":""]})]}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"Less "}),(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"Â·"}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"green",children:"â–‘"}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"green",children:"â–’"}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"green",children:"â–“"}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{color:"green",children:"â–ˆ"}),(0,r.jsx)(s.EY,{dimColor:!0,children:" More"})]})]}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsx)(s.EY,{children:" "}),(0,r.jsxs)(s.az,{children:[(0,r.jsx)(s.EY,{dimColor:!0,children:"View more at "}),(0,r.jsx)(s.EY,{color:"blue",children:"https://cursor.com/dashboard?tab=analytics"})]})]});var C};o()}catch(e){o(e)}}))},"./src/components/user-message-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{H:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/hooks/use-screen-size.ts"),a=n("./src/utils/text-wrapping.ts"),c=e([s,l]);[s,l]=c.then?(await c)():c;const d=({content:e,overrideBorderColor:t})=>{const n=(0,l.l)(),o=Math.max(1,n.width-10),c=(0,a.F)(e,i.p9,o);return(0,r.jsx)(s.az,{borderStyle:"single",borderColor:null!=t?t:"foreground",borderDimColor:!0,paddingLeft:1,paddingRight:5,marginX:1,width:n.width-2,children:(0,r.jsx)(s.EY,{color:"foreground",wrap:"wrap",children:c})})};o()}catch(e){o(e)}}))},"./src/components/web-fetch-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{n:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;const a=null!==(n=e.url)&&void 0!==n?n:"";let c,d,u="pending";switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:u="pending";break;case"error":u="error",c=(null==t?void 0:t.result.value.error)||"Unknown error";break;case"success":u="success";break;case"rejected":u="rejected",d=(null==t?void 0:t.result.value.reason)||"Web fetch rejected";break;default:u="pending"}return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"WebFetch",primary:a,status:u,note:d}),c&&(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",c]})})]})};o()}catch(e){o(e)}}))},"./src/components/web-search-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{F:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=({tool:{args:e,result:t}})=>{var n,o,a,c;if(!e)return null;const d=null!==(n=e.searchTerm)&&void 0!==n?n:"";let u,p,h,g="pending";switch(null===(o=null==t?void 0:t.result)||void 0===o?void 0:o.case){case void 0:g="pending";break;case"error":g="error",p=(null==t?void 0:t.result.value.error)||"Unknown error";break;case"success":g="success",h=null!==(c=null===(a=null==t?void 0:t.result.value.references)||void 0===a?void 0:a.length)&&void 0!==c?c:0;break;case"rejected":g="rejected",u=(null==t?void 0:t.result.value.reason)||"Web search rejected";break;default:g="pending"}return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:"WebSearch",primary:d,status:g,note:u}),p&&(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,children:(0,r.jsxs)(s.EY,{color:"red",children:["Error: ",p]})}),"success"===g&&void 0!==h&&(0,r.jsx)(s.az,{marginLeft:i.SK,marginTop:1,children:(0,r.jsxs)(s.EY,{dimColor:!0,children:["Found ",h," reference",1!==h?"s":""]})})]})};o()}catch(e){o(e)}}))},"./src/components/write-shell-stdin-tool-ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>d});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/constants.ts"),l=n("./src/components/tool-call-header.tsx"),a=e([s,l]);[s,l]=a.then?(await a)():a;const c=String.fromCharCode(4),d=({tool:{args:e,result:t}})=>{var n,o;if(!e)return null;const a=`shell ${e.shellId}`,d=function(e,t=50){const n=e.split(c).join("<EOF>").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t");return n.length>t?`${n.slice(0,t-3)}...`:n}(e.chars);let u,p="pending";const h=null==t?void 0:t.result,g=null==h?void 0:h.case;switch(g){case void 0:p="pending";break;case"success":p="success";break;case"error":p="error",u=String(null!==(o=null===(n=null==h?void 0:h.value)||void 0===n?void 0:n.error)&&void 0!==o?o:"")||"Write failed";break;default:p="pending"}const m=(0,i.F_)("writeShellStdinToolCall","success"===p)||("success"===p?"Wrote to stdin":"Writing to stdin");return(0,r.jsxs)(s.az,{flexDirection:"column",paddingRight:2,children:[(0,r.jsx)(l.C,{name:m,primary:a,status:p}),(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"gray",children:d?`"${d}"`:"(empty)"})}),"error"===g&&u&&(0,r.jsx)(s.az,{marginLeft:i.SK,children:(0,r.jsx)(s.EY,{color:"red",children:u})})]})};o()}catch(e){o(e)}}))},"./src/context/agent-state-context.tsx":(e,t,n)=>{n.d(t,{C9:()=>a,oG:()=>l,tO:()=>c});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),s=n("./src/analytics.ts");const i=(0,r.createContext)(null),l=({children:e,fileChangeTracker:t,pendingDecisionStore:n,configProvider:l,initialViewMode:a="chat",initialInputValue:c="",initialIsCompact:d=!0,initialAgentStore:u,modelManager:p})=>{const[h,g]=(0,r.useState)((()=>t.getChanges())),[m,f]=(0,r.useState)(a),[v,x]=(0,r.useState)(p.getCurrentModel()),[b,y]=(0,r.useState)(c),[j,w]=(0,r.useState)(n.getPendingDecisions()),[k,C]=(0,r.useState)([]),[S,E]=(0,r.useState)(0),[$,M]=(0,r.useState)(u),[T,A]=(0,r.useState)(!1),[I,D]=(0,r.useState)(!1),[_,P]=(0,r.useState)(d),[L,R]=(0,r.useState)((()=>$.getMetadata("mode"))),[O,Y]=(0,r.useState)(null),[z,N]=(0,r.useState)(null),[F,B]=(0,r.useState)(null),U=(0,r.useCallback)((e=>{return t=void 0,n=void 0,r=function*(){l?yield p.setCurrentModel(e,l):p.setCurrentModelWithoutPersistence(e),(0,s.sx)("cli.model.select",{model:e.modelId})},new((o=void 0)||(o=Promise))((function(e,s){function i(e){try{a(r.next(e))}catch(e){s(e)}}function l(e){try{a(r.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,l)}a((r=r.apply(t,n||[])).next())}));var t,n,o,r}),[l,p]);(0,r.useEffect)((()=>{const e=t.subscribe((()=>{g(t.getChanges())}));return g(t.getChanges()),e}),[t]),(0,r.useEffect)((()=>{const e=n.subscribe((e=>{w(e)}));return w(n.getPendingDecisions()),e}),[n]),(0,r.useEffect)((()=>{const e=$.subscribeToMetadata("mode",(e=>{R(e)}));return R($.getMetadata("mode")),e}),[$]),(0,r.useEffect)((()=>{const e=()=>{const e=$.getConversationStateStructure(),t=null==e?void 0:e.tokenDetails,n="number"==typeof(null==t?void 0:t.usedTokens)&&Number.isFinite(t.usedTokens)?t.usedTokens:null,o="number"==typeof(null==t?void 0:t.maxTokens)&&Number.isFinite(t.maxTokens)?t.maxTokens:null;if(Y(n),N(o),null!=n&&null!=o&&o>0){const e=Math.max(0,Math.min(100,Math.round(n/o*100*10)/10));B(e)}else B(null)},t=[];return t.push($.subscribeToMetadata("latestRootBlobId",(()=>{e()}))),e(),()=>{for(const e of t)try{e()}catch(e){}}}),[$]),(0,r.useEffect)((()=>p.subscribe((e=>{x(e)}))),[p]);const q=(0,r.useCallback)((e=>{n.approveDecision(e)}),[n]),H=(0,r.useCallback)(((e,t)=>{n.rejectDecision(e,t)}),[n]),W=(0,r.useCallback)((e=>n.requestApproval(e)),[n]);return(0,o.jsx)(i.Provider,{value:{changedFiles:h,viewMode:m,setViewMode:f,mode:L,currentModel:v,setCurrentModel:U,inputValue:b,setInputValue:y,pendingDecisions:j,approvePendingDecision:q,rejectPendingDecision:H,requestApproval:W,queuedMessages:k,setQueuedMessages:C,reviewSelectedIndex:S,setReviewSelectedIndex:E,agentStore:$,setAgentStore:M,modelManager:p,isGenerating:T,setIsGenerating:A,isSummarizing:I,setIsSummarizing:D,isCompact:_,setIsCompact:P,conversationTokensUsed:O,conversationMaxTokens:z,conversationTokenPercent:F},children:e})},a=()=>{const e=(0,r.useContext)(i);if(!e)throw new Error("useAgentState must be used within an AgentStateProvider");return e},c=()=>a().isCompact},"./src/context/config-context.tsx":(e,t,n)=>{n.d(t,{$i:()=>l,t1:()=>i});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const s=(0,r.createContext)(void 0),i=({children:e,configProvider:t})=>{const n=t.get();return(0,o.jsx)(s.Provider,{value:{config:n,configProvider:t},children:e})},l=()=>{var e,t;const{config:n}=(()=>{const e=(0,r.useContext)(s);if(void 0===e)throw new Error("useConfig must be used within a ConfigContextProvider");return e})();return null!==(t=null===(e=n.display)||void 0===e?void 0:e.showLineNumbers)&&void 0!==t&&t}},"./src/context/slash-command-context.tsx":(e,t,n)=>{n.d(t,{E:()=>i,x:()=>l});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const s=(0,r.createContext)(null),i=({children:e})=>{const[t,n]=(0,r.useState)([]),i=(0,r.useCallback)((e=>{n((t=>[...t.filter((t=>t.id!==e.id)),e]))}),[]),l=(0,r.useCallback)((e=>{n((t=>t.filter((t=>t.id!==e))))}),[]);return(0,o.jsx)(s.Provider,{value:{dynamicCommands:t,registerCommand:i,unregisterCommand:l},children:e})},l=()=>{const e=(0,r.useContext)(s);if(!e)throw new Error("useSlashCommandRegistry must be used within SlashCommandProvider");return e}},"./src/context/sudo-password-context.tsx":(e,t,n)=>{n.d(t,{S:()=>i,h:()=>l});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const s=(0,r.createContext)(null);function i({store:e,children:t}){return(0,o.jsx)(s.Provider,{value:e,children:t})}function l(){return(0,r.useContext)(s)}},"./src/context/terminal-state-context.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{PH:()=>u,rs:()=>c});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);s=(l.then?(await l)():l)[0];const a=(0,i.createContext)(null),c=({children:e})=>{const[t,n]=(0,i.useState)(0),[o,l]=(0,i.useState)(0),[c,d]=(0,i.useState)(0),[u,p]=(0,i.useState)(null),h=(0,s.t$)().stdout,g=(0,i.useRef)(null),m=(0,i.useRef)(null),f=(0,i.useCallback)((e=>{n((e=>e+1)),e&&p(e)}),[]),v=(0,i.useCallback)((e=>{l((e=>e+1))}),[]),x=(0,i.useCallback)((e=>{d((e=>e+1))}),[]);return(0,i.useEffect)((()=>{const e=h;if(!e)return;const t=()=>{const t=e.columns,n=e.rows;null===g.current&&(g.current=t),null===m.current&&(m.current=n);const o=t!==g.current,r=n!==m.current;o&&(g.current=t,v()),r&&(m.current=n,x()),(o||r)&&f()};return e.on("resize",t),t(),()=>{e.off("resize",t)}}),[h,v,x,f]),(0,r.jsx)(a.Provider,{value:{terminalEpoch:t,widthEpoch:o,heightEpoch:c,lastReason:u,bumpTerminalEpoch:f,bumpWidthEpoch:v,bumpHeightEpoch:x},children:e})},d=()=>{const e=(0,i.useContext)(a);if(!e)throw new Error("useTerminalState must be used within a TerminalStateProvider");return e},u=()=>d().widthEpoch;o()}catch(e){o(e)}}))},"./src/conversation/dynamic-item.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{C:()=>b});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/components/create-plan-tool-ui.tsx"),a=n("./src/components/index.ts"),c=n("./src/components/markdown.tsx"),d=n("./src/components/merged-read-search-tool-ui.tsx"),u=n("./src/components/plan-execution-message.tsx"),p=n("./src/components/running-agents-ui.tsx"),h=n("./src/components/shell-turn-ui.tsx"),g=n("./src/conversation/tool-call.tsx"),m=e([s,l,a,c,d,u,p,h,g]);[s,l,a,c,d,u,p,h,g]=m.then?(await m)():m;const f=200,v=({content:e})=>{const[t,n]=(0,i.useState)(e),o=(0,i.useRef)(null),s=(0,i.useRef)(0),l=(0,i.useRef)(!0),a=(0,i.useMemo)((()=>t.split("\n\n").length),[t]),d=(0,i.useMemo)((()=>e.split("\n\n").length),[e]);return(0,i.useEffect)((()=>{if(o.current&&clearTimeout(o.current),l.current||a<d)return n(e),s.current=performance.now(),void(l.current=!1);const t=performance.now(),r=t-s.current;if(r>=f)return n(e),void(s.current=t);const i=f-r;return o.current=setTimeout((()=>{n(e),s.current=performance.now()}),i),()=>{o.current&&clearTimeout(o.current)}}),[e,a,d]),(0,r.jsx)(c.Ay,{content:t})},x=!1,b=({item:e,options:t})=>{if(x)return(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(s.EY,{color:"red",children:JSON.stringify(e,null,2)})});if("agent-text"===e.type){const t=e.completed?e.text:e.text.includes("\n")?e.text.slice(0,e.text.lastIndexOf("\n")):e.text;return(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(v,{content:t})})}return"plan-execution"===e.type?(0,r.jsx)(u.p,{content:e.message}):"user-message"===e.type?t.hideUserMessages?null:(0,r.jsx)(a.Hw,{content:e.message}):"agent-tool-calls"===e.type?e.calls.every((e=>"taskToolCall"===e.call.tool.case))&&e.calls.length>0?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(p.q,{agents:e.calls.map((e=>{var t;const n="task"===(null===(t=e.additionalData)||void 0===t?void 0:t.type)?e.additionalData:void 0;return(0,p.e)(e.id,e.call.tool.value,n,{completed:e.completed,aborted:e.aborted})}))})}):e.calls.length>1?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(d.r,{tools:e.calls})}):(0,r.jsx)(s.az,{flexDirection:"column",children:e.calls.map((n=>(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(g.S,{call:n,options:t,isLastStepOfTurn:e.isLastStepOfTurn,isLastTurn:e.isLastTurn})},n.id)))}):"plan"===e.type?"createPlanToolCall"!==e.call.tool.case?null:(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(l.U,{tool:e.call.tool.value,isSuggestingPlan:!0,planDecisionIndex:e.decisionIndex,state:"pending"})}):"shell-turn"===e.type?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(h.o,{command:e.command,output:e.stdout,exitCode:e.exitCode})}):null};o()}catch(e){o(e)}}))},"./src/conversation/static-item.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{j:()=>x});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/app-header.tsx"),l=n("./src/components/create-plan-tool-ui.tsx"),a=n("./src/components/markdown.tsx"),c=n("./src/components/merged-read-search-tool-ui.tsx"),d=n("./src/components/plan-execution-message.tsx"),u=n("./src/components/running-agents-ui.tsx"),p=n("./src/components/shell-turn-ui.tsx"),h=n("./src/components/summary.tsx"),g=n("./src/components/user-message-ui.tsx"),m=n("./src/conversation/tool-call.tsx"),f=e([s,i,l,a,c,d,u,p,h,g,m]);[s,i,l,a,c,d,u,p,h,g,m]=f.then?(await f)():f;const v=!1,x=({item:e,options:t})=>v?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(s.EY,{children:JSON.stringify(e,null,2)})}):"summary"===e.type?(0,r.jsx)(h.B,{summary:e.summary}):"agent-text"===e.type?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(a.Ay,{content:e.text})}):"debug-info"===e.type?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsxs)(s.EY,{children:["Debug info: ",e.serverUrl]})}):"header"===e.type?(0,r.jsx)(i.j,{isRepository:e.isRepository,folderMode:e.folderMode}):"plan-execution"===e.type?(0,r.jsx)(d.p,{content:e.message}):"user-message"===e.type?t.hideUserMessages?null:(0,r.jsx)(g.H,{content:e.message}):"agent-tool-calls"===e.type?e.calls.every((e=>"taskToolCall"===e.call.tool.case))&&e.calls.length>0?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(u.q,{agents:e.calls.map((e=>{var t;const n="task"===(null===(t=e.additionalData)||void 0===t?void 0:t.type)?e.additionalData:void 0;return(0,u.e)(e.id,e.call.tool.value,n,{completed:e.completed,aborted:e.aborted})}))})}):e.calls.length>1?(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(c.r,{tools:e.calls})}):(0,r.jsx)(s.az,{flexDirection:"column",children:e.calls.map((n=>(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(m.S,{call:n,options:t,isLastStepOfTurn:!1,isLastTurn:e.isLastTurn})},n.id)))}):"plan"===e.type?"createPlanToolCall"!==e.call.tool.case?null:(0,r.jsx)(s.az,{paddingX:1,children:(0,r.jsx)(l.U,{tool:e.call.tool.value,isSuggestingPlan:!1,planDecisionIndex:e.decisionIndex,state:0===e.decisionIndex?"accepted":"rejected"})}):"shell-turn"===e.type?(0,r.jsx)(s.az,{paddingX:2,children:(0,r.jsx)(p.o,{command:e.command,output:e.stdout,exitCode:e.exitCode})}):null;o()}catch(e){o(e)}}))},"./src/conversation/tool-call.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{S:()=>M});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("./src/components/ask-question-tool-ui.tsx"),l=n("./src/components/create-plan-tool-ui.tsx"),a=n("./src/components/delete-tool-ui.tsx"),c=n("./src/components/edit-tool-ui.tsx"),d=n("./src/components/fetch-mcp-resource-tool-ui.tsx"),u=n("./src/components/glob-tool-ui.tsx"),p=n("./src/components/grep-tool-ui.tsx"),h=n("./src/components/list-mcp-resources-tool-ui.tsx"),g=n("./src/components/ls-tool-ui.tsx"),m=n("./src/components/mcp-tool-ui.tsx"),f=n("./src/components/read-lints-tool-ui.tsx"),v=n("./src/components/read-todos-tool-ui.tsx"),x=n("./src/components/read-tool-ui.tsx"),b=n("./src/components/sem-search-tool-ui.tsx"),y=n("./src/components/shell-tool-ui.tsx"),j=n("./src/components/switch-mode-tool-ui.tsx"),w=n("./src/components/task-tool-ui.tsx"),k=n("./src/components/update-todos-tool-ui.tsx"),C=n("./src/components/web-fetch-tool-ui.tsx"),S=n("./src/components/web-search-tool-ui.tsx"),E=n("./src/components/write-shell-stdin-tool-ui.tsx"),$=e([s,i,l,a,c,d,u,p,h,g,m,f,v,x,b,y,j,w,k,C,S,E]);[s,i,l,a,c,d,u,p,h,g,m,f,v,x,b,y,j,w,k,C,S,E]=$.then?(await $)():$;const M=({call:{call:e,aborted:t,additionalData:n},isLastStepOfTurn:o,isLastTurn:$,options:{isCompact:M,isSuggestingPlan:T,isGenerating:A,planDecisionIndex:I,shellManager:D}})=>{switch(e.tool.case){case"shellToolCall":{const n=!M&&!!$;return(0,r.jsx)(y.f,{tool:e.tool.value,expand:n,aborted:t,shellManager:D})}case"deleteToolCall":return(0,r.jsx)(a.Y,{tool:e.tool.value});case"grepToolCall":return(0,r.jsx)(p.h,{tool:e.tool.value});case"semSearchToolCall":return(0,r.jsx)(b.S,{tool:e.tool.value});case"globToolCall":return(0,r.jsx)(u.P,{tool:e.tool.value});case"editToolCall":return(0,r.jsx)(c.N,{tool:e.tool.value,aborted:t});case"readToolCall":return(0,r.jsx)(x.B,{tool:e.tool.value});case"readLintsToolCall":return(0,r.jsx)(f.A,{tool:e.tool.value});case"updateTodosToolCall":return(0,r.jsx)(k.v,{tool:e.tool.value,aborted:t});case"readTodosToolCall":return(0,r.jsx)(v.w,{tool:e.tool.value,aborted:t});case"lsToolCall":return(0,r.jsx)(g.U,{tool:e.tool.value});case"mcpToolCall":return(0,r.jsx)(m.v,{tool:e.tool.value});case"listMcpResourcesToolCall":return(0,r.jsx)(h.A,{tool:e.tool.value});case"readMcpResourceToolCall":return(0,r.jsx)(d.J,{tool:e.tool.value});case"webSearchToolCall":return(0,r.jsx)(S.F,{tool:e.tool.value});case"webFetchToolCall":return(0,r.jsx)(C.n,{tool:e.tool.value});case"taskToolCall":{const o="task"===(null==n?void 0:n.type)?n:void 0;return(0,r.jsx)(w.K,{tool:e.tool.value,aborted:t,additionalData:o})}case"writeShellStdinToolCall":return(0,r.jsx)(E.S,{tool:e.tool.value});case"askQuestionToolCall":return(0,r.jsx)(i.S,{tool:e.tool.value});case"switchModeToolCall":return(0,r.jsx)(j.U,{tool:e.tool.value});case"createPlanToolCall":{const t=o&&$?T?"pending":A?"accepted":"rejected":o?"rejected":"accepted",n=T||!M&&!!$;return(0,r.jsx)(l.U,{tool:e.tool.value,isSuggestingPlan:T,planDecisionIndex:I,state:t,expand:n})}default:return(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{color:"red",children:["Unknown tool type: ",JSON.stringify(e.tool.case)]})})}};o()}catch(e){o(e)}}))},"./src/execution-mode/approval.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{K:()=>l});var r=n("./src/components/approval-dialog.tsx"),s=e([r]);r=(s.then?(await s)():s)[0];var i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function l(e){return i(this,void 0,void 0,(function*(){if(!0!==e.get().showSandboxIntro)return!1;const t=yield(0,r.b)({title:"Command Execution",description:["Cursor can execute commands safely in a sandbox. \nChoose how commands should be executed:"],options:[{key:"a",label:"Auto - Commands run in sandbox automatically with configurable network access",value:"auto"},{key:"m",label:"Manual - All commands require approval (allowlist mode)",value:"manual"},{key:"u",label:"Unrestricted - All commands run unsandboxed without approval",value:"unrestricted"},{key:"q",label:"Quit",value:"quit"}],onAction:()=>i(this,void 0,void 0,(function*(){})),variant:"info"});if(!t||"quit"===t)return!0;let n;if("auto"===t){const e=[{key:"y",label:"Yes - Enable network access in sandbox",value:"yes"},{key:"n",label:"No - Disable network access in sandbox (allowlist only)",value:"no"},{key:"q",label:"Quit",value:"quit"}];if(n=yield(0,r.b)({title:"Network Access Configuration",description:["Choose network access policy:"],options:e,onAction:()=>i(this,void 0,void 0,(function*(){})),variant:"info"}),!n||"quit"===n)return!0}const o={auto:"enabled",manual:"disabled",unrestricted:"disabled",quit:"disabled"}[t],s={auto:"allowlist",manual:"allowlist",unrestricted:"unrestricted",quit:"allowlist"}[t],l="yes"===n?"enabled":"allowlist";return yield e.transform((e=>Object.assign(Object.assign({},e),{showSandboxIntro:!1,approvalMode:s,sandbox:Object.assign(Object.assign({},e.sandbox),{mode:o,networkAccess:l})}))),!1}))}o()}catch(a){o(a)}}))},"./src/headless.ts":(e,t,n)=>{n.d(t,{t:()=>v});var o=n("../agent-client/dist/index.js"),r=n("../agent-core/dist/index.js"),s=n("../agent-exec/dist/index.js"),i=n("../proto/dist/generated/agent/v1/agent_pb.js"),l=n("../proto/dist/generated/agent/v1/selected_context_pb.js"),a=n("../proto/dist/generated/agent/v1/shell_exec_pb.js"),c=n("./src/console-io.ts"),d=n("./src/hang-detection.ts"),u=n("./src/state/session.ts"),p=n("./src/utils/interaction-responses.ts"),h=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const g="printenv",m=5e3;let f=!1;function v(e,t,n,v,x,b,y,j){return h(this,void 0,void 0,(function*(){var w,k,C,S,E;t.trim()||(0,c.uQ)(1,"Error: No prompt provided for print mode");const $=new AbortController,M=()=>{(0,c.p2)("\nAborting operation..."),$.abort()};process.on("SIGINT",M);const T=Date.now(),A=!0===j.streamPartialOutput,I="stream-json"===j.outputFormat,D="json"===j.outputFormat,_="text"===j.outputFormat,P=I||A,L=!0===j.captureEnv;let R="";(0,d.ln)({agentMode:b.getMetadata("mode"),conversationId:b.getId(),conversationCreatedAt:b.getMetadata("createdAt"),turnCount:b.getConversationStateStructure().turns.length,isHeadless:!0});let O="",Y="";const z=e=>{if(!P||0===Y.length)return;const t={type:"assistant",message:{role:"assistant",content:[{type:"text",text:Y}]},session_id:j.sessionId};e.modelCallId&&(t.model_call_id=e.modelCallId),e.includeTimestamp&&(t.timestamp_ms=Date.now()),process.stdout.write(`${JSON.stringify(t)}\n`),Y=""},N=(e,t)=>{if(!P)return;z({includeTimestamp:!0});const n=Object.assign({type:"retry",subtype:e,session_id:j.sessionId,timestamp_ms:Date.now()},t);process.stdout.write(`${JSON.stringify(n)}\n`)},F=e=>{if(!P)return;const t={type:"connection",subtype:e,session_id:j.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(t)}\n`)},B={sendUpdate(t,n){return h(this,void 0,void 0,(function*(){switch(n.type){case"text-delta":if(R+=n.text,O+=n.text,Y+=n.text,A){const e={type:"assistant",message:{role:"assistant",content:[{type:"text",text:n.text}]},session_id:j.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(e)}\n`)}break;case"tool-call-started":if(z({includeTimestamp:!0,modelCallId:n.modelCallId}),O="",I||A){const e={type:"tool_call",subtype:"started",call_id:n.callId,tool_call:n.toolCall,model_call_id:n.modelCallId,session_id:j.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(e)}\n`)}break;case"tool-call-completed":{const t=L&&(I||A)&&"shellToolCall"===n.toolCall.tool.case?yield function(e,t){return h(this,void 0,void 0,(function*(){var n;try{const o=t.get(s.qk);if(!o)throw new Error("shell executor unavailable");const r=yield o.execute(e,new a.a({command:g,timeout:m,simpleCommands:[g],skipApproval:!0,parsingResult:new a.HO({parsingFailed:!1,executableCommands:[new a.Pv({name:g,args:[],fullText:g})],hasRedirects:!1,hasCommandSubstitution:!1})}));if("success"===r.result.case)return null!==(n=r.result.value.stdout)&&void 0!==n?n:"";if("failure"===r.result.case){const e=r.result.value.stdout;if(e&&e.length>0)return e}throw new Error(function(e){var t;const n=e.result.case;if(!n)return"unknown shell result";switch(n){case"failure":{const{exitCode:t,stderr:n}=e.result.value,o=null==n?void 0:n.split("\n").find(Boolean);return`exit code ${t}${o?` (${o.substring(0,200)})`:""}`}case"timeout":return`timeout after ${e.result.value.timeoutMs}ms`;case"rejected":return`rejected: ${null!==(t=e.result.value.reason)&&void 0!==t?t:"unknown reason"}`;case"spawnError":return`spawn error: ${e.result.value.error}`;case"permissionDenied":return`permission denied: ${e.result.value.error}`;default:return n}}(r))}catch(e){if(!f){const t=e instanceof Error?e.message:String(e);(0,c.p2)(`Warning: Failed to capture environment snapshot; falling back to process.env snapshot (${t})`),f=!0}return Object.entries(process.env).map((([e,t])=>`${e}=${null!=t?t:""}`)).join("\n")}}))}(e,x):void 0;if(I||A){const e=Object.assign({type:"tool_call",subtype:"completed",call_id:n.callId,tool_call:n.toolCall,model_call_id:n.modelCallId,session_id:j.sessionId,timestamp_ms:Date.now()},void 0!==t?{env:t}:{});process.stdout.write(`${JSON.stringify(e)}\n`)}break}case"thinking-delta":if(I||A){const e={type:"thinking",subtype:"delta",text:n.text,session_id:j.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(e)}\n`)}break;case"thinking-completed":if(I||A){const e={type:"thinking",subtype:"completed",session_id:j.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(e)}\n`)}}}))},query(e,t){return h(this,void 0,void 0,(function*(){(e=>{if(!P)return;z({includeTimestamp:!0});const t={type:"interaction_query",subtype:"request",query_type:e.type,query:e,session_id:j.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(t)}\n`)})(t);const e=(0,p.l)(t,{approveWebSearch:y,askQuestionRejectReason:"Questions skipped in headless mode",webSearchRejectReason:"User Rejected"});return((e,t)=>{if(!P)return;const n={type:"interaction_query",subtype:"response",query_type:e,response:t,session_id:j.sessionId,timestamp_ms:Date.now()};process.stdout.write(`${JSON.stringify(n)}\n`)})(t.type,e),e}))}};try{const o=yield n.awaitCurrentModel();if(I||A){const e={type:"system",subtype:"init",apiKeySource:null!==(w=j.apiKeySource)&&void 0!==w?w:"login",cwd:process.cwd(),session_id:j.sessionId,model:o.displayName,permissionMode:"default"};process.stdout.write(`${JSON.stringify(e)}\n`);const n={type:"user",message:{role:"user",content:[{type:"text",text:t}]},session_id:j.sessionId};process.stdout.write(`${JSON.stringify(n)}\n`)}const s=new l.xv,a=new i.UserMessageAction({userMessage:new i.UserMessage({text:t,selectedContext:s,messageId:crypto.randomUUID()})}),p=new r.hg;yield v.run(e,b.getConversationStateStructure(),new i.ConversationAction({action:{case:"userMessageAction",value:a}}),o,B,x,b.getBlobStore(),p,b,[],{conversationId:b.getId(),headers:j.headers,customSystemPrompt:j.customSystemPrompt,enableAgentRetries:null!==(k=j.enableRetries)&&void 0!==k&&k,onRetryStarting:(e,t)=>h(this,void 0,void 0,(function*(){P?N("starting",{attempt:e,is_resume:t.isResume}):(0,c.p2)(`Retry attempt ${e}...\n`),t.isResume||P||(R="",O="",Y="")})),onRetryResuming:e=>h(this,void 0,void 0,(function*(){P&&N("resuming",{checkpoint_turn_count:e.checkpointState.turns.length,attempt:e.nextAttempt})})),onConnectionStateChange:e=>{"reconnecting"===e.state?P?F("reconnecting"):(0,c.p2)("Connection lost, reconnecting...\n"):"connected"===e.state&&P&&F("reconnected")},onStall:(0,d.M4)(b.getId(),{actionType:"userMessageAction"})});const g=u.d.getLastRequestId(),m=Date.now()-T;if(D){const e=Object.assign({type:"result",subtype:"success",is_error:!1,duration_ms:m,duration_api_ms:m,result:R||"",session_id:j.sessionId},g?{request_id:g}:{});process.stdout.write(`${JSON.stringify(e)}\n`)}else if(I){z({includeTimestamp:!1});const e=Object.assign({type:"result",subtype:"success",duration_ms:m,duration_api_ms:m,is_error:!1,result:R||"",session_id:j.sessionId},g?{request_id:g}:{});process.stdout.write(`${JSON.stringify(e)}\n`)}else if(A){const e=Object.assign({type:"result",subtype:"success",duration_ms:m,duration_api_ms:m,is_error:!1,result:R||"",session_id:j.sessionId},g?{request_id:g}:{});process.stdout.write(`${JSON.stringify(e)}\n`)}else _&&process.stdout.write(`${O||""}\n`);yield null===(C=j.onSessionEnd)||void 0===C?void 0:C.call(j,"completed"),process.exit(0)}catch(e){e instanceof o.cc&&(yield null===(S=j.onSessionEnd)||void 0===S?void 0:S.call(j,"aborted"),(0,c.uQ)(130,"Operation cancelled")),yield null===(E=j.onSessionEnd)||void 0===E?void 0:E.call(j,"error"),(0,c.uQ)(1,String(e))}finally{process.off("SIGINT",M)}}))}},"./src/hooks/prompt/use-at-palette.ts":(e,t,n)=>{n.d(t,{q:()=>A,g:()=>D});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),r=n("./src/constants.ts"),s=n("node:child_process"),i=n("node:fs"),l=n("node:os"),a=n.n(l),c=n("node:path"),d=n("node:util"),u=n("../proto/dist/generated/agent/v1/agent_service_pb.js"),p=n("./src/debug.ts"),h=n("./src/utils/fuzzy.ts"),g=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const m=(0,d.promisify)(s.execFile),f=.3,v=1e5;function x(e,t,n){return g(this,arguments,void 0,(function*(e,t,n,o=2e3){try{const{stdout:r}=yield m(e,t,{cwd:n,timeout:o,encoding:"utf8",maxBuffer:10485760});return r}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`Command failed: ${t}`)}}))}let b="rg";const y={ready:!1,paths:[],building:!1,startedAt:null,baseDir:null,strategies:new Set,lastReason:null,lastDurationMs:null,sessionId:null};let j=0;const w=new Set;function k(){for(const e of Array.from(w))try{e()}catch(e){}}function C(){return g(this,arguments,void 0,(function*(e={}){var t,n,o,r;if(y.ready||y.building)return;y.building=!0,y.startedAt=Date.now();const l=null!=(a=e.cwd)?a:process.cwd();var a;y.baseDir=l;const d=null!==(t=e.maxFiles)&&void 0!==t?t:2e4,u=null!==(n=e.maxDepth)&&void 0!==n?n:16,h=null!==(o=e.includeHidden)&&void 0!==o&&o;e.rgPath&&e.rgPath.length>0&&(b=e.rgPath);const f=Number(null!==(r=process.env.AT_FILE_INDEX_TIMEOUT_MS)&&void 0!==r?r:"8000");(0,p.debugLog)("atFileSuggestions.index.start",{cwd:l,maxFiles:d,maxDepth:u,includeHidden:h,timeoutMs:f});const v=++j;y.sessionId=v;const w=new Set,C=new Set,S=[],E=[],$=Date.now()+f;let M=!1,T=0;const A=e=>{S.push(e)},I=(e,t)=>{if(!M&&y.sessionId===v){for(const t of e)w.add(t);for(const e of t)C.add(e);(()=>{if(M||y.sessionId!==v)return;const e=w.size+C.size;(e<=64||e-T>=256)&&(y.paths=Array.from(w).concat(Array.from(C)),T=e,k())})()}},D=()=>g(this,void 0,void 0,(function*(){try{return yield function(e,t,n){return g(this,arguments,void 0,(function*(e,t,n,o=2e3){try{return yield m(e,t,{cwd:n,timeout:o,encoding:"utf8",maxBuffer:10485760}),!0}catch(e){return!1}}))}("git",["rev-parse","--is-inside-work-tree"],l)}catch(e){return!1}}));let _=!1,P=!1,L=!1;const R=e=>{M||0===y.strategies.size&&(e=>{if(M)return;M=!0;for(const e of E)clearTimeout(e);for(const e of S)try{e.kill()}catch(e){}const t=Array.from(w),n=new Set;for(const e of t){let t=(0,c.dirname)(e);for(;t&&"."!==t;)n.add(`${t}/`),t=(0,c.dirname)(t)}const o=new Set(y.paths);for(const e of t)o.add(e);for(const e of n)o.add(e);const r=Array.from(o);y.paths=r.sort(((e,t)=>{const n=e.endsWith("/"),o=t.endsWith("/");if(n!==o){const r=n?e.slice(0,-1):e,s=o?t.slice(0,-1):t;if(r===s||r.startsWith(`${s}/`)||s.startsWith(`${r}/`))return n?-1:1}return e.localeCompare(t,void 0,{sensitivity:"base"})})),y.ready=!0,y.building=!1;const s=y.startedAt?Date.now()-y.startedAt:void 0;y.lastReason=e,y.lastDurationMs=null!=s?s:null,y.strategies.clear(),(0,p.debugLog)("atFileSuggestions.index.done",{reason:e,durationMs:s,total:y.paths.length}),k()})(e)},O=()=>{if(_)return;_=!0,y.strategies.add("rg"),k();const e=["--files","--follow","--max-depth",String(u),"--no-messages"];h&&e.push("--hidden");const t=(0,s.spawn)(b,e,{cwd:l});A(t);const n=[],o=new Set;let r="",i=!1;const a=e=>{if(!i){i=!0;try{t.kill()}catch(e){}I(n,o),y.strategies.delete("rg"),R(`rg:${e}`)}},m=setTimeout((()=>a("timeout")),f);E.push(m),t.stdout.setEncoding("utf8"),t.stdout.on("data",(e=>{if(M||y.sessionId!==v)return;let t;for(r+=e;-1!==(t=r.indexOf("\n"));){const e=r.slice(0,t).trim();if(r=r.slice(t+1),!e)continue;const s=e.split(c.sep).join("/");n.push(s);let i=(0,c.dirname)(s);for(;i&&"."!==i;)o.add(`${i}/`),i=(0,c.dirname)(i);if((n.length<=64||n.length%256==0)&&I(n,o),n.length>=d||Date.now()>$)return clearTimeout(m),void a(n.length>=d?"limit":"timeout")}})),t.on("error",(e=>{(()=>{g(this,void 0,void 0,(function*(){clearTimeout(m),i||M||((0,p.debugLog)("atFileSuggestions.rg.error",String(e)),y.strategies.delete("rg"),(yield D())&&!P?yield Y(!0):L||z(!0),R("rg:error"))}))})()})),t.on("close",(e=>{(()=>{g(this,void 0,void 0,(function*(){clearTimeout(m),i||M||(0===e||n.length>0?a("complete"):(y.strategies.delete("rg"),(yield D())&&!P?yield Y(!0):L||z(!0),R("rg:empty")))}))})()}))},Y=(...e)=>g(this,[...e],void 0,(function*(e=!1){if(P)return;P=!0,y.strategies.add("git"),k();const t=(0,s.spawn)("git",["ls-files","-co","--exclude-standard","-z","--","."],{cwd:l});A(t);const n=[],o=new Set;let r="",i=!1;const a=r=>{if(!i){i=!0;try{t.kill()}catch(e){}I(n,o),y.strategies.delete("git"),R(`git:${r}${e?":fallback":""}`)}},u=setTimeout((()=>a("timeout")),f);E.push(u);let h="";try{const e=yield x("git",["rev-parse","--show-prefix"],l);h=e.trim().split(c.sep).join("/")}catch(e){}t.stdout.setEncoding("utf8"),t.stdout.on("data",(e=>{if(M||y.sessionId!==v)return;let t;for(r+=e;-1!==(t=r.indexOf("\0"));){const e=r.slice(0,t);if(r=r.slice(t+1),!e)continue;let s=e.split(c.sep).join("/");if(h&&s.startsWith(h)&&(s=s.slice(h.length)),s.startsWith("../"))continue;n.push(s);let i=(0,c.dirname)(s);for(;i&&"."!==i;)o.add(`${i}/`),i=(0,c.dirname)(i);if((n.length<=64||n.length%256==0)&&I(n,o),n.length>=d||Date.now()>$)return clearTimeout(u),void a(n.length>=d?"limit":"timeout")}})),t.on("error",(t=>{clearTimeout(u),i||M||(i=!0,(0,p.debugLog)("atFileSuggestions.git.error",String(t)),y.strategies.delete("git"),L||z(e),R("git:error"))})),t.on("close",(t=>{clearTimeout(u),i||M||(0===t||n.length>0?a("complete"):(y.strategies.delete("git"),L||z(e),R("git:empty")))}))})),z=(e=!1)=>{if(L)return;L=!0,y.strategies.add("node"),k();const t=new Set([".git","node_modules","out","dist","build","target",".next",".cache","venv",".venv"]),n=[""];let o=!1;const r=()=>g(this,void 0,void 0,(function*(){for(;!M;){const e=n.shift();if(void 0===e)break;if((e?e.split("/").filter(Boolean).length:0)>u)continue;const r=e?(0,c.join)(l,e):l;let s;try{s=yield i.promises.readdir(r,{withFileTypes:!0})}catch(e){continue}const a=[],p=new Set;for(const r of s){if(M){o=!0;break}const s=r.name;if(!h&&s.startsWith("."))continue;if(t.has(s))continue;const i=e?(0,c.join)(e,s):s;if(r.isDirectory())n.push(i+c.sep);else{a.push(i);let e=(0,c.dirname)(i);for(;e&&"."!==e;)p.add(`${e}/`),e=(0,c.dirname)(e);if(w.size+a.length>=d){o=!0;break}}}if(a.length>0&&I(a,p),Date.now()>$||w.size>=d){o=!0;break}}}));Promise.all(Array.from({length:8},(()=>r()))).then((()=>{y.strategies.delete("node"),R(`node:${o?"timeout":"complete"}${e?":fallback":""}`)})).catch((()=>{y.strategies.delete("node"),R("node:error"+(e?":fallback":""))}))};try{O(),(yield D())&&(yield Y(!0))}catch(e){(0,p.debugLog)("atFileSuggestions.index.start.error",String(e)),z()}}))}function S(e,t){const n=e.endsWith("/"),o=n?e.slice(0,-1):e;if(!t)return 1+(n?5:0);const r=(0,h.dt)(o,t);return r<=0?0:r+(n?5:0)}function E(){try{const e=a().homedir(),t=(0,c.join)(e,".cursor","ide_state.json"),n=(0,i.readFileSync)(t,"utf8");return u.m_.fromJsonString(n).recentlyViewedFiles.filter((e=>e.relativePath&&e.absolutePath&&e.absolutePath.startsWith(process.cwd()))).map((e=>e.relativePath))}catch(e){return[]}}function $(e){return`${e.replace(/[^A-Za-z0-9._-]/g,"").split("").map((e=>`*${e}`)).join("")}*`}var M=n("./src/hooks/prompt/use-windowed-nav.ts"),T=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const A=/(^|[^A-Za-z0-9._\-/])@([A-Za-z0-9._\-/]*)$/,I=200;function D(e,t,n){return r.KD?function(e,t,n){const[r,l]=(0,o.useState)([]),[a,d]=(0,o.useState)(!1),[u,h]=(0,o.useState)(!1),m=(0,o.useRef)(e),j=(0,o.useRef)(0),w=(0,M.m)(6);(0,o.useEffect)((()=>{const n=e!==m.current;m.current=e,A.test(e)&&!e.startsWith("/")||u&&h(!1);const o=e.match(A);if(!o)return d((e=>!e&&e)),0!==r.length&&l([]),void w.setLength(0);if(u)return d((e=>!e&&e)),0!==r.length&&l([]),void w.setLength(0);const k=o[2],M=()=>T(this,void 0,void 0,(function*(){const e=++j.current;if((null==t?void 0:t.rgPath)?yield C({rgPath:t.rgPath}):yield C(),e!==j.current)return;const o=(yield function(e){return g(this,arguments,void 0,(function*(e,t=50){const n=e.trim().replace(/^[.[/\\]+/,"");if(!n)return function(e){const t=E(),n=[],o=new Set,r=Math.floor(e*f);for(const e of t.slice(0,r)){const t=e.toLowerCase();o.has(t)||(o.add(t),n.push({path:e,score:v+S(e,"")}))}if(y.ready&&y.paths.length>0){const r=[];for(const t of y.paths){if(t.endsWith("/")){const e=t.split("/").filter(Boolean),n=e.length>0?`${e[0]}/`:t,s=n.toLowerCase();o.has(s)||(o.add(s),r.push(n))}else{const e=t.indexOf("/");if(-1===e){const e=t.toLowerCase();o.has(e)||(o.add(e),r.push(t))}else{const n=`${t.slice(0,e)}/`,s=n.toLowerCase();o.has(s)||(o.add(s),r.push(n))}}if(r.length>=2*e)break}for(const e of r)n.push({path:e,score:S(e,"")});const s=n.sort(((e,t)=>t.score-e.score||e.path.localeCompare(t.path,void 0,{sensitivity:"base"}))).slice(0,e);return(0,p.debugLog)("atFileSuggestions.default.index",{count:s.length,recentCount:t.length}),s}try{const r=process.cwd(),l=(0,i.readdirSync)(r,{withFileTypes:!0}),a=!1,d=l.filter((e=>a||!e.name.startsWith("."))).map((e=>({name:e.name,path:e.isDirectory()?`${e.name}${c.sep}`:e.name,isDir:e.isDirectory()})));let u=d;try{if(0===(0,s.spawnSync)("git",["rev-parse","--is-inside-work-tree"],{cwd:r,stdio:"ignore"}).status&&d.length>0){const e=d.map((e=>e.path)).join("\0"),t=(0,s.spawnSync)("git",["check-ignore","-z","--stdin"],{cwd:r,encoding:"utf8",input:e}),n=new Set((t.stdout||"").split("\0").filter(Boolean));u=d.filter((e=>!n.has(e.path))),(0,p.debugLog)("atFileSuggestions.default.gitFilter",{total:d.length,ignored:d.length-u.length})}}catch(e){}for(const{path:e}of u){const t=e.toLowerCase();o.has(t)||(o.add(t),n.push({path:e,score:S(e,"")}))}const h=n.sort(((e,t)=>t.score-e.score||e.path.localeCompare(t.path,void 0,{sensitivity:"base"}))).slice(0,e);return(0,p.debugLog)("atFileSuggestions.default.readdir",{count:h.length,recentCount:t.length}),h}catch(e){return[]}}(t);yield C();const o=[],r=y.paths.length>0?y.paths:[],l=new Set;try{const e=[];for(const o of E())if(S(o,n)>0&&e.push(o),e.length>=t)break;for(const t of e){const e=t.toLowerCase();l.has(e)||(l.add(e),o.push({path:t,score:S(t,n)+v}))}}catch(e){}for(const e of r){const t=e.toLowerCase();if(l.has(t))continue;const r=S(e,n);r>0&&(l.add(t),o.push({path:e,score:r}))}if(o.length<t&&n.length>=3)try{const e=yield function(e,t){return g(this,void 0,void 0,(function*(){const n=y.baseDir||process.cwd(),o=new Set;try{let r="";try{const e=yield x("git",["rev-parse","--show-prefix"],n);r=e.trim().split(c.sep).join("/")}catch(e){}const s=`:(icase,glob)${r}**/${$(e)}`,i=(yield x("git",["ls-files","-co","--exclude-standard","-z","--",s],n)).split("\0").filter(Boolean).map((e=>e.split(c.sep).join("/"))).map((e=>r&&e.startsWith(r)?e.slice(r.length):e)).filter((e=>!e.startsWith("../")));for(const e of i)if(o.add(e),o.size>=t)break}catch(e){}if(o.size<Math.max(8,Math.floor(t/4)))try{const r=`**/${$(e)}`,s=(yield x(b,["--files","--iglob",r],n)).split("\n").filter(Boolean).map((e=>e.split(c.sep).join("/")));for(const e of s)if(o.add(e),o.size>=t)break}catch(e){}return Array.from(o)}))}(n,4*t);for(const t of e){const e=t.toLowerCase();if(l.has(e))continue;const r=S(t,n);r>0&&(l.add(e),o.push({path:t,score:r}))}}catch(e){}return o.sort(((e,t)=>t.score-e.score||e.path.localeCompare(t.path,void 0,{sensitivity:"base"}))),o.slice(0,t)}))}(k)).map((e=>e.path));if(e!==j.current)return;(o.length!==r.length||o.some(((e,t)=>e!==r[t])))&&l(o),w.setLength(o.length);const a=o.length>0;d((e=>e!==a?a:e)),a&&n&&w.reset()}));if(!a)return void M().catch((()=>{}));const D=setTimeout((()=>{M().catch((()=>{}))}),I);return()=>clearTimeout(D)}),[e,u,a,w.reset,w.setLength,null==t?void 0:t.rgPath,r]);const k=(0,o.useCallback)((e=>{if(!a||0===r.length)return null;const t=r[w.index];if(!t)return null;const n=t.endsWith("/")?`@${t}`:`@${t} `;return e.replace(A,((e,t)=>`${t}${n}`))}),[a,r,w.index]),D=(0,o.useCallback)((()=>{d(!1)}),[]),_=(0,o.useCallback)((()=>{h(!0),d(!1)}),[]),P=!n&&a;return(0,o.useMemo)((()=>({active:P,suggestions:r,index:w.index,windowStart:w.windowStart,next:w.next,prev:w.prev,reset:w.reset,acceptExpansion:k,hide:D,suppress:_})),[P,r,w.index,w.windowStart,w.next,w.prev,w.reset,k,D,_])}(e,t,n):{active:!1,suggestions:[],index:0,windowStart:0,next:()=>{},prev:()=>{},reset:()=>{},acceptExpansion:()=>null,hide:()=>{},suppress:()=>{}}}},"./src/hooks/prompt/use-ephemeral.ts":(e,t,n)=>{n.d(t,{N:()=>i});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),r=n("./src/constants.ts"),s=n("./src/debug.ts");function i(){const[e,t]=(0,o.useState)([]),n=(0,o.useRef)(null),i=(0,o.useRef)(!1),l=(0,o.useRef)(!1),a=(0,o.useCallback)((e=>{if(Array.isArray(e)){const t=e[0];return t&&"object"==typeof t&&!Array.isArray(t)&&"text"in t?[e]:e}return[e]}),[]),c=(0,o.useCallback)((()=>{n.current&&(clearTimeout(n.current),n.current=null)}),[]),d=(0,o.useCallback)((()=>{c(),t([])}),[c]),u=(0,o.useCallback)(((e,o)=>{const i=a(e);c(),t(i),!0===(null==o?void 0:o.persistUntilInput)&&(l.current=!0);const d=null==o?void 0:o.minLingerMs;if(i.length>0){const e=null!=d?d:l.current?void 0:r.fj;void 0!==e&&(n.current=setTimeout((()=>{t([]),n.current=null,null===s.debugLog||void 0===s.debugLog||(0,s.debugLog)("ephemeral.timeout.clear")}),e))}}),[c,a]),p=(0,o.useCallback)((()=>{i.current=!0}),[]);(0,o.useEffect)((()=>()=>{c()}),[c]);const h=(0,o.useCallback)((()=>{l.current&&(l.current=!1,c(),t([]))}),[c]),g=(0,o.useCallback)((o=>{c(),0!==e.length&&(n.current=setTimeout((()=>{t([]),n.current=null,null===s.debugLog||void 0===s.debugLog||(0,s.debugLog)("ephemeral.linger.clear")}),Math.max(0,0|o)))}),[c,e.length]);return(0,o.useMemo)((()=>({lines:e,set:u,clear:d,preserveNextClear:p,normalize:a,onUserInput:h,linger:g})),[e,u,d,p,a,h,g])}},"./src/hooks/prompt/use-prompt-history.ts":(e,t,n)=>{n.d(t,{a:()=>g});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),r=n("./src/debug.ts"),s=n("node:fs"),i=n("node:os"),l=n("node:path"),a=n("./src/utils/characters.ts"),c=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const d=500;function u(){switch((0,i.platform)()){case"win32":{const e=process.env.APPDATA||(0,l.join)((0,i.homedir)(),"AppData","Roaming");return(0,l.join)(e,"Cursor","prompt_history.json")}case"darwin":return(0,l.join)((0,i.homedir)(),".cursor","prompt_history.json");default:{const e=process.env.XDG_CONFIG_HOME||(0,l.join)((0,i.homedir)(),".config");return(0,l.join)(e,"cursor","prompt_history.json")}}}function p(){return c(this,void 0,void 0,(function*(){const e=u();try{const t=yield s.promises.readFile(e,"utf8"),n=JSON.parse(t);if(Array.isArray(n)){const e=n.filter((e=>"string"==typeof e)),t=new Set,o=[];for(const n of e){const e=(0,a.p3)(n);0!==e.length&&(t.has(e)||(t.add(e),o.push(e)))}return o.slice(0,d)}return[]}catch(e){return[]}}))}var h=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function g(){const[e,t]=(0,o.useState)([]),[n,i]=(0,o.useState)(null),g=(0,o.useRef)("");(0,o.useEffect)((()=>{(()=>{h(this,void 0,void 0,(function*(){try{const e=yield p();t(e)}catch(e){null===r.debugLog||void 0===r.debugLog||(0,r.debugLog)("history.init.error",String(e))}}))})()}),[]);const m=(0,o.useCallback)((t=>{if(0===e.length)return null;if(null!=n)return null;g.current=t,i(0);const o=e[0];return null!=o?o:null}),[e,n]),f=(0,o.useCallback)((()=>{var t;if(0===e.length)return null;const o=Math.min(e.length-1,(null!=n?n:0)+1);return i(o),null!==(t=e[o])&&void 0!==t?t:null}),[e,n]),v=(0,o.useCallback)((t=>{var o;if(null==n)return null;const r=n-1;return r>=0?(i(r),{value:null!==(o=e[r])&&void 0!==o?o:t,exited:!1}):(i(null),{value:g.current,exited:!0})}),[n,e]),x=(0,o.useCallback)((e=>h(this,void 0,void 0,(function*(){try{const n=yield function(e){return c(this,void 0,void 0,(function*(){const t=(0,a.p3)(e);if(0===t.length)return yield p();let n=yield p();return n=n.filter((e=>e!==t)),n.unshift(t),n.length>d&&(n=n.slice(0,d)),yield function(e){return c(this,void 0,void 0,(function*(){const t=u();yield function(e){return c(this,void 0,void 0,(function*(){const t=(0,l.dirname)(e);try{yield s.promises.mkdir(t,{recursive:!0})}catch(e){}}))}(t);const n=new Set,o=[];for(const t of e){const e=(0,a.p3)(t);if(0!==e.length&&!n.has(e)&&(n.add(e),o.push(e),o.length>=d))break}const r=JSON.stringify(o,null,2);yield s.promises.writeFile(t,r,"utf8")}))}(n),n}))}(e);t(n),i(null),g.current=""}catch(e){null===r.debugLog||void 0===r.debugLog||(0,r.debugLog)("history.add.error",String(e))}}))),[]),b=(0,o.useCallback)((()=>{i(null),g.current=""}),[]),y=(0,o.useCallback)((()=>{i(null),g.current=""}),[]),j=(0,o.useCallback)((()=>{t([]),i(null),g.current=""}),[]);return(0,o.useMemo)((()=>({items:e,index:n,inHistory:null!=n,draftBeforeHistory:g.current,begin:m,up:f,down:v,record:x,reset:b,resetForSlash:y,clearAllLocal:j})),[e,n,m,f,v,x,b,y,j])}},"./src/hooks/prompt/use-slash-palette.ts":(e,t,n)=>{n.d(t,{e:()=>p});var o=n("../context/dist/index.js"),r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),s=n("./src/constants.ts"),i=n("./src/instrument.ts"),l=n("./src/utils/error-info.ts"),a=n("./src/utils/fuzzy.ts"),c=n("./src/hooks/prompt/use-windowed-nav.ts"),d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function u(e,t,n,o,r,s){var i,l;if(!e.isArgSuggestion||!e.parentCommandId)return null;const a=t.find((t=>t.id.toLowerCase()===e.parentCommandId.toLowerCase())),c=null!==(l=null===(i=null==a?void 0:a.args)||void 0===i?void 0:i.length)&&void 0!==l?l:0;if(c>0&&n.length>c){const e=n.slice(0,c);return r&&"trailing"===s.kind?`${s.promptPrefix} /${e.join(" ")} ${o} `:`/${e.join(" ")} ${o} `}return null}function p(e,t,n,p,h){const[g,m]=(0,r.useState)([]),[f,v]=(0,r.useState)(!1),[x,b]=(0,r.useState)(!1),y=(0,c.m)(s.kQ),j=(0,r.useRef)(null),w=(0,r.useRef)(null),k=(0,r.useRef)(e),[C,S]=(0,r.useState)({kind:"none"});(0,r.useEffect)((()=>{var r,s,i,l,c;const u=e!==k.current;k.current=e;const p=(0,o.q6)(),f=null!=h?h:e.length,w=function(e,t){var n,o,r;const s=/(?:^|\s)(\/\S*)/g,i=[];for(const t of e.matchAll(s)){const e=t[0],r=null!==(n=t[1])&&void 0!==n?n:"",s=(null!==(o=t.index)&&void 0!==o?o:0)+(e.length-r.length),l=s+r.length,a=r.slice(1);i.push({slashStart:s,slashEnd:l,fragment:a})}if(e.startsWith("/")){const t=/^\/(\S*)/.exec(e);if(t){const e=null!==(r=t[1])&&void 0!==r?r:"",n=1+e.length;i.some((e=>0===e.slashStart))||i.unshift({slashStart:0,slashEnd:n,fragment:e})}}for(const n of i)if(t>=n.slashStart&&t<=n.slashEnd)return{found:!0,prefix:e.slice(0,n.slashStart).trimEnd(),fragment:n.fragment,slashStart:n.slashStart,slashEnd:n.slashEnd};return null}(e,f),C=/^(.*?)(\s+)\/(\S*)$/.exec(e);if(null==w?void 0:w.found){const t=e.slice(w.slashEnd);0===w.slashStart&&0===t.length?S({kind:"none"}):S({kind:"cursor",promptPrefix:w.prefix,fragment:w.fragment,slashStart:w.slashStart,slashEnd:w.slashEnd,suffix:t})}else if(C){const e=null!==(r=C[1])&&void 0!==r?r:"",t=null!==(s=C[3])&&void 0!==s?s:"";S({kind:"trailing",promptPrefix:e,fragment:t})}else S({kind:"none"});const E=(null==w?void 0:w.found)||null!=C;if(!e.startsWith("/")&&!E)return 0!==g.length&&m([]),y.setLength(0),v((e=>!e&&e)),void(x&&b(!1));if(x){if(!u)return 0!==g.length&&m([]),y.setLength(0),void v((e=>!e&&e));b(!1)}let $;$=(null==w?void 0:w.found)?w.fragment:C?null!==(i=C[3])&&void 0!==i?i:"":e.slice(1);const M=$.split(/\s+/),T=0===$.length?[]:M.filter(((e,t)=>!(""===e&&t===M.length-1&&!$.endsWith(" ")))),A=null!==(l=T[0])&&void 0!==l?l:"",I=()=>d(this,void 0,void 0,(function*(){const e=A,o=e.toLowerCase(),r=e?t.find((e=>e.id.toLowerCase()===o)):void 0;if(null==r?void 0:r.getArgSuggestions){const e=yield r.getArgSuggestions(p,[],n);if(e&&e.length>0)return e.map((e=>({identifier:e.value,label:e.value,description:e.description||"",args:[],parentCommandId:r.id,isArgSuggestion:!0})))}const s=(null==w?void 0:w.found)&&w.slashStart>0,i=(E&&s||E&&null!=C?t.filter((e=>e.inline)):t).map(((t,n)=>{const o=`${t.id} ${t.title} ${t.description||""}`;let r=e?(0,a.dt)(o,e):1;if(e&&t.id.toLowerCase().startsWith(e.toLowerCase())&&(r+=1e3),e&&t.boostedAlts){const n=e.toLowerCase();t.boostedAlts.some((e=>n===e.toLowerCase()||n.startsWith(e.toLowerCase())||e.toLowerCase().includes(n)))&&(r+=1500)}return{c:t,score:r,originalIndex:n}})).filter((t=>!e||t.score>0)).sort(((t,n)=>e?n.score-t.score||t.c.id.localeCompare(n.c.id):t.originalIndex-n.originalIndex));return i.map((({c:e})=>({identifier:e.id,label:e.title,description:e.description||"",ghostText:e.ghostText,args:(e.args||[]).map((e=>({identifier:e.id,required:e.required}))),inline:e.inline})))})),D=()=>d(this,void 0,void 0,(function*(){const e=t.find((e=>e.id.toLowerCase()===A.toLowerCase()));if(!e)return[];const o=T.slice(1);if(e.getArgSuggestions){const t=yield e.getArgSuggestions(p,o,n);if(t&&t.length>0)return t.map((t=>({identifier:t.value,label:t.value,description:t.description||"",args:[],parentCommandId:e.id,isArgSuggestion:!0})))}return(e.args||[]).slice(o.length).map((t=>({identifier:t.id,label:t.id,description:!1===t.required?"optional":"required",args:[],parentCommandId:e.id,isArgSuggestion:!0})))}));null===(c=j.current)||void 0===c||c.abort();const _=new AbortController;j.current=_,(()=>{d(this,void 0,void 0,(function*(){let e=[];if(e=T.length<=1||1===T.length&&!$.endsWith(" ")?yield I():yield D(),_.signal.aborted)return;(e.length!==g.length||e.some(((e,t)=>{var n,o;return e.identifier!==(null===(n=g[t])||void 0===n?void 0:n.identifier)||e.parentCommandId!==(null===(o=g[t])||void 0===o?void 0:o.parentCommandId)})))&&m(e),y.setLength(e.length);const t=e.length>0;if(v((e=>e!==t?t:e)),t&&u){const t=T.slice(1).filter((e=>e.length>0)),n=t.length>0?t[t.length-1]:"";if(n){const t=e.findIndex((e=>e.identifier===n));t>=0?y.setIndex(t):y.reset()}else y.reset()}}))})()}),[e,t,x,n,g,y.reset,y.setIndex,y.setLength,h]);const E=(0,r.useCallback)((e=>{var n,o,r,s,i;if(!f||0===g.length)return null;const l=g[y.index];if(!l)return null;const a=/^(.*?)(\s+)\/(\S*)$/.exec(e),c=null!==a,d=a?(null!==(n=a[1])&&void 0!==n?n:"").trimEnd():"",p=a&&null!==(o=a[3])&&void 0!==o?o:"";if("cursor"===C.kind){const{promptPrefix:t,suffix:n}=C,o=`/${l.identifier} `,r=`${t.length>0?`${t} `:""}${o}${n.startsWith(" ")?n.slice(1):n}`;return r!==e?r:null}const h="trailing"===C.kind||c,m=h?"trailing"===C.kind?C.fragment:p:e.startsWith("/")?e.slice(1):"";if(!h&&!e.startsWith("/"))return null;const v="trailing"===C.kind?C.promptPrefix:d,x=m.includes(" "),b=e.endsWith(" ");if(!x){if(l.isArgSuggestion&&l.parentCommandId)return h?`${v} /${l.parentCommandId} ${l.identifier} `:`/${l.parentCommandId} ${l.identifier} `;const t=`/${l.identifier} `,n=h?`${v} ${t}`:t;return n!==e?n:null}const j=m.split(/\s+/);if(j.length>=2){const n=m.split(/\s+/).filter(Boolean),o=null!==(r=n[n.length-1])&&void 0!==r?r:"",a=l.identifier,c=null!==(s=j[0])&&void 0!==s?s:"",d=t.find((e=>e.id.toLowerCase()===c.toLowerCase())),p=1===(null===(i=null==d?void 0:d.args)||void 0===i?void 0:i.length);if(b){const r=(null==d?void 0:d.args)?d.args.length:void 0,s=Math.max(0,n.length-1);if(!d||null==r||s>=r){if(p&&l.isArgSuggestion){const e=h?"":"/",t=l.parentCommandId||c;return h?`${v} /${t} ${a} `:`${e}${t} ${a} `}const o=u(l,t,n,a,h,{kind:"trailing",promptPrefix:v});if(null!==o)return o;if(h)return`${v} /${a} `;const r=e.trimEnd(),s=r.lastIndexOf(" ");return`${s>=0?r.slice(0,s+1):""}${a} `}return o===a?null:`${e}${a} `}if(p&&l.isArgSuggestion){const e=h?"":"/",t=l.parentCommandId||c;return h?`${v} /${t} ${a} `:`${e}${t} ${a} `}const g=u(l,t,n,a,h,{kind:"trailing",promptPrefix:v});if(null!==g)return g;const f=e.lastIndexOf(" ");return(f>=0?e.slice(f+1):e)===a?e.endsWith(" ")?null:`${e} `:`${f>=0?e.slice(0,f+1):""}${a} `}return null}),[f,g,y.index,t,C]),$=(0,r.useCallback)((()=>{b(!0),v(!1)}),[]),M=(0,r.useCallback)(((e,t,n,r,s)=>d(this,void 0,void 0,(function*(){var a,c,d,u,p;let h,g="";if(e.startsWith("/"))h=e.slice(1);else{const t=/^(.*?)(\s+)\/(\S.*)$/.exec(e);if(!t)return"not-a-command";g=(null!==(a=t[1])&&void 0!==a?a:"").trimEnd(),h=null!==(c=t[3])&&void 0!==c?c:""}const m=h.split(/\s+/).filter(Boolean),f=m[0]||"";if(!f)return"not-a-command";const v=m.slice(1),x=(g?t.filter((e=>e.inline)):t).find((e=>e.id.toLowerCase()===f.toLowerCase()));if(!x)return g?"not-a-command":(null==s||s(f),"unknown");if(!x.run)return"handled";const b=(x.args||[]).filter((e=>!1!==e.required));if(v.length<b.length)return"handled";"quit"===f.toLowerCase()&&(null==r||r(!0)),null===(d=w.current)||void 0===d||d.abort();const y=new AbortController;w.current=y;const[j,k]=(0,o.q6)().withCancel();y.signal.addEventListener("abort",k);try{yield x.run(j,v,{onModelChange:n.onModelChange,insertText:e=>{if(!y.signal.aborted)if(g){const t=e&&e.length>0?e:g;n.insertText(t)}else n.insertText(e)},clearInput:()=>{var e;y.signal.aborted||null===(e=n.clearInput)||void 0===e||e.call(n)},enterShellMode:()=>{var e;return null===(e=n.enterShellMode)||void 0===e?void 0:e.call(n)},print:(e,t)=>{var o;y.signal.aborted||null===(o=n.print)||void 0===o||o.call(n,e,t)},exit:e=>{var t;return null===(t=n.exit)||void 0===t?void 0:t.call(n,e)},onHistoryCleared:()=>{var e;return null===(e=n.onHistoryCleared)||void 0===e?void 0:e.call(n)},onResumeChat:n.onResumeChat,getChatId:n.getChatId,logout:n.logout,onNewChat:n.onNewChat,onSummarize:n.onSummarize,onTransferToCloud:n.onTransferToCloud,submitMessage:(e,t)=>{var o;y.signal.aborted||null===(o=n.submitMessage)||void 0===o||o.call(n,e,t)},onOpenMcpPager:n.onOpenMcpPager,onOpenSandboxPager:n.onOpenSandboxPager,getPromptPrefix:()=>g||void 0,onOpenSkillsPager:n.onOpenSkillsPager,hidePalette:$})}catch(e){if(!y.signal.aborted){(0,i.Fb)(e,"error");const{message:t}=(0,l.q)(e);null===(u=n.print)||void 0===u||u.call(n,[[{text:`Error: ${t}`,color:"red"}]]),null===(p=n.clearInput)||void 0===p||p.call(n)}}finally{w.current===y&&(w.current=null)}return"executed"}))),[$]);(0,r.useEffect)((()=>()=>{var e,t;null===(e=j.current)||void 0===e||e.abort(),null===(t=w.current)||void 0===t||t.abort()}),[]);const T=!p&&f;return(0,r.useMemo)((()=>({active:T,items:g,index:y.index,windowStart:y.windowStart,next:y.next,prev:y.prev,reset:y.reset,acceptExpansion:E,runIfExecutable:M,hide:$})),[T,g,y.index,y.windowStart,y.next,y.prev,y.reset,E,M,$])}},"./src/hooks/prompt/use-windowed-nav.ts":(e,t,n)=>{n.d(t,{m:()=>l});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const r=2;function s(e){return e-r}function i(e,t,n){const o=s(n),r=Math.max(0,t-o);return e>r?r:e<0?0:e}function l(e=6){const[t,n]=(0,o.useState)(0),[r,l]=(0,o.useState)(0),[a,c]=(0,o.useState)(0),d=(0,o.useCallback)((t=>{c((o=>t===o?o:(n((e=>0===t?0:Math.min(e,t-1))),l((n=>i(n,t,e))),t)))}),[e]),u=(0,o.useCallback)((()=>{0!==a&&n((t=>{const n=(t+1)%a;return l((o=>{if(a<=e)return 0;if(n<t)return 0;const r=s(e);return n>=o+r?i(n-r+1,a,e):o})),n}))}),[a,e]),p=(0,o.useCallback)((()=>{0!==a&&n((t=>{const n=(t-1+a)%a;return l((o=>{if(a<=e)return 0;if(n>t){const t=s(e);return i(Math.max(0,a-t),a,e)}return n<o?i(n,a,e):o})),n}))}),[a,e]),h=(0,o.useCallback)((()=>{n(0),l(0)}),[]),g=(0,o.useCallback)((t=>{if(0===a)return;const o=Math.max(0,Math.min(t,a-1));n(o),l((t=>{if(a<=e)return 0;const n=s(e);return o<t?i(o,a,e):o>=t+n?i(o-n+1,a,e):t}))}),[a,e]),m=(0,o.useCallback)(((n=e)=>({visibleStart:r,highlight:t-r})),[t,r,e]);return(0,o.useMemo)((()=>({index:t,windowStart:r,setLength:d,setIndex:g,next:u,prev:p,reset:h,page:m})),[t,r,d,g,u,p,h,m])}},"./src/hooks/use-attach-background-composer.ts":(e,t,n)=>{n.d(t,{n:()=>h});var o=n("node:crypto"),r=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),s=n("../proto/dist/generated/aiserver/v1/tools_pb.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=n("./src/constants.ts"),a=n("./src/debug.ts"),c=n("./src/hang-detection.ts"),d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))},u=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise((function(o,r){!function(e,t,n,o){Promise.resolve(o).then((function(t){e({value:t,done:n})}),t)}(o,r,(t=e[n](t)).done,t.value)}))}}};const p=6e4;function h(e,t){const[n,h]=(0,i.useState)({bubbles:[]}),[m,f]=(0,i.useState)(r.R6p.UNSPECIFIED),[v,x]=(0,i.useState)(!1),[b,y]=(0,i.useState)(!1),[j,w]=(0,i.useState)(void 0),[k,C]=(0,i.useState)(void 0),[S,E]=(0,i.useState)(void 0),[$,M]=(0,i.useState)(void 0),T=(0,i.useRef)(void 0),[A,I]=(0,i.useState)(void 0),[D,_]=(0,i.useState)(!1),P=(0,i.useRef)(!1),L=(0,i.useRef)(!1),R=(0,i.useRef)(null),O=(0,i.useRef)(!1),Y=(0,i.useRef)(r.R6p.UNSPECIFIED),z=(0,i.useRef)(!1),N=(0,i.useRef)(!1),F=(0,i.useCallback)((()=>d(this,void 0,void 0,(function*(){if(t)try{P.current||_(!0);const n=function(e){var t,n,o,r,s,i;if("object"!=typeof(i=e)||null===i)return[];const l=null!==(o=null===(n=null===(t=e.diff)||void 0===t?void 0:t.diffs)||void 0===n?void 0:n.map((e=>{var t,n,o,r;return{path:null!==(n=null!==(t=e.to)&&void 0!==t?t:e.from)&&void 0!==n?n:"",before:null!==(o=e.beforeFileContents)&&void 0!==o?o:void 0,after:null!==(r=e.afterFileContents)&&void 0!==r?r:void 0}})))&&void 0!==o?o:[],a=null!==(s=null===(r=e.submoduleDiffs)||void 0===r?void 0:r.flatMap((e=>{var t;return(null===(t=e.diff)||void 0===t?void 0:t.diffs)&&"string"==typeof e.relativePath&&0!==e.relativePath.length?e.diff.diffs.map((t=>{var n,o,r,s;const i=null!==(o=null!==(n=t.to)&&void 0!==n?n:t.from)&&void 0!==o?o:"",l=e.relativePath.replace(/\/+$/,"");return{path:i.startsWith("/")?`${l}${i}`:`${l}/${i}`,before:null!==(r=t.beforeFileContents)&&void 0!==r?r:void 0,after:null!==(s=t.afterFileContents)&&void 0!==s?s:void 0}})):[]})))&&void 0!==s?s:[];return[...l,...a]}(yield e.getOptimizedDiffDetails({bcId:t}));I(n),P.current=!0}catch(e){(0,a.debugLog)("Error fetching diffs",e)}finally{_(!1)}}))),[e,t]),B=(0,i.useCallback)((()=>d(this,void 0,void 0,(function*(){if(t)if(L.current)try{const n=yield e.getBackgroundComposerChangesHash({bcId:t});n.hash!==T.current&&(T.current=n.hash,yield F())}finally{_(!1)}else _(!1)}))),[e,t,F]);(0,i.useEffect)((()=>{if(!t)return;const e=setInterval((()=>{N.current||(N.current=!0,B().finally((()=>{N.current=!1})))}),l.Ep);return()=>clearInterval(e)}),[B,t]);const U=(0,i.useCallback)((t=>d(this,void 0,void 0,(function*(){var n,o,i,l,d,m,v,b,j,k,S,$,T;if(O.current)return;O.current=!0,w(void 0);const A=new AbortController;R.current=A;try{let w=0;try{y(!0);const[n,o]=yield Promise.allSettled([e.fetchBackgroundComposer({bcId:t}),e.listDetailedBackgroundComposers({bcId:t,n:1})]),r="fulfilled"===n.status?n.value:void 0,i="fulfilled"===o.status?o.value:void 0;if("rejected"===o.status)(0,a.debugLog)("Failed to fetch detailed background composers",t);else{(0,a.debugLogJSON)("detailed",i);const e=null===(d=null==i?void 0:i.composers)||void 0===d?void 0:d[0];e&&(C(e.modelDetails),E(null===(m=e.composer)||void 0===m?void 0:m.branchName),M(null===(v=e.composer)||void 0===v?void 0:v.repoUrl))}if(h({bubbles:[]}),(null===(j=null===(b=null==i?void 0:i.composers)||void 0===b?void 0:b[0])||void 0===j?void 0:j.prompt)&&r&&!(null===(S=null===(k=r.responses)||void 0===k?void 0:k[0])||void 0===S?void 0:S.humanMessage)&&h({bubbles:[{type:"user",isDone:!0,text:i.composers[0].prompt.text,richText:i.composers[0].prompt.richText,isOptimistic:!1}]}),(null==r?void 0:r.responses)&&r.responses.length>0){for(const e of r.responses){const t=null===($=e.toolCall)||void 0===$?void 0:$.tool;t!==s.XaY.EDIT_FILE&&t!==s.XaY.EDIT_FILE_V2||(L.current=!0,B()),g(e,h)}w=r.responses.length}}catch(e){(0,a.debugLog)("Failed to fetch background composer",t)}finally{y(!1)}x(!0),(0,c.ln)({backgroundComposerAttached:!0,backgroundComposerId:t});const P=new r.R3$({bcId:t,startingIndex:w}),R=e.attachBackgroundComposer(P,{signal:A.signal});let O=Date.now(),Y=r.R6p.UNSPECIFIED,z=!1;const N=setInterval((()=>{const e=Date.now()-O,n=Y===r.R6p.FINISHED||Y===r.R6p.ERROR||Y===r.R6p.EXPIRED;!z&&!n&&e>=p&&(z=!0,(0,c.Dy)({category:"background_composer",waitingFor:"background_composer_message",lastActivityAgoMs:e,extra:{bcId:t,lastStatus:r.R6p[Y]}},"warning"))}),1e4);try{try{for(var I,D=!0,_=u(R);!(n=(I=yield _.next()).done);D=!0){l=I.value,D=!1;const e=l;if(O=Date.now(),z=!1,void 0!==e.statusUpdate&&e.statusUpdate!==r.R6p.UNSPECIFIED&&(Y=e.statusUpdate,f(e.statusUpdate)),e.headlessAgenticComposerResponse){const t=null===(T=e.headlessAgenticComposerResponse.toolCall)||void 0===T?void 0:T.tool;t!==s.XaY.EDIT_FILE&&t!==s.XaY.EDIT_FILE_V2||(L.current=!0,B()),g(e.headlessAgenticComposerResponse,h)}}}catch(e){o={error:e}}finally{try{D||n||!(i=_.return)||(yield i.call(_))}finally{if(o)throw o.error}}}finally{clearInterval(N)}}catch(e){const n=e instanceof Error?e.message:"string"==typeof e?e:JSON.stringify(e);(0,a.debugLog)("Error attaching background composer",t,n),w(n)}finally{x(!1),O.current=!1,(0,c.ln)({backgroundComposerAttached:!1,backgroundComposerId:void 0})}}))),[e,B]);(0,i.useEffect)((()=>{if(h({bubbles:[]}),f(r.R6p.UNSPECIFIED),x(!1),w(void 0),I(void 0),P.current=!1,T.current=void 0,_(!1),L.current=!1,t)return U(t),()=>{var e;null===(e=R.current)||void 0===e||e.abort(),O.current=!1}}),[U,t]);const q=(0,i.useCallback)((()=>{var e;t&&(null===(e=R.current)||void 0===e||e.abort(),O.current=!1,U(t))}),[U,t]);(0,i.useEffect)((()=>{Y.current=m}),[m]),(0,i.useEffect)((()=>{if(!t)return;let n=!1;const o=()=>d(this,void 0,void 0,(function*(){if(!z.current&&!n&&Y.current!==r.R6p.FINISHED&&Y.current!==r.R6p.ERROR&&Y.current!==r.R6p.EXPIRED){z.current=!0;try{const o=yield e.getBackgroundComposerStatus({bcId:t});!n&&o&&void 0!==o.status&&f(o.status)}catch(e){}finally{z.current=!1}}}));o();const s=setInterval((()=>{o()}),l.kh);return()=>{n=!0,clearInterval(s)}}),[e,t]);const H=(0,i.useCallback)(((e,t)=>{const n=(0,o.randomUUID)();return h((o=>({bubbles:[...o.bubbles,{type:"user",text:e,richText:null!=t?t:e,isDone:!1,isOptimistic:!0,bubbleId:n}]}))),n}),[]),W=(0,i.useCallback)((e=>{h((t=>{const n=t.bubbles;if(e){const o=n.findIndex((t=>"user"===t.type&&t.isOptimistic&&t.bubbleId===e));return-1!==o?{bubbles:[...n.slice(0,o),...n.slice(o+1)]}:t}for(let e=n.length-1;e>=0;e--){const t=n[e];if("user"===t.type&&t.isOptimistic)return{bubbles:[...n.slice(0,e),...n.slice(e+1)]}}return t}))}),[]);return(0,i.useMemo)((()=>({responses:n,status:m,isAttached:v,isLoadingConversation:b,isLoadingDiffs:D,error:j,reconnect:q,addOptimisticFollowup:H,removeOptimisticFollowup:W,modelDetails:k,branchName:S,repoUrl:$,diffs:A})),[n,m,v,b,D,j,q,H,W,k,S,$,A])}function g(e,t){var n,o;const s=e=>function(e){let t=e.length;for(let n=e.length-1;n>=0;n--){const o=e[n];if("user"!==o.type||!o.isOptimistic)break;t=n}return t}(e);if(e.thinking&&t((t=>{var n,o,r,i;const l=s(t.bubbles),a=l>0?t.bubbles[l-1]:void 0;if(a&&"thinking"===a.type&&!a.isDone){const r=Object.assign(Object.assign({},a),{text:a.text+(null!==(o=null===(n=e.thinking)||void 0===n?void 0:n.text)&&void 0!==o?o:"")});return{bubbles:[...t.bubbles.slice(0,l-1),r,...t.bubbles.slice(l)]}}const c={type:"thinking",text:null!==(i=null===(r=e.thinking)||void 0===r?void 0:r.text)&&void 0!==i?i:"",isDone:!1,thinkingDurationMs:0};return l===t.bubbles.length?{bubbles:[...t.bubbles,c]}:{bubbles:[...t.bubbles.slice(0,l),c,...t.bubbles.slice(l)]}})),void 0!==e.thinkingDurationMs&&t((t=>{var n;let o=-1;for(let e=s(t.bubbles)-1;e>=0;e--)if("thinking"===(null===(n=t.bubbles[e])||void 0===n?void 0:n.type)){o=e;break}if(-1===o)return t;const r=Object.assign(Object.assign({},t.bubbles[o]),{thinkingDurationMs:Number(e.thinkingDurationMs),isDone:!0});return{bubbles:[...t.bubbles.slice(0,o),r,...t.bubbles.slice(o+1)]}})),e.thinking||void 0!==e.thinkingDurationMs||t((e=>{const t=s(e.bubbles);if(0===t)return e;const n=e.bubbles[t-1];if(!n||"thinking"!==n.type||n.isDone)return e;const o=Object.assign(Object.assign({},n),{isDone:!0});return{bubbles:[...e.bubbles.slice(0,t-1),o,...e.bubbles.slice(t)]}})),e.status&&t((t=>{const n=s(t.bubbles),o=n>0?t.bubbles[n-1]:void 0,i=e.status;if(!i)return t;if(!i.isComplete&&"status"!==(null==o?void 0:o.type)){const e={type:"status",statusType:i.type,message:i.message,isDone:i.isComplete,isVisible:!0};return n===t.bubbles.length?{bubbles:[...t.bubbles,e]}:{bubbles:[...t.bubbles.slice(0,n),e,...t.bubbles.slice(n)]}}if("status"===(null==o?void 0:o.type)){const e=Object.assign(Object.assign({},o),{isDone:i.isComplete}),s=[...t.bubbles.slice(0,n-1),e,...t.bubbles.slice(n)];if(i.type===r.ywg.INDEX_SYNC){const o=Object.assign(Object.assign({},e),{isVisible:!1});return{bubbles:[...t.bubbles.slice(0,n-1),o,...t.bubbles.slice(n)]}}return i.isComplete&&i.type===r.ywg.GENERIC?{bubbles:[...s,{type:"status",statusType:i.type,message:i.message,isDone:!0,isVisible:!0}]}:{bubbles:s}}return t})),e.status||t((e=>{const t=s(e.bubbles);if(0===t)return e;const n=e.bubbles[t-1];if(!n||"status"!==n.type)return e;if(n.statusType!==r.ywg.INDEX_SYNC)return e;const o=Object.assign(Object.assign({},n),{isDone:!0,isVisible:!1});return{bubbles:[...e.bubbles.slice(0,t-1),o,...e.bubbles.slice(t)]}})),e.text&&t((t=>{const n=s(t.bubbles),o=n>0?t.bubbles[n-1]:void 0;if(o&&"text"===o.type&&!o.isDone){const r=Object.assign(Object.assign({},o),{text:o.text+e.text});return{bubbles:[...t.bubbles.slice(0,n-1),r,...t.bubbles.slice(n)]}}const r={type:"text",text:e.text,isDone:!!e.isMessageDone};return n===t.bubbles.length?{bubbles:[...t.bubbles,r]}:{bubbles:[...t.bubbles.slice(0,n),r,...t.bubbles.slice(n)]}})),e.toolCall){const n=e.toolCall;t((e=>{const t=e.bubbles.findIndex((e=>"tool"===e.type&&e.toolCall.toolCallId===n.toolCallId));if(-1===t)return{bubbles:[...e.bubbles,{type:"tool",toolCall:n,toolResult:void 0}]};const o=e.bubbles[t],r=Object.assign(Object.assign({},o),{toolCall:n});return{bubbles:[...e.bubbles.slice(0,t),r,...e.bubbles.slice(t+1)]}}))}if(e.finalToolResult&&t((t=>{const n=e.finalToolResult;if(!n)return t;const o=t.bubbles.findIndex((e=>"tool"===e.type&&e.toolCall.toolCallId===n.toolCallId));if(-1===o)return t;const r=t.bubbles[o],s=Object.assign(Object.assign({},r),{toolResult:n.result});return{bubbles:[...t.bubbles.slice(0,o),s,...t.bubbles.slice(o+1)]}})),e.humanMessage){const n=e.humanMessage,o=n.bubbleId;t((t=>{var r,s;const i=o?t.bubbles.findIndex((e=>"user"===e.type&&e.bubbleId===o)):-1;if(-1!==i){const e=t.bubbles[i],o=Object.assign(Object.assign({},e),{text:n.text,richText:null!==(r=n.richText)&&void 0!==r?r:"",isOptimistic:!1});return{bubbles:[...t.bubbles.slice(0,i),o,...t.bubbles.slice(i+1)]}}{const r={type:"user",text:n.text,richText:null!==(s=n.richText)&&void 0!==s?s:"",isDone:!!e.isMessageDone,isOptimistic:!1,bubbleId:o};return{bubbles:[...t.bubbles,r]}}})),t((e=>{const t=e.bubbles;for(let e=t.length-1;e>=0;e--){const n=t[e];if("user"===n.type&&n.isOptimistic)return{bubbles:[...t.slice(0,e),...t.slice(e+1)]}}return e}))}var i;e.isMessageDone&&t((e=>{const t=s(e.bubbles);if(0===t)return e;const n=e.bubbles[t-1];if(!n||"text"!==n.type&&"user"!==n.type&&"thinking"!==n.type)return e;const o=Object.assign(Object.assign({},n),{isDone:!0});return{bubbles:[...e.bubbles.slice(0,t-1),o,...e.bubbles.slice(t)]}})),e.error&&(i={type:"error",message:(null===(n=e.error)||void 0===n?void 0:n.message)||"An unknown error occurred",errorDetails:null===(o=e.error)||void 0===o?void 0:o.errorDetails},t((e=>{const t=s(e.bubbles);return t===e.bubbles.length?{bubbles:[...e.bubbles,i]}:{bubbles:[...e.bubbles.slice(0,t),i,...e.bubbles.slice(t)]}})))}},"./src/hooks/use-background-actions.ts":(e,t,n)=>{n.d(t,{V:()=>v});var o=n("node:child_process"),r=n("node:fs"),s=n("node:os"),i=n.n(s),l=n("node:path"),a=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),c=n("./src/utils/git.ts"),d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function u(e,t){try{null==e||e(t)}catch(e){}}function p(e,t){return(0,o.execFileSync)("git",e,{cwd:t,encoding:"utf8",stdio:["ignore","pipe","pipe"],maxBuffer:2097152}).trim()}function h(e,t){try{return p(e,t)}catch(e){return}}function g(e){return h(["rev-parse","--abbrev-ref","HEAD"],e)}function m(e,t){(0,r.mkdirSync)((0,l.dirname)(e),{recursive:!0}),(0,r.writeFileSync)(e,t,"utf8")}function f(e,t,n){const s=(0,l.join)(i().tmpdir(),`bg-merge-${Date.now()}-${Math.random().toString(36).slice(2)}`);(0,r.mkdirSync)(s,{recursive:!0});const a=(0,l.join)(s,"base.txt"),c=(0,l.join)(s,"ours.txt"),d=(0,l.join)(s,"theirs.txt"),u=e=>e.replace(/\r\n/g,"\n").replace(/\r/g,"\n");(0,r.writeFileSync)(a,u(e),"utf8"),(0,r.writeFileSync)(c,u(n),"utf8"),(0,r.writeFileSync)(d,u(t),"utf8");const p=["merge-file","-p","-L","Current (Your changes)","-L","Base (Original)","-L","Incoming (Cloud Agent changes)",c,a,d];let h="",g=!1;try{try{h=(0,o.execFileSync)("git",p,{encoding:"utf8",maxBuffer:10485760})}catch(e){const t=e;if(!t||1!==t.status||"string"!=typeof t.stdout)throw e;h=t.stdout,g=!0}}finally{try{(0,r.rmSync)(s,{recursive:!0,force:!0})}catch(e){}}var m;return"\r\n"==(((m=n).match(/\r\n/g)||[]).length>(m.match(/(?<!\r)\n/g)||[]).length?"\r\n":"\n")&&(h=h.replace(/\n/g,"\r\n")),{merged:h,hasConflicts:g}}function v(e){const t=(0,a.useCallback)(((t,n)=>d(this,void 0,void 0,(function*(){var o,r,s;const i=null==n?void 0:n.print,l=null==n?void 0:n.confirm,a=(0,c.ky)(process.cwd());u(i,[{text:"Â» ",dim:!0},{text:"Checking out background branch locally",bold:!0}]);const d=yield e.getBackgroundComposerInfo({bcId:t}),m=null===(r=null===(o=null==d?void 0:d.composer)||void 0===o?void 0:o.composer)||void 0===r?void 0:r.branchName;if(!m)return void u(i,[{text:"error:",color:"red",bold:!0},{text:" No branch available to checkout for this cloud agent"}]);var f;h((f=m)?["fetch","--prune","--tags","origin",f]:["fetch","--all","--prune","--tags"],a);const v=g(a),x=(null!==(s=h(["status","--porcelain"],a))&&void 0!==s?s:"").length>0;if((v&&v!==m||x)&&l&&!(yield l({title:x?"You have local changes that may conflict.":"You are not on the target branch.",detail:x?`Current branch: ${null!=v?v:"unknown"}. Continuing will attempt to check out '${m}'.`:`Current branch: ${null!=v?v:"unknown"}. Will switch to '${m}'.`,continueLabel:"Continue",cancelLabel:"Cancel"})))return;!function(e,t){void 0!==h(["show-ref","--verify",`refs/heads/${t}`],e)?p(["checkout",t],e):p(void 0!==h(["ls-remote","--exit-code","--heads","origin",t],e)?["checkout","-b",t,"--track",`origin/${t}`]:["checkout","-b",t],e),h(["pull","--ff-only"],e)}(a,m);const b=g(a);u(i,[[{text:"âœ” ",color:"green",bold:!0},{text:"Now on branch "},{text:null!=b?b:m,bold:!0}]])}))),[e]),n=(0,a.useCallback)(((t,n)=>d(this,void 0,void 0,(function*(){var o,s,i,a,d,p;const v=null==n?void 0:n.print,x=null==n?void 0:n.confirm,b=(0,c.ky)(process.cwd()),y=g(b);u(v,[{text:"Â» ",dim:!0},{text:"Applying cloud agent changes locally",bold:!0}]);const j=yield e.getOptimizedDiffDetails({bcId:t}),w=[],k=e=>{var t,n;const o=e.to&&"/dev/null"!==e.to?e.to:e.from;if(!o)return;let r=function(e){const t=["/workspace/","file:///workspace/"];for(const n of t)if(e.startsWith(n)){const t=e.slice(n.length);return t.startsWith("/")?t.slice(1):t}return e}(o);r.startsWith("/")&&(r=r.slice(1)),w.push({relativePath:r,isDeleted:"/dev/null"===e.to&&"/dev/null"!==e.from,isNew:"/dev/null"===e.from&&"/dev/null"!==e.to,originalContent:null!==(t=e.beforeFileContents)&&void 0!==t?t:"",finalContent:null!==(n=e.afterFileContents)&&void 0!==n?n:""})};for(const e of null!==(s=null===(o=j.diff)||void 0===o?void 0:o.diffs)&&void 0!==s?s:[])k(e);for(const e of null!==(i=j.submoduleDiffs)&&void 0!==i?i:[])if(!e.errored&&(null===(a=e.diff)||void 0===a?void 0:a.diffs))for(const t of e.diff.diffs){const n=t.to&&"/dev/null"!==t.to?t.to:t.from;if(!n)continue;const o=`${e.relativePath}/${n}`;k(Object.assign(Object.assign({},t),{to:"/dev/null"===t.to?"/dev/null":o,from:"/dev/null"===t.from?"/dev/null":`${e.relativePath}/${t.from}`}))}if(0===w.length)return void u(v,[{text:"No changes to apply.",dim:!0}]);if((null!==(d=h(["status","--porcelain"],b))&&void 0!==d?d:"").length>0&&x&&!(yield x({title:"You have local changes",detail:`Applying ${w.length} changes${y?` from ${y}`:""}. We'll merge into your working tree and show conflict markers where needed.`,continueLabel:"Apply",cancelLabel:"Cancel"})))return;const C=[];let S=0,E=0,$=0,M=0,T=0;for(const e of w){const t=(0,l.resolve)(b,e.relativePath),n=(0,r.existsSync)(t),o=n?(0,r.readFileSync)(t,"utf8"):"",s=e.isDeleted?"":e.finalContent,{merged:i,hasConflicts:a}=f(null!==(p=e.originalContent)&&void 0!==p?p:"",null!=s?s:"",null!=o?o:"");if(e.isDeleted)if(0!==i.length||a)m(t,i),C.push([{text:"â€¢ ",color:a?"red":"green"},{text:e.relativePath,bold:!0},{text:a?" (conflicts)":" (updated)",dim:!0}]),a?T+=1:$+=1,S+=1;else if((0,r.existsSync)(t)){try{(0,r.rmSync)(t,{force:!0})}catch(e){}C.push([{text:"- ",color:"yellow"},{text:e.relativePath,bold:!0},{text:" (deleted)",dim:!0}]),M+=1,S+=1}else C.push([{text:"â€¢ ",color:"gray"},{text:e.relativePath,bold:!0},{text:" (unchanged)",dim:!0}]);else i===o?C.push([{text:"â€¢ ",color:"gray"},{text:e.relativePath,bold:!0},{text:" (unchanged)",dim:!0}]):(m(t,i),n?a?T+=1:$+=1:E+=1,C.push([{text:"â€¢ ",color:a?"red":"green"},{text:e.relativePath,bold:!0},{text:a?" (conflicts)":e.isNew?" (created)":" (updated)",dim:!0}]),S+=1),C.length%10==0&&u(v,C.slice(-10))}const A=[];E>0&&A.push(`${E} created`),$>0&&A.push(`${$} updated`),M>0&&A.push(`${M} deleted`),T>0&&A.push(`${T} with conflicts`);const I=A.length>0?` (${A.join(", ")})`:"",D=[{text:"âœ” ",color:"green",bold:!0},{text:`Applied ${S}/${w.length} file changes${I}`},y?{text:` on ${y}`,dim:!0}:{text:"",dim:!0}];u(v,[...C.slice(-10),D])}))),[e]);return(0,a.useMemo)((()=>({checkoutLocally:t,applyChangesLocally:n})),[t,n])}},"./src/hooks/use-confirm-overlay.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{_:()=>a});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("../ink/build/index.js"),i=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),l=e([s]);function a(){const[e,t]=(0,i.useState)(!1),[n,o]=(0,i.useState)(null),[l,a]=(0,i.useState)(0),c=(0,i.useRef)(null),d=(0,i.useRef)(l);(0,i.useEffect)((()=>{d.current=l}),[l]);const u=(0,i.useCallback)((e=>new Promise((n=>{o(e),a(0),d.current=0,c.current=n,t(!0)}))),[]),p=(0,i.useCallback)((e=>{const n=c.current;c.current=null,t(!1),n&&n(e)}),[]);return(0,s.Ge)(((t,n)=>{e&&(n.upArrow||"k"===t||"K"===t?a((e=>Math.max(0,e-1))):n.downArrow||"j"===t||"J"===t?a((e=>Math.min(1,e+1))):n.return?p(0===d.current):"y"!==t&&"Y"!==t?("n"===t||"N"===t||n.escape||n.ctrl&&"c"===t)&&p(!1):p(!0))}),{isActive:e}),{askConfirm:u,element:(0,i.useMemo)((()=>{var t,o;if(!e||!n)return null;const i=[{key:"y",label:null!==(t=n.continueLabel)&&void 0!==t?t:"Continue",value:!0},{key:"n",label:null!==(o=n.cancelLabel)&&void 0!==o?o:"Cancel",value:!1}];return(0,r.jsx)(s.az,{flexDirection:"column",marginTop:1,marginX:2,children:(0,r.jsxs)(s.az,{flexDirection:"column",borderStyle:"round",borderColor:"yellow",paddingX:2,paddingY:1,children:[(0,r.jsx)(s.az,{children:(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:"yellow",bold:!0,children:"âš  "}),(0,r.jsx)(s.EY,{color:"foreground",bold:!0,children:n.title})]})}),n.detail&&(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"foreground",children:n.detail})}),(0,r.jsx)(s.az,{marginTop:2,flexDirection:"column",children:i.map(((e,t)=>(0,r.jsxs)(s.EY,{children:[(0,r.jsx)(s.EY,{color:l===t?"green":"gray",children:l===t?"â–¶ ":"  "}),(0,r.jsxs)(s.EY,{color:l===t?"foreground":"gray",bold:l===t,children:["[",e.key,"] ",e.label]})]},e.key)))}),(0,r.jsx)(s.az,{marginTop:1,children:(0,r.jsx)(s.EY,{color:"gray",dimColor:!0,children:"Use arrow keys to navigate, Enter to select, or press the key shown"})})]})})}),[e,n,l]),isActive:e}}s=(l.then?(await l)():l)[0],o()}catch(c){o(c)}}))},"./src/hooks/use-current-branch.ts":(e,t,n)=>{n.d(t,{h:()=>d});var o=n("node:fs"),r=n.n(o),s=n("node:path"),i=n.n(s),l=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),a=n("./src/debug.ts"),c=n("./src/utils/path-utils.ts");function d(e){return(0,l.useMemo)((()=>{try{const t=(0,c.rR)(e.root);if(!t)return(0,a.debugLog)(`No .git directory found starting from: ${e.root}`),null;const n=i().join(t,"HEAD");if(!r().existsSync(n))return null;const o=r().readFileSync(n,"utf8").trim(),s=o.match(/^ref: refs\/heads\/(.+)$/);return s?s[1]:/^[0-9a-f]{40}$/.test(o)?o.slice(0,7):null}catch(e){return null}}),[e.root])}},"./src/hooks/use-debounced-callback.ts":(e,t,n)=>{n.d(t,{Y:()=>s});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const r=e=>{e.current&&(clearTimeout(e.current),e.current=null)};function s(e,t,n,s){const i="number"==typeof t?t:0,l=null!=n?n:{},a=!!l.leading,c=!("trailing"in l)||!!l.trailing,d="number"==typeof l.maxWait&&l.maxWait>=0?l.maxWait:void 0,u=(0,o.useRef)(e),p=(0,o.useRef)(null),h=(0,o.useRef)(null),g=(0,o.useRef)(null),m=(0,o.useRef)(null),f=(0,o.useRef)(0),v=(0,o.useRef)(void 0);(0,o.useEffect)((()=>{u.current=e}),[e]);const x=(0,o.useCallback)((()=>{s&&s({})}),[s]),b=(0,o.useCallback)((e=>{const t=g.current,n=m.current;return g.current=null,m.current=null,f.current=e,t?(v.current=u.current.apply(n,t),v.current):v.current}),[]),y=(0,o.useMemo)((()=>{const e=()=>{r(p),c&&g.current&&(b(Date.now()),x()),r(h)},t=()=>{r(h),g.current&&(r(p),b(Date.now()),x())},n=function(...n){const o=Date.now();if(g.current=n,m.current=this,a&&!p.current&&(v.current=u.current.apply(this,n),f.current=o),c&&(r(p),p.current=setTimeout(e,i)),void 0!==d&&!h.current){const e=o-f.current,n=Math.max(0,d-e);h.current=setTimeout(t,n)}return v.current};return n.cancel=()=>{r(p),r(h),g.current=null,m.current=null},n.flush=()=>(r(p),r(h),b(Date.now())),n.isPending=()=>!!p.current,n}),[a,c,i,d,b,x]);return(0,o.useEffect)((()=>()=>{r(p),r(h)}),[]),y}},"./src/hooks/use-git-root.ts":(e,t,n)=>{n.d(t,{_:()=>l});var o=n("node:path"),r=n.n(o),s=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),i=n("./src/utils/path-utils.ts");function l(e){return(0,s.useMemo)((()=>{const t=(0,i.rR)(e.root);return t?r().dirname(t):null}),[e.root])}},"./src/hooks/use-mounted-effect.ts":(e,t,n)=>{n.d(t,{H:()=>r});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");function r(e,t){const n=(0,o.useRef)(!1),r=(0,o.useCallback)(e,null!=t?t:[]);(0,o.useEffect)((()=>{n.current?r():n.current=!0}),[r])}},"./src/hooks/use-screen-size.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{l:()=>l});var r=n("../ink/build/index.js"),s=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),i=e([r]);function l(){const{stdout:e}=(0,r.t$)(),t=(0,s.useCallback)((()=>({height:e.rows,width:e.columns})),[e]),[n,o]=(0,s.useState)(t);return(0,s.useEffect)((()=>{function n(){o(t())}return e.on("resize",n),()=>{e.off("resize",n)}}),[e,t]),n}r=(i.then?(await i)():i)[0],o()}catch(a){o(a)}}))},"./src/hooks/use-send-to-background.ts":(e,t,n)=>{n.d(t,{$:()=>L});var o=n("node:child_process"),r=n("node:crypto"),s=n("../agent-client/dist/index.js"),i=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),l=n("../proto/dist/generated/aiserver/v1/chat_pb.js"),a=n("../../node_modules/.pnpm/@connectrpc+connect@1.6.1_patch_hash=a4b9a5e69295313832387f25b708426bcf53041a2f50bc7b95_a276813e7efa8e1efb8a7b0efc1d56a0/node_modules/@connectrpc/connect/dist/esm/connect-error.js"),c=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),d=n("./src/debug.ts"),u=n("../agent-kv/dist/index.js"),p=n("../proto/dist/generated/agent/v1/agent_pb.js"),h=n("./src/utils/terminal-title.ts"),g=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const m=new u.cm(p.ConversationTurnStructure),f=new u.cm(p.UserMessage);function v(e,t,n){return g(this,void 0,void 0,(function*(){var o,r;const s=new Set,i=e=>{e&&e.length>0&&s.add((0,u.nj)(e))};for(const s of t.turns){i(s);try{const t=yield n.getBlob(e,s);if(t){const s=m.deserialize(t);if("agentConversationTurn"===s.turn.case){const t=s.turn.value;i(t.userMessage);try{const s=yield n.getBlob(e,t.userMessage);if(s){const e=null!==(r=null===(o=f.deserialize(s).selectedContext)||void 0===o?void 0:o.selectedImages)&&void 0!==r?r:[];for(const t of e)"blobId"===t.dataOrBlobId.case&&t.dataOrBlobId.value.length>0?i(t.dataOrBlobId.value):"blobIdWithData"===t.dataOrBlobId.case&&t.dataOrBlobId.value.blobId.length>0&&i(t.dataOrBlobId.value.blobId)}}catch(e){}for(const e of t.steps)i(e)}else if("shellConversationTurn"===s.turn.case){const e=s.turn.value;i(e.shellCommand),i(e.shellOutput)}}}catch(e){}}for(const e of t.todos)i(e);t.summary&&t.summary.length>0&&i(t.summary),t.plan&&t.plan.length>0&&i(t.plan);for(const e of t.summaryArchives)i(e);for(const e of t.rootPromptMessagesJson)i(e);for(const[o,r]of Object.entries(t.subagentStates))if(r.conversationState){const t=yield v(e,r.conversationState,n);for(const e of t)s.add(e)}return s}))}function x(e,t){return g(this,void 0,void 0,(function*(){const n=t.getConversationStateStructure(),o=t.getBlobStore(),r=n.clone();r.fileStatesV2={},r.readPaths=[],r.pendingToolCalls=[],r.previousWorkspaceUris=[];const s=yield v(e,r,o),l=[];let a=0;for(const t of s){const n=(0,u.aD)(t),r=yield o.getBlob(e,n);if(r){const e=new Uint8Array(n),t=new Uint8Array(r);l.push(new i.onr({id:e,value:t})),a+=r.length}}const c=t.getMetadata("name"),d=(0,h.iq)(c)?c:"";return{conversationState:r,preFetchedBlobs:l,agentId:t.getMetadata("agentId"),agentName:d,totalBlobBytes:a}}))}function b(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`}var y=n("./src/utils/git.ts"),j=n("node:fs"),w=n("node:fs/promises"),k=n("node:os"),C=n("node:path"),S=n("node:util"),E=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const $=(0,S.promisify)(o.execFile),M="Cursor: Apply local changes for cloud agent";function T(e,t){try{return(0,o.execFileSync)("git",e,{cwd:t,stdio:["ignore","pipe","pipe"],encoding:"utf8",maxBuffer:2097152}).trimEnd()}catch(e){return}}function A(e,t){return E(this,void 0,void 0,(function*(){try{const{stdout:n}=yield $("git",e,{cwd:t,maxBuffer:2097152});return n.trimEnd()}catch(e){return}}))}function I(e,t){return E(this,void 0,void 0,(function*(){const{stdout:n}=yield function(e,t){return E(this,void 0,void 0,(function*(){var n,o;try{const{stdout:n,stderr:o}=yield $("git",e,{cwd:t,maxBuffer:2097152});return{stdout:n.trim(),stderr:o.trim()}}catch(t){const r=t,s=null!==(o=null!==(n=r.stderr)&&void 0!==n?n:r.message)&&void 0!==o?o:String(t);throw new Error(`git ${e.join(" ")} failed: ${s}`)}}))}(e,t);return n}))}var D=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function _(e,t){try{return(0,o.execFileSync)("git",e,{cwd:t,stdio:["ignore","pipe","ignore"],encoding:"utf8",maxBuffer:1048576}).trim()}catch(e){return}}function P(e){let t=e;e.startsWith("git@github.com:")&&(t=`https://github.com/${e.slice(15).replace(/\.git$/i,"")}`),e.startsWith("ssh://git@github.com/")&&(t=`https://github.com/${e.slice(21).replace(/\.git$/i,"")}`),e.startsWith("git://github.com/")&&(t=`https://github.com/${e.slice(17).replace(/\.git$/i,"")}`),t=t.replace(/\.git$/i,"");const n=t.replace(/^https?:\/\//i,"");return{httpsUrl:t,hostPath:n}}function L(e){const[t,o]=(0,c.useState)(!1),[u,p]=(0,c.useState)(!1),[h,g]=(0,c.useState)(!1),[m,f]=(0,c.useState)(""),v=(0,c.useRef)(!1),S=(0,c.useCallback)((()=>{h&&(v.current=!0)}),[h]),$=(0,c.useCallback)((t=>D(this,void 0,void 0,(function*(){var n,r,s;const a=t.trim();if(0===a.length)return{type:"error",message:"Prompt is empty",timestampMs:Date.now()};o(!0);try{const t=process.cwd(),o=(0,y.ky)(t),c=null!==(n=_(["config","--get","remote.origin.url"],o))&&void 0!==n?n:(()=>{var e;const t=_(["remote","-v"],o);if(!t)return;const n=null!==(e=t.split(/\r?\n/).find((e=>e.includes("(fetch)"))))&&void 0!==e?e:t.split(/\r?\n/)[0],r=null==n?void 0:n.split(/\s+/);return null==r?void 0:r[1]})(),d=null!==(r=_(["rev-parse","--abbrev-ref","HEAD"],o))&&void 0!==r?r:"main";if(!c)return{type:"error",message:"Cloud Agent requires a Git remote. Add a GitHub remote and try again.",timestampMs:Date.now()};const{httpsUrl:u,hostPath:p}=P(c);let h;try{h=(yield e.getBackgroundComposerUserSettings({})).modelName}catch(e){}const g=null===(s=(yield e.startBackgroundComposerFromSnapshot({snapshotNameOrId:p,snapshotWorkspaceRootPath:o,devcontainerStartingPoint:{url:u,ref:d,cursorServerCommit:"",userExtensions:[],environmentJsonOverride:"",dontAllowReadingEnvironmentJsonFromDatabase:!1,skipBuildCaches:!1},repoUrl:p,autoBranch:!0,returnImmediately:!0,source:i._bo.EDITOR,modelDetails:h?{modelName:h,maxMode:!0}:{},additionalModelDetails:[],repositoryInfo:{repositoryInfo:void 0,pathEncryptionKey:"",shouldSyncIndex:!1,repositoryInfoShouldQueryStaging:!1,repositoryInfoShouldQueryProd:!1,repoQueryAuthToken:"",queryOnlyRepoAccess:void 0},conversationHistory:[{text:a,richText:a,capabilityContexts:[],type:l.Jc.HUMAN,images:[]}]})).composer)||void 0===s?void 0:s.bcId;let m;if(g)try{const t=yield e.getBackgroundComposerStatus({bcId:g});m=(()=>{switch(t.status){case i.R6p.CREATING:return"CREATING";case i.R6p.RUNNING:return"RUNNING";case i.R6p.FINISHED:return"FINISHED";case i.R6p.ERROR:return"ERROR";case i.R6p.EXPIRED:return"EXPIRED";default:return"UNKNOWN"}})()}catch(e){}return g?{type:"success",bcId:g,repoHostPath:p,branch:d,statusText:m,timestampMs:Date.now()}:{type:"error",message:"Failed to start Cloud Agent",timestampMs:Date.now()}}catch(e){return{type:"error",message:`Failed to start Cloud Agent: ${e instanceof Error?e.message:String(e)}`,timestampMs:Date.now()}}finally{o(!1)}}))),[e]),L=(0,c.useCallback)(((t,n,o)=>D(this,void 0,void 0,(function*(){var r,s;const a=n.trim();if(!t||!a)return{type:"error",message:t?"Follow-up message is empty":"Background composer ID is required",timestampMs:Date.now()};p(!0);try{const n=new l.hS({text:a,richText:a,capabilityContexts:[],type:l.Jc.HUMAN,images:[]});(null==o?void 0:o.bubbleId)&&(n.bubbleId=o.bubbleId);const c=new i.FFs({bcId:t,followupMessage:n,synchronous:null!==(r=null==o?void 0:o.synchronous)&&void 0!==r&&r,followupSource:null!==(s=null==o?void 0:o.source)&&void 0!==s?s:i._bo.CLI});return yield e.addAsyncFollowupBackgroundComposer(c),{type:"success",bcId:t,timestampMs:Date.now()}}catch(e){const t=e instanceof Error?e.message:String(e);return(0,d.debugLog)(`Failed to send follow-up: ${t}`),{type:"error",message:`Failed to send follow-up: ${t}`,timestampMs:Date.now()}}finally{p(!1)}}))),[e]),R=(0,c.useCallback)(((t,o,l,c)=>D(this,void 0,void 0,(function*(){var u,p,h;const{confirm:m,setStatus:S}=l;g(!0);const $=e=>{f(e),S&&S(e)};v.current=!1;const D=()=>v.current;try{$("Checking git status");const s={confirm:m,setStatus:$},l=yield function(e){return E(this,void 0,void 0,(function*(){var t,n,o,r,s;const{confirm:i,setStatus:l}=e,a=process.cwd(),c=(0,y.ky)(a),d=e=>({success:!1,error:e,repoRoot:c,branch:"",originalBranch:"",commit:"",remoteUrl:""});if(!(0,j.existsSync)((0,C.join)(c,".git")))return d("Not a git repository. Initialize with: git init && git remote add origin <url>");const u=T(["config","--get","remote.origin.url"],c);if(!u)return d("No remote 'origin' configured. Add with: git remote add origin <url>");const p=T(["rev-parse","--abbrev-ref","HEAD"],c);if(!p||"HEAD"===p)return d("Not on a branch (detached HEAD). Checkout a branch first: git checkout -b <branch>");const h=yield A(["ls-remote","--heads","origin",p],c);if(!h||0===h.length){if(!(yield i({title:"Branch Not Pushed",detail:`The branch "${p}" is not on the remote repository. Push to remote before kicking off agent?`,continueLabel:"Push",cancelLabel:"Cancel"})))return d("Cancelled by user");try{null==l||l("Pushing branch"),yield I(["push","-u","origin",p],c);const e=yield A(["ls-remote","--heads","origin",p],c);if(!e||0===e.length)return d("Push completed but branch not found on remote")}catch(e){return d(`Failed to push branch: ${e instanceof Error?e.message:String(e)}`)}}yield A(["fetch","origin",p],c);const g=T(["rev-list","--count",`origin/${p}..HEAD`],c),m=parseInt(null!=g?g:"0",10),f=null!==(t=yield A(["diff","--no-color"],c))&&void 0!==t?t:"",v=null!==(n=yield A(["diff","--cached","--no-color"],c))&&void 0!==n?n:"";let x,b;if(f.trim().length>0||v.trim().length>0||m>0)try{null==l||l("Preparing branch"),x=yield function(e,t){return E(this,void 0,void 0,(function*(){var n;const o=yield function(e){return E(this,void 0,void 0,(function*(){var t;const n=[],o=(null!==(t=yield A(["status","--porcelain","-z","-uall"],e))&&void 0!==t?t:"").split("\0");let r=0;for(;r<o.length;){const e=o[r];if(""===e){r++;continue}if(e.length<4){r++;continue}const t=e.substring(0,2).trim(),s=e.substring(3);t.startsWith("R")||t.startsWith("C")?r+=2:r++,s&&n.push({path:s,status:t})}return n}))}(e);if(0===o.length)return;const r=function(){const e=Date.now(),t=Math.random().toString(36).substring(2,7);return(0,C.join)((0,k.tmpdir)(),`cursor-worktree-${e}-${t}`)}(),s=`cursor/cloud-agent-${Date.now()}-${Math.random().toString(36).substring(2,7)}`;try{if(yield I(["worktree","add","-b",s,r,t],e),yield function(e,t,n){return E(this,void 0,void 0,(function*(){for(const o of n){const n=(0,C.join)(e,o.path),r=(0,C.join)(t,o.path);if("D"===o.status)try{yield(0,w.unlink)(r)}catch(e){if(e instanceof Error&&"ENOENT"!==e.code)throw e}else if(["M","A","R","C","U","??","AM","MM"].includes(o.status))try{yield(0,w.mkdir)((0,C.dirname)(r),{recursive:!0}),yield(0,w.copyFile)(n,r)}catch(e){console.warn(`Error copying file ${o.path}:`,e)}else console.warn(`Unexpected file status: ${o.status} for file: ${o.path}`)}}))}(e,r,o),yield I(["add","-A"],r),""!==(null!==(n=yield A(["status","--porcelain"],r))&&void 0!==n?n:"").trim())try{yield I(["commit","-m",M],r)}catch(e){return void console.warn("Failed to commit changes in worktree:",e)}else console.warn("No changes to commit in worktree after copying dirty files");try{yield I(["push","--set-upstream","origin",s],r)}catch(e){console.warn(`Failed to push branch ${s}, continuing anyway:`,e)}return s}finally{try{yield A(["worktree","remove",r,"--force"],e)}catch(t){try{yield(0,w.rm)(r,{recursive:!0,force:!0}),yield A(["worktree","prune"],e)}catch(e){}}}}))}(c,"HEAD")}catch(e){return d(`Failed to prepare worktree with changes: ${e instanceof Error?e.message:String(e)}`)}return b=x?null!==(r=null!==(o=T(["rev-parse",`origin/${x}`],c))&&void 0!==o?o:T(["rev-parse","HEAD"],c))&&void 0!==r?r:"":null!==(s=T(["rev-parse","HEAD"],c))&&void 0!==s?s:"",{success:!0,repoRoot:c,branch:null!=x?x:p,originalBranch:p,commit:b,remoteUrl:u,worktreeBranch:x}}))}(s);if(!l.success)return{type:"cancelled",reason:null!==(u=l.error)&&void 0!==u?u:"Git preparation failed",timestampMs:Date.now()};if(D())return{type:"cancelled",reason:"Transfer cancelled by user",timestampMs:Date.now()};$("Exporting conversation");const a=yield x(t,o);$("Validating transfer size");const h=function(e,t=104857600){if(e.totalBlobBytes>t)return`Conversation is too large to transfer (${b(e.totalBlobBytes)} > ${b(t)}). Try starting a new conversation with a summary of the current one.`}(a);if(h)return{type:"error",message:h,timestampMs:Date.now()};if(D())return{type:"cancelled",reason:"Transfer cancelled by user",timestampMs:Date.now()};let g;$("Fetching settings");try{g=(yield e.getBackgroundComposerUserSettings({})).modelName}catch(e){}if(D())return{type:"cancelled",reason:"Transfer cancelled by user",timestampMs:Date.now()};$("Creating cloud agent");const{httpsUrl:f,hostPath:v}=P(l.remoteUrl);(0,d.debugLog)("StartBackgroundComposerFromSnapshot request:",{snapshotNameOrId:v,snapshotWorkspaceRootPath:l.repoRoot,repoUrl:v,httpsUrl:f,branch:l.branch,conversationStateTurnCount:a.conversationState.turns.length,conversationStateTodoCount:a.conversationState.todos.length,preFetchedBlobCount:a.preFetchedBlobs.length,totalBlobBytes:a.totalBlobBytes,modelName:g,sampleBlobIds:a.preFetchedBlobs.slice(0,3).map((e=>`${Array.from(e.id.slice(0,8)).map((e=>e.toString(16).padStart(2,"0"))).join("")}... (${e.value.length} bytes)`))});try{const e=a.conversationState.toJsonString();(0,d.debugLog)(`ConversationState JSON length: ${e.length} chars`);const t=a.conversationState.toBinary();(0,d.debugLog)(`ConversationState binary length: ${t.length} bytes`);for(let e=0;e<a.preFetchedBlobs.length;e++){const t=a.preFetchedBlobs[e];try{t.toBinary()}catch(t){throw(0,d.debugLog)(`Failed to serialize preFetchedBlob ${e}:`,String(t)),t}}(0,d.debugLog)("All preFetchedBlobs validated successfully")}catch(e){return(0,d.debugLog)("Failed to serialize:",String(e)),{type:"error",message:`Invalid data for transfer: ${e instanceof Error?e.message:String(e)}`,timestampMs:Date.now()}}const S=(0,r.randomUUID)(),_=(0,r.randomUUID)();if((0,d.debugLog)("Request fields being sent:",{snapshotNameOrId:v,snapshotWorkspaceRootPath:l.repoRoot,devcontainerUrl:f,devcontainerRef:l.branch,repoUrl:v,modelName:g,agentSessionId:S,kickoffMessageId:_,conversationStateTurns:a.conversationState.turns.length,preFetchedBlobsCount:a.preFetchedBlobs.length}),a.preFetchedBlobs.length>0){const e=a.preFetchedBlobs[0];(0,d.debugLog)("First blob details:",{idLength:e.id.length,valueLength:e.value.length,idIsUint8Array:e.id instanceof Uint8Array,valueIsUint8Array:e.value instanceof Uint8Array})}(0,d.debugLog)("Sending request to startBackgroundComposerFromSnapshot..."),$("Sending to cloud");const{ConversationAction:L,UserMessageAction:R,UserMessage:O}=yield Promise.resolve().then(n.bind(n,"../proto/dist/generated/agent/v1/agent_pb.js")),Y=(null==c?void 0:c.trim())||"Continue working on the current task.",z=new L({action:{case:"userMessageAction",value:new R({userMessage:new O({text:Y,messageId:_,richText:Y}),sendToInteractionListener:!0})}}),N=null===(p=(yield e.startBackgroundComposerFromSnapshot({snapshotNameOrId:v,snapshotWorkspaceRootPath:l.repoRoot,devcontainerStartingPoint:{url:f,ref:l.branch,cursorServerCommit:"",userExtensions:[],environmentJsonOverride:"",dontAllowReadingEnvironmentJsonFromDatabase:!1,skipBuildCaches:!1},repoUrl:v,autoBranch:!0,baseBranch:l.originalBranch,returnImmediately:!0,source:i._bo.CLI,modelDetails:g?{modelName:g,maxMode:!0}:{},additionalModelDetails:[],repositoryInfo:{repositoryInfo:void 0,pathEncryptionKey:"",shouldSyncIndex:!1,repositoryInfoShouldQueryStaging:!1,repositoryInfoShouldQueryProd:!1,repoQueryAuthToken:"",queryOnlyRepoAccess:void 0},conversationState:a.conversationState,preFetchedBlobs:a.preFetchedBlobs,name:a.agentName,conversationAction:z,agentSessionId:S,kickoffMessageId:_,addInitialMessageToResponses:!0})).composer)||void 0===p?void 0:p.bcId;let F;if(N){$("Verifying cloud agent");try{const t=yield e.getBackgroundComposerStatus({bcId:N});F=(()=>{switch(t.status){case i.R6p.CREATING:return"CREATING";case i.R6p.RUNNING:return"RUNNING";case i.R6p.FINISHED:return"FINISHED";case i.R6p.ERROR:return"ERROR";case i.R6p.EXPIRED:return"EXPIRED";default:return"UNKNOWN"}})()}catch(e){}}return N?{type:"success",bcId:N,repoHostPath:v,branch:l.branch,statusText:F,transferredBlobCount:a.preFetchedBlobs.length,transferredBlobBytes:a.totalBlobBytes,worktreeBranch:l.worktreeBranch,timestampMs:Date.now()}:{type:"error",message:"Failed to create cloud agent",timestampMs:Date.now()}}catch(e){const t=e instanceof Error?e.message:String(e);if((0,d.debugLog)(`Transfer to cloud failed: ${t}`),e instanceof a.T){const t=(0,s.mb)(e),n=e.code,o={0:"OK",1:"CANCELED",2:"UNKNOWN",3:"INVALID_ARGUMENT",4:"DEADLINE_EXCEEDED",5:"NOT_FOUND",6:"ALREADY_EXISTS",7:"PERMISSION_DENIED",8:"RESOURCE_EXHAUSTED",9:"FAILED_PRECONDITION",10:"ABORTED",11:"OUT_OF_RANGE",12:"UNIMPLEMENTED",13:"INTERNAL",14:"UNAVAILABLE",15:"DATA_LOSS",16:"UNAUTHENTICATED"};if((0,d.debugLog)("ConnectError details:",{code:n,codeName:null!==(h=o[n])&&void 0!==h?h:`CODE_${n}`,message:e.message,rawMessage:e.rawMessage,details:t}),e.metadata){const t={};e.metadata.forEach(((e,n)=>{t[n]=e})),(0,d.debugLog)("ConnectError metadata:",t)}e.cause&&(0,d.debugLog)("ConnectError cause:",String(e.cause));const r={};for(const t of Object.keys(e))try{r[t]=e[t]}catch(e){r[t]="[unreadable]"}(0,d.debugLog)("ConnectError all properties:",r)}else e instanceof Error&&((0,d.debugLog)("Error stack:",e.stack),e.cause&&(0,d.debugLog)("Error cause:",String(e.cause)));return{type:"error",message:`Transfer failed: ${t}`,timestampMs:Date.now()}}finally{g(!1),f("")}}))),[e]);return(0,c.useMemo)((()=>({isSubmitting:t,isSubmittingFollowup:u,isTransferring:h,transferStatus:m,sendToBackground:$,sendFollowupToBackground:L,transferToCloud:R,cancelTransfer:S})),[t,u,h,m,$,L,R,S])}},"./src/hooks/use-shared-animation.ts":(e,t,n)=>{n.d(t,{e:()=>l,q:()=>r});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");const r=210,s=new Map;function i(e){let t=s.get(e);return t||(t={tick:0,timer:null,listeners:new Set},t.timer=setInterval((()=>{t.tick=t.tick+1;for(const e of t.listeners)e(t.tick)}),e),s.set(e,t)),t}function l(e,t){const[n,r]=(0,o.useState)((()=>i(e).tick));return(0,o.useEffect)((()=>{if(t)return;const n=i(e),o=e=>r(e);return n.listeners.add(o),r(n.tick),()=>{n.listeners.delete(o),0===n.listeners.size&&n.timer&&(clearInterval(n.timer),n.timer=null,s.delete(e))}}),[e,t]),n}},"./src/hooks/use-slash-commands.ts":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{d:()=>L});var r=n("node:child_process"),s=n("node:crypto"),i=n("node:fs"),l=n("node:os"),a=n("node:path"),c=n("../mcp-agent-exec/dist/index.js"),d=n("../proto/dist/generated/aiserver/v1/dashboard_pb.js"),u=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),p=n("./src/commands/custom-commands.ts"),h=n("./src/commands/logout.tsx"),g=n("./src/commands/set-line-numbers.ts"),m=n("./src/context/agent-state-context.tsx"),f=n("./src/context/config-context.tsx"),v=n("./src/context/slash-command-context.tsx"),x=n("./src/context/vim-mode-context.tsx"),b=n("./src/debug.ts"),y=n("./src/mcp/project-paths.ts"),j=n("./src/mcp/server-suggestions.ts"),w=n("./src/models/filter-legacy-models.ts"),k=n("./src/models/model-utils.ts"),C=n("./src/state/index.ts"),S=n("./src/state/session.ts"),E=n("./src/statsig.ts"),$=n("./src/utils/clipboard.ts"),M=n("./src/utils/fuzzy.ts"),T=n("./src/utils/git.ts"),A=n("./src/utils/oauth-callback.ts"),I=n("./src/utils/open-browser.ts"),D=n("./src/utils/terminal-environment.ts"),_=e([h]);h=(_.then?(await _)():_)[0];var P=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function L({credentialManager:e,configProvider:t,modelManager:o,mcpLoader:_,disabledStore:L,dashboardClient:R,autoRunAvailability:O}){const{vimEnabled:Y,toggleVimEnabled:z}=(0,x.v)(),{dynamicCommands:N}=((0,f.$i)(),(0,v.x)()),{agentStore:F,setIsSummarizing:B}=(0,m.C9)(),[U,q]=(0,u.useState)((()=>o.getAvailableModels())),[H,W]=(0,u.useState)([]),[G,X]=(0,u.useState)(null);(0,u.useEffect)((()=>o.subscribe((()=>{q(o.getAvailableModels())}))),[o]);const K=(0,E.QF)("enable_skills");(0,u.useEffect)((()=>{(()=>{P(this,void 0,void 0,(function*(){try{const e=(0,T.ky)(process.cwd())||process.cwd(),t=new p.FD(R),n=yield t.loadCommands(e,{includeSkills:K});W(n),X(t)}catch(e){(0,b.debugLog)("Failed to load cursor commands:",e),W([]),X(null)}}))})()}),[R,K]);const Q=(0,u.useMemo)((()=>{const u=[];u.push({id:"model",title:"Model",description:"Set the current model",inline:!0,args:[{id:"model"}],getArgSuggestions:(e,t,n)=>{const o=t.join(" ").trim(),r=e=>({value:e.displayName||e.displayNameShort||e.displayModelId||"",description:""});return o?U.map(r).map(((e,t)=>({s:e,originalIndex:t,score:(0,M.dt)(e.value,o)}))).filter((e=>e.score>0)).sort(((e,t)=>t.score!==e.score?t.score-e.score:e.originalIndex-t.originalIndex)).map((e=>e.s)):(0,w.s)(U).map(r)},run:(e,n,r)=>{var s,i,l;const a=n.join(" ").trim();if(!a)return;let c=o.normalizeModelId(a);if(!c){if(!a.startsWith("GENERICBASE"))throw null===(s=r.clearInput)||void 0===s||s.call(r),new Error(`Unknown model: ${a}.`);c={modelId:a,displayModelId:a,displayName:a,displayNameShort:a}}if(!0!==t.get().maxMode||(0,k.B)(c))null===(l=r.onModelChange)||void 0===l||l.call(r,c);else{const e=(0,k.U)(c);e.maxMode=!0,null===(i=r.onModelChange)||void 0===i||i.call(r,e)}r.insertText("")}});const p="disabled"===(null==O?void 0:O.type),m="sandbox-only"===(null==O?void 0:O.type)?"Auto-run in sandbox":"Run Everything";u.push({id:"auto-run",title:"Auto-Run",description:p?"Auto-run is disabled by admin settings":`Toggle ${m} mode or set [on|off|status]`,args:[{id:"state",required:!1}],getArgSuggestions:(e,t,n)=>{const o=(t[0]||"").trim().toLowerCase(),r=p?[{value:"status",description:"Show current status"}]:[{value:"on",description:`Enable ${m} mode`},{value:"off",description:"Disable (use sandbox if available)"},{value:"toggle",description:`Toggle ${m} mode`},{value:"status",description:"Show current status"}];return o?r.filter((e=>e.value.startsWith(o))):r},run:(e,t,n)=>{var o,r,s,i,l,a;const c=(t[0]||"").trim().toLowerCase(),d=F.getMetadata("mode");if("status"===c){const e="auto-run"===d?`ON (${m})`:"OFF";return null===(o=n.print)||void 0===o||o.call(n,[[{text:"Auto-run: ",dim:!0},{text:e,color:"auto-run"===d?"yellow":"gray"}]]),void n.insertText("")}if(p&&"off"!==c&&(""!==c&&"toggle"!==c||"auto-run"!==d))return null===(r=n.print)||void 0===r||r.call(n,[[{text:"Auto-run is disabled by admin settings (no sandbox available)",color:"red"}]]),void(null===(s=n.clearInput)||void 0===s||s.call(n));let u;if(""===c||"toggle"===c)u="auto-run"===d?"default":"auto-run";else if("on"===c)u="auto-run";else{if("off"!==c)return null===(i=n.print)||void 0===i||i.call(n,[[{text:"Usage: /auto-run [on|off|toggle|status]",color:"red"}]]),void(null===(l=n.clearInput)||void 0===l||l.call(n));u="default"}F.setMetadata("mode",u);const h="auto-run"===u?`ON (${m})`:"OFF";null===(a=n.print)||void 0===a||a.call(n,[[{text:"Auto-run: ",dim:!0},{text:h,color:"auto-run"===u?"yellow":"gray"}]]),n.insertText("")}}),u.push({id:"plan",title:"Plan Mode",description:"Toggle plan mode or submit a prompt in plan mode",args:[{id:"prompt",required:!1}],run:(e,t,n)=>{var o,r,s;const i=(t||[]).join(" ").trim();i.length>0?(F.setMetadata("mode","plan"),null===(o=n.submitMessage)||void 0===o||o.call(n,i,{mode:"plan"}),n.insertText("")):("plan"===F.getMetadata("mode")?(F.setMetadata("mode","default"),null===(r=n.print)||void 0===r||r.call(n,[[{text:"Plan mode ",dim:!0},{text:"disabled",color:"gray"}]])):(F.setMetadata("mode","plan"),null===(s=n.print)||void 0===s||s.call(n,[[{text:"Plan mode ",dim:!0},{text:"enabled",color:"green"}]])),n.insertText(""))}}),u.push({id:"ask",title:"Ask Mode",description:"Toggle ask mode (Q&A, read-only; no edits or command execution)",run:(e,t,n)=>{var o,r;"search"===F.getMetadata("mode")?(F.setMetadata("mode","default"),null===(o=n.print)||void 0===o||o.call(n,[[{text:"Ask mode ",dim:!0},{text:"disabled",color:"gray"}]])):(F.setMetadata("mode","search"),null===(r=n.print)||void 0===r||r.call(n,[[{text:"Ask mode ",dim:!0},{text:"enabled",color:"green"}]])),n.insertText("")}}),u.push({id:"max-mode",title:"Max Mode",description:"Toggle max mode for higher-capacity model variants",args:[{id:"state",required:!1}],getArgSuggestions:(e,t,n)=>{const o=(t[0]||"").trim().toLowerCase(),r=[{value:"on",description:"Enable max mode"},{value:"off",description:"Disable max mode"}];return o?r.filter((e=>e.value.startsWith(o))):r},run:(e,t,n)=>{var r,s,i,l,a,c,d;const u=(t[0]||"").trim().toLowerCase(),p=o.getCurrentModel();if(!p)return null===(r=n.print)||void 0===r||r.call(n,[[{text:"No model selected",color:"red"}]]),void(null===(s=n.clearInput)||void 0===s||s.call(n));const h=!0===p.maxMode;let g;if(""===u)g=!h;else if("on"===u)g=!0;else{if("off"!==u)return null===(i=n.print)||void 0===i||i.call(n,[[{text:"Usage: /max-mode [on|off]",color:"red"}]]),void(null===(l=n.clearInput)||void 0===l||l.call(n));g=!1}if(g&&(0,k.B)(p))return null===(a=n.print)||void 0===a||a.call(n,[[{text:"Max mode is not available for Auto",color:"yellow"}]]),void n.insertText("");const m=(0,k.U)(p);m.maxMode=g,null===(c=n.onModelChange)||void 0===c||c.call(n,m);const f=[[{text:"Max mode: ",dim:!0},{text:g?"ON":"OFF",color:g?"white":"gray"}]];null===(d=n.print)||void 0===d||d.call(n,f),n.insertText("")}});const f=e=>P(this,void 0,void 0,(function*(){var t,n,o,r,s,i,l;if(null===(t=e.print)||void 0===t||t.call(e,[[{text:"Aborting current operation...",color:"yellow"}]]),!e.onNewChat)return null===(n=e.print)||void 0===n||n.call(e,[[{text:"Restarting requires CLI reload; press Ctrl-C twice.",color:"yellow"}]]),void(null===(o=e.clearInput)||void 0===o||o.call(e));null===(r=e.clearInput)||void 0===r||r.call(e),null===(s=e.print)||void 0===s||s.call(e,[[{text:"Creating new chat...",color:"cyan"}]]);const a=(yield e.onNewChat())||(null===(i=e.getChatId)||void 0===i?void 0:i.call(e));a&&(null===(l=e.print)||void 0===l||l.call(e,[[{text:`New chat: ${a}`,color:"cyan"}]])),e.insertText("")}));u.push({id:"clear",title:"Clear",description:"Start a new chat session",boostedAlts:["new","new-chat","newchat"],run:(e,t,n)=>P(this,void 0,void 0,(function*(){yield f(n)}))}),u.push({id:"compress",title:"Compress Conversation",description:"Summarize the conversation to reduce context",run:(e,t,n)=>P(this,void 0,void 0,(function*(){var e,t,o;if(null===(e=n.clearInput)||void 0===e||e.call(n),0!==F.getConversationStateStructure().turns.length){try{B(!0)}catch(e){}yield null===(o=n.onSummarize)||void 0===o?void 0:o.call(n)}else null===(t=n.print)||void 0===t||t.call(n,[[{text:"No active session.",color:"red"}]])}))}),u.push({id:"vim",title:"Vim Mode",description:"Toggle Vim keys",run:(e,t,n)=>{var o;const r=Y;z(),null===(o=n.print)||void 0===o||o.call(n,["Vim mode "+(r?"disabled":"enabled")]),n.insertText("")}}),u.push({id:"line-numbers",title:"Line Numbers",description:"Toggle line numbers in code blocks",boostedAlts:["lines","numbers"],run:(e,n,o)=>P(this,void 0,void 0,(function*(){var e,n;try{const n=yield(0,g.x)(t);null===(e=o.print)||void 0===e||e.call(o,["Line numbers "+(n?"enabled":"disabled")]),o.insertText("")}catch(e){null===(n=o.print)||void 0===n||n.call(o,[`Error toggling line numbers: ${String(e)}`]),o.insertText("")}}))}),u.push({id:"shell",title:"Shell Mode",description:"Enter Shell Mode (hint: type ! on an empty line)",boostedAlts:["sh","run"],inline:!0,args:[{id:"command",required:!1}],run:(e,t,n)=>{var o;null===(o=n.enterShellMode)||void 0===o||o.call(n);const r=(t||[]).join(" ").trim();r.length>0?n.insertText(r):n.insertText("")}}),u.push({id:"about",title:"About",description:"Show CLI version, system, and account info (copies to clipboard)",run:(t,r,s)=>P(this,void 0,void 0,(function*(){var t,r,i,a,c,d,u,p;null===(t=s.clearInput)||void 0===t||t.call(s);const h=null!=="2026.01.28-fd13201"?"2026.01.28-fd13201":"unknown",g=null!==(c=null!==(i=null===(r=o.getCurrentModel())||void 0===r?void 0:r.displayName)&&void 0!==i?i:null===(a=o.getCurrentModel())||void 0===a?void 0:a.modelId)&&void 0!==c?c:"Auto",m=(0,l.platform)(),f=(yield Promise.resolve().then(n.t.bind(n,"node:os",23))).arch(),v=(0,D.detectTerminalProgram)(),x=(0,D.detectShell)(),b=S.d.getLastRequestId();let y=null;try{const t=yield e.getAccessToken(),o=yield e.getRefreshToken();if(t&&o){const{GetMeRequest:e}=yield Promise.resolve().then(n.bind(n,"../proto/dist/generated/aiserver/v1/dashboard_pb.js"));y=null!==(d=(yield R.getMe(new e({}))).email)&&void 0!==d?d:null}}catch(e){}const j=[`CLI Version: ${h}`,`Model: ${g}`,`OS: ${m} (${f})`,`Terminal: ${v}`,`Shell: ${x}`];b&&j.push(`Last Request ID: ${b}`),j.push(`User Email: ${null!=y?y:"Not logged in"}`);const w=j.join("\n"),k=yield(0,$.e)(w),C=[{label:"CLI Version",value:h},{label:"Model",value:g},{label:"OS",value:`${m} (${f})`},{label:"Terminal",value:v},{label:"Shell",value:x}];b&&C.push({label:"Last Request ID",value:b}),C.push({label:"User Email",value:null!=y?y:"Not logged in",valueColor:y?"cyan":"yellow"});const E=Math.max(...C.map((e=>e.value.length))),M=Math.max(20+E+6,50),T="â”€".repeat(M-2),A=[[{text:`â•­${T}â•®`,dim:!0}],[{text:`â”‚${" ".repeat(M-2)}â”‚`,dim:!0}],[{text:"â”‚  ",dim:!0},{text:"About Cursor CLI",color:"cyan",bold:!0},{text:`${" ".repeat(M-20)}â”‚`,dim:!0}],[{text:`â”‚${" ".repeat(M-2)}â”‚`,dim:!0}]];for(const e of C){const t=e.label.padEnd(20),n=e.value.padEnd(M-20-6);A.push([{text:"â”‚  ",dim:!0},{text:t,dim:!0},{text:n,color:null!==(u=e.valueColor)&&void 0!==u?u:"cyan"},{text:"  â”‚",dim:!0}])}A.push([{text:`â”‚${" ".repeat(M-2)}â”‚`,dim:!0}]),A.push([{text:`â•°${T}â•¯`,dim:!0}]),A.push([]),A.push([{text:k?"âœ“ Copied to clipboard":"Could not copy to clipboard",color:k?"green":"yellow"}]),null===(p=s.print)||void 0===p||p.call(s,A,{minLingerMs:1e4}),s.insertText("")}))}),u.push({id:"setup-terminal",title:"Setup Terminal",description:"Configure your terminal for newlines",visible:()=>{const e=(0,D.detectTerminalProgram)();return!(0,D.terminalSupportsShiftEnter)(e)},run:(e,t,o)=>P(this,void 0,void 0,(function*(){var e,t,r,s;null===(e=o.clearInput)||void 0===e||e.call(o);const i=(0,D.detectTerminalProgram)(),{CONFIGURABLE_TERMINAL_SETUP:l,terminalSupportsShiftEnter:a,configureAppleTerminal:c}=yield Promise.resolve().then(n.bind(n,"./src/utils/terminal-environment.ts"));if(a(i))return null===(t=o.print)||void 0===t||t.call(o,[[{text:"âœ“ Your terminal already supports Shift+Enter!",color:"green"}],[{text:"Press Shift+Enter to insert a newline.",dim:!0}]],{minLingerMs:5e3}),void o.insertText("");if("apple-terminal"===i){const e=c(),t=[];if(e.success)t.push([{text:`âœ“  ${e.message}`,color:"green"}]),e.requiresRestart?(t.push([]),t.push([{text:"Please restart Terminal.app for changes to take effect.",color:"yellow",bold:!0}]),t.push([{text:"Then use Option+Enter to insert newlines.",dim:!0}])):t.push([{text:"Use Option+Enter to insert newlines.",dim:!0}]);else{t.push([{text:`Could not auto-configure: ${e.error}`,color:"red"}]),t.push([]),t.push([{text:"Manual setup:",color:"cyan",bold:!0}]);const n=l[i];if(n)for(const e of n.instructions)""===e?t.push([]):t.push([{text:`  ${e}`,dim:!0}])}return null===(r=o.print)||void 0===r||r.call(o,t,{minLingerMs:1e4}),void o.insertText("")}const d=l[i],u=[];if(u.push([{text:"Setup Terminal",color:"cyan",bold:!0}]),u.push([]),u.push([{text:"Universal options (work in all terminals):",color:"green",bold:!0}]),u.push([{text:"  â€¢ Type \\ then press Enter",dim:!0}]),u.push([{text:"  â€¢ Press Ctrl+J",dim:!0}]),u.push([]),d){u.push([{text:`Setup for ${d.name}:`,color:"cyan",bold:!0}]);for(const e of d.instructions)""===e?u.push([]):u.push([{text:`  ${e}`,dim:!0}])}else u.push([{text:`Detected terminal: ${i}`,color:"yellow"}]),u.push([{text:"No specific setup instructions available.",dim:!0}]),u.push([{text:"Use \\+Enter or Ctrl+J for newlines.",dim:!0}]);null===(s=o.print)||void 0===s||s.call(o,u,{minLingerMs:15e3}),o.insertText("")}))});const v={id:"help",title:"Help",description:"Show help (/help [cmd])",args:[{id:"command",required:!1}],getArgSuggestions:(e,t,n)=>{const o=((null==t?void 0:t[0])||"").trim(),r=o.toLowerCase(),s=u.filter((e=>"help"!==e.id)).map((e=>({value:e.id,description:e.title})));return r?s.map((e=>({s:e,prefix:e.value.toLowerCase().startsWith(r)?1:0,score:(0,M.dt)(`${e.value} ${e.description||""}`,o)}))).filter((e=>e.score>0||e.prefix>0)).sort(((e,t)=>t.prefix-e.prefix||t.score-e.score||e.s.value.localeCompare(t.s.value))).map((e=>e.s)):s},run:(e,t,n)=>{var o,r,s,i;const l=u.filter((e=>"help"!==e.id)),a=t[0];if(!a){const e=[[{text:"Commands:",color:"cyan",bold:!0}]];for(const t of l){const n=(t.args||[]).map((e=>!1!==e.required?`<${e.id}>`:`[${e.id}]`)).join(" "),o=`/${t.id}${n?` ${n}`:""}`;e.push([{text:o,color:"cyan"},...t.description?[{text:" - ",color:"gray"},{text:t.description,dim:!0}]:[]])}return e.push([]),e.push([{text:"Hint:",color:"cyan",bold:!0},{text:" /help <command> for details",dim:!0}]),null===(o=n.print)||void 0===o||o.call(n,e),void n.insertText("")}const c=l.find((e=>e.id.toLowerCase()===a.toLowerCase()));if(!c)return null===(r=n.print)||void 0===r||r.call(n,[`Unknown command: ${a}`,"Run /help to list all commands."]),void(null===(s=n.clearInput)||void 0===s||s.call(n));const d=(c.args||[]).map((e=>!1!==e.required?`<${e.id}>`:`[${e.id}]`)).join(" "),p=[[{text:"Usage:",color:"cyan",bold:!0},{text:` /${c.id}${d?` ${d}`:""}`,color:"cyan"}]];if(c.description&&p.push([{text:c.description,dim:!0}]),c.args&&c.args.length>0){p.push([{text:"Arguments:",color:"cyan",bold:!0}]);for(const e of c.args)p.push([{text:!1!==e.required?`<${e.id}>`:`[${e.id}]`,color:"cyan"}])}null===(i=n.print)||void 0===i||i.call(n,p),n.insertText("")}};u.push(v),u.push({id:"feedback",title:"Feedback",description:"Share feedback with the team",args:[{id:"message",required:!0}],run:(e,t,r)=>P(this,void 0,void 0,(function*(){var e,s,i,a,c,u,p,h,g;const m=t.join(" ").trim();null===(e=r.clearInput)||void 0===e||e.call(r),null===(s=r.print)||void 0===s||s.call(r,[[{text:"Sending feedback...",color:"cyan"}]]);const f=(0,l.platform)(),v=(yield Promise.resolve().then(n.t.bind(n,"node:os",23))).arch(),x=(0,D.detectTerminalProgram)(),y=(0,D.detectShell)(),j=null!==(u=null!==(a=null===(i=o.getCurrentModel())||void 0===i?void 0:i.displayName)&&void 0!==a?a:null===(c=o.getCurrentModel())||void 0===c?void 0:c.modelId)&&void 0!==u?u:"Auto";try{yield R.submitFeedback(new d.SubmitFeedbackRequest({message:m,version:null!=="2026.01.28-fd13201"?"2026.01.28-fd13201":"unknown",lastAgentReqId:null!==(p=S.d.getLastRequestId())&&void 0!==p?p:void 0,os:`${f} (${v})`,terminal:x,shell:y,model:j})),null===(h=r.print)||void 0===h||h.call(r,[[{text:"Feedback sent. Thank you!",color:"green"}]]),(0,b.debugLog)("/feedback: success")}catch(e){null===(g=r.print)||void 0===g||g.call(r,[[{text:"Failed to send feedback",color:"red"}]]),(0,b.debugLog)("/feedback: error",String(e))}finally{r.insertText(""),(0,b.debugLog)("/feedback: done")}}))});const x=(e,t,n)=>{var o,s,i;let l;null===(o=n.clearInput)||void 0===o||o.call(n);try{l=(0,r.execFileSync)("git",["rev-parse","--show-toplevel"],{encoding:"utf8"}).trim()}catch(e){l=process.cwd()}null===(s=n.print)||void 0===s||s.call(n,[[{text:"Opening ",dim:!0},{text:l,color:"cyan"},{text:" in Cursor...",dim:!0}]]);try{const e=(0,r.spawn)("cursor",[l],{stdio:"ignore",detached:!0});"function"==typeof e.unref&&e.unref(),(0,b.debugLog)("/open: launched cursor",l)}catch(e){null===(i=n.print)||void 0===i||i.call(n,[[{text:"Failed to launch cursor CLI",color:"red"}]]),(0,b.debugLog)("/open: failed to launch cursor",String(e))}finally{n.insertText("")}};return u.push({id:"open",title:"Open in Cursor",description:"Open the repository's git root in Cursor",boostedAlts:["cursor"],run:x}),u.push({id:"cursor",title:"Open in Cursor",description:"Alias for /open",run:x}),u.push({id:"resume-chat",title:"Resume Chat",description:"Resume a previous chat by folder name",args:[{id:"chat",required:!0}],getArgSuggestions:(e,t,n)=>{const o=(0,C.r)();try{const e=(0,i.readdirSync)(o,{withFileTypes:!0}).filter((e=>{var t;return e.isDirectory()&&e.name!==(null===(t=n.getChatId)||void 0===t?void 0:t.call(n))})).map((e=>{try{const t=(0,a.join)(o,e.name),n=(0,i.statSync)(t);return{name:e.name,lastModified:n.mtime}}catch(e){return null}})).filter((e=>null!==e)).sort(((e,t)=>t.lastModified.getTime()-e.lastModified.getTime())),t=new Date,r=e=>{const n=Math.floor((Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())-Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))/864e5),o=e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return n<=0?`Today ${o}`:1===n?`Yesterday ${o}`:n<7?`${n} days ago ${o}`:`${e.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})} ${o}`};return e.map((e=>({value:e.name,description:r(e.lastModified)})))}catch(e){return[]}},run:(e,t,n)=>P(this,void 0,void 0,(function*(){var e,o,r,s,l,c;const d=(t[0]||"").trim();if(!d)return;if(d===(null===(e=n.getChatId)||void 0===e?void 0:e.call(n)))return null===(o=n.print)||void 0===o||o.call(n,[[{text:"Cannot resume current chat",color:"red"}]]),void(null===(r=n.clearInput)||void 0===r||r.call(n));const u=(0,C.r)(),p=(0,a.join)(u,d);try{if(!(0,i.statSync)(p).isDirectory())throw new Error("Not a directory")}catch(e){return null===(s=n.print)||void 0===s||s.call(n,[[{text:`Chat not found: ${d}`,color:"red"}]]),void(null===(l=n.clearInput)||void 0===l||l.call(n))}n.onResumeChat?(yield n.onResumeChat(d),n.insertText("")):null===(c=n.print)||void 0===c||c.call(n,[[{text:"Resume not supported in this context",color:"red"}]])}))}),u.push({id:"copy-request-id",title:"Copy Request ID",description:"Copy last request ID",run:(e,t,n)=>P(this,void 0,void 0,(function*(){var e,t;const o=S.d.getLastRequestId();if(!o)return null===(e=n.print)||void 0===e||e.call(n,[[{text:"No request ID found.",color:"red"}],[{text:"Submit a prompt first, then retry /copy-request-id.",dim:!0}]]),void n.insertText("");const r=yield(0,$.e)(o),s=[{text:r?"Copied request id ":"Request id ",color:r?"green":"cyan"},{text:o,color:"cyan"}];null===(t=n.print)||void 0===t||t.call(n,[s],{minLingerMs:8e3}),n.insertText("")}))}),u.push({id:"copy-conversation-id",title:"Copy Conversation ID",description:"Copy current conversation ID",run:(e,t,n)=>P(this,void 0,void 0,(function*(){var e,t,o;const r=null===(e=n.getChatId)||void 0===e?void 0:e.call(n),s=0===F.getConversationStateStructure().turns.length;if(!r||s)return null===(t=n.print)||void 0===t||t.call(n,[[{text:"No conversation ID found.",color:"red"}],[{text:"Start a conversation first, then retry /copy-conversation-id.",dim:!0}]]),void n.insertText("");const i=yield(0,$.e)(r),l=[{text:i?"Copied conversation id ":"Conversation id ",color:i?"green":"cyan"},{text:r,color:"cyan"}];null===(o=n.print)||void 0===o||o.call(n,[l],{minLingerMs:8e3}),n.insertText("")}))}),u.push({id:"logout",title:"Logout",description:"Sign out from Cursor",run:(n,o,r)=>P(this,void 0,void 0,(function*(){yield(0,h.handleLogout)(e,t)}))}),u.push({id:"quit",title:"Quit",description:"Exit",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),setTimeout((()=>{var e;return null===(e=n.exit)||void 0===e?void 0:e.call(n,!1)}),0)}}),u.push({id:"exit",title:"Exit",description:"Exit",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),setTimeout((()=>{var e;return null===(e=n.exit)||void 0===e?void 0:e.call(n,!1)}),0)}}),u.push({id:"mcp",title:"MCP",description:"Manage MCP servers (list, login, enable, disable, list-tools)",ghostText:"[list|login|enable|disable|list-tools] [<identifier>]",args:[{id:"subcommand",required:!1},{id:"identifier",required:!1}],getArgSuggestions:(e,t)=>P(this,void 0,void 0,(function*(){const e=(t[0]||"").trim().toLowerCase();if(t.length<=1){const t=[{value:"list",description:"List MCP servers and their status"},{value:"login",description:"Authenticate with an MCP server"},{value:"enable",description:"Enable an MCP server (approve or re-enable)"},{value:"disable",description:"Disable an MCP server (won't be loaded or prompted)"},{value:"list-tools",description:"List tools for an MCP server"}];return e?t.filter((t=>t.value.startsWith(e))):t}if("login"===e||"enable"===e||"disable"===e||"list-tools"===e){const n=t.slice(1).join(" ").trim();try{return yield(0,j.d)(e,L,n)}catch(e){return[]}}return[]})),run:(e,t,n)=>P(this,void 0,void 0,(function*(){var o,r,s,i,d,u,p,h,g,m,f,v,x,j,w,k,C,S,E,$,M,T,D,P,R,O,Y,z,N,F,B,U,q,H,W,G,X,K;const Q=(t[0]||"").trim().toLowerCase();if(""===Q||"list"===Q)return null===(o=n.clearInput)||void 0===o||o.call(n),null===(r=n.onOpenMcpPager)||void 0===r||r.call(n),void n.insertText("");if("login"===Q){const o=t.slice(1).join(" ").trim();if(!o)return null===(s=n.print)||void 0===s||s.call(n,[[{text:"Usage: /mcp login <identifier>",color:"red"}]]),null===(i=n.clearInput)||void 0===i||i.call(n),void n.insertText("");null===(d=n.clearInput)||void 0===d||d.call(n);try{let t;null===(u=n.print)||void 0===u||u.call(n,[[{text:`Preparing MCP login for ${o}...`,color:"cyan"}]]),null===(p=n.print)||void 0===p||p.call(n,[[{text:`Loading MCP server '${o}' from .cursor/mcp.json or ~/.cursor/mcp.json...`,color:"cyan"}]]);try{t=yield _.loadClient(e,o)}catch(e){const t=e instanceof c.C9?`MCP server '${o}' is disabled. Re-enable it to use /mcp login.`:`Failed to load MCP '${o}': ${(0,A.u1)(e)}`;return null===(h=n.print)||void 0===h||h.call(n,[[{text:t,color:"red"}]],{minLingerMs:5e3}),(0,b.debugLog)("/mcp login: load error",(0,A.u1)(e)),void n.insertText("")}const r=yield t.getState(e);if("ready"===r.kind)null===(g=n.print)||void 0===g||g.call(n,[[{text:`âœ“ MCP '${o}' is ready.`,color:"green"}]],{minLingerMs:5e3}),(0,b.debugLog)("/mcp login: already ready",o);else if("requires_authentication"===r.kind){const e=r.url;null===(m=n.print)||void 0===m||m.call(n,[[{text:`MCP '${o}' requires authentication. Opening your browser...`,color:"cyan"}],[{text:"If it doesn't open, navigate to:",color:"cyan"}],[{text:e,color:"blue"}],[{text:`Listening on ${A.Yt} for the OAuth callback...`,color:"cyan"}]],{minLingerMs:5e3}),e&&((0,I.g1)(e)?(0,I.ph)(e):null===(f=n.print)||void 0===f||f.call(n,[[{text:"Navigate to the following URL in your browser:",color:"cyan"}],[{text:e}]],{minLingerMs:5e3}));try{const e=yield(0,A.T5)();yield r.callback(e),null===(v=n.print)||void 0===v||v.call(n,[[{text:`âœ“ Received authorization code '${e.substring(0,6)}...'.`,color:"green"}],[{text:"You can close the browser. Re-running the command should now complete authentication.",color:"green"}]],{minLingerMs:5e3}),(0,b.debugLog)("/mcp login: success",o,e.substring(0,6))}catch(e){null===(x=n.print)||void 0===x||x.call(n,[[{text:`Authentication callback failed: ${(0,A.u1)(e)}`,color:"red"}]],{minLingerMs:5e3}),(0,b.debugLog)("/mcp login: callback error",(0,A.u1)(e))}}else null===(j=n.print)||void 0===j||j.call(n,[[{text:`Unknown MCP client state for '${o}'.`,color:"red"}]],{minLingerMs:5e3}),(0,b.debugLog)("/mcp login: unknown state",o,r)}catch(e){const t=e instanceof Error?e.message:String(e);null===(w=n.print)||void 0===w||w.call(n,[[{text:"MCP login failed: ",color:"red"}],[{text:t,color:"red",dim:!0}]],{minLingerMs:5e3}),(0,b.debugLog)("/mcp login: error",t)}}else if("enable"===Q){const o=t.slice(1).join(" ").trim();if(!o)return null===(k=n.print)||void 0===k||k.call(n,[[{text:"Usage: /mcp enable <identifier>",color:"red"}]]),null===(C=n.clearInput)||void 0===C||C.call(n),void n.insertText("");null===(S=n.clearInput)||void 0===S||S.call(n);try{const t=process.cwd(),{projectRoot:r,approvalPath:s}=(0,y.C)(t),i=new c.mF(s,r),d=(0,a.join)((0,l.homedir)(),".cursor","mcp.json"),u=(0,a.join)(t,".cursor","mcp.json"),[p,h]=yield Promise.all([(0,c.h1)(d).catch((()=>({mcpServers:{}}))),(0,c.h1)(u).catch((()=>({mcpServers:{}})))]),g=Object.assign(Object.assign({},p.mcpServers),h.mcpServers)[o];if(!g)return null===(E=n.print)||void 0===E||E.call(n,[[{text:`MCP server '${o}' not found in configuration`,color:"red"}],[{text:"Check .cursor/mcp.json or ~/.cursor/mcp.json",dim:!0}]],{minLingerMs:5e3}),void n.insertText("");const m=(0,c.Ko)(o,g,r),f=(yield i.getApprovals()).includes(m),v=yield L.isServerDisabled(o),x=!v;v&&(yield L.removeDisabledServer(o),yield _.load(e,!1));const j=[];f||(yield i.addApproval(m)),x&&f?j.push([{text:`MCP server '${o}' is already enabled`,color:"yellow"}]):j.push([{text:`âœ“ Enabled MCP server: ${o}`,color:"green"}]),null===($=n.print)||void 0===$||$.call(n,j,{minLingerMs:5e3}),(0,b.debugLog)("/mcp enable: success",{identifier:o,wasEnabled:x,wasDisabled:v,isApproved:f})}catch(e){const t=e instanceof Error?e.message:String(e);null===(M=n.print)||void 0===M||M.call(n,[[{text:"MCP enable failed: ",color:"red"}],[{text:t,color:"red",dim:!0}]],{minLingerMs:15e3}),(0,b.debugLog)("/mcp enable: error",t)}}else if("disable"===Q){const o=t.slice(1).join(" ").trim();if(!o)return null===(T=n.print)||void 0===T||T.call(n,[[{text:"Usage: /mcp disable <identifier>",color:"red"}]]),null===(D=n.clearInput)||void 0===D||D.call(n),void n.insertText("");null===(P=n.clearInput)||void 0===P||P.call(n);try{null===(R=n.print)||void 0===R||R.call(n,[[{text:`Disabling MCP server '${o}'...`,color:"cyan"}]]);const t=yield L.isServerDisabled(o);t||(yield L.addDisabledServer(o),yield _.load(e,!1)),t?null===(O=n.print)||void 0===O||O.call(n,[[{text:`MCP server '${o}' is already disabled`,color:"yellow"}]]):null===(Y=n.print)||void 0===Y||Y.call(n,[[{text:`âœ“ Disabled MCP server: ${o}`,color:"green"}],[{text:"The server will no longer be loaded or prompted for approval.",color:"gray"}]]),(0,b.debugLog)("/mcp disable: success",o)}catch(e){const t=e instanceof Error?e.message:String(e);null===(z=n.print)||void 0===z||z.call(n,[[{text:"Failed to disable MCP server: ",color:"red"}],[{text:t,color:"red",dim:!0}]],{minLingerMs:5e3}),(0,b.debugLog)("/mcp disable: error",t)}}else if("list-tools"===Q){const o=t.slice(1).join(" ").trim();if(!o)return null===(N=n.print)||void 0===N||N.call(n,[[{text:"Usage: /mcp list-tools <identifier>",color:"red"}]]),null===(F=n.clearInput)||void 0===F||F.call(n),void n.insertText("");null===(B=n.clearInput)||void 0===B||B.call(n),null===(U=n.print)||void 0===U||U.call(n,[[{text:`Loading tools for '${o}'...`,color:"cyan"}]]);try{let t;try{t=yield _.loadClient(e,o)}catch(e){const t=e instanceof c.C9?`MCP server '${o}' is disabled. Re-enable it before listing tools.`:`Failed to load MCP '${o}': ${(0,A.u1)(e)}`;return null===(q=n.print)||void 0===q||q.call(n,[[{text:t,color:"red"}]],{minLingerMs:5e3}),(0,b.debugLog)("/mcp list-tools: load error",(0,A.u1)(e)),void n.insertText("")}const r=yield t.getTools(e);if(0===r.length)null===(H=n.print)||void 0===H||H.call(n,[[{text:`No tools available for '${o}'`,color:"yellow"}]],{minLingerMs:5e3});else{const e=[[{text:`Tools for '${o}':`,color:"cyan",bold:!0}]];for(const t of r){const n=t.inputSchema&&"object"==typeof t.inputSchema?Object.keys(t.inputSchema.properties||{}).join(", "):"";e.push([{text:`  ${t.name}`,color:"cyan"},...n?[{text:"(",color:"gray"},{text:n,dim:!0},{text:")",color:"gray"}]:[]])}null===(W=n.print)||void 0===W||W.call(n,e,{minLingerMs:8e3})}(0,b.debugLog)("/mcp list-tools: success",o,r.length)}catch(e){const t=e instanceof Error?e.message:String(e);null===(G=n.print)||void 0===G||G.call(n,[[{text:"Failed to list tools: ",color:"red"}],[{text:t,color:"red",dim:!0}]],{minLingerMs:15e3}),(0,b.debugLog)("/mcp list-tools: error",t)}}else null===(X=n.print)||void 0===X||X.call(n,[[{text:"Usage: /mcp [list|login|enable|disable|list-tools] [<identifier>]",color:"red"}]],{minLingerMs:5e3}),null===(K=n.clearInput)||void 0===K||K.call(n);n.insertText("")}))}),u.push({id:"sandbox",title:"Sandbox",description:(()=>{var e,n,o,r;const s=t.get(),i=null!==(n=null===(e=s.sandbox)||void 0===e?void 0:e.mode)&&void 0!==n?n:"disabled",l=null!==(r=null===(o=s.sandbox)||void 0===o?void 0:o.networkAccess)&&void 0!==r?r:"allowlist";return"enabled"===i?"enabled"===l?"âœ“ Sandbox enabled, with network access":"âœ“ Sandbox enabled, network requires approval":"âœ“ Sandbox disabled"})(),run:(e,t,n)=>{var o,r;null===(o=n.clearInput)||void 0===o||o.call(n),null===(r=n.onOpenSandboxPager)||void 0===r||r.call(n),n.insertText("")}}),(0,b.isDebugEnabled)()&&(u.push({id:"debug-test",title:"Debug Test",description:"Emit debug log",visible:()=>(0,b.isDebugEnabled)(),run:(e,t,n)=>{var o;const r=(0,s.randomUUID)();null===(o=n.print)||void 0===o||o.call(n,[[{text:"Emitted debug-test ",dim:!0},{text:r,color:"cyan"}]]),n.insertText("")}}),u.push({id:"throw",title:"Throw Error",description:"Throw test error",args:[{id:"message",required:!1}],visible:()=>(0,b.isDebugEnabled)(),run:(e,t,n)=>{var o,r;const i=(null===(o=t.join(" "))||void 0===o?void 0:o.trim())||`debug throw ${(0,s.randomUUID)()}`;throw null===(r=n.clearInput)||void 0===r||r.call(n),new Error(i)}}),u.push({id:"pq",title:"Open in Prompt Quality",description:"Open last request dashboard",visible:()=>(0,b.isDebugEnabled)(),run:(e,t,n)=>P(this,void 0,void 0,(function*(){var e,t;const o=S.d.getLastRequestId();if(!o)return null===(e=n.print)||void 0===e||e.call(n,[[{text:"No request ID found.",color:"red"}],[{text:"Submit a prompt first, then retry /pq.",dim:!0}]]),void n.insertText("");const r=`http://go/prompts/?requestId=${o}`;null===(t=n.print)||void 0===t||t.call(n,[[{text:"Opening ",dim:!0},{text:r,color:"cyan"}]]),yield(0,I.ph)(r),n.insertText("")}))})),[...u,...N,...H].filter((e=>!e.visible||e.visible()))}),[Y,N,H,e,t,U,o,_,L,R,F.getConversationStateStructure,F.getMetadata,F.setMetadata,B,z,null==O?void 0:O.type]);return(0,u.useMemo)((()=>({commands:Q,findSkillReferences:e=>K&&G?G.findSkillReferences(e):{skills:[],cleanedMessage:e}})),[Q,G,K])}o()}catch(R){o(R)}}))},"./src/hooks/use-sudo-password-requests.ts":(e,t,n)=>{n.d(t,{k:()=>r});var o=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js");function r(e){const[t,n]=(0,o.useState)([]);(0,o.useEffect)((()=>{if(e)return e.subscribe(n);n([])}),[e]);const r=(0,o.useCallback)(((t,n)=>{null==e||e.submitPassword(t,n)}),[e]),s=(0,o.useCallback)((t=>{null==e||e.cancelRequest(t)}),[e]);return{requests:t,currentRequest:t.length>0?t[0]:null,submitPassword:r,cancelRequest:s}}},"./src/image-processing.ts":(e,t,n)=>{n.d(t,{w:()=>c});var o=n("node:fs"),r=n("../proto/dist/generated/agent/v1/selected_context_pb.js"),s=n("../../node_modules/.pnpm/jimp@1.6.0/node_modules/jimp/dist/esm/index.js"),i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function l(e){if(255===e[0]&&216===e[1]&&255===e[2])return"image/jpeg";if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return"image/png";if(71===e[0]&&73===e[1]&&70===e[2])return"image/gif";if(82===e[0]&&73===e[1]&&70===e[2]&&70===e[3])return"image/webp";throw new Error("Unsupported image type: supported formats are jpeg, png, gif, or webp.")}const a=["userMessageAction"],c=e=>i(void 0,void 0,void 0,(function*(){const t=e.action.case;if(!a.includes(t))return;const n=e.action.value.userMessage;if(!n)return;const o=n.selectedContext;if(!o||0===o.selectedImages.length)return;const r=o.selectedImages.map((e=>e.path)).filter((e=>!!e));if(0===r.length)return;const s=yield d(r);o.selectedImages=s})),d=e=>i(void 0,void 0,void 0,(function*(){return(yield Promise.allSettled(e.map((e=>i(void 0,void 0,void 0,(function*(){const t=yield o.promises.readFile(e),n=yield function(e,t){return i(this,void 0,void 0,(function*(){var n,o,r,i,l,a;const c=yield s.dK.read(Buffer.from(e));let d=null!==(n=c.width)&&void 0!==n?n:t,u=null!==(o=c.height)&&void 0!==o?o:t;(d>t||u>t)&&c.scaleToFit({w:t,h:t});let p=yield c.getBuffer("image/jpeg",{quality:80}),h=80,g=.9;for(;p.length>5242880&&(h>=10||g>.1);)h>=10?(p=yield c.getBuffer("image/jpeg",{quality:h}),h-=10):(d=Math.floor((null!==(r=c.width)&&void 0!==r?r:t)*g),u=Math.floor((null!==(i=c.height)&&void 0!==i?i:t)*g),c.scaleToFit({w:d,h:u}),p=yield c.getBuffer("image/jpeg",{quality:90}),g*=.8);return{bytes:new Uint8Array(p),width:null!==(l=c.width)&&void 0!==l?l:d,height:null!==(a=c.height)&&void 0!==a?a:u}}))}(new Uint8Array(t),2048);return new r.d({dimension:{width:n.width,height:n.height},mimeType:l(n.bytes),dataOrBlobId:{case:"data",value:new Uint8Array(n.bytes)}})})))))).filter((e=>"fulfilled"===e.status)).map((e=>e.value))}))},"./src/mcp/approval.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{Cz:()=>v,Ny:()=>x,Vh:()=>f});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:os"),i=n("node:path"),l=n.n(i),a=n("../ink/build/index.js"),c=n("../mcp-agent-exec/dist/index.js"),d=n("./src/components/approval-dialog.tsx"),u=n("./src/debug.ts"),p=n("./src/mcp/disabled-store.ts"),h=n("./src/mcp/project-paths.ts"),g=e([a,d]);[a,d]=g.then?(await g)():g;var m=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function f(e){return m(this,void 0,void 0,(function*(){const{projectRoot:t,approvalPath:n,disabledPath:o}=e,r={mcpServers:{}},i=l().join((0,s.homedir)(),".cursor","mcp.json"),a=l().join(t,".cursor","mcp.json"),[d,h]=yield Promise.all([(0,c.h1)(i).catch((()=>({mcpServers:{}}))),(0,c.h1)(a).catch((()=>({mcpServers:{}})))]);let g=[];try{const e=new c.mF(n,t);g=yield e.getApprovals()}catch(e){const t=e instanceof Error?e.message:String(e);(0,u.debugLogJSON)("Failed to read MCP approvals:",t);for(const[e,t]of[...Object.entries(d.mcpServers),...Object.entries(h.mcpServers)])r.mcpServers[e]=t;return{servers:r,error:`Could not read MCP approvals: ${t}`}}let m=[];try{const e=new p.P(o);m=yield e.getDisabledServers()}catch(e){(0,u.debugLogJSON)("Failed to read disabled MCP servers:",e instanceof Error?e.message:String(e))}for(const[e,n]of[...Object.entries(d.mcpServers),...Object.entries(h.mcpServers)]){if(m.includes(e))continue;const o=(0,c.Ko)(e,n,t);g.includes(o)||(r.mcpServers[e]=n)}return{servers:r}}))}function v(e,t){return m(this,void 0,void 0,(function*(){const{projectRoot:n,approvalPath:o}=t,r=new c.mF(o,n),s=Object.entries(e.mcpServers).map((([e,t])=>(0,c.Ko)(e,t,n)));yield r.addApprovals(s)}))}function x(e){return m(this,void 0,void 0,(function*(){const t=null!=e?e:process.cwd(),n=(0,h.C)(t),{servers:o,error:s}=yield f(n);return 0===Object.keys(o.mcpServers).length||(yield(0,d.b)({title:"MCP Server Approval Required",description:["Some MCP servers can execute code and read your data. Learn more at cursor.com/docs/context/mcp","The following MCP servers need to be approved:"],content:(0,r.jsxs)(r.Fragment,{children:[Object.entries(o.mcpServers).map((([e,t])=>(0,r.jsxs)(a.EY,{color:"cyan",children:["â€¢ ",e,"command"in t&&(0,r.jsxs)(a.EY,{color:"gray",children:[" (command: ",t.command,")"]}),"url"in t&&(0,r.jsxs)(a.EY,{color:"gray",children:[" (url: ",t.url,")"]})]},e))),s&&(0,r.jsxs)(a.EY,{color:"yellow",children:["\n","âš  Warning: ",s]})]}),options:[{key:"a",label:"Approve all servers",value:"approved"},{key:"c",label:"Continue without approval",value:"continued"},{key:"q",label:"Quit",value:"quit"}],onAction:e=>m(this,void 0,void 0,(function*(){if("approved"===e)try{yield v(o,n)}catch(e){(0,u.debugLogJSON)("Failed to save MCP server approvals:",e instanceof Error?e.message:String(e))}}))}))}))}o()}catch(b){o(b)}}))},"./src/mcp/server-suggestions.ts":(e,t,n)=>{n.d(t,{d:()=>a});var o=n("node:os"),r=n("node:path"),s=n("../mcp-agent-exec/dist/index.js"),i=n("./src/mcp/project-paths.ts"),l=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function a(e,t){return l(this,arguments,void 0,(function*(e,t,n=""){const{projectRoot:l}=(0,i.C)(process.cwd()),a=(0,r.join)((0,o.homedir)(),".cursor","mcp.json"),c=(0,r.join)(l,".cursor","mcp.json"),[d,u,p]=yield Promise.all([(0,s.h1)(a).catch((()=>({mcpServers:{}}))),(0,s.h1)(c).catch((()=>({mcpServers:{}}))),t.getDisabledServers()]),h=(0,s.N_)(d,u),g=Object.keys(h.mcpServers);if(0===g.length&&("enable"===e||"disable"===e))return[{value:"",description:"No MCP servers configured"}];let m=g;if("disable"===e?m=m.filter((e=>!p.includes(e))):"enable"===e&&(m=m.filter((e=>p.includes(e)))),0===m.length){if("disable"===e)return[{value:"",description:"All MCP servers are currently disabled"}];if("enable"===e)return[{value:"",description:"All MCP servers are currently enabled"}]}const f=m.map((e=>({value:e,description:`MCP server: ${e}`})));if(!n)return f;const v=n.toLowerCase();return f.filter((e=>e.value.toLowerCase().includes(v)))}))}},"./src/models/filter-legacy-models.ts":(e,t,n)=>{n.d(t,{s:()=>r});const o=[{familyPattern:/^GPT-5\.\d(?!.*Codex)(?:\s|$)/i,versions:["GPT-5.1","GPT-5.2"]},{familyPattern:/^GPT-5\.\d Codex(?:\s|$)/i,versions:["GPT-5.1 Codex","GPT-5.2 Codex"]},{familyPattern:/^Opus 4/i,versions:["Opus 4","Opus 4.1","Opus 4.5"]},{familyPattern:/^Sonnet 4/i,versions:["Sonnet 4","Sonnet 4 1M","Sonnet 4.5"]},{familyPattern:/^Gemini \d/i,versions:["Gemini 2.5","Gemini 3"]}];function r(e){const t=new Set(e.map((e=>e.displayName||e.displayNameShort||e.displayModelId)));return e.filter((e=>!function(e,t){for(const{familyPattern:n,versions:r}of o){if(!n.test(e))continue;let o=-1;for(let t=r.length-1;t>=0;t--)if(e.startsWith(r[t])){o=t;break}if(-1!==o)for(let e=o+1;e<r.length;e++){const n=r[e];for(const e of t)if(e.startsWith(n))return!0}}return!1}(e.displayName||e.displayNameShort||e.displayModelId,t)))}},"./src/pending-decision-store.ts":(e,t,n)=>{n.d(t,{$U:()=>a,uS:()=>l,yB:()=>i});var o=n("./src/analytics.ts"),r=n("./src/utils/url-utils.ts"),s=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const i="web-search",l="web-fetch";class a{constructor(){this.decisions=[],this.listeners=new Set,this.idCounter=0}getPendingDecisions(){return[...this.decisions]}subscribe(e){return this.listeners.add(e),e(this.getPendingDecisions()),()=>{this.listeners.delete(e)}}notifyListeners(){const e=this.getPendingDecisions();this.listeners.forEach((t=>{t(e)}))}addDecision(e){this.decisions=[...this.decisions,e],this.notifyListeners()}removeDecision(e){this.decisions=this.decisions.filter((t=>t.id!==e)),this.notifyListeners()}findDecision(e){return this.decisions.find((t=>t.id===e))}approveDecision(e){const t=this.findDecision(e);t&&((0,o.sx)("cli.request.user_input.response",{tool:t.operation.type||"unknown",response:"approved"}),t.resolve({approved:!0}),this.removeDecision(e))}rejectDecision(e,t){const n=this.findDecision(e);n&&(n.resolve({approved:!1,reason:t}),this.removeDecision(e))}clearAll(){const e=this.getPendingDecisions();for(const t of e)try{t.resolve({approved:!1,reason:"cleared"})}catch(e){}this.decisions=[],this.notifyListeners()}requestApproval(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const r=`decision-${Date.now()}-${this.idCounter++}`;(0,o.sx)("cli.request.user_input.requested",{tool:e.type||"unknown",type:"approval"});const s={id:r,type:"approval",operation:e,timestamp:Date.now(),resolve:t,reject:n};this.addDecision(s)}))}))}requestWebSearchApproval(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{var r;const s=`decision-${Date.now()}-${this.idCounter++}`;(0,o.sx)("cli.request.user_input.requested",{tool:i,type:"approval"});const l={id:s,type:"approval",operation:{type:i,details:{searchTerm:null!==(r=e.searchTerm)&&void 0!==r?r:""}},timestamp:Date.now(),resolve:t,reject:n};this.addDecision(l)}))}))}requestWebFetchApproval(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{var s;const i=`decision-${Date.now()}-${this.idCounter++}`,a=null!==(s=e.url)&&void 0!==s?s:"",c=(0,r.B)(a);(0,o.sx)("cli.request.user_input.requested",{tool:l,type:"approval"});const d={id:i,type:"approval",operation:{type:l,details:{url:a,domain:c}},timestamp:Date.now(),resolve:t,reject:n};this.addDecision(d)}))}))}}},"./src/run-agent.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{J:()=>z});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:path"),i=n("../agent-kv/dist/index.js"),l=n("../context/dist/index.js"),a=n("../context-rpc/dist/index.js"),c=n("../cursor-config/dist/index.js"),d=n("../hooks/dist/index.js"),u=n("../hooks-exec/dist/index.js"),p=n("../ink/build/index.js"),h=n("../local-exec/dist/index.js"),g=n("../mcp-agent-exec/dist/index.js"),m=n("../proto/dist/generated/aiserver/v1/aiserver_connect.js"),f=n("../shell-exec/dist/index.js"),v=n("./src/always-approve-decision-provider.ts"),x=n("./src/always-deny-decision-provider.ts"),b=n("./src/client.ts"),y=n("./src/commands/update-core.ts"),j=n("./src/console-io.ts"),w=n("./src/debug.ts"),k=n("./src/headless.ts"),C=n("./src/models/index.ts"),S=n("./src/pending-decision-store.ts"),E=n("./src/shared/resources.ts"),$=n("./src/state/index.ts"),M=n("./src/state/session.ts"),T=n("./src/state/sqlite-blob-store.ts"),A=n("./src/sudo/index.ts"),I=n("./src/team-hooks-sync.ts"),D=n("./src/ui.tsx"),_=n("./src/utils/api-endpoint.ts"),P=n("./src/utils/auth-errors.ts"),L=e([p,D]);[p,D]=L.then?(await L)():L;var R=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))},O=function(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var o,r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(void 0===o){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose],n&&(r=o)}if("function"!=typeof o)throw new TypeError("Object not disposable.");r&&(o=function(){try{r.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:o,async:n})}else n&&e.stack.push({async:!0});return t},Y=function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var o,r=0;return function e(){for(;o=t.stack.pop();)try{if(!o.async&&1===r)return r=0,t.stack.push(o),Promise.resolve().then(e);if(o.dispose){var s=o.dispose.call(o.value);if(o.async)return r|=2,Promise.resolve(s).then(e,(function(t){return n(t),e()}))}else r|=1}catch(e){n(e)}if(1===r)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}}("function"==typeof SuppressedError?SuppressedError:function(e,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=e,o.suppressed=t,o});function z(e,t,n,o){return R(this,void 0,void 0,(function*(){var L,z,N,F,B,U,q,H,W,G,X,K,Q,J,V,Z,ee,te;const ne={stack:[],error:void 0,hasError:!1};try{const Y=O(ne,(0,l.VI)(e.withName("runAgent")),!1),{backendUrl:oe,insecure:re,print:se,debug:ie=!1,withDiffs:le=!1,resumeChatId:ae,resumeBcId:ce,rgPath:de,diagnosticsProvider:ue,codebaseReferenceProvider:pe,model:he,workspace:ge}=n;ie&&(yield(0,w.initDebug)());try{new URL(oe)}catch(e){(0,j.uQ)(1,`Error: Invalid backend URL "${oe}"`)}const me=(0,$.r)(),fe=ae,ve=fe||crypto.randomUUID(),xe=(0,s.join)(me,ve),be=(0,s.join)(xe,"store.db");let ye;ye=fe?yield T.M.initAndLoad(be):new T.M(be);const je=new i.pH(ye,ye),we=Date.now(),ke=ge?(0,s.resolve)(ge):process.cwd(),Ce=(0,b.ms)(o,oe,re,n.configProvider),Se=new h.J1(Ce);let Ee,$e=!1,Me=!1;try{const e=yield Se.fetchServerConfig();e.agentUrlConfig&&(Ee={agentUrl:e.agentUrlConfig.agentUrl,agentnUrl:e.agentUrlConfig.agentnUrl}),$e=null!==(L=e.cliSandboxDefaultEnabled)&&void 0!==L&&L,Me=null!==(z=e.claudeCodeHooksEnabled)&&void 0!==z&&z}catch(e){yield(0,P.lv)(e,o)}const Te=null===(N=n.configProvider.get().authInfo)||void 0===N?void 0:N.teamId,Ae=null!=Te?(0,c.Vi)({credentialManager:o,endpoint:(0,_.G6)(n.endpoint),configProvider:n.configProvider}):void 0,{hooksConfig:Ie,projectDir:De,teamHooksResultPromise:_e}=yield(0,E.Pb)({workingDirectory:ke,claudeCodeHooksEnabled:Me,teamId:null!=Te?Te:void 0,dashboardClient:Ae});let Pe;const Le=(0,u.jv)(Ie),Re=null!=_e;if(Le||Re){const e=(0,b.OC)(o,{backendUrl:oe,insecure:re,configProvider:n.configProvider}),t=(0,a.Zj)(m.E,e);Pe=(0,b.Np)(t)}let Oe,Ye,ze=()=>{};_e&&(Oe=new Promise((e=>{ze=e})));let Ne,Fe=Ie;if(Le||Re){const e={cursor_version:null!=="2026.01.28-fd13201"?"2026.01.28-fd13201":"1.0.0",user_email:null!==(B=null===(F=n.configProvider.get().authInfo)||void 0===F?void 0:F.email)&&void 0!==B?B:null},t=(0,f.Fn)();if(Ye=new u.WL(Ie,De,e,t,Pe,Oe),_e&&Ye){const e=Ye;_e.then((t=>{null!=t&&(Fe=(0,I.O)(Fe,t.teamHooks,t.teamDir),e.updateConfig(Fe))})).finally((()=>ze()))}}const Be=new Promise((e=>{Ne=e})),Ue=e=>R(this,void 0,void 0,(function*(){var t,o,r;if(Ye&&(Re||Ye.hasHooksForStep(d._E.sessionEnd)))try{const s={conversation_id:ve,generation_id:ve,model:null!==(r=null!==(o=null===(t=null==dt?void 0:dt.getCurrentModel())||void 0===t?void 0:t.modelId)&&void 0!==o?o:he)&&void 0!==r?r:"unknown",session_id:ve,reason:e,duration_ms:Date.now()-we,is_background_agent:"background"===n.mode,final_status:e};yield Ye.executeHookForStep(d._E.sessionEnd,s)}catch(e){(0,w.debugLogJSON)("[hooks] sessionEnd hook failed:",e)}finally{null==Ye||Ye.clearSessionEnvironment()}})),qe=(0,E.A1)(n.configProvider,n.endpoint),He=()=>R(this,void 0,void 0,(function*(){var e;const t=null!==(e=n.configProvider.get().approvalMode)&&void 0!==e?e:"allowlist";if(!n.force&&"unrestricted"!==t)return!1;try{const e=yield qe.getAutoRunControls();if(!0===(null==e?void 0:e.enabled)&&!0!==e.enableRunEverything)return n.force&&(0,j.uQ)(1,"Error: Your team administrator has disabled the 'Run Everything' option.\nPlease run without '--force' to approve commands individually, or contact your administrator to enable this feature."),!1}catch(e){(0,w.debugLogJSON)("Warning: Could not fetch team admin settings for auto-run check:",e)}return!0})),We=new S.$U,Ge=new A.Ek;let Xe,Ke=null;if(!se){const e=(0,A.Gx)();if(e){Ke=new A._A;try{const t=yield Ke.start();Xe={socketPath:t,helperPath:e},Ke.onPasswordRequest((e=>R(this,void 0,void 0,(function*(){return Ge.addRequest(e)})))),(0,w.debugLog)("askpass.server.started",{socketPath:t,helperPath:e})}catch(e){(0,w.debugLog)("askpass.server.startFailed",{error:e instanceof Error?e.message:String(e)}),Ke=null}}else(0,w.debugLog)("askpass.helper.notFound",{})}const Qe=()=>R(this,void 0,void 0,(function*(){Ke&&(Ge.cancelAll(),yield Ke.stop(),Ke=null)})),Je=(yield He())?new v.I:se?new x.N:We,{createLocalResourceProvider:Ve,permissionsService:Ze,fileChangeTracker:et,dashboardClient:tt,mcpLoader:nt,disabledStore:ot,isRepository:rt,autoRunAvailability:st,setGetIsAutoRun:it,setGetIsAskMode:lt}=yield(0,E._Y)(Y.ctx,{configProvider:n.configProvider,decisionProvider:Je,workingDirectory:ke,rgPath:de,withDiffs:le,getIsAutoRun:()=>"auto-run"===je.getMetadata("mode"),getIsAskMode:()=>"search"===je.getMetadata("mode"),isBrowserUserEnabled:n.isBrowserUseEnabled,ignoreApproveMcps:null!==(U=n.approveMcps)&&void 0!==U&&U,sandboxOverride:n.sandboxOverride,sandboxDefaultEnabled:$e,claudeCodeHooksEnabled:Me,hookExecutor:Ye,hooksConfig:Ie,teamHooksResultPromise:_e,hooksAdditionalContextPromise:Be,promptHookClient:Pe,endpoint:n.endpoint,teamSettingsService:qe,askpassConfig:Xe}),at=(0,b.t9)(o,{backendUrl:oe,insecure:re,configProvider:n.configProvider}),ct=(0,b.c3)(o,oe,n.configProvider),dt=yield C.P3.init(at,{configProvider:n.configProvider,initialModel:he}),ut=yield nt.load(e),pt=new g.uz(ut);if(fe)try{yield je.resetFromDb(e);const t=je.getMetadata("lastUsedModel");yield dt.setModelFromStoredId(t,n.configProvider);const o=yield je.getLastRequestIdFromConversation(e);o&&M.d.recordLastRequest(o)}catch(e){(0,j.uQ)(1,`Failed to resume chat "${fe}": ${e instanceof Error?e.message:String(e)}`)}!fe&&Ye&&(Re||Ye.hasHooksForStep(d._E.sessionStart))?(()=>{R(this,void 0,void 0,(function*(){var e,t;try{const o=yield dt.awaitCurrentModel(),r={conversation_id:ve,generation_id:ve,model:null!==(t=null!==(e=o.modelId)&&void 0!==e?e:he)&&void 0!==t?t:"unknown",session_id:ve,is_background_agent:"background"===n.mode,composer_mode:n.mode},s=yield Ye.executeHookForStep(d._E.sessionStart,r);s&&(s.env&&Ye.setSessionEnvironment(s.env),s.additional_context&&(0,w.debugLog)("[hooks] sessionStart additional_context received",{length:s.additional_context.length})),Ne(null==s?void 0:s.additional_context)}catch(e){(0,w.debugLogJSON)("[hooks] sessionStart hook failed:",e),Ne(void 0)}}))})():Ne(void 0),n.force&&je.setMetadata("mode","auto-run");const ht=n.mode;if(ce)je.setMetadata("mode","background"),je.setMetadata("resumeBcId",ce);else if(ht&&["plan","ask","background"].includes(ht)){const e="ask"===ht?"search":ht;je.setMetadata("mode",e)}const gt=(e,t)=>(M.d.recordLastRequest(e.requestId,{path:e.inner.url}),t(e)),mt=(0,b.hO)(o,{backendUrl:oe,insecure:re,requestMiddleware:gt,configProvider:n.configProvider,agentEndpoint:n.agentEndpoint,serverAgentUrlConfig:Ee});let ft=n.configProvider.get();const vt=ft.authInfo;(null===(q=null==vt?void 0:vt.email)||void 0===q?void 0:q.endsWith("@anysphere.co"))&&"static"!==ft.channel&&"prod-stable-internal"!==ft.channel&&(yield n.configProvider.transform((e=>Object.assign(Object.assign({},e),{channel:"lab"}))),ft=n.configProvider.get()),null!==(H=n.disableAutoUpdate)&&void 0!==H&&H||"static"===ft.channel||(0,y.N)({dashboardClient:tt,showProgress:!1,channel:ft.channel,isAutoUpdate:!0}).catch((e=>{(0,w.debugLogJSON)("backgroundUpdateCheckFailed",e)}));let xt=!1;try{if(se){if(ie){const e=(0,w.getDebugSession)();e&&(0,j.p2)(`Debug server: ${e.serverUrl} (log: ${e.logFile})`)}const o=Ve({diagnosticsProvider:ue,mcpLease:pt,codebaseReferenceProvider:pe,conversationId:ve,generationId:ve,model:null!==(X=null!==(G=null===(W=dt.getCurrentModel())||void 0===W?void 0:W.modelId)&&void 0!==G?G:he)&&void 0!==X?X:"unknown"});yield(0,k.t)(e,t,dt,mt,o,je,null!==(K=n.force)&&void 0!==K&&K,{outputFormat:null!==(Q=n.outputFormat)&&void 0!==Q?Q:"text",streamPartialOutput:n.streamPartialOutput,sessionId:ve,apiKeySource:null!==(J=n.apiKeySource)&&void 0!==J?J:"login",headers:n.headers,captureEnv:null!==(V=n.printEnv)&&void 0!==V&&V,customSystemPrompt:n.customSystemPrompt,enableRetries:n.enableRetries,onSessionEnd:Ue})}else{const s=ie?(0,w.getDebugSession)():null,i=new h.Aj,l=Ve({diagnosticsProvider:ue,mcpLease:pt,codebaseReferenceProvider:pe,shellManager:i,conversationId:ve,generationId:ve,model:null!==(te=null!==(ee=null===(Z=dt.getCurrentModel())||void 0===Z?void 0:Z.modelId)&&void 0!==ee?ee:he)&&void 0!==te?te:"unknown"});if(process.stdin.isTTY)try{process.stdin.resume(),process.stdout.write("[>1u");const e=()=>{try{process.stdout.write("[<u")}catch(e){}};process.on("SIGINT",(()=>R(this,void 0,void 0,(function*(){e(),yield Qe(),yield Ue("aborted"),process.exit(130)})))),process.on("SIGTERM",(()=>R(this,void 0,void 0,(function*(){e(),yield Qe(),yield Ue("aborted"),process.exit(143)})))),process.on("exit",e)}catch(e){(0,w.debugLog)("Failed to resume stdin",{error:e})}const{waitUntilExit:a}=(0,p.XX)((0,r.jsx)(D.X,{ctx:e,prompt:t,agentClient:mt,aiServerClient:at,resources:l,agentStore:je,pendingDecisionStore:We,fileChangeTracker:et,configProvider:n.configProvider,credentialManager:o,dashboardClient:tt,mcpLease:pt,mcpLoader:nt,disabledStore:ot,addToAllowList:(t,n)=>Ze.addToAllowList(e,t,n),addWebFetchDomainToAllowlist:e=>R(this,void 0,void 0,(function*(){yield n.configProvider.transform((t=>{var n;const o=null!==(n=t.webFetchDomainAllowlist)&&void 0!==n?n:[];return o.includes(e)?t:Object.assign(Object.assign({},t),{webFetchDomainAllowlist:[...o,e]})}))})),addToDenyList:(t,n)=>Ze.addToDenyList(e,t,n),modelManager:dt,endpoint:n.endpoint,headers:n.headers,customSystemPrompt:n.customSystemPrompt,onAgentStoreChanged:e=>{it((()=>"auto-run"===e.getMetadata("mode"))),lt((()=>"search"===e.getMetadata("mode")))},debugInfo:s?{serverUrl:s.serverUrl,logFile:s.logFile}:void 0,isRepository:rt,rgPath:de,backgroundComposerClient:ct,shellManager:i,hookExecutor:Ye,hooksConfig:Ie,onBeforeExit:()=>R(this,void 0,void 0,(function*(){xt=!0,yield Ue("completed")})),autoRunAvailability:st,sudoPasswordStore:Ge}),{exitOnCtrlC:!1,patchConsole:!1});yield a()}}catch(e){throw xt=!0,yield Ue("error"),e}finally{if(process.stdin.isTTY)try{process.stdout.write("[<u")}catch(e){}xt||(yield Ue("completed")),yield Qe(),yield je.dispose()}return ve}catch(e){ne.error=e,ne.hasError=!0}finally{Y(ne)}}))}o()}catch(N){o(N)}}))},"./src/shared/resources.ts":(e,t,n)=>{n.d(t,{A1:()=>w,Pb:()=>j,_Y:()=>k});var o=n("node:os"),r=n("node:path"),s=n.n(r),i=n("../cli-credentials/dist/index.js"),l=n("../context/dist/index.js"),a=n("../cursor-config/dist/index.js"),c=n("../hooks-exec/dist/index.js"),d=n("../local-exec/dist/index.js"),u=n("../shell-exec/dist/index.js"),p=n("./src/mcp/disabled-store.ts"),h=n("./src/mcp/project-paths.ts"),g=n("./src/statsig.ts"),m=n("./src/team-hooks-sync.ts"),f=n("./src/utils/api-endpoint.ts"),v=n("./src/utils/git.ts"),x=n("./src/utils/git-diffs.ts"),b=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const y=(0,l.h)("shared-resources");function j(){return b(this,arguments,void 0,(function*(e={}){const{workingDirectory:t,claudeCodeHooksEnabled:n=!1,teamId:o,dashboardClient:r}=e,s=null!=t?t:process.cwd(),i=(0,v.ky)(s);let l;null!=o&&r&&(l=(0,m.a)({dashboardClient:r,teamId:o}));const a=(0,c.Ve)(i,{claudeCodeHooksEnabled:n}),d=new c.IF,u=new c.gY(d,a),p=yield u.load({loadClaudeHooks:n});return l?{hooksConfig:p,projectDir:i,teamHooksResultPromise:l}:{hooksConfig:p,projectDir:i}}))}function w(e,t){const n=(0,i.jo)(null!=="cursor"?"cursor":"cursor-dev"),o=(0,a.Vi)({credentialManager:n,endpoint:(0,f.G6)(t),configProvider:e});return new d.w(new d.zM(o))}function k(e,t){return b(this,void 0,void 0,(function*(){var r,l,v,j,w,k,C,S,E,$,M,T,A;const I=null!==(r=t.workingDirectory)&&void 0!==r?r:process.cwd();let D=null!==(l=t.rgPath)&&void 0!==l?l:"rg";if(!t.rgPath)try{const{execSync:e}=yield Promise.resolve().then(n.t.bind(n,"node:child_process",23));D=e("which rg",{encoding:"utf8"}).trim()}catch(e){}const _=(0,i.jo)(null!=="cursor"?"cursor":"cursor-dev"),P=(0,a.Vi)({credentialManager:_,endpoint:(0,f.G6)(t.endpoint),configProvider:t.configProvider}),L=null!==(v=t.teamSettingsService)&&void 0!==v?v:new d.w(new d.zM(P)),R=new d.$1(I);if(t.withDiffs){const e=(0,x.buildFileChanges)((0,x.collectGitStatuses)());for(const t of e)R.trackChange(t.path,t.before,t.after)}try{yield(0,d.Rh)(e)}catch(t){y.warn(e,"Failed to sync built-in skills",{error:t})}const O=()=>!0,Y=new d.xK,z=new d.KO(e,Y,I,D,!1,O,void 0),N=new d.EV(e,[I],(0,o.homedir)(),void 0,O),F=new d.Px([z,N]),B=new d.o_([new d.Vz(I,O),new d.di(F)]),U=new d.E1(Y,D,L),q=[],H=new class{constructor(e,t,n=()=>!1,o,r=!1){this.configProvider=e,this.getIsAutoRun=t,this.getIsAskMode=n,this.teamSettingsService=o,this.sandboxDefaultEnabled=r,this.baseProvider=new a.QX(e)}setGetIsAutoRun(e){this.getIsAutoRun=e}setGetIsAskMode(e){this.getIsAskMode=e}getPermissions(){return b(this,void 0,void 0,(function*(){var e,t,n;const o=yield this.baseProvider.getPermissions();let r,s;const i=this.configProvider.get(),l="enabled"===(null===(e=i.sandbox)||void 0===e?void 0:e.networkAccess),a=this.sandboxDefaultEnabled?"enabled":"disabled",c=null!==(n=null===(t=i.sandbox)||void 0===t?void 0:t.mode)&&void 0!==n?n:a,d=(0,u.K3)()&&"enabled"===c;if(this.getIsAutoRun()){const e=yield this.teamSettingsService.getAutoRunControls();!0===(null==e?void 0:e.enabled)&&!0!==e.enableRunEverything?(r="allowlist",s=d?{type:"workspace_readwrite",networkAccess:l}:{type:"insecure_none"}):(r="unrestricted",s={type:"insecure_none"})}else d?(r="allowlist",s=this.getIsAskMode()?{type:"workspace_readonly",networkAccess:l}:{type:"workspace_readwrite",networkAccess:l}):(r="allowlist",s={type:"insecure_none"});return Object.assign(Object.assign({},o),{approvalMode:r,userConfiguredPolicy:s})}))}updatePermissions(e){return b(this,void 0,void 0,(function*(){return this.baseProvider.updatePermissions(e)}))}}(t.configProvider,t.getIsAutoRun,null!==(j=t.getIsAskMode)&&void 0!==j?j:()=>!1,L,null!==(w=t.sandboxDefaultEnabled)&&void 0!==w&&w);q.push(H);const W=yield(0,d.ky)(e,Y,I),G=!!W,X=null!=W?W:I,K=yield a.N2.loadFromPath(s().join(X,".claude","settings.json"));K&&q.push(K);const Q=yield a.N2.loadFromPath(s().join((0,o.homedir)(),".claude","settings.json"));Q&&q.push(Q);const J=new a.Ol(q),{projectRoot:V,projectDir:Z,disabledPath:ee}=(0,h.C)(I),te=new p.P(ee),ne=a.aK.init(L,V,Z,null!==(k=t.ignoreApproveMcps)&&void 0!==k&&k,te),oe=t.configProvider.get(),re=!0===t.sandboxDefaultEnabled?"enabled":"disabled",se=null!==(E=null!==(C=t.sandboxOverride)&&void 0!==C?C:null===(S=oe.sandbox)||void 0===S?void 0:S.mode)&&void 0!==E?E:re,ie=null===($=oe.sandbox)||void 0===$?void 0:$.networkAccess,le=new d.kh(U,t.decisionProvider,J,L,void 0,(0,g.QF)("admin_network_controls")),ae={rgPath:D,executeIndexedGrep:void 0};let ce,de=t.teamHooksResultPromise;if(t.hooksConfig)ce=t.hooksConfig;else{const e=null===(M=t.configProvider.get().authInfo)||void 0===M?void 0:M.teamId;null!=e&&P&&!de&&(de=(0,m.a)({dashboardClient:P,teamId:e}));const n=null!==(T=t.claudeCodeHooksEnabled)&&void 0!==T&&T,o=(0,c.Ve)(X,{claudeCodeHooksEnabled:n}),r=new c.IF,s=new c.gY(r,o);ce=yield s.load({loadClaudeHooks:n})}const ue=new c.HW(ce);let pe,he=()=>{};de&&(pe=new Promise((e=>{he=e})));const ge=null!==(A=t.hookExecutor)&&void 0!==A?A:(()=>{var e,n;const o={cursor_version:null!=="2026.01.28-fd13201"?"2026.01.28-fd13201":"1.0.0",user_email:null!==(n=null===(e=t.configProvider.get().authInfo)||void 0===e?void 0:e.email)&&void 0!==n?n:null},r=(0,u.Fn)();return new c.WL(ce,X,o,r,t.promptHookClient,pe)})();de&&pe&&de.then((t=>{if(null!=t){const n=(0,m.O)(ce,t.teamHooks,t.teamDir);ue.setConfig(n),ge.updateConfig(n),y.info(e,"Team hooks config merged after fetch")}})).finally((()=>he()));const me=(0,u.K3)()&&"enabled"===se,fe=yield function(e,t){return b(this,void 0,void 0,(function*(){try{const n=yield e.getAutoRunControls();if(!0===(null==n?void 0:n.enabled)&&!0!==n.enableRunEverything)return t?{type:"sandbox-only"}:{type:"disabled"}}catch(e){}return{type:"run-everything"}}))}(L,me);return{permissionsService:le,grepProvider:ae,fileChangeTracker:R,dashboardClient:P,teamSettingsService:L,mcpLoader:ne,disabledStore:te,isRepository:G,hooksConfigLease:ue,hookExecutor:ge,hooksConfig:ce,autoRunAvailability:fe,createLocalResourceProvider:({diagnosticsProvider:e,mcpLease:n,codebaseReferenceProvider:o,shellManager:r,pendingDecisionProviderOverride:s,conversationId:i="",generationId:l="",model:a="unknown"})=>{const p=new d.Dv({pendingDecisionStore:null!=s?s:t.decisionProvider,fileChangeTracker:R,gitExecutor:Y,ignoreService:U,grepProvider:ae,permissionsService:le,workspacePaths:[I],diagnosticsProvider:e,mcpLease:n,cursorRulesService:F,subagentsService:B,repositoryProvider:o,projectDir:Z,shellManager:r,_sandboxPolicyResolver:void 0,_defaultSandboxPolicy:"enabled"===se?{type:"workspace_readwrite",networkAccess:"enabled"===ie}:{type:"insecure_none"},getSandboxEnabled:()=>(0,u.K3)()&&"enabled"===se,getSandboxSupported:u.K3,attributionConfigProvider:t.configProvider,askpassConfig:t.askpassConfig});return new c.ae(p,ge,(()=>({conversation_id:i,generation_id:l,model:a})),n,t.hooksAdditionalContextPromise,pe,ue)},setGetIsAutoRun:e=>{H.setGetIsAutoRun(e)},setGetIsAskMode:e=>{H.setGetIsAskMode(e)}}}))}},"./src/sudo/index.ts":(e,t,n)=>{n.d(t,{_A:()=>h,Ek:()=>g,Gx:()=>l});var o=n("node:fs"),r=n("node:path"),s=n("node:url");const i=!1;function l(){const e=process.argv[1];if(e){const t=(0,r.dirname)(e);if(i){const e=(0,r.join)(t,"cursor-askpass.cmd");if((0,o.existsSync)(e))return e}else{const e=(0,r.join)(t,"cursor-askpass");if((0,o.existsSync)(e))return e}const n=(0,r.join)(t,"cursor-askpass.js");if((0,o.existsSync)(n))return n}const t=(0,r.dirname)((0,s.fileURLToPath)("file:///__w/everysphere/everysphere/packages/agent-cli/src/sudo/askpass-helper-path.ts")),n=(0,r.join)(t,"cursor-askpass.js");if((0,o.existsSync)(n))return n;const l=(0,r.join)(t,"cursor-askpass.ts");if((0,o.existsSync)(l))return l;const a=(0,r.join)(t,"..","..","dist-package",i?"cursor-askpass.cmd":"cursor-askpass");return(0,o.existsSync)(a)?a:null}var a=n("node:crypto"),c=n("node:fs/promises"),d=n("node:net"),u=n("node:os"),p=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};class h{constructor(e={}){var t,n;this.server=null,this.socketPath=null,this.handler=null,this.activeConnections=new Set,this.config={socketPath:null!==(t=e.socketPath)&&void 0!==t?t:(0,r.join)((0,u.tmpdir)(),`cursor-askpass-${(0,a.randomUUID)()}.sock`),requestTimeoutMs:null!==(n=e.requestTimeoutMs)&&void 0!==n?n:12e4}}onPasswordRequest(e){this.handler=e}start(){return p(this,void 0,void 0,(function*(){if(this.server)throw new Error("AskpassServer is already running");try{yield(0,c.unlink)(this.config.socketPath)}catch(e){}return new Promise(((e,t)=>{this.server=(0,d.createServer)((e=>{this.handleConnection(e)})),this.server.on("error",(e=>{t(e)})),this.server.listen(this.config.socketPath,(()=>{this.socketPath=this.config.socketPath,e(this.socketPath)}))}))}))}stop(){return p(this,void 0,void 0,(function*(){for(const e of this.activeConnections)e.destroy();if(this.activeConnections.clear(),this.server&&(yield new Promise((e=>{this.server.close((()=>e()))})),this.server=null),this.socketPath){try{yield(0,c.unlink)(this.socketPath)}catch(e){}this.socketPath=null}}))}getSocketPath(){return this.socketPath}isRunning(){return null!==this.server}handleConnection(e){this.activeConnections.add(e);let t="",n=!1;const o=setTimeout((()=>{n||(this.sendResponse(e,{type:"password_denied",id:"timeout",reason:"request timed out"}),e.destroy())}),this.config.requestTimeoutMs);e.on("data",(r=>p(this,void 0,void 0,(function*(){t+=r.toString("utf8");const s=t.indexOf("\n");if(-1===s)return;const i=t.slice(0,s);if(t=t.slice(s+1),!n){n=!0,clearTimeout(o);try{const t=JSON.parse(i);if("password_request"!==t.type)return this.sendResponse(e,{type:"password_denied",id:t.id||"unknown",reason:"invalid request type"}),void e.destroy();if(!this.handler)return this.sendResponse(e,{type:"password_denied",id:t.id,reason:"no handler registered"}),void e.destroy();try{const n=yield this.handler(t);null!==n?this.sendResponse(e,{type:"password_response",id:t.id,password:n}):this.sendResponse(e,{type:"password_denied",id:t.id,reason:"user cancelled"})}catch(n){this.sendResponse(e,{type:"password_denied",id:t.id,reason:n instanceof Error?n.message:"handler error"})}}catch(t){this.sendResponse(e,{type:"password_denied",id:"parse_error",reason:"failed to parse request"})}e.destroy()}})))),e.on("close",(()=>{clearTimeout(o),this.activeConnections.delete(e)})),e.on("error",(()=>{clearTimeout(o),this.activeConnections.delete(e)}))}sendResponse(e,t){try{e.write(`${JSON.stringify(t)}\n`)}catch(e){}}}class g{constructor(){this.requests=[],this.listeners=new Set}getPendingRequests(){return[...this.requests]}subscribe(e){return this.listeners.add(e),e(this.getPendingRequests()),()=>{this.listeners.delete(e)}}addRequest(e){return new Promise((t=>{const n={id:e.id,prompt:e.prompt,timestamp:Date.now(),resolve:n=>{this.removeRequest(e.id),t(n)}};this.requests=[...this.requests,n],this.notifyListeners()}))}submitPassword(e,t){const n=this.requests.find((t=>t.id===e));n&&n.resolve(t)}cancelRequest(e){const t=this.requests.find((t=>t.id===e));t&&t.resolve(null)}cancelAll(){for(const e of this.requests)try{e.resolve(null)}catch(e){}this.requests=[],this.notifyListeners()}removeRequest(e){this.requests=this.requests.filter((t=>t.id!==e)),this.notifyListeners()}notifyListeners(){const e=this.getPendingRequests();for(const t of this.listeners)t(e)}}},"./src/transcript/index.ts":(e,t,n)=>{n.d(t,{Ko:()=>M});var o,r=n("node:fs/promises"),s=n("node:os"),i=n("node:path"),l=n("../agent-kv/dist/index.js"),a=n("../context/dist/index.js"),c=n("../proto/dist/generated/agent/v1/agent_pb.js"),d=n("../utils/dist/index.js");n("../proto/dist/generated/aiserver/v1/chat_pb.js"),function(e){e.INTERNAL="INTERNAL",e.EXTERNAL="EXTERNAL"}(o||(o={}));var u=function(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var o,r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(void 0===o){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose],n&&(r=o)}if("function"!=typeof o)throw new TypeError("Object not disposable.");r&&(o=function(){try{r.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:o,async:n})}else n&&e.stack.push({async:!0});return t},p=function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var o,r=0;return function e(){for(;o=t.stack.pop();)try{if(!o.async&&1===r)return r=0,t.stack.push(o),Promise.resolve().then(e);if(o.dispose){var s=o.dispose.call(o.value);if(o.async)return r|=2,Promise.resolve(s).then(e,(function(t){return n(t),e()}))}else r|=1}catch(e){n(e)}if(1===r)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}}("function"==typeof SuppressedError?SuppressedError:function(e,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=e,o.suppressed=t,o});const h=d.O2,g=d.sh;function m(e,t){return t instanceof Uint8Array?{__type:"Uint8Array",hex:(n=t,Array.from(n).map((e=>e.toString(16).padStart(2,"0"))).join(""))}:"bigint"==typeof t?t.toString():t;var n}function f(e,t){return t&&"object"==typeof t&&"Uint8Array"===t.__type&&"string"==typeof t.hex?function(e){const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substring(n,n+2),16);return t}(t.hex):t}const v=new class{serialize(e){const t=JSON.stringify(e,m);return l.bO.serialize(t)}deserialize(e){const t=l.bO.deserialize(e);return JSON.parse(t,f)}},x=new l.cm(c.ConversationSummaryArchive);async function b(e,t,n){const o=[];for(const r of n){const n=await t.getBlob(e,r);if(n)try{const e=v.deserialize(n);o.push(e)}catch(e){}}return o}const y=["user_info","project_layout","rules","open_and_recently_viewed_files","system_reminder"];function j(e){let t=e;for(const e of y){const n=new RegExp(`<${e}>[\\s\\S]*?</${e}>`,"g");t=t.replace(n,"")}return t.replace(/\n{3,}/g,"\n\n").trim()}function w(e,t){return void 0===e?"":"string"==typeof e?t?j(e):e:e.map((e=>function(e,t){switch(e.type){case"text":return t?j(e.text):e.text;case"image":return"[Image]";case"file":return e.filename?`[File: ${e.filename}]`:"[File]";case"reasoning":return`[Thinking] ${e.text}`;case"redacted-reasoning":return"[Thinking]";case"tool-call":return`[Tool call] ${e.toolName}${function(e){if(null==e)return"";if("object"!=typeof e)return String(e);const t=e,n=Object.entries(t);return 0===n.length?"":`\n${n.map((([e,t])=>{let n;return n="string"==typeof t?t:"object"==typeof t&&null!==t?JSON.stringify(t):String(t),`  ${e}: ${n}`})).join("\n")}`}(e.args)}`;case"tool-result":return`[Tool result] ${e.toolName}`;default:return""}}(e,t))).filter(Boolean).join("\n")}function k(e,t){const n={role:e.role},o=e.content;if("string"==typeof o){const e=t?j(o):o;e.trim()&&(n.text=e)}else if(Array.isArray(o)){const e=[],r=[],s=[];let i;for(const n of o)switch(n.type){case"text":{const o=t?j(n.text):n.text;o.trim()&&e.push(o);break}case"reasoning":n.text.trim()&&r.push(n.text);break;case"redacted-reasoning":r.push("[REDACTED]");break;case"image":e.push("[Image]");break;case"file":e.push(n.filename?`[File: ${n.filename}]`:"[File]");break;case"tool-call":s.push({toolName:n.toolName,args:n.args});break;case"tool-result":i={toolName:n.toolName}}e.length>0&&(n.text=e.join("\n")),r.length>0&&(n.thinking=r.join("\n")),s.length>0&&(n.toolCalls=s),i&&(n.toolResult=i)}return n}class C{projectDir;blobStore;writeFile;options;constructor(e,t,n,o={}){var r,s;this.projectDir=e,this.blobStore=t,this.writeFile=n,this.options={writeJson:null!==(r=o.writeJson)&&void 0!==r&&r,writeJsonl:null!==(s=o.writeJsonl)&&void 0!==s&&s}}async writeFromState(e,t,n){const o={stack:[],error:void 0,hasError:!1};try{const r=u(o,(0,a.VI)(e.withName("writeFromState")),!1);try{const e=await async function(e,t,n){const o={stack:[],error:void 0,hasError:!1};try{const r=u(o,(0,a.VI)(e.withName("hydrateSummaryArchives")),!1);let s=0;const i=(0,a.OA)(r.ctx),l=[],c=await Promise.all(n.summaryArchives.map((async e=>{s++;const n=await t.getBlob(i,e);if(n)try{const e=x.deserialize(n);return s+=e.summarizedMessages.length,await b(i,t,e.summarizedMessages)}catch(e){}return[]})));r.span.setAttribute("getBlobCount",s);for(const e of c)l.push(...e);r[Symbol.dispose]();const d=u(o,(0,a.VI)(e.withName("hydratePromptMessages")),!1),p=await b(i,t,n.rootPromptMessagesJson);d.span.setAttribute("getBlobCount",n.rootPromptMessagesJson.length);const h=p.filter((e=>"system"!==e.role&&!function(e){var t;const n=e.providerOptions;return!0===(null===(t=null==n?void 0:n.cursor)||void 0===t?void 0:t.isSummary)}(e)));return l.push(...h),l}catch(e){o.error=e,o.hasError=!0}finally{p(o)}}(r.ctx,this.blobStore,t);if(0===e.length)return;const o=g(n),s=`${this.projectDir}/${h}/${o}`,i=function(e){let t=e.filter((e=>"system"!==e.role));t.length>=2&&"user"===t[0].role&&"user"===t[1].role&&(t=t.slice(1));const n=[];for(const e of t){const t="user"===e.role,o=w(e.content,t);o.trim()&&("tool"===e.role?n.push(o):n.push(`${e.role}:\n${o}`))}return n.join("\n\n")}(e);if(i.trim()&&await this.writeFile(`${s}.txt`,i),this.options.writeJson){const n=function(e){let t=e.filter((e=>"system"!==e.role));t.length>=2&&"user"===t[0].role&&"user"===t[1].role&&(t=t.slice(1));const n=[];for(const e of t){const t=k(e,"user"===e.role);(t.text||t.thinking||t.toolCalls||t.toolResult)&&n.push(t)}return 0===n.length?"":JSON.stringify(n,null,2)}(e);if(n){const e=function(e){switch(e){case c.AgentMode.AGENT:return"agent";case c.AgentMode.ASK:return"ask";case c.AgentMode.PLAN:return"plan";case c.AgentMode.DEBUG:return"debug";case c.AgentMode.TRIAGE:return"triage";case c.AgentMode.PROJECT:return"project";case c.AgentMode.UNSPECIFIED:default:return"agent"}}(t.mode),o=JSON.stringify({mode:e,messages:JSON.parse(n)},null,2);await this.writeFile(`${s}.json`,o)}}if(this.options.writeJsonl){const t=function(e){let t=e.filter((e=>"system"!==e.role));t.length>=2&&"user"===t[0].role&&"user"===t[1].role&&(t=t.slice(1));const n=[];for(const e of t){const t=k(e,"user"===e.role),o=[];if(t.text&&o.push(t.text),t.thinking&&o.push(t.thinking),0===o.length)continue;const r=o.join("\n\n"),s={role:e.role,message:{content:[{type:"text",text:r}]}};n.push(JSON.stringify(s))}return n.join("\n")}(e);t&&await this.writeFile(`${s}.jsonl`,t)}}catch(e){console.error("[TranscriptStore] Failed to write transcript:",e)}}catch(e){o.error=e,o.hasError=!0}finally{p(o)}}}var S=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function E(e){const t=(0,d.r_)(e);return(0,i.join)((0,s.homedir)(),d.mz,t)}function $(e,t){return S(this,void 0,void 0,(function*(){const n=(0,i.dirname)(e);yield(0,r.mkdir)(n,{recursive:!0}),yield(0,r.writeFile)(e,t,"utf-8")}))}class M{constructor(e,t,n){this.workspacePath=e,this.conversationId=t,this.projectDir=E(e),this.transcriptStore=new C(this.projectDir,n,$)}writeFromState(e,t){return S(this,void 0,void 0,(function*(){try{yield this.transcriptStore.writeFromState(e,t,this.conversationId)}catch(e){console.error("[CliTranscriptWriter] Failed to write transcript:",e)}}))}getTranscriptPath(){return function(e,t){const n=g(t);return(0,i.join)(function(e){return(0,i.join)(E(e),h)}(e),`${n}.txt`)}(this.workspacePath,this.conversationId)}getProjectDir(){return this.projectDir}}},"./src/ui.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{X:()=>Ie});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:crypto"),i=n("node:fs"),l=n("node:path"),a=n.n(l),c=n("../agent-client/dist/index.js"),d=n("../agent-core/dist/index.js"),u=n("../agent-kv/dist/index.js"),p=n("../agent-ui-state/dist/index.js"),h=n("../context/dist/index.js"),g=n("../hooks-exec/dist/index.js"),m=n("../ink/build/index.js"),f=n("../proto/dist/generated/agent/v1/agent_pb.js"),v=n("../proto/dist/generated/agent/v1/agent_service_pb.js"),x=n("../proto/dist/generated/agent/v1/ask_question_tool_pb.js"),b=n("../proto/dist/generated/agent/v1/create_plan_tool_pb.js"),y=n("../proto/dist/generated/agent/v1/cursor_rules_pb.js"),j=n("../proto/dist/generated/agent/v1/selected_context_pb.js"),w=n("../proto/dist/generated/agent/v1/setup_vm_environment_tool_pb.js"),k=n("../proto/dist/generated/aiserver/v1/background_composer_pb.js"),C=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/index.js"),S=n("./src/analytics.ts"),E=n("./src/background.tsx"),$=n("./src/commands/custom-commands.ts"),M=n("./src/commands/logout.tsx"),T=n("./src/components/alt-screen.tsx"),A=n("./src/components/animated-dots.tsx"),I=n("./src/components/ask-question-form.tsx"),D=n("./src/components/cube-overlay.tsx"),_=n("./src/components/file-change-review.tsx"),P=n("./src/components/hexagon-loader.tsx"),L=n("./src/components/index.ts"),R=n("./src/components/items-pager.tsx"),O=n("./src/components/mcp-servers-pager.tsx"),Y=n("./src/components/prompt-bar.tsx"),z=n("./src/components/queued-message-banner.tsx"),N=n("./src/components/sandbox-pager.tsx"),F=n("./src/components/sudo-password-banner.tsx"),B=n("./src/components/switch-mode-approval.tsx"),U=n("./src/components/unified-list-pager.tsx"),q=n("./src/components/usage-pager.tsx"),H=n("./src/console-io.ts"),W=n("./src/constants.ts"),G=n("./src/context/agent-state-context.tsx"),X=n("./src/context/config-context.tsx"),K=n("./src/context/slash-command-context.tsx"),Q=n("./src/context/sudo-password-context.tsx"),J=n("./src/context/terminal-state-context.tsx"),V=n("./src/context/theme-context.tsx"),Z=n("./src/context/vim-mode-context.tsx"),ee=n("./src/conversation/dynamic-item.tsx"),te=n("./src/conversation/static-item.tsx"),ne=n("./src/debug.ts"),oe=n("./src/ephemeral-bridge.ts"),re=n("./src/hang-detection.ts"),se=n("./src/hooks/use-attach-background-composer.ts"),ie=n("./src/hooks/use-confirm-overlay.tsx"),le=n("./src/hooks/use-mounted-effect.ts"),ae=n("./src/hooks/use-send-to-background.ts"),ce=n("./src/hooks/use-slash-commands.ts"),de=n("./src/image-processing.ts"),ue=n("./src/state/index.ts"),pe=n("./src/state/session.ts"),he=n("./src/state/sqlite-blob-store.ts"),ge=n("./src/statsig.ts"),me=n("./src/transcript/index.ts"),fe=n("./src/utils/git.ts"),ve=n("./src/utils/interaction-utils.ts"),xe=n("./src/utils/plan-utils.ts"),be=n("./src/utils/terminal-title.ts"),ye=n("./src/utils/tokens.ts"),je=n("./src/utils/turn-file-tracker.ts"),we=n("./src/utils/url-utils.ts"),ke=e([m,E,M,T,A,I,D,_,P,L,R,O,Y,z,N,F,B,U,q,J,V,ee,te,ie,ce]);[m,E,M,T,A,I,D,_,P,L,R,O,Y,z,N,F,B,U,q,J,V,ee,te,ie,ce]=ke.then?(await ke)():ke;var Ce=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))},Se=function(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var o,r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");o=t[Symbol.asyncDispose]}if(void 0===o){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");o=t[Symbol.dispose],n&&(r=o)}if("function"!=typeof o)throw new TypeError("Object not disposable.");r&&(o=function(){try{r.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:o,async:n})}else n&&e.stack.push({async:!0});return t},Ee=function(e){return function(t){function n(n){t.error=t.hasError?new e(n,t.error,"An error was suppressed during disposal."):n,t.hasError=!0}var o,r=0;return function e(){for(;o=t.stack.pop();)try{if(!o.async&&1===r)return r=0,t.stack.push(o),Promise.resolve().then(e);if(o.dispose){var s=o.dispose.call(o.value);if(o.async)return r|=2,Promise.resolve(s).then(e,(function(t){return n(t),e()}))}else r|=1}catch(e){n(e)}if(1===r)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}}("function"==typeof SuppressedError?SuppressedError:function(e,t,n){var o=new Error(n);return o.name="SuppressedError",o.error=e,o.suppressed=t,o});function $e(e){const t=e.split("\n");if(0===t.length||"---"!==t[0].trim())return e;for(let e=1;e<t.length;e++)if("---"===t[e].trim())return t.slice(e+1).join("\n").trimStart();return e}const Me=()=>{var e;const{stdout:t}=(0,m.t$)(),n=Math.max(20,null!==(e=null==t?void 0:t.columns)&&void 0!==e?e:80),o=Math.max(2,Math.floor((n-12-2)/2)),s="â”€".repeat(o),i="â”€".repeat(o);return(0,r.jsxs)(m.az,{marginY:1,children:[(0,r.jsx)(m.EY,{dimColor:!0,children:s}),(0,r.jsx)(m.EY,{children:" "}),(0,r.jsx)(m.EY,{color:"magenta",bold:!0,children:"STATIC ABOVE"}),(0,r.jsx)(m.EY,{children:" "}),(0,r.jsx)(m.EY,{dimColor:!0,children:i})]})},Te=({uiConversationState:e,onRequestReviewMode:t,onOpenBackgroundPicker:o,onOpenRulesPager:s,onOpenCommandsPager:i,onOpenUsagePager:l,onOpenSkillsPager:a,onOpenMcpPager:c,onOpenSandboxPager:d,isOverlayActive:u,isProcessing:h,sendMessage:g,onAbort:f,debugInfo:v,isGenerating:x,unshownTokenEstimate:b,onResumeChat:y,onNewChat:j,getChatId:w,addToAllowList:k,addWebFetchDomainToAllowlist:E,onImagesUpdated:$,configProvider:T,credentialManager:D,isRepository:_,rgPath:R,isResumingChat:O,isSendingToBackground:N,isTransferring:F,transferStatus:U,onSummarize:q,onTransferToCloud:H,checkCloudAgentAccess:X,externalCursorToEndSignal:Q,sendShellCommand:J,executePlan:V,isSuggestingPlan:Z,planDecisionIndex:oe,setPlanDecisionIndex:re,onRejectPlan:se,onDiscardPlan:ie,askQuestionPrompt:le,switchModePrompt:ae,onAskQuestionSelectionChange:ce,onAskQuestionSubmit:de,onAskQuestionSkip:ue,onSwitchModeDecisionIndexChange:pe,onSwitchModeApprove:he,onSwitchModeReject:me,shellManager:fe,dashboardClient:ve,onSendQueuedNow:xe,onCancelFirstQueued:be,onPopLastForEdit:je,onClearPoppedForEdit:we,slashCommands:ke,inputDisabled:Se,onBeforeExit:Ee,autoRunAvailability:$e})=>{const{pendingDecisions:Te,rejectPendingDecision:Ae,inputValue:Ie,setInputValue:De,changedFiles:_e,queuedMessages:Pe,isSummarizing:Le,mode:Re}=(0,G.C9)(),Oe=(0,G.tO)(),{registerCommand:Ye,unregisterCommand:ze}=(0,K.x)(),[Ne,Fe]=(0,C.useState)(null),[Be,Ue]=(0,C.useState)(!1),qe=le?"ask-question":ae?"switch-mode":e.rejectedPlan?"plan-revision":Ne?"rejection-reason":Te.length>0?"decision":"message";(0,C.useEffect)((()=>{var e;const n=(null!==(e=null==_e?void 0:_e.length)&&void 0!==e?e:0)>0;if(!W.hD||!n)return void ze("review");const o={id:"review",title:"Review edits",description:"Enter review mode to inspect edits",run:(e,n,o)=>{var r;null===(r=o.clearInput)||void 0===r||r.call(o),t()}};return Ye(o),()=>ze("review")}),[Ye,ze,t,_e]),(0,C.useEffect)((()=>(Ye({id:"resume",title:"Resume Session",description:"Open the picker for chats and cloud agents",run:(e,t,n)=>{var r;null===(r=n.clearInput)||void 0===r||r.call(n),o()}}),()=>{ze("resume")})),[Ye,ze,o]),(0,C.useEffect)((()=>(Ye({id:"rule",title:"Rules",description:"Manage Cursor rules",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),s()}}),()=>ze("rule"))),[Ye,ze,s]),(0,C.useEffect)((()=>(Ye({id:"command",title:"Commands",description:"Manage custom commands",boostedAlts:["commands"],run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),i()}}),()=>ze("command"))),[Ye,ze,i]),(0,C.useEffect)((()=>(Ye({id:"usage",title:"Usage",description:"Show AI usage stats",run:(e,t,o)=>Ce(void 0,void 0,void 0,(function*(){var e,t,r,s,i;null===(e=o.clearInput)||void 0===e||e.call(o),null===(t=o.print)||void 0===t||t.call(o,[[{text:"Loading usage data...",color:"cyan"}]]);try{const{GetMeRequest:e,GetUserAnalyticsRequest:t}=yield Promise.resolve().then(n.bind(n,"../proto/dist/generated/aiserver/v1/dashboard_pb.js")),i=yield ve.getMe(new e({}));if(!i.userId)return void(null===(r=o.print)||void 0===r||r.call(o,[[{text:"Not logged in. Run /login first.",color:"red"}]]));const a=new Date,c=a.getTime(),d=new Date(a);d.setDate(d.getDate()-364);const u=((yield ve.getUserAnalytics(new t({teamId:null!==(s=i.teamId)&&void 0!==s?s:0,userId:i.userId,startDate:BigInt(d.getTime()),endDate:BigInt(c),version:"v2"}))).dailyMetrics||[]).map((e=>{var t,n;const o=(null!==(t=e.acceptedLinesAdded)&&void 0!==t?t:0)+(null!==(n=e.acceptedLinesDeleted)&&void 0!==n?n:0);return{date:Number(e.date),agentLines:o,tabLines:0,totalLines:o+0}}));l(u)}catch(e){const t=e instanceof Error?e.message:String(e);null===(i=o.print)||void 0===i||i.call(o,[[{text:"Failed to load usage data: ",color:"red"}],[{text:t,color:"red",dim:!0}],[],[{text:"View your usage at ",dim:!0},{text:"https://cursor.com/dashboard?tab=analytics",color:"blue"}]])}}))}),()=>ze("usage"))),[Ye,ze,l,ve]);const He=(0,ge.QF)("enable_skills");(0,C.useEffect)((()=>{if(He)return Ye({id:"skills",title:"Skills",description:"Open skills menu",inline:!0,run:(e,t,n)=>{var o,r,s,i,l;const a=[null!==(r=null===(o=n.getPromptPrefix)||void 0===o?void 0:o.call(n))&&void 0!==r?r:"",null!==(s=null==t?void 0:t.join(" "))&&void 0!==s?s:""].filter(Boolean).join(" ");null===(i=n.clearInput)||void 0===i||i.call(n),a&&n.insertText(a),null===(l=n.onOpenSkillsPager)||void 0===l||l.call(n)}}),()=>{ze("skills")}}),[Ye,ze,He]),(0,C.useEffect)((()=>{if((0,ne.isDebugEnabled)())return Ye({id:"static-indicator",title:"Static Indicator",description:"Toggle static divider and highlighting (/static-indicator [on|off|toggle|status])",args:[{id:"state",required:!1}],run:(e,t,n)=>{var o,r,s,i;const l=(t[0]||"").trim().toLowerCase(),a=Be;if("status"===l)return null===(o=n.print)||void 0===o||o.call(n,[[{text:"Static indicator is ",dim:!0},{text:a?"ON":"OFF",color:a?"green":"gray"}]]),void n.insertText("");let c=null;if(""===l||"toggle"===l?c=!a:"on"===l?c=!0:"off"===l&&(c=!1),null===c)return null===(r=n.print)||void 0===r||r.call(n,[[{text:"Usage: /static-indicator [on|off|toggle|status]",color:"red"}]]),void(null===(s=n.clearInput)||void 0===s||s.call(n));Ue(c),null===(i=n.print)||void 0===i||i.call(n,[[{text:"Static indicator ",dim:!0},{text:c?"enabled":"disabled",color:c?"green":"gray"}]]),n.insertText("")}}),()=>ze("static-indicator")}),[Ye,ze,Be]);const We=(0,C.useMemo)((()=>{var t;return"agent"===(null===(t=e.pendingTurn)||void 0===t?void 0:t.type)&&void 0!==e.pendingTurn.thinkingContent&&e.pendingTurn.thinkingContent.length>0}),[e]),Ge=(0,C.useMemo)((()=>{var t;return"agent"!==(null===(t=e.pendingTurn)||void 0===t?void 0:t.type)?null:e.pendingTurn.thinkingContent}),[e]),Xe=(0,C.useMemo)((()=>{var t;if("agent"!==(null===(t=e.pendingTurn)||void 0===t?void 0:t.type))return null;const n=e.pendingTurn.pendingState;if("tool-call-segment"!==(null==n?void 0:n.type))return null;const o=n.groups[n.groups.length-1];if("tool-call-group"!==(null==o?void 0:o.type))return null;const r=o.calls[o.calls.length-1];return(0,W.F_)(r.call.tool.case,!1)}),[e]),[Ke,Qe]=(0,C.useState)(null);(0,C.useEffect)((()=>{if(!Xe)return void Qe(null);const e=setTimeout((()=>{Qe(Xe)}),W.V2);return()=>clearTimeout(e)}),[Xe]);const[Je,Ve]=(0,C.useState)(0),Ze=(0,C.useRef)(0);(0,C.useEffect)((()=>{const e=Date.now(),t=W.Zx,n=e-Ze.current;if(n>=t)return Ze.current=e,void Ve(b);const o=setTimeout((()=>{Ze.current=Date.now(),Ve(b)}),t-n);return()=>clearTimeout(o)}),[b]);const et=(0,C.useCallback)((()=>Ce(void 0,void 0,void 0,(function*(){yield(0,M.handleLogout)(D,T)}))),[D,T]),{staticItems:tt,dynamicItems:nt}=(0,C.useMemo)((()=>(0,p.HE)(e,v,{isRepository:_,folderMode:"background"===Re?"git":"cwd"})),[e,v,_,Re]),ot=(0,C.useDeferredValue)(nt),rt={hideUserMessages:!1,isCompact:Oe||null!==le,isSuggestingPlan:Z,isGenerating:x,planDecisionIndex:oe,shellManager:fe};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.jC,{items:tt,children:(e,t)=>(0,r.jsx)(m.az,{marginTop:1,flexDirection:"column",children:(0,r.jsx)(te.j,{item:e,options:rt})},`static-item-${e.key}`)}),Be&&(0,r.jsx)(Me,{}),(0,r.jsx)(m.az,{flexDirection:"column",children:ot.map((e=>(0,r.jsx)(m.az,{marginTop:1,flexDirection:"column",children:(0,r.jsx)(ee.C,{item:e,options:rt})},e.key)))}),O&&(0,r.jsx)(m.az,{flexDirection:"column",children:(0,r.jsxs)(m.az,{flexDirection:"row",gap:1,paddingTop:2,paddingLeft:2,children:[(0,r.jsx)(m.az,{width:1,children:(0,r.jsx)(P.A,{customInterval:210,activeColor:"cyan"},"resume-hex")}),(0,r.jsx)(m.az,{flexDirection:"row",children:(0,r.jsx)(m.EY,{bold:!0,children:"Loading conversation"})})]})}),(0,r.jsxs)(m.az,{flexDirection:"column",children:["1"===process.env.AGENT_CLI_SESSION_WARNING_SANDBOX_UNSUPPORTED&&(0,r.jsx)(m.az,{marginX:1,marginTop:1,borderStyle:"round",borderColor:"yellow",paddingX:1,children:(0,r.jsx)(m.EY,{color:"yellow",children:"Sandbox is not supported on this OS. Falling back to allowlist mode for this session."})}),Ge&&(0,r.jsx)(m.az,{paddingX:2,children:(0,r.jsx)(L.Yl,{content:Ge,maxLines:5,padding:4,color:"dim"})}),ae?(0,r.jsx)(m.az,{paddingX:1,marginTop:1,children:(0,r.jsx)(B.V,{prompt:ae})}):null,le?(0,r.jsx)(m.az,{paddingX:1,marginTop:1,children:(0,r.jsx)(I.o,{args:le.args,selection:le.selection,isAsync:le.isAsync})}):null,(0,r.jsx)(Y.q,{isEmptyChat:0===e.completedTurns.length&&void 0===e.pendingTurn,value:Ie,onChange:e=>{De(e)},onSubmit:(e,t)=>Ce(void 0,void 0,void 0,(function*(){var n;if("message"===qe&&e.trim())g(e,{display:null==t?void 0:t.display,cursorRules:null==t?void 0:t.cursorRules,mode:null==t?void 0:t.mode}),"background"!==Re&&(De(""),$([]));else if("rejection-reason"===qe&&Ne){const t=Te.find((e=>e.id===Ne)),o=(null===(n=null==t?void 0:t.operation)||void 0===n?void 0:n.type)||"unknown";(0,S.sx)("cli.request.user_input.response",{tool:o,response:"rejected",reason:e.trim()||void 0}),Ae(Ne,e.trim()||void 0),Fe(null),De(""),$([])}else"plan-revision"===qe&&e.trim()&&(g(e.trim(),{display:e.trim()}),De(""),$([]))})),onSubmitShell:J,topStatusMarginTop:(void 0!==e.pendingTurn||e.completedTurns.length>0)&&"plan-revision"===qe?0:1,topStatus:le||ae?null:x||Le||F||Pe.length>0?(0,r.jsxs)(m.az,{flexDirection:"column",children:[Pe.length>0&&(0,r.jsx)(z.J,{messages:Pe,showTip:!0,inputIsEmpty:0===Ie.length}),F&&(0,r.jsxs)(m.az,{flexDirection:"row",gap:1,children:[(0,r.jsx)(m.az,{width:1,children:(0,r.jsx)(P.A,{customInterval:210,activeColor:"cyan"},"transfer-hex")}),(0,r.jsxs)(m.az,{flexDirection:"row",children:[(0,r.jsx)(m.EY,{bold:!0,children:U||"Moving to cloud"}),(0,r.jsx)(m.EY,{bold:!0,children:(0,r.jsx)(A.U,{})})]})]}),(x||Le)&&!F&&(0,r.jsxs)(m.az,{flexDirection:"row",gap:1,children:[(0,r.jsx)(m.az,{width:1,children:(0,r.jsx)(P.A,{customInterval:210,activeColor:"green"},"gen-hex")}),(0,r.jsxs)(m.az,{flexDirection:"row",children:[(0,r.jsx)(m.EY,{bold:!0,children:We?"Thinking":Le?"Summarizing":null!=Ke?Ke:"Generating"}),(0,r.jsx)(m.EY,{bold:!0,children:(0,r.jsx)(A.U,{})})]}),(()=>{const e=(0,ye.a)(Je);return e?(0,r.jsxs)(m.EY,{dimColor:!0,children:[" ",e]}):null})()]})]}):null,inputMode:qe,isDisabled:N,isProcessing:h,isSendingToBackground:N,isRepository:_,onCtrlC:f,onRequestReview:t,slashCommands:ke,externalCursorToEndSignal:Q,onBeginRejection:e=>{Fe(e),De("")},onResumeChat:y,getChatId:w,onSkipRejectionReason:()=>{Ne&&(Ae(Ne,void 0),Fe(null),De(""))},onCancelRejectionReason:()=>{Ne&&(Fe(null),De(""))},onAddToAllowList:k,onAddWebFetchDomainToAllowlist:E,onImagesUpdated:$,onLogout:et,onNewChat:j,onSummarize:q,onTransferToCloud:H,checkCloudAgentAccess:X,isCloudHandoffEnabled:!0,rgPath:R,isSuggestingPlan:Z,planDecisionIndex:oe,onPlanDecisionIndexChange:re,onExecutePlan:V,onDiscardPlan:ie,onRejectPlan:se,askQuestionPrompt:le,onAskQuestionSelectionChange:ce,onAskQuestionSubmit:de,onAskQuestionSkip:ue,switchModePrompt:ae,onSwitchModeDecisionIndexChange:pe,onSwitchModeApprove:he,onSwitchModeReject:me,onSendQueuedNow:xe,onCancelFirstQueued:be,onPopLastForEdit:je,onClearPoppedForEdit:we,onOpenMcpPager:c,onOpenSandboxPager:d,onOpenSkillsPager:a,inputDisabled:Se,isOverlayActive:u,onBeforeExit:Ee,autoRunAvailability:$e})]},"prompt")]})},Ae=e=>{var t,n;const{mode:o,viewMode:l,setViewMode:M,changedFiles:A,currentModel:I,pendingDecisions:P,agentStore:L,setAgentStore:Y,setIsGenerating:z,setIsSummarizing:F,isSummarizing:B,inputValue:W,setInputValue:X,setQueuedMessages:Q}=(0,G.C9)(),[J,Z]=(0,C.useState)((()=>(0,p.Du)())),[ee,te]=(0,C.useState)(!1),ge=(0,G.tO)(),{registerCommand:ye,unregisterCommand:ke}=(0,K.x)(),{commands:Me,findSkillReferences:Ae}=(0,ce.d)({credentialManager:e.credentialManager,configProvider:e.configProvider,modelManager:e.modelManager,mcpLoader:e.mcpLoader,disabledStore:e.disabledStore,dashboardClient:e.dashboardClient}),[,Ie]=(0,C.useState)(null),[De,_e]=(0,C.useState)(null),[Pe,Le]=(0,C.useState)(0),[Re,Oe]=(0,C.useState)(null),Ye=(0,C.useRef)(!1),ze=(0,C.useRef)(void 0),Ne=(0,C.useRef)(L),Fe=(0,C.useRef)(J),Be=(0,C.useRef)(null),Ue=(0,C.useRef)(null);(0,C.useEffect)((()=>{(0,re.ln)({agentMode:L.getMetadata("mode"),conversationId:L.getId(),conversationCreatedAt:L.getMetadata("createdAt"),turnCount:L.getConversationStateStructure().turns.length,isHeadless:!1})}),[L]);const qe=(0,C.useRef)(void 0),He=(0,C.useRef)(!1),We=(0,C.useRef)([]),Ge=(0,C.useRef)(null),Xe=(0,C.useRef)(void 0),[Ke]=(0,C.useState)((()=>new je.k(e.fileChangeTracker))),Qe=(0,C.useRef)(null),Je=(0,C.useRef)(L.getMetadata("mode")),Ve=(0,C.useMemo)((()=>De?{targetModeId:De.args.targetModeId,explanation:De.args.explanation,decisionIndex:Pe}:null),[De,Pe]),Ze=(0,C.useMemo)((()=>Re?{args:Re.args,selection:Re.selection,isAsync:Re.isAsync}:null),[Re]),et=(0,C.useRef)(0),tt=(0,C.useRef)((0,s.randomUUID)()),nt=(0,C.useRef)(!1),ot=(0,C.useMemo)((()=>{const e=process.cwd(),t=(0,fe.ky)(e);return t!==e||(0,i.existsSync)(a().join(e,".git"))?t:e}),[]),rt=(0,C.useRef)(void 0);(0,C.useEffect)((()=>{rt.current=new me.Ko(ot,L.getId(),L.getBlobStore())}),[ot,L]);const st=(0,C.useMemo)((()=>{var e;return B?((0,ne.debugLog)("processingType isSummarizing",B),"summary"):void 0!==J.pendingTurn&&("agent"===J.pendingTurn.type?"plan"!==(null===(e=J.pendingTurn.pendingState)||void 0===e?void 0:e.type)&&"agent":"shell"===J.pendingTurn.type&&"shell")}),[B,J.pendingTurn]);(0,C.useEffect)((()=>{Ye.current=st}),[st]),(0,C.useEffect)((()=>{Ne.current=L}),[L]),(0,C.useEffect)((()=>{Fe.current=J}),[J]),(0,C.useEffect)((()=>{"plan"!==o&&(Je.current=o)}),[o]),(0,C.useEffect)((()=>{Be.current=De}),[De]),(0,C.useEffect)((()=>{Ue.current=Re}),[Re]);const[it,lt]=(0,C.useState)(!1),[at,ct]=(0,C.useState)(0),{stdout:dt}=(0,m.t$)(),{exit:ut}=(0,m.nm)(),pt=(0,C.useCallback)((e=>Ce(void 0,void 0,void 0,(function*(){const{promise:t,resolve:n}=Promise.withResolvers();return lt(!0),setTimeout((()=>Ce(void 0,void 0,void 0,(function*(){yield e(),(0,T.m)(dt),setTimeout((()=>{lt(!1),n()}),10)}))),10),t}))),[dt]),ht=(0,C.useCallback)((e=>{pt((()=>{M(e)}))}),[pt,M]),gt=(0,V.cb)();(0,C.useEffect)((()=>{const e={id:"sync-theme",title:"Sync Theme",description:"Re-detect terminal theme and refresh UI",run:(e,t,n)=>Ce(void 0,void 0,void 0,(function*(){var e,t,o;null===(e=n.clearInput)||void 0===e||e.call(n);try{yield gt(),yield pt((()=>{})),null===(t=n.print)||void 0===t||t.call(n,[[{text:"Theme synced.",color:"green"}]])}catch(e){null===(o=n.print)||void 0===o||o.call(n,[[{text:"Failed to sync theme.",color:"red"}]])}n.insertText("")}))};return ye(e),()=>ke("sync-theme")}),[ye,ke,gt,pt]),(0,C.useEffect)((()=>{const e={id:"cube",title:"Spinning Cube",description:"Show full-screen spinning cube overlay",run:(e,t,n)=>{var o;null===(o=n.clearInput)||void 0===o||o.call(n),pt((()=>te(!0)))}};return ye(e),()=>ke("cube")}),[ye,ke,pt]),(0,C.useEffect)((()=>{const e=L.getMetadata("name");(0,be.iq)(e)?(0,be.Bp)(e):(0,be.cu)()}),[L]);const mt=(0,V.pW)(),ft=(0,C.useRef)(null);(0,le.H)((()=>{ft.current!==mt&&(null!==ft.current&&pt((()=>{})),ft.current=!!mt)}),[mt]),(0,le.H)((()=>{lt(!0),(0,T.m)(dt),setTimeout((()=>{lt(!1)}),10)}),[ge]);const[vt,xt]=(0,C.useState)([]),[bt,yt]=(0,C.useState)(!1),[jt,wt]=(0,C.useState)(0),[kt,Ct]=(0,C.useState)([]),St=st&&void 0!==J.pendingTurn&&"agent"===J.pendingTurn.type&&"plan"!==(null===(t=J.pendingTurn.pendingState)||void 0===t?void 0:t.type)&&0===P.length;(0,C.useEffect)((()=>{z(St)}),[St,z]);const[Et,$t]=(0,C.useState)(null);(0,C.useEffect)((()=>{const e=()=>{if(qe.current)return(0,H.p2)("\nAborting current operation..."),void qe.current.abort("user_sigint");"review"!==l?process.exit(0):M("chat")};return process.on("SIGINT",e),()=>{process.off("SIGINT",e)}}),[l,M]);const[Mt,Tt]=(0,C.useState)((()=>{const t=e.agentStore.getMetadata("resumeBcId");return"string"==typeof t&&t.length>0?(e.agentStore.setMetadata("mode","background"),e.agentStore.setMetadata("resumeBcId",""),t):null})),[At,It]=(0,C.useState)(!1),[Dt,_t]=(0,C.useState)(!1),[Pt,Lt]=(0,C.useState)("rules"),[Rt,Ot]=(0,C.useState)("list"),[Yt,zt]=(0,C.useState)(null),[Nt,Ft]=(0,C.useState)(void 0),Bt=(0,C.useCallback)((()=>{Lt("rules"),Ot("list"),zt(null),Ft(void 0),_t(!0)}),[]),Ut=(0,C.useCallback)((()=>{Lt("commands"),Ot("list"),zt(null),Ft(void 0),_t(!0)}),[]),qt=(0,C.useCallback)((()=>{Lt("skills"),Ot("list"),zt(null),Ft(void 0),_t(!0)}),[]),Ht=(0,C.useCallback)((()=>{pt((()=>{_t(!1),Ot("list"),zt(null),Ft(void 0)}))}),[pt]),[Wt,Gt]=(0,C.useState)(!1),Xt=(0,C.useCallback)((()=>{Gt(!0)}),[]),[Kt,Qt]=(0,C.useState)(!1),Jt=(0,C.useCallback)((()=>{Qt(!0)}),[]),[Vt,Zt]=(0,C.useState)(!1),[en,tn]=(0,C.useState)([]),nn=(0,C.useCallback)((e=>{tn(e),Zt(!0)}),[]),{sendToBackground:on,sendFollowupToBackground:rn,transferToCloud:sn,cancelTransfer:ln,isSubmitting:an,isTransferring:cn,transferStatus:dn}=(0,ae.$)(e.backgroundComposerClient),un=(0,C.useCallback)((e=>Ce(void 0,void 0,void 0,(function*(){if(an)return;if(Mt)return void(yield rn(Mt,e,{source:k._bo.CLI}));const t=yield on(e);if("success"===t.type){const e=t.bcId;(0,T.m)(dt),Tt(e),X(""),xt([])}}))),[Mt,an,rn,on,X,dt]),pn=(0,ie._)(),hn=(0,C.useCallback)((t=>Ce(void 0,void 0,void 0,(function*(){if(cn)return;(0,ne.debugLog)("handleTransferToCloud: starting",{message:t});const n=e.ctx.withName("chat.transfer-to-cloud"),o={confirm:pn.askConfirm},r=yield sn(n,L,o,t);if("success"===r.type)return(0,ne.debugLog)("handleTransferToCloud: success",r.bcId),lt(!0),X(""),xt([]),void setTimeout((()=>{const e=`https://cursor.com/agents/${r.bcId}`;(0,H.p2)(`\n  [90mOpen Cloud Agent in:[0m [1m[36m${e}[0m`),r.worktreeBranch&&(0,H.p2)(`\n  [90mCloud agent will work on branch:[0m [36m${r.worktreeBranch}[0m`),(0,H.p2)("\n"),ut(),process.exit(0)}),100);"cancelled"===r.type?((0,ne.debugLog)("handleTransferToCloud: cancelled",r.reason),(0,oe.ET)([{text:"Transfer cancelled: ",color:"yellow"},{text:r.reason,dim:!0}])):((0,ne.debugLog)("handleTransferToCloud: error",r.message),(0,oe.ET)([{text:"âœ— ",color:"red"},{text:r.message}]))}))),[cn,e.ctx,pn.askConfirm,sn,L,ut,X]),gn=(0,C.useCallback)((()=>Ce(void 0,void 0,void 0,(function*(){try{return yield e.backgroundComposerClient.getBackgroundComposerUserSettings({}),{hasAccess:!0}}catch(e){return(0,ne.debugLog)("checkCloudAgentAccess: error",e),{hasAccess:!1,setupUrl:"https://cursor.com/dashboard?tab=cloud-agents"}}}))),[e.backgroundComposerClient]),mn=(0,C.useCallback)((()=>{const e=Be.current;if(!e)return;const t="plan"===Je.current?"default":Je.current,n=(0,ve.Kx)(e.args.targetModeId,t);L.setMetadata("mode",n),e.resolve({approved:!0}),_e(null),Le(0)}),[L]),fn=(0,C.useCallback)((()=>{const e=Be.current;e&&(e.resolve({approved:!1,reason:"Mode switch rejected by user"}),_e(null),Le(0))}),[]),vn=(0,C.useCallback)((e=>{Oe((t=>{if(!t)return t;const n=Object.assign(Object.assign({},t),{selection:e});return Ue.current=n,n}))}),[]),xn=(0,C.useCallback)((t=>Ce(void 0,void 0,void 0,(function*(){const n={stack:[],error:void 0,hasError:!1};try{const o=Se(n,(0,h.VI)(e.ctx.withName("chat.ask-question.async")),!1).ctx,r=qe.current;if(r)try{return void(yield r.submitConversationAction(t))}catch(e){}const s=Xe.current;if(s)try{yield s(o,t)}catch(e){(0,H.p2)(`\nFailed to deliver your answer: ${e instanceof Error?e.message:String(e)}\n`)}else(0,H.p2)("\nCould not deliver your answer (session may have ended).\n")}catch(e){n.error=e,n.hasError=!0}finally{Ee(n)}}))),[e.ctx]),bn=(0,C.useCallback)((()=>{const e=Ue.current;if(!e)return;const t=(0,ve.iX)(e.args,e.selection);if(e.isAsync){const n=new f.ConversationAction({action:{case:"asyncAskQuestionCompletionAction",value:new f.AsyncAskQuestionCompletionAction({originalToolCallId:e.toolCallId,originalArgs:e.args,result:t})}});xn(n)}else e.resolve&&e.resolve({result:t});Oe(null)}),[xn]),yn=(0,C.useCallback)((()=>{const e=Ue.current;if(!e)return;const t=(0,ve.N$)("Questions skipped by user");if(e.isAsync){const n=new f.ConversationAction({action:{case:"asyncAskQuestionCompletionAction",value:new f.AsyncAskQuestionCompletionAction({originalToolCallId:e.toolCallId,originalArgs:e.args,result:t})}});xn(n)}else e.resolve&&e.resolve({result:t});Oe(null)}),[xn]),jn=(0,C.useCallback)(((e,t=!1,n=null,o)=>{var r;const s=null!==(r=null==n?void 0:n.turns.length)&&void 0!==r?r:0;let i=null;!t&&n&&L.handleCheckpoint(e,n),Z((e=>{var n;let r=e;if(e.pendingTurn){const t=e.pendingTurn,n=Qe.current,s=n?Ke.finalizeTurn(n):[];let i=0;Et&&(i=Date.now()-Et);const l=s.reduce(((e,t)=>{var n,o;return e+((null===(n=t.after)||void 0===n?void 0:n.split("\n").length)||0)-((null===(o=t.before)||void 0===o?void 0:o.split("\n").length)||0)}),0),a=s.length;if("agent"===t.type)try{const n=t.completedSteps.filter((e=>"tool-call-group"===e.type&&e.calls.some((e=>"updateTodosToolCall"===e.call.tool.case)))).length,r=t.completedSteps.filter((e=>"tool-call-group"===e.type)).length;(0,S.sx)("cli.request.completed",{end_reason:o,lines_changed:l,files_changed:a,todos_completed:n,tools_used:r,time_elapsed_ms:i,estimated_tokens:e.liveTokens})}catch(e){}const c=(0,p.RN)(e);r=(0,p.Gv)(c)}const l=e.pendingTurn?r:(0,p.RN)(r);if((0,ne.debugLog)(`stopUiConversation: hasReceivedToolCall: ${t}, numTurns: ${s}, abortedState.completedTurns.length: ${l.completedTurns.length}, abortedState.pendingTurn: ${l.pendingTurn?"true":"false"}`),t)return l;if(s<l.completedTurns.length+(l.pendingTurn?1:0)){const e=null!==(n=l.pendingTurn)&&void 0!==n?n:l.completedTurns[l.completedTurns.length-1];return"agent"===(null==e?void 0:e.type)&&(i=e.userMessage),(0,ne.debugLog)(`stopUiConversation: truncating, lastTurn: ${null==e?void 0:e.type}, restoredInput: ${i}`),(0,p.P4)(l,s)}return l})),setImmediate((()=>{if(i){const e=i;X((t=>t?`${e}\n${t}`:e)),wt((e=>e+1))}})),F(!1),"true"===process.env.AGENT_CLI_EXIT_ON_COMPLETION&&setTimeout((()=>process.exit(0)),10)}),[L,Et,X,F,Ke.finalizeTurn]),wn=(0,C.useCallback)(((t,n)=>Ce(void 0,void 0,void 0,(function*(){var r,l,u,m,v,y,j,k,C,E,$,M;if("background"===o&&"userMessageAction"===n.action.case){const e=null===(r=n.action.value.userMessage)||void 0===r?void 0:r.text;return void(e&&(yield un(e)))}const T=Date.now();$t(T),I&&L.setMetadata("lastUsedModel",I.modelId);const A=tt.current;let D=!1,_=!1,P=!1;const R=L.getConversationStateStructure().clone(),[O,Y]=t.withCancel(),z=new d.hg;z.addAbortCallback((()=>{var n,o,r,s,i;P=!0,Y();const l=Be.current;l&&(l.resolve({approved:!1,reason:"Aborted by user"}),_e(null),Le(0));const a=Ue.current;a&&(a.resolve&&a.resolve({result:(0,ve.N$)("Aborted by user")}),Oe(null)),He.current?(0,ne.debugLog)("[abort] Skipping cleanup (send-now)"):((0,ne.debugLog)("[abort] Running abort cleanup"),Q([]),We.current=[],Ge.current=null,"agent"===Ye.current&&jn(t,_,R,"user_aborted"),e.hookExecutor&&e.hooksConfig&&((null===(o=null===(n=e.hooksConfig.userHooks)||void 0===n?void 0:n.hooks.stop)||void 0===o?void 0:o.length)||(null===(s=null===(r=e.hooksConfig.projectHooks)||void 0===r?void 0:r.hooks.stop)||void 0===s?void 0:s.length))&&e.hookExecutor.executeHookForStep(g._E.stop,{conversation_id:L.getId(),generation_id:A,model:null!==(i=null==I?void 0:I.modelId)&&void 0!==i?i:"unknown",status:"aborted",loop_count:et.current}).catch((e=>{(0,ne.debugLog)("[hooks] Stop hook error on abort:",e)})))}));const N={handleCheckpoint:(e,t)=>Ce(void 0,void 0,void 0,(function*(){var n;if(!P)return null===(n=rt.current)||void 0===n||n.writeFromState(e,t),L.handleCheckpoint(e,t)})),getLatestCheckpoint:()=>L.getLatestCheckpoint()};try{const o={sendUpdate:(e,n)=>Ce(void 0,void 0,void 0,(function*(){if(!P)if(Z((e=>{try{return(0,p.as)(e,n)}catch(t){if(t instanceof p.VX)return e;throw t}})),"summary-started"!==n.type){if("heartbeat"!==n.type)if("summary-completed"!==n.type){if("text-delta"!==n.type&&"token-delta"!==n.type){if("user-message-appended"===n.type){z.markMessageAsProcessed(n.userMessage);const e=`turn-${Date.now()}`;return Qe.current=e,Ke.startTurn(e),void Q([])}if("tool-call-started"===n.type||"partial-tool-call"===n.type)return _=!0,void("tool-call-started"===n.type&&(0,S.sx)("cli.request.tools.used",{tool:n.toolCall.tool.case||"unknown",count:1}));if("thinking-delta"!==n.type&&"thinking-completed"!==n.type)return"summary"===n.type?(pt((()=>{})),void F(!1)):void 0;D||(D=!0,(0,h.HF)(t,"token_counts_visible"))}}else F(!1)}else F(!0)})),query:(t,n)=>Ce(void 0,void 0,void 0,(function*(){var t,o,r,s;switch(n.type){case"web-search-request":return"auto-run"===L.getMetadata("mode")?{approved:!0}:yield e.pendingDecisionStore.requestWebSearchApproval(n.args);case"web-fetch-request":{if("auto-run"===L.getMetadata("mode"))return{approved:!0};const r=null!==(t=n.args.url)&&void 0!==t?t:"",i=(0,we.B)(r),l=null!==(o=e.configProvider.get().webFetchDomainAllowlist)&&void 0!==o?o:[];return s=i,l.some((e=>{if("*"===e)return!0;if(e.startsWith("*.")){const t=e.slice(2);return s===t||s.endsWith(`.${t}`)}return e===s}))?((0,ne.debugLog)("web-fetch-auto-approved",{domain:i,url:r}),{approved:!0}):yield e.pendingDecisionStore.requestWebFetchApproval(n.args)}case"switch-mode-request":{if(Be.current||Ue.current)return{approved:!1,reason:"Another interaction is already pending"};const e=n.args;return yield new Promise((t=>{Le(0),_e({toolCallId:n.toolCallId,args:e,resolve:t})}))}case"ask-question-request":{if(Be.current||Ue.current)return{result:(0,ve.N$)("Another interaction is already pending")};const e=n.args,t=null!==(r=e.runAsync)&&void 0!==r&&r,o=(0,ve.AX)(e);return t?(Oe({toolCallId:n.toolCallId,args:e,isAsync:!0,selection:o}),{result:new x.tz({result:{case:"async",value:new x.yt}})}):yield new Promise((t=>{Oe({toolCallId:n.toolCallId,args:e,resolve:t,isAsync:!1,selection:o})}))}case"create-plan-request":{let e="";try{const t=process.cwd(),o=(0,fe.ky)(t),r=o!==t||(0,i.existsSync)(a().join(t,".git"))?o:void 0,s=L.getId();e=(yield(0,xe.IB)({args:n.args,workspaceRoot:r,conversationId:s})).planUri}catch(e){console.error("[CLI] Failed to create plan file:",e instanceof Error?e.message:e)}return{result:new b.bK({result:{case:"success",value:new b.Jo},planUri:e})}}case"setup-vm-environment-request":return new w.r$({result:{case:"success",value:new w.JH}});default:throw new Error("Unhandled interaction query type")}}))};try{ze.current=Y,qe.current=z,yield Promise.all([(0,c.Oe)(t,n,e.resources),(0,de.w)(n)]),yield e.agentClient.run(O,L.getConversationStateStructure(),n,yield e.modelManager.awaitCurrentModel(),o,e.resources,L.getBlobStore(),z,N,[],{conversationId:L.getId(),headers:e.headers,customSystemPrompt:e.customSystemPrompt,onStall:(0,re.M4)(L.getId(),{actionType:n.action.case,execId:"shellCommandAction"===n.action.case?n.action.value.execId:void 0})})}finally{ze.current=void 0,qe.current===z&&(qe.current=void 0)}if(Z((e=>{const t=(0,p.Gv)(e),n=t.completedTurns.at(-1);if("agent"===(null==n?void 0:n.type))try{const e=Qe.current,o=e?Ke.finalizeTurn(e):[],r=o.reduce(((e,t)=>{var n,o;return e+((null===(n=t.after)||void 0===n?void 0:n.split("\n").length)||0)-((null===(o=t.before)||void 0===o?void 0:o.split("\n").length)||0)}),0),s=o.length,i=n.steps.filter((e=>"tool-call-group"===e.type&&e.calls.some((e=>"updateTodosToolCall"===e.call.tool.case)))).length,l=n.steps.filter((e=>"tool-call-group"===e.type)).length;let a=0;Et&&(a=Date.now()-Et),(0,S.sx)("cli.request.completed",{end_reason:"success",lines_changed:r,files_changed:s,todos_completed:i,tools_used:l,time_elapsed_ms:a,estimated_tokens:t.liveTokens})}catch(e){}return t})),(0,re.ln)({turnCount:L.getConversationStateStructure().turns.length}),e.hookExecutor&&e.hooksConfig&&((null===(u=null===(l=e.hooksConfig.userHooks)||void 0===l?void 0:l.hooks.stop)||void 0===u?void 0:u.length)||(null===(v=null===(m=e.hooksConfig.projectHooks)||void 0===m?void 0:m.hooks.stop)||void 0===v?void 0:v.length)))try{const t=yield e.hookExecutor.executeHookForStep(g._E.stop,{conversation_id:L.getId(),generation_id:A,model:null!==(y=null==I?void 0:I.modelId)&&void 0!==y?y:"unknown",status:"completed",loop_count:et.current});if(t&&"string"==typeof t.followup_message&&t.followup_message.trim().length>0){const e=t.followup_message;et.current+=1,(0,ne.debugLog)(`[hooks] Stop hook returned followup_message, queueing (loop ${et.current})`);const n=new f.ConversationAction({action:{case:"userMessageAction",value:new f.UserMessageAction({userMessage:new f.UserMessage({text:e,messageId:(0,s.randomUUID)()})})}});We.current.push({action:n,display:e.slice(0,100)+(e.length>100?"...":"")})}}catch(e){(0,ne.debugLog)("[hooks] Stop hook error:",e)}}catch(n){if(He.current)throw n;throw jn(t,_,R,"error"),e.hookExecutor&&e.hooksConfig&&((null===(k=null===(j=e.hooksConfig.userHooks)||void 0===j?void 0:j.hooks.stop)||void 0===k?void 0:k.length)||(null===(E=null===(C=e.hooksConfig.projectHooks)||void 0===C?void 0:C.hooks.stop)||void 0===E?void 0:E.length))&&e.hookExecutor.executeHookForStep(g._E.stop,{conversation_id:L.getId(),generation_id:A,model:null!==($=null==I?void 0:I.modelId)&&void 0!==$?$:"unknown",status:"error",loop_count:et.current}).catch((e=>{(0,ne.debugLog)("[hooks] Stop hook error on error:",e)})),n}const B=We.current.shift();if(B){const t={stack:[],error:void 0,hasError:!1};try{Xe.current||(0,re.Dy)({category:"queue_processing",waitingFor:"queue_item_processing",conversationId:L.getId(),extra:{queueLength:We.current.length+1,queuedActionType:B.action.action.case,sendConversationActionRefUndefined:!0}},"error"),Q(We.current.map((e=>e.display)));const n=`turn-${Date.now()}`;Qe.current=n,Ke.startTurn(n),Z((e=>(0,p.HG)(e,B.display)));const o=Se(t,(0,h.VI)(e.ctx.withName("chat.queued")),!1);yield null===(M=Xe.current)||void 0===M?void 0:M.call(Xe,o.ctx,B.action)}catch(e){t.error=e,t.hasError=!0}finally{Ee(t)}}}))),[L,L.getId,I,o,e.resources,e.modelManager.awaitCurrentModel,e.agentClient.run,un,pt,F,Q,jn,Ke.startTurn,Ke.finalizeTurn,Et,e.headers,e.customSystemPrompt,e.ctx.withName,e.pendingDecisionStore.requestWebSearchApproval,e.pendingDecisionStore.requestWebFetchApproval,e.hookExecutor,e.hooksConfig,e.configProvider.get]);(0,C.useEffect)((()=>(Xe.current=wn,()=>{Xe.current=void 0})),[wn]);const kn=(0,C.useCallback)(((t,n)=>Ce(void 0,void 0,void 0,(function*(){var r,i,l,a,c,d,u,m,x,b,w,k,C;const E={stack:[],error:void 0,hasError:!1};try{const $=Se(E,(0,h.VI)(e.ctx.withName("chat.request")),!1).ctx,{skills:M}=Ae(t),T=[...M.map((e=>{const t=new y.DX({fullPath:e.path,content:$e(e.content),type:new y.f5({type:{case:"manuallyAttached",value:new y._u}})});return new j.G4({rule:t})})),...null!==(r=null==n?void 0:n.cursorRules)&&void 0!==r?r:[]],A=Ge.current;if(A){Ge.current=null;const e="userMessageAction"===A.action.action.case?null===(l=null===(i=A.action.action.value)||void 0===i?void 0:i.userMessage)||void 0===l?void 0:l.selectedContext:void 0,o=new f.ConversationAction({action:{case:"userMessageAction",value:new f.UserMessageAction({userMessage:new f.UserMessage({text:t,selectedContext:e,messageId:crypto.randomUUID()})})}});if(qe.current)return We.current.push({action:o,display:null!==(a=null==n?void 0:n.display)&&void 0!==a?a:t}),Q(We.current.map((e=>e.display))),X(""),void xt([]);const r=`turn-${Date.now()}`;return Qe.current=r,Ke.startTurn(r),Z((e=>{var o;return(0,p.HG)(e,null!==(o=null==n?void 0:n.display)&&void 0!==o?o:t)})),void(yield wn($,o))}et.current=0;const D=(0,s.randomUUID)();if(tt.current=D,!t.trim())return;if(e.hookExecutor&&e.hooksConfig&&((null===(d=null===(c=e.hooksConfig.userHooks)||void 0===c?void 0:c.hooks.beforeSubmitPrompt)||void 0===d?void 0:d.length)||(null===(m=null===(u=e.hooksConfig.projectHooks)||void 0===u?void 0:u.hooks.beforeSubmitPrompt)||void 0===m?void 0:m.length)))try{const n=yield e.hookExecutor.executeHookForStep(g._E.beforeSubmitPrompt,{conversation_id:L.getId(),generation_id:D,model:null!==(x=null==I?void 0:I.modelId)&&void 0!==x?x:"unknown",prompt:t,attachments:[]});if(n&&!1===n.continue){const e=null!==(b=n.user_message)&&void 0!==b?b:"A beforeSubmitPrompt hook blocked this submission.";return(0,ne.debugLog)(`[hooks] beforeSubmitPrompt blocked: ${e}`),void(0,oe.ET)([[{text:e,color:"yellow"}]])}}catch(e){(0,ne.debugLog)("[hooks] beforeSubmitPrompt error:",e)}if((0,S.sx)("cli.request.create",{length:t.length,model:(null==I?void 0:I.modelId)||"unknown"}),"background"===o)return void(yield un(t));if(qe.current){const e=null!==(w=null==n?void 0:n.display)&&void 0!==w?w:t,r=new j.xv({selectedImages:vt.map((e=>new j.d({path:e.path}))),cursorRules:T}),s=null!==(k=null==n?void 0:n.mode)&&void 0!==k?k:o,i=(0,ve.cT)(s),l=new f.ConversationAction({action:{case:"userMessageAction",value:new f.UserMessageAction({userMessage:new f.UserMessage({text:t,selectedContext:r,messageId:crypto.randomUUID(),mode:i})})}});return We.current.push({action:l,display:e}),Q(We.current.map((e=>e.display))),X(""),void xt([])}if(0===Fe.current.completedTurns.length){const n=L.getId();e.aiServerClient.nameAgent(new v.Il({userMessage:t})).then((e=>{L.setMetadata("name",e.name),(0,be.iq)(e.name)&&Ne.current.getId()===n&&(0,be.Bp)(e.name)})).catch((e=>{(0,ne.debugLog)(e)}))}const _=`turn-${Date.now()}`;Qe.current=_,Ke.startTurn(_),Z((e=>{var o;return(0,p.HG)(e,null!==(o=null==n?void 0:n.display)&&void 0!==o?o:t)}));const P=new j.xv({selectedImages:vt.map((e=>new j.d({path:e.path}))),cursorRules:T}),R=null!==(C=null==n?void 0:n.mode)&&void 0!==C?C:o,O=(0,ve.cT)(R),Y=new f.ConversationAction({action:{case:"userMessageAction",value:new f.UserMessageAction({userMessage:new f.UserMessage({text:t,selectedContext:P,messageId:crypto.randomUUID(),mode:O})})}});yield wn($,Y)}catch(e){E.error=e,E.hasError=!0}finally{Ee(E)}}))),[L.getId,L.setMetadata,null==I?void 0:I.modelId,Ae,o,e.aiServerClient.nameAgent,e.ctx.withName,vt,un,wn,X,Q,Ke.startTurn,e.hookExecutor,e.hooksConfig]),Cn=(0,C.useCallback)((e=>{const t=W.trim();Ht();const n=`/${e.name}`,{fullMessage:o,displayText:r}=(0,$.jI)(n,t||void 0);t?X(o):kn(o.trim(),{display:r})}),[W,Ht,X,kn]),Sn=()=>Ce(void 0,void 0,void 0,(function*(){qe.current&&qe.current.abort("abort_and_clear_pending"),e.pendingDecisionStore.clearAll()})),En=(t,n)=>Ce(void 0,void 0,void 0,(function*(){var o,r,i;e.fileChangeTracker.clear(),Ke.cleanup(),Y(t),null===(o=e.onAgentStoreChanged)||void 0===o||o.call(e,t);const l=t.getMetadata("name");if((0,be.iq)(l)?(0,be.Bp)(l):(0,be.cu)(),n.loadFromDb)try{const n=yield t.getFullConversation(e.ctx);"false"!==process.env.AGENT_CLI_LOAD_HISTORY?(Z((0,p.N1)(n)),Ie(null!==(i=null===(r=n.summary)||void 0===r?void 0:r.summary)&&void 0!==i?i:"")):(Z((0,p.Du)()),Ie(null))}catch(e){Z((0,p.Du)())}else Z((0,p.Du)());Q([]),X(""),We.current=[],Ge.current=null,_e(null),Le(0),Oe(null),et.current=0,tt.current=(0,s.randomUUID)()})),$n=t=>Ce(void 0,void 0,void 0,(function*(){try{yt(!0),Z((0,p.Du)()),yield Sn(),yield L.dispose(),pe.d.clearLastRequest();const n=a().join((0,ue.r)(),t),o=a().join(n,"store.db"),r=yield he.M.initAndLoad(o),s=new u.pH(r,r);yield s.resetFromDb(e.ctx);const i=yield s.getLastRequestIdFromConversation(e.ctx);i&&pe.d.recordLastRequest(i),yield En(s,{loadFromDb:!0}),s.setMetadata("mode","default");const l=s.getMetadata("lastUsedModel");l&&(yield e.modelManager.setModelFromStoredId(l,e.configProvider))}finally{yt(!1),We.current=[],Ge.current=null,et.current=0,tt.current=(0,s.randomUUID)()}})),Mn=(0,C.useCallback)((()=>Ce(void 0,void 0,void 0,(function*(){var t;const n={stack:[],error:void 0,hasError:!1};try{const o=We.current;if(0===o.length)return;const r=o.shift();Q(o.map((e=>e.display))),X(""),He.current=!0,Ge.current=null;try{Z((e=>(0,p.RN)(e))),qe.current&&qe.current.abort("new_message_submitted");const e=()=>Ce(void 0,void 0,void 0,(function*(){const e=Date.now();for(;void 0!==qe.current&&!(Date.now()-e>5e3);)yield new Promise((e=>setTimeout(e,50)))}));yield e()}finally{He.current=!1}const s=`turn-${Date.now()}`;Qe.current=s,Ke.startTurn(s),Z((e=>(0,p.HG)(e,r.display)));const i=Se(n,(0,h.VI)(e.ctx.withName("chat.queued-now")),!1);yield null===(t=Xe.current)||void 0===t?void 0:t.call(Xe,i.ctx,r.action)}catch(e){n.error=e,n.hasError=!0}finally{Ee(n)}}))),[e.ctx,Ke,Q,X]),Tn=(0,C.useCallback)((()=>{const e=We.current;0!==e.length&&(e.shift(),Q(e.map((e=>e.display))))}),[Q]),An=(0,C.useCallback)((()=>{const e=We.current;if(0===e.length)return null;const t=e.pop();return Q(e.map((e=>e.display))),Ge.current=t,t.display}),[Q]),In=(0,C.useCallback)((()=>{Ge.current=null}),[]);(0,C.useEffect)((()=>{Ce(void 0,void 0,void 0,(function*(){(0,ne.debugLog)("Loading existing conversation");try{L.getConversationStateStructure().turns.length>0&&0===J.completedTurns.length&&yt(!0);const t=yield L.getFullConversation(e.ctx);"false"!==process.env.AGENT_CLI_LOAD_HISTORY&&(t.summary&&Ie(t.summary.summary),t.turns.length>0&&Z((e=>e.completedTurns.length>0||e.pendingTurn?e:(0,p.N1)(t))))}finally{yt(!1)}}))}),[L,e.ctx,J.completedTurns.length]),(0,C.useEffect)((()=>{e.prompt&&!nt.current&&(nt.current=!0,kn(e.prompt))}),[e.prompt,kn]);const{responses:Dn,status:_n,isLoadingDiffs:Pn,addOptimisticFollowup:Ln,removeOptimisticFollowup:Rn,modelDetails:On,isAttached:Yn,isLoadingConversation:zn,repoUrl:Nn,branchName:Fn,diffs:Bn}=(0,se.n)(e.backgroundComposerClient,null!=Mt?Mt:null),Un=(0,C.useCallback)((()=>{e.isRepository&&It(!0)}),[e.isRepository]),qn=(0,C.useCallback)((()=>{ht("review"),(0,S.sx)("cli.review.enter")}),[ht]);(0,C.useEffect)((()=>{Mt&&Bn?((0,ne.debugLogJSON)("Setting background review changes",Bn),Ct(Bn)):Ct([])}),[Mt,Bn]);const Hn=(0,C.useMemo)((()=>{if(!Mt)return!1;const e=(()=>{const e=Dn.bubbles;for(let t=e.length-1;t>=0;t--){const n=e[t];if("thinking"===n.type)return!n.isDone}return!1})(),t=(()=>{const e=Dn.bubbles;for(let t=e.length-1;t>=0;t--){const n=e[t];if("text"===n.type)return n}})();return e||t&&!t.isDone||_n===k.R6p.RUNNING||_n===k.R6p.CREATING}),[Mt,Dn.bubbles,_n]);return ee?(0,r.jsx)(T.I,{clearScreenTrigger:at,clearOnMount:!0,children:(0,r.jsx)(D.a,{onClose:()=>{pt((()=>te(!1)))}})}):(0,r.jsxs)(T.I,{clearScreenTrigger:at,clearOnMount:!1,children:[!it&&!At&&!Dt&&!Vt&&!Wt&&!Kt&&"review"===l&&(0,r.jsx)(_.Z,{fileChangeTracker:e.fileChangeTracker,changes:Mt?kt:A,onExit:()=>{ht("chat")},onSubmitPrompt:e=>{kn(e)},initialSelectedIndex:(0,p.b)(J,A),isGenerating:Mt?Hn:void 0}),!it&&At&&!Dt&&!Vt&&!Wt&&!Kt&&(0,r.jsx)(U.W,{client:e.backgroundComposerClient,onClose:()=>{pt((()=>{It(!1)}))},onSelectBackground:t=>{e.isRepository?pt((()=>{It(!1),Tt(t),e.agentStore.setMetadata("mode","background")})):pt((()=>{It(!1)}))},onSelectChat:e=>{M("chat"),It(!1),Tt(null),pt((()=>{})).then((()=>$n(e)))}}),!it&&Dt&&!("skills"===Pt&&"list"===Rt)&&(0,r.jsx)(R.g,{mode:Pt,viewState:Rt,onViewStateChange:Ot,viewingItemPath:null!=Yt?Yt:void 0,onViewingItemPathChange:zt,editContent:Nt,onEditContentChange:Ft,onClose:Ht,onSelect:"skills"===Pt?Cn:void 0}),!it&&Vt&&!Dt&&(0,r.jsx)(q.z,{dailyMetrics:en,onClose:()=>{pt((()=>{Zt(!1)}))}}),!it&&Wt&&(0,r.jsx)(O.g,{ctx:e.ctx,mcpLoader:e.mcpLoader,disabledStore:e.disabledStore,onClose:()=>{pt((()=>{Gt(!1)}))}}),!it&&Kt&&(0,r.jsx)(N.J,{configProvider:e.configProvider,onClose:()=>{pt((()=>{Qt(!1)}))}}),!it&&!At&&!Dt&&!Vt&&!Wt&&!Kt&&"chat"===l&&Mt&&(0,r.jsx)(E.y,{bcId:Mt,isAttached:Yn,backgroundComposerClient:e.backgroundComposerClient,isRepository:e.isRepository,debugInfo:e.debugInfo,modelManager:e.modelManager,responses:Dn,status:_n,isLoadingConversation:zn,addOptimisticFollowup:Ln,removeOptimisticFollowup:Rn,modelDetails:On,repoUrl:Nn,branchName:Fn,onRequestReview:()=>{ht("review"),(0,S.sx)("cli.review.enter")},changes:kt,isLoadingDiffs:Pn,onOpenComposerPicker:()=>It(!0),onSwitchComposer:t=>{(0,T.m)(dt),Tt(t),e.agentStore.setMetadata("mode","background")}}),!it&&!At&&(!Dt||"skills"===Pt&&"list"===Rt)&&!Vt&&!Wt&&!Kt&&!Mt&&"chat"===l&&(0,r.jsx)(Te,Object.assign({},e,{uiConversationState:J,onRequestReviewMode:qn,onOpenBackgroundPicker:Un,onOpenRulesPager:Bt,onOpenCommandsPager:Ut,onOpenUsagePager:nn,onOpenSkillsPager:qt,onOpenMcpPager:Xt,onOpenSandboxPager:Jt,isOverlayActive:pn.isActive,isProcessing:!!st,isSendingToBackground:an,isTransferring:cn,transferStatus:dn,sendMessage:kn,sendShellCommand:t=>Ce(void 0,void 0,void 0,(function*(){const n={stack:[],error:void 0,hasError:!1};try{const o=Se(n,(0,h.VI)(e.ctx.withName("chat.shell")),!1).ctx,r=crypto.randomUUID(),s=new f.ShellCommandAction({shellCommand:new f.ShellCommand({command:t}),execId:r});Z((e=>(0,p.Yb)(e,t))),yield wn(o,new f.ConversationAction({action:{case:"shellCommandAction",value:s}}))}catch(e){n.error=e,n.hasError=!0}finally{Ee(n)}})),executePlan:()=>Ce(void 0,void 0,void 0,(function*(){const t={stack:[],error:void 0,hasError:!1};try{const n=Se(t,(0,h.VI)(e.ctx.withName("chat.execute-plan")),!1).ctx,o=`turn-${Date.now()}`;Qe.current=o,Ke.startTurn(o),Z((e=>(0,p.ti)(e)));const r=new f.ConversationAction({action:{case:"executePlanAction",value:new f.ExecutePlanAction({executionMode:f.AgentMode.AGENT})}}),s="plan"===Je.current?"default":Je.current;L.setMetadata("mode",s),yield wn(n,r)}catch(e){t.error=e,t.hasError=!0}finally{Ee(t)}})),isSuggestingPlan:(0,p.OE)(J),planDecisionIndex:null!==(n=(0,p.II)(J))&&void 0!==n?n:0,setPlanDecisionIndex:e=>Z((0,p.k4)(J,e)),onAbort:()=>{cn&&ln(),qe.current&&qe.current.abort("user_cancelled")},isGenerating:St,unshownTokenEstimate:J.liveTokens,onResumeChat:$n,onNewChat:()=>Ce(void 0,void 0,void 0,(function*(){yield Sn(),yield L.dispose(),pe.d.clearLastRequest();const t=(0,ue.r)(),n=(0,s.randomUUID)(),o=a().join(t,n),r=a().join(o,"store.db"),i=new he.M(r);i.set("agentId",n);const l=new u.pH(i,i);yield En(l,{loadFromDb:!1});const c=l.getMetadata("lastUsedModel");return yield e.modelManager.setModelFromStoredId(c,e.configProvider),et.current=0,tt.current=(0,s.randomUUID)(),yield pt((()=>{})),n})),getChatId:()=>L.getId(),onImagesUpdated:e=>xt(e),isResumingChat:bt,onSummarize:()=>Ce(void 0,void 0,void 0,(function*(){(0,ne.debugLog)("onSummarize"),F(!0);const t=e.ctx.withName("chat.summarize");yield wn(t,new f.ConversationAction({action:{case:"summarizeAction",value:new f.SummarizeAction}}))})),onTransferToCloud:hn,checkCloudAgentAccess:gn,onRejectPlan:()=>Z((e=>(0,p.bE)(e))),onDiscardPlan:()=>{Z((e=>(0,p.cp)(e)))},externalCursorToEndSignal:jt,askQuestionPrompt:Ze,switchModePrompt:Ve,onAskQuestionSelectionChange:vn,onAskQuestionSubmit:bn,onAskQuestionSkip:yn,onSwitchModeDecisionIndexChange:Le,onSwitchModeApprove:mn,onSwitchModeReject:fn,mcpLoader:e.mcpLoader,shellManager:e.shellManager,onSendQueuedNow:Mn,onCancelFirstQueued:Tn,onPopLastForEdit:An,onClearPoppedForEdit:In,slashCommands:Me,inputDisabled:Dt&&"skills"===Pt&&"list"===Rt})),!it&&Dt&&"skills"===Pt&&"list"===Rt&&(0,r.jsx)(R.g,{mode:Pt,viewState:Rt,onViewStateChange:Ot,viewingItemPath:null!=Yt?Yt:void 0,onViewingItemPathChange:zt,editContent:Nt,onEditContentChange:Ft,onClose:Ht,onSelect:Cn}),pn.element]})},Ie=e=>{var t,n;return(0,C.useEffect)((()=>()=>{process.stdout.write("[?25h")}),[]),(0,r.jsx)(X.t1,{configProvider:e.configProvider,children:(0,r.jsx)(Z.l,{configProvider:e.configProvider,children:(0,r.jsx)(J.rs,{children:(0,r.jsx)(K.E,{children:(0,r.jsx)(V.NP,{children:(0,r.jsx)(Q.S,{store:null!==(t=e.sudoPasswordStore)&&void 0!==t?t:null,children:(0,r.jsxs)(G.oG,{fileChangeTracker:e.fileChangeTracker,pendingDecisionStore:e.pendingDecisionStore,configProvider:e.configProvider,initialViewMode:"chat",initialAgentStore:e.agentStore,modelManager:e.modelManager,children:[(0,r.jsx)(F.t,{store:null!==(n=e.sudoPasswordStore)&&void 0!==n?n:null}),(0,r.jsx)(Ae,Object.assign({},e))]})})})})})})})};o()}catch(De){o(De)}}))},"./src/utils/auth-errors.ts":(e,t,n)=>{n.d(t,{hY:()=>i,lv:()=>l});var o=n("../../node_modules/.pnpm/@connectrpc+connect@1.6.1_patch_hash=a4b9a5e69295313832387f25b708426bcf53041a2f50bc7b95_a276813e7efa8e1efb8a7b0efc1d56a0/node_modules/@connectrpc/connect/dist/esm/connect-error.js"),r=n("../../node_modules/.pnpm/@connectrpc+connect@1.6.1_patch_hash=a4b9a5e69295313832387f25b708426bcf53041a2f50bc7b95_a276813e7efa8e1efb8a7b0efc1d56a0/node_modules/@connectrpc/connect/dist/esm/code.js"),s=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};class i extends Error{constructor(e="Your stored authentication is invalid. Please log in again.",t){super(e),this.cause=t,this.name="InvalidTokenError",Error.captureStackTrace&&Error.captureStackTrace(this,i)}}function l(e,t){return s(this,void 0,void 0,(function*(){if(function(e){if(e instanceof o.T)return e.code===r.C.Unauthenticated||e.code===r.C.PermissionDenied;if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("401")||t.includes("unauthorized")||t.includes("unauthenticated")||t.includes("authentication failed")||t.includes("invalid token")||t.includes("token expired")}return!1}(e)){try{yield t.clearAuthentication()}catch(e){}throw new i("Your stored authentication is invalid. Please log in again.",e)}throw e}))}},"./src/utils/characters.ts":(e,t,n)=>{function o(e){return e.replace(/\x1B(?:[@-Z\\-_]|\[[0-?]*[ -/]*[@-~]|\][^\u0007]*(?:\u0007|\x1b\\))/g,"")}function r(e){let t=String(null!=e?e:"");return t=o(t),t=t.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/g,""),t=t.replace(/[\u200B-\u200F\u202A-\u202E\u2060-\u206F\uFEFF]/g,""),t=function(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}(t),t.length>1e4&&(t=t.slice(0,1e4)),t}n.d(t,{aJ:()=>o,p3:()=>r})},"./src/utils/color-mixing.ts":(e,t,n)=>{n.d(t,{E2:()=>s,LQ:()=>a,LR:()=>c,Lh:()=>l,Ob:()=>i,PT:()=>r});var o=n("node:process");function r(){var e,t;const n=null!==(t=null===(e=null===o.stdout||void 0===o.stdout?void 0:o.stdout.getColorDepth)||void 0===e?void 0:e.call(o.stdout))&&void 0!==t?t:1;return n>=24?"truecolor":n>=8?"ansi256":n>=4?"basic":"none"}function s(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function i(e){const t=e=>{const t=Math.round(Math.max(0,Math.min(255,e))).toString(16);return 1===t.length?`0${t}`:t};return`#${t(e.r)}${t(e.g)}${t(e.b)}`}function l(e,t,n=.8){const o=1-n;return{r:Math.round(e.r*n+t.r*o),g:Math.round(e.g*n+t.g*o),b:Math.round(e.b*n+t.b*o)}}function a(e,t,n){return e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5)}function c(e){var t,n,o,r;if(e>=0&&e<=15)return null!==(t=["#000000","#800000","#008000","#808000","#000080","#800080","#008080","#c0c0c0","#808080","#ff0000","#00ff00","#ffff00","#0000ff","#ff00ff","#00ffff","#ffffff"][e])&&void 0!==t?t:"#000000";if(e>=16&&e<=231){const t=e-16,s=Math.floor(t/36),i=Math.floor(t%36/6),l=t%6,a=[0,95,135,175,215,255],c=null!==(n=a[s])&&void 0!==n?n:0,d=null!==(o=a[i])&&void 0!==o?o:0,u=null!==(r=a[l])&&void 0!==r?r:0,p=e=>e.toString(16).padStart(2,"0");return`#${p(c)}${p(d)}${p(u)}`}if(e>=232&&e<=255){const t=8+10*(e-232),n=Math.max(0,Math.min(255,t)),o=e=>e.toString(16).padStart(2,"0");return`#${o(n)}${o(n)}${o(n)}`}return"#808080"}},"./src/utils/diff-colors.ts":(e,t,n)=>{n.d(t,{U:()=>i,a:()=>s});var o=n("./src/constants.ts"),r=n("./src/utils/color-mixing.ts");function s(e){if("truecolor"===(0,r.PT)())return e?o.iP:o.eh;const t=e?o.Xh:o.XM;return{addHex:(0,r.LR)(t.add),removeHex:(0,r.LR)(t.remove)}}function i(e){return e&&0!==e.length?"+"!==e[0]||e.startsWith("+++")?"-"!==e[0]||e.startsWith("---")?"other":"removed":"added":"other"}},"./src/utils/diff-sequences.ts":(e,t,n)=>{n.d(t,{A:()=>g});const o="@jest/diff-sequences",r=0,s=(e,t,n,o,r)=>{let s=0;for(;e<t&&n<o&&r(e,n);)e+=1,n+=1,s+=1;return s},i=(e,t,n,o,r)=>{let s=0;for(;e<=t&&n<=o&&r(t,o);)t-=1,o-=1,s+=1;return s},l=(e,t,n,o,r,i,l)=>{let a=0,c=-e,d=i[a],u=d;i[a]+=s(d+1,t,o+d-c+1,n,r);const p=Math.min(e,l);for(a+=1,c+=2;a<=p;a+=1,c+=2){if(a!==e&&u<i[a])d=i[a];else if(d=u+1,t<=d)return a-1;u=i[a],i[a]=d+s(d+1,t,o+d-c+1,n,r)}return l},a=(e,t,n,o,r,s,l)=>{let a=0,c=e,d=s[a],u=d;s[a]-=i(t,d-1,n,o+d-c-1,r);const p=Math.min(e,l);for(a+=1,c-=2;a<=p;a+=1,c-=2){if(a!==e&&s[a]<u)d=s[a];else if(d=u-1,d<t)return a-1;u=s[a],s[a]=d-i(t,d-1,n,o+d-c-1,r)}return l},c=(e,t,n,o,l,a,c,d,u,p,h)=>{const g=o-t,m=l-o-(n-t),f=-m-(e-1),v=e-1-m;let x=r;const b=Math.min(e,d);for(let r=0,d=-e;r<=b;r+=1,d+=2){const b=0===r||r!==e&&x<c[r],y=b?c[r]:x,j=b?y:y+1,w=g+j-d,k=s(j+1,n,w+1,l,a),C=j+k;if(x=c[r],c[r]=C,f<=d&&d<=v){const r=(e-1-(d+m))/2;if(r<=p&&u[r]-1<=C){const r=g+y-(b?d+1:d-1),s=i(t,y,o,r,a),c=y-s+1,u=r-s+1;h.nChangePreceding=e-1,e-1==c+u-t-o?(h.aEndPreceding=t,h.bEndPreceding=o):(h.aEndPreceding=c,h.bEndPreceding=u),h.nCommonPreceding=s,0!==s&&(h.aCommonPreceding=c,h.bCommonPreceding=u),h.nCommonFollowing=k,0!==k&&(h.aCommonFollowing=j+1,h.bCommonFollowing=w+1);const p=C+1,m=w+k+1;return h.nChangeFollowing=e-1,e-1==n+l-p-m?(h.aStartFollowing=n,h.bStartFollowing=l):(h.aStartFollowing=p,h.bStartFollowing=m),!0}}}return!1},d=(e,t,n,o,l,a,c,d,u,p,h)=>{const g=l-n,m=l-o-(n-t),f=m-e,v=m+e;let x=r;const b=Math.min(e,p);for(let r=0,p=e;r<=b;r+=1,p-=2){const b=0===r||r!==e&&u[r]<x,y=b?u[r]:x,j=b?y:y-1,w=g+j-p,k=i(t,j-1,o,w-1,a),C=j-k;if(x=u[r],u[r]=C,f<=p&&p<=v){const r=(e+(p-m))/2;if(r<=d&&C-1<=c[r]){const r=w-k;if(h.nChangePreceding=e,e===C+r-t-o?(h.aEndPreceding=t,h.bEndPreceding=o):(h.aEndPreceding=C,h.bEndPreceding=r),h.nCommonPreceding=k,0!==k&&(h.aCommonPreceding=C,h.bCommonPreceding=r),h.nChangeFollowing=e-1,1===e)h.nCommonFollowing=0,h.aStartFollowing=n,h.bStartFollowing=l;else{const t=g+y-(b?p-1:p+1),o=s(y,n,t,l,a);h.nCommonFollowing=o,0!==o&&(h.aCommonFollowing=y,h.bCommonFollowing=t);const r=y+o,i=t+o;e-1==n+l-r-i?(h.aStartFollowing=n,h.bStartFollowing=l):(h.aStartFollowing=r,h.bStartFollowing=i)}return!0}}}return!1},u=(e,t,n,r,s,i,p,h,g,m)=>{if(s-r<n-t){if((i=!i)&&1===p.length){const{foundSubsequence:e,isCommon:t}=p[0];p[1]={foundSubsequence:(t,n,o)=>{e(t,o,n)},isCommon:(e,n)=>t(n,e)}}const e=t,o=n;t=r,n=s,r=e,s=o}const{foundSubsequence:f,isCommon:v}=p[i?1:0];((e,t,n,r,s,i,u,p,h)=>{const g=r-t,m=s-n,f=n-t,v=s-r,x=v-f;let b=f,y=f;if(u[0]=t-1,p[0]=n,x%2==0){const o=(e||x)/2,c=(f+v)/2;for(let e=1;e<=c;e+=1)if(b=l(e,n,s,g,i,u,b),e<o)y=a(e,t,r,m,i,p,y);else if(d(e,t,n,r,s,i,u,b,p,y,h))return}else{const o=((e||x)+1)/2,d=(f+v+1)/2;let j=1;for(b=l(j,n,s,g,i,u,b),j+=1;j<=d;j+=1)if(y=a(j-1,t,r,m,i,p,y),j<o)b=l(j,n,s,g,i,u,b);else if(c(j,t,n,r,s,i,u,b,p,y,h))return}throw new Error(`${o}: no overlap aStart=${t} aEnd=${n} bStart=${r} bEnd=${s}`)})(e,t,n,r,s,v,h,g,m);const{nChangePreceding:x,aEndPreceding:b,bEndPreceding:y,nCommonPreceding:j,aCommonPreceding:w,bCommonPreceding:k,nCommonFollowing:C,aCommonFollowing:S,bCommonFollowing:E,nChangeFollowing:$,aStartFollowing:M,bStartFollowing:T}=m;t<b&&r<y&&u(x,t,b,r,y,i,p,h,g,m),0!==j&&f(j,w,k),0!==C&&f(C,S,E),M<n&&T<s&&u($,M,n,T,s,i,p,h,g,m)},p=(e,t)=>{if("number"!=typeof t)throw new TypeError(`${o}: ${e} typeof ${typeof t} is not a number`);if(!Number.isSafeInteger(t))throw new RangeError(`${o}: ${e} value ${t} is not a safe integer`);if(t<0)throw new RangeError(`${o}: ${e} value ${t} is a negative integer`)},h=(e,t)=>{const n=typeof t;if("function"!==n)throw new TypeError(`${o}: ${e} typeof ${n} is not a function`)};function g(e,t,n,o){p("aLength",e),p("bLength",t),h("isCommon",n),h("foundSubsequence",o);const l=s(0,e,0,t,n);if(0!==l&&o(l,0,0),e!==l||t!==l){const s=l,a=l,c=i(s,e-1,a,t-1,n),d=e-c,p=t-c,h=l+c;e!==h&&t!==h&&u(0,s,d,a,p,!1,[{foundSubsequence:o,isCommon:n}],[r],[r],{aCommonFollowing:r,aCommonPreceding:r,aEndPreceding:r,aStartFollowing:r,bCommonFollowing:r,bCommonPreceding:r,bEndPreceding:r,bStartFollowing:r,nChangeFollowing:r,nChangePreceding:r,nCommonFollowing:r,nCommonPreceding:r}),0!==c&&o(c,d,p)}}},"./src/utils/fuzzy.ts":(e,t,n)=>{function o(e,t){var n,o;const r=e.toLowerCase(),s=t.toLowerCase();if(0===s.length)return 1;let i=0,l=0,a=0,c=-1;for(let t=0;t<s.length;t++){const d=s[t];let u=!1;for(let t=l;t<r.length;t++)if(r[t]===d){u=!0,l=t+1,c>=0&&t===c+1?(a++,i+=15*a):a=1,0===t&&(i+=30);const r=e[t-1];t>0&&("/"===r||"-"===r||"_"===r||"."===r||" "===r)&&(i+=25);const s=t>0&&/[a-z]/.test(null!==(n=e[t-1])&&void 0!==n?n:""),d=/[A-Z]/.test(null!==(o=e[t])&&void 0!==o?o:"");s&&d&&(i+=20),c>=0&&(i-=2*(t-c-1)),c=t;break}if(!u)return 0}return i+=Math.max(0,50-e.length),r===s&&(i+=100),i}n.d(t,{dt:()=>o})},"./src/utils/git-diffs.ts":(e,t,n)=>{n.r(t),n.d(t,{buildFileChanges:()=>f,buildUnifiedDiff:()=>d,collectGitStatuses:()=>m});var o=n("node:child_process"),r=n("node:fs"),s=n.n(r),i=n("node:os"),l=n.n(i),a=n("node:path"),c=n.n(a);const d=e=>{const t=s().mkdtempSync(c().join(l().tmpdir(),"delta-full-")),n=c().join(t,"before"),r=c().join(t,"after");s().mkdirSync(n,{recursive:!0}),s().mkdirSync(r,{recursive:!0});const i=(e,t,n)=>{const o=c().join(e,t);s().mkdirSync(c().dirname(o),{recursive:!0}),s().writeFileSync(o,n)};for(const t of e){const e=c().isAbsolute(t.path)?c().relative(process.cwd(),t.path):t.path;void 0!==t.before&&i(n,e,t.before),void 0!==t.after&&i(r,e,t.after)}const a=["diff","--no-index","--no-prefix","--diff-algorithm=patience","--unified=3","--","before","after"];let d="";try{d=(0,o.execFileSync)("git",a,{encoding:"utf8",cwd:t})}catch(e){const t=e;if(!(null==t?void 0:t.stdout))throw e;d=t.stdout}const u=(e=>{const t=c().join(n,""),o=c().join(r,"");let s=e.split(t).join("").split(o).join("");const i=c().join("before",""),l=c().join("after","");return s=s.split(i).join("").split(l).join(""),s})(d);return s().rmSync(t,{recursive:!0,force:!0}),u};function u(e){return(0,o.execFileSync)("git",e,{encoding:"utf8"}).trim()}function p(e){try{return(0,o.execFileSync)("git",["show",`HEAD:${e}`],{encoding:"utf8"})}catch(e){return}}let h=null;function g(e){const t=h||(h=u(["rev-parse","--show-toplevel"]),h),n=c().isAbsolute(e)?e:c().join(t,e);try{return(0,r.readFileSync)(n,"utf8")}catch(e){return""}}function m(){const e=u(["diff","--name-status","HEAD"]),t=(""===e?[]:e.split("\n")).filter(Boolean).map((e=>{var t,n,o,r,s;const i=e.split("\t"),l=(null!==(t=i[0])&&void 0!==t?t:"")[0];if("R"===l||"C"===l){const e=null!==(n=i[1])&&void 0!==n?n:"";return{code:l,path:null!==(o=i[2])&&void 0!==o?o:e,oldPath:e}}return{code:l,path:null!==(s=null!==(r=i[1])&&void 0!==r?r:i[0])&&void 0!==s?s:""}})),n=u(["ls-files","--others","--exclude-standard"]),o=""===n?[]:n.split("\n");for(const e of o)e&&t.push({code:"A",path:e});return t}function f(e){var t,n,o;const r=[];for(const s of e)if(s.path)switch(s.code){case"A":{const e=g(s.path);r.push({path:s.path,before:void 0,after:e});break}case"M":{const e=null!==(t=p(s.path))&&void 0!==t?t:"",n=g(s.path);r.push({path:s.path,before:e,after:n});break}case"D":{const e=null!==(n=p(s.path))&&void 0!==n?n:"";r.push({path:s.path,before:e,after:void 0});break}case"R":{const e=s.oldPath&&null!==(o=p(s.oldPath))&&void 0!==o?o:"",t=g(s.path);r.push({path:s.path,before:e,after:t});break}}return r}},"./src/utils/inline-diff.ts":(e,t,n)=>{n.d(t,{U:()=>l,f:()=>a});var o=n("./src/utils/diff-sequences.ts");function r(e){const t=[],n=/(\S+|\s+)/g;for(const o of e.matchAll(n))t.push({text:o[0],start:o.index,end:o.index+o[0].length});return t}function s(e,t){var n,o;if(0===e.length&&0===t.length)return 1;if(0===e.length||0===t.length)return 0;const r=Math.min(e.length,t.length)/Math.max(e.length,t.length);if(r<.3)return r;const s=new Map;for(const t of e)s.set(t,(null!==(n=s.get(t))&&void 0!==n?n:0)+1);let i=0;for(const e of t){const t=null!==(o=s.get(e))&&void 0!==o?o:0;t>0&&(i++,s.set(e,t-1))}return 2*i/(e.length+t.length)}function i(e,t=0){if(0===e.length)return[];const n=[];let o=Object.assign({},e[0]);for(let r=1;r<e.length;r++){const s=e[r];s.start<=o.end+t?o.end=Math.max(o.end,s.end):(n.push(o),o=Object.assign({},s))}return n.push(o),n}function l(e,t,n=.25){if(e===t)return{before:[],after:[]};if(0===e.length||0===t.length)return{before:[],after:[]};if(s(e,t)<n)return{before:[],after:[]};const l=r(e),a=r(t),c=new Array(l.length).fill(!0),d=new Array(a.length).fill(!0);(0,o.A)(l.length,a.length,((e,t)=>l[e].text===a[t].text),((e,t,n)=>{for(let o=0;o<e;o++)c[t+o]=!1,d[n+o]=!1}));const u=[],p=[];let h=0;for(let e=0;e<l.length;e++)if(c[e]){const t=l[e];u.push({start:t.start,end:t.end}),h+=t.end-t.start}let g=0;for(let e=0;e<a.length;e++)if(d[e]){const t=a[e];p.push({start:t.start,end:t.end}),g+=t.end-t.start}const m=e.length>0?h/e.length:0,f=t.length>0?g/t.length:0;return m>.5||f>.5?{before:[],after:[]}:{before:i(u,0),after:i(p,0)}}function a(e){const t=[];let n=0;for(;n<e.length;){if("common"===e[n].type||"gap"===e[n].type){n++;continue}const o=[];for(;n<e.length&&"removed"===e[n].type;)o.push(n),n++;const r=[];for(;n<e.length&&"added"===e[n].type;)r.push(n),n++;if(0!==o.length&&0!==r.length)if(o.length===r.length)for(let e=0;e<o.length;e++)t.push({removedIdx:o[e],addedIdx:r[e]});else{const n=new Set;for(const i of o){let o=-1,l=0;for(const t of r){if(n.has(t))continue;const r=s(e[i].content,e[t].content);r>l&&(l=r,o=t)}-1!==o&&l>.25&&(t.push({removedIdx:i,addedIdx:o}),n.add(o))}}}return t}},"./src/utils/oauth-callback.ts":(e,t,n)=>{n.d(t,{T5:()=>c,Yt:()=>l,u1:()=>a});var o=n("node:http"),r=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const s=8787,i="/callback",l=`http://localhost:${s}${i}`;function a(e){if(e&&"object"==typeof e&&"message"in e){const t=e.message;if("string"==typeof t&&t.length>0)return t}if("string"==typeof e&&e.length>0)return e;try{return JSON.stringify(e)}catch(e){return"Unknown error"}}function c(){return r(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=(0,o.createServer)(((o,r)=>{if(!o.url)return r.statusCode=400,void r.end("Bad request");const l=new URL(o.url,`http://localhost:${s}`);if(l.pathname!==i)return r.statusCode=404,void r.end("Not found");const a=l.searchParams.get("code"),c=l.searchParams.get("error");a?(r.statusCode=200,r.setHeader("Content-Type","text/html"),r.end("<html><body><h1>Authorized</h1>You can close this window.</body></html>"),e(a),setTimeout((()=>n.close()),1e3)):(r.statusCode=400,r.end(`Auth failed: ${null!=c?c:"No code"}`),t(new Error(null!=c?c:"No authorization code provided")),setTimeout((()=>n.close()),1e3))}));n.listen(s,(()=>{}))}))}))}},"./src/utils/output-format.ts":(e,t,n)=>{n.d(t,{nt:()=>r});const o=["text","json","stream-json"];function r(e){if(null==e)return"text";if(function(e){return"string"==typeof e&&o.includes(e)}(e))return e;const t=o.join(", ");throw new Error(`Invalid --output-format. Allowed values: ${t}`)}},"./src/utils/path-utils.ts":(e,t,n)=>{n.d(t,{Kr:()=>u,RZ:()=>p,fw:()=>c,me:()=>h,rR:()=>g,tk:()=>d});var o=n("node:fs"),r=n.n(o),s=n("node:path"),i=n.n(s),l=n("../utils/dist/index.js"),a=n("./src/constants.ts");function c(e){const t=process.cwd(),n=(0,s.relative)(t,e);return n.startsWith("..")||(0,s.isAbsolute)(n)?e:""===n?".":n}function d(e,t){if(e.length<=t)return e;const n="...",o=t-3,r=e.split(/[\\/]/);if(r.length<=2)return e.length>t?e.substring(0,t-3)+n:e;const s=Math.floor(.4*o),l=o-s,a=[];let c=0;for(let e=0;e<r.length-1;e++){const t=r[e],n=t.length+(a.length>0?1:0);if(!(c+n<=s))break;a.push(t),c+=n}const d=[];let u=0;for(let e=r.length-1;e>=0;e--){const t=r[e],n=t.length+(d.length>0?1:0);if(!(u+n<=l))break;d.unshift(t),u+=n}if(0===a.length&&d.length>0)return n+i().sep+d.join(i().sep);const p=a.join(i().sep),h=d.join(i().sep);return p&&h?p+i().sep+n+i().sep+h:p?p+i().sep+n:h?n+i().sep+h:n}function u(e,t=a.rY){return(0,l.JD)(e)?"tool output":function(e,t=25){return t<=0?"":e.length<=t?e:t<=3?e.slice(-t):`...${e.slice(-(t-3))}`}(c(e||""),t)}function p(e,t,n={}){var o,r;const s=null!==(o=n.ellipsis)&&void 0!==o?o:"â‹¯";if(t<=0)return"";if(e.length<=t)return e;const l=e.split(i().sep);if(0===l.length)return e.slice(-t);const a=`${s}${i().sep}`,c=e=>{const t=l.slice(l.length-e).join(i().sep);return((e<l.length?a:"")+t).length};let d=1,u=Math.max(1,l.length),p=1;for(;d<=u;){const e=Math.floor((d+u)/2);c(e)<=t?(p=e,d=e+1):u=e-1}const h=p<l.length,g=l.slice(l.length-p),m=(h?a:"")+g.join(i().sep);if(m.length<=t)return m;const f=g.length-1,v=null!==(r=g[f])&&void 0!==r?r:"",x=(h?a:"")+g.slice(0,Math.max(0,f)).join(i().sep),b=x.length>0?x+(x.endsWith(i().sep)?"":i().sep):h?a:"",y=Math.max(0,t-b.length);return y<=0?(h?s:"").slice(0,t):b+(v.length<=y?v:v.slice(-y))}function h(e,t){if("number"==typeof e){const n=Math.max(1,e+1);return"number"==typeof t&&t>0?1===t?`line ${n}`:`lines ${n}-${n+t-1}`:`line ${n}`}}function g(e){let t=e;for(;t!==i().parse(t).root;){const e=i().join(t,".git");if(r().existsSync(e))return e;t=i().dirname(t)}const n=i().join(t,".git");return r().existsSync(n)?n:null}},"./src/utils/plan-utils.ts":(e,t,n)=>{n.d(t,{IB:()=>d});var o=n("node:fs"),r=n("node:fs/promises"),s=n("node:os"),i=n("node:path"),l=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}function c(e){const t=[];if(t.push(`  - id: "${a(e.id)}"`),t.push(`    content: "${a(e.content)}"`),t.push("    status: pending"),e.dependencies&&e.dependencies.length>0){t.push("    dependencies:");for(const n of e.dependencies)t.push(`      - "${a(n)}"`)}return t}function d(e){return l(this,void 0,void 0,(function*(){const{args:t,workspaceRoot:n,conversationId:d}=e,{plansDir:u}=yield function(e){return l(this,void 0,void 0,(function*(){const t=void 0===e,n=null!=e?e:(0,s.homedir)(),a=(0,i.join)(n,".cursor"),c=(0,i.join)(a,"plans");return(0,o.existsSync)(a)||(yield(0,r.mkdir)(a,{recursive:!0})),t||(yield function(e){return l(this,void 0,void 0,(function*(){const t=(0,i.join)(e,".gitignore");try{let e="";if((0,o.existsSync)(t)&&(e=yield(0,r.readFile)(t,"utf-8")),!e.includes("plans/")){const n=e.trim()+(e.trim()?"\n":"")+"plans/\n";yield(0,r.writeFile)(t,n,"utf-8")}}catch(e){}}))}(a)),(0,o.existsSync)(c)||(yield(0,r.mkdir)(c,{recursive:!0})),{plansDir:c,isUserDir:t}}))}(n),p=function(e,t){return`${e.replace(/[^a-zA-Z0-9-_ ]/g,"").trim().substring(0,50)||"Plan"}-${t.substring(0,8)}.plan.md`}(t.name||function(e){const t=e.match(/^#\s+(.+)$/m);if(t)return t[1].trim().substring(0,50);const n=e.split("\n");for(const e of n){const t=e.trim();if(t&&!t.startsWith("#"))return t.substring(0,50)}return"Plan"}(t.plan),d),h=(0,i.join)(u,p),g=(0,o.existsSync)(h),m=function(e,t){var n;const o=[];o.push(`\x3c!-- ${t} --\x3e`);const r=!!(e.todos&&e.todos.length>0),s=!0===e.isProject,i=!!(s&&e.phases&&e.phases.length>0);if(r||i||s){if(o.push("---"),r){o.push("todos:");for(const t of e.todos)o.push(...c(t))}if(o.push(`isProject: ${s}`),i&&e.phases){o.push("phases:");for(const t of e.phases)if(o.push(`  - name: "${a(null!==(n=t.name)&&void 0!==n?n:"")}"`),o.push("    todos:"),t.todos&&t.todos.length>0)for(const e of t.todos)for(const t of c(e))o.push(`    ${t}`)}o.push("---")}return o.push(e.plan),o.join("\n")}(t,d);return yield(0,r.writeFile)(h,m,"utf-8"),{planUri:`file://${h}`,created:!g}}))}},"./src/utils/prompt-utils.ts":(e,t,n)=>{n.d(t,{C:()=>r});var o=n("./src/utils/path-utils.ts");function r(e,t,n){const r=t.trim();return r?`For ${(0,o.fw)(e)}${n&&null!=n.startLine&&null!=n.endLine?` (lines ${n.startLine}-${n.endLine})`:""}:\n${r}`:""}},"./src/utils/task-tool.ts":(e,t,n)=>{function o(e){var t;if(e&&0!==e.length)for(let n=e.length-1;n>=0;n-=1){const o=e[n];if("assistantMessage"===(null===(t=o.message)||void 0===t?void 0:t.case)){const e=o.message.value.text;if(e&&e.trim().length>0)return e}}}function r(e){var t;const n=null==e?void 0:e.type,o=null==n?void 0:n.case;switch(o){case void 0:return;case"custom":{const e=null!==(t=null==n?void 0:n.value)&&void 0!==t?t:void 0,o=null==e?void 0:e.name;return o&&o.trim().length>0?o.trim():"custom"}case"unspecified":return"general-purpose";case"computerUse":return"computer-use";case"explore":return"explore";case"shell":case"bash":return"shell";case"mediaReview":return"media-review";case"browserUse":return"browser-use";case"vmSetupHelper":return"vm-setup-helper";case"debug":return"debug";default:return o}}function s(e){if(void 0===e)return;const t=Number(e);if(!Number.isFinite(t)||t<0)return;if(t<1e3)return`${t}ms`;const n=t/1e3;return n>=10?`${Math.round(n)}s`:`${n.toFixed(1)}s`}n.d(t,{Nc:()=>r,Uk:()=>o,uH:()=>s})},"./src/utils/terminal-title.ts":(e,t,n)=>{n.d(t,{Bp:()=>i,cu:()=>l,iq:()=>s});const o="Cursor Agent",r="New Agent";function s(e){return"string"==typeof e&&0!==e.trim().length&&e.trim()!==r}function i(e){if(!process.stdout.isTTY)return;const t="string"==typeof e&&e.trim().length>0?e.trim():o;try{process.stdout.write(`]0;${t}`)}catch(e){}}function l(){i(o)}},"./src/utils/text-wrapping.ts":(e,t,n)=>{function o(e,t){const n=[];if(t<=0)return[""];const o=e.split(/\s+/).filter((e=>e.length>0));let r="";const s=()=>{n.push(r),r=""},i=e=>{for(let o=0;o<e.length;o+=t){const i=e.slice(o,o+t);i.length===t?n.push(i):0===r.length?r=i:r.length+1+i.length<=t?r=`${r} ${i}`:(s(),r=i)}};for(const e of o)e.length>t?(r.length>0&&s(),i(e)):0===r.length?r=e:r.length+1+e.length<=t?r=`${r} ${e}`:(s(),r=e);return r.length>0&&n.push(r),0===n.length&&n.push(""),n}function r(e,t,n){var r,s,i;if(t<=0||n<=0)return"";const l=e.replaceAll("\r\n","\n").split("\n"),a=[];for(let e=0;e<l.length;e+=1){const i=null!==(r=l[e])&&void 0!==r?r:"",c=i.match(/^[ \t]+/),d=null!==(s=null==c?void 0:c[0])&&void 0!==s?s:"",u=i.slice(d.length),p=Math.max(0,n-d.length);if(p<=0){if(a.push(d.slice(0,n)),a.length>=t+1)break;continue}const h=o(u,p);for(const e of h){const n=`${d}${e}`;if(a.push(n),a.length>=t+1)break}if(a.length>=t+1)break}if(a.length<=t)return a.join("\n");const c=a.slice(0,t),d=t-1,u=null!==(i=c[d])&&void 0!==i?i:"";return u.length>=n?c[d]=`${u.slice(0,Math.max(0,n-1))}â€¦`:c[d]=`${u}â€¦`,c.join("\n")}n.d(t,{F:()=>r,G:()=>o})},"./src/utils/tokens.ts":(e,t,n)=>{function o(e,t){var n,o;if(null==e)return null;const r=Math.floor(e);if(!(r>0))return null;const s=null!==(n=null==t?void 0:t.shortThreshold)&&void 0!==n?n:1e3,i=null!==(o=null==t?void 0:t.decimals)&&void 0!==o?o:2,l=e=>e.replace(/\.0+$|(?<=\.[0-9]*?)0+$/g,"").replace(/\.$/,""),a=(e,t)=>{if(t<=0)return Math.floor(e);const n=Math.pow(10,t);return Math.floor(e*n)/n};let c;return c=r>=1e6&&r>=s?`${l(a(r/1e6,i).toFixed(i))}M`:r>=1e3&&r>=s?`${l(a(r/1e3,i).toFixed(i))}k`:String(r),`${c} ${1===r?"token":"tokens"}`}n.d(t,{a:()=>o})},"./src/utils/turn-file-tracker.ts":(e,t,n)=>{n.d(t,{k:()=>o});class o{constructor(e){this.fileChangeTracker=e,this.turnStartSnapshots=new Map}startTurn(e){this.turnStartSnapshots.set(e,[...this.fileChangeTracker.getChanges()])}getTurnChanges(e){const t=this.turnStartSnapshots.get(e);if(!t)return[];const n=this.fileChangeTracker.getChanges(),o=(new Set(t.map((e=>e.path))),[]);for(const e of n){const n=t.find((t=>t.path===e.path));n?n.after!==e.after&&o.push({path:e.path,before:n.after,after:e.after}):o.push(e)}return o}finalizeTurn(e){const t=this.getTurnChanges(e);return this.turnStartSnapshots.delete(e),t}cleanup(){this.turnStartSnapshots.clear()}}},"./src/utils/url-utils.ts":(e,t,n)=>{function o(e){var t;try{let t=e;return e.includes("://")||(t=`https://${e}`),new URL(t).hostname}catch(n){const o=e.match(/(?:https?:\/\/)?([^/\s:]+)/);return null!==(t=null==o?void 0:o[1])&&void 0!==t?t:e}}n.d(t,{B:()=>o})},"./src/workspace/approval.tsx":(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{c:()=>b});var r=n("../../node_modules/.pnpm/react@19.2.3/node_modules/react/jsx-runtime.js"),s=n("node:fs"),i=n("node:fs/promises"),l=n("node:os"),a=n("node:path"),c=n("../cursor-config/dist/index.js"),d=n("../ink/build/index.js"),u=n("../utils/dist/index.js"),p=n("./src/components/approval-dialog.tsx"),h=n("./src/debug.ts"),g=n("./src/mcp/approval.tsx"),m=n("./src/mcp/project-paths.ts"),f=e([d,p,g]);[d,p,g]=f.then?(await f)():f;var v=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function l(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((o=o.apply(e,t||[])).next())}))};const y=".workspace-trusted";function x(e){const t=(0,a.resolve)(e),n=(0,l.homedir)(),o=t.split(a.sep).filter((e=>e.length>0));return!(t!==n&&!n.startsWith(t+a.sep))||o.length<3}function b(e){return v(this,void 0,void 0,(function*(){const t=null!=e?e:process.cwd(),n=(0,c.Xq)(t),o=(0,m.C)(t),l=(0,a.join)(n,y);if((0,s.existsSync)(l))return"already_approved";if(function(e){try{const t=(0,c.m4)();if(!(0,s.existsSync)(t))return!1;const n=new Set((0,s.readdirSync)(t));let o=(0,a.resolve)(e),r=(0,a.dirname)(o);for(;r!==o;){const e=(0,u.r_)(r);if(n.has(e)){const n=(0,a.join)(t,e),o=(0,a.join)(n,y);if((0,s.existsSync)(o)&&!x(r))return!0}o=r,r=(0,a.dirname)(o)}return!1}catch(e){return(0,h.debugLogJSON)("Failed to check parent approvals:",e instanceof Error?e.message:String(e)),!1}}(t))return"already_approved";const{servers:f}=yield(0,g.Vh)(o),b=Object.keys(f.mcpServers).length>0,j=[],w=[b?"Cursor Agent can execute code and access files in your workspace. You will also trust the MCP servers this workspace has enabled.":"Cursor Agent can execute code and access files in your workspace.","Do you want to mark this workspace as trusted?"];j.push({key:"a",label:"Trust this workspace",value:b?"approved_with_mcp":"approved"}),b&&j.push({key:"w",label:"Trust this workspace, but don't enable all MCP servers",value:"approved"}),j.push({key:"q",label:"Quit",value:"quit"});const k=yield(0,p.b)({title:"Workspace Trust Required",description:w,content:(0,r.jsx)(d.EY,{color:"cyan",bold:!0,children:t}),options:j,onAction:e=>v(this,void 0,void 0,(function*(){if("approved"===e||"approved_with_mcp"===e){try{yield(0,i.mkdir)(n,{recursive:!0});const e=(0,a.join)(n,y);yield(0,i.writeFile)(e,JSON.stringify({trustedAt:(new Date).toISOString(),workspacePath:t},null,2))}catch(e){(0,h.debugLogJSON)("Failed to create project directory or trust marker:",e instanceof Error?e.message:String(e))}if("approved_with_mcp"===e&&b)try{yield(0,g.Cz)(f,o)}catch(e){(0,h.debugLogJSON)("Failed to approve MCP servers:",e instanceof Error?e.message:String(e))}}}))});return k}))}o()}catch(j){o(j)}}))}};